import base64;exec base64.b64decode('IyAtKi0gY29kaW5nOiB1dGYtOCAtKi0KaW1wb3J0IHVybGxpYgppbXBvcnQgdXJsbGliMgppbXBvcnQgcmUKaW1wb3J0IG9zCmltcG9ydCB4Ym1jcGx1Z2luCmltcG9ydCB4Ym1jZ3VpCmltcG9ydCB4Ym1jYWRkb24KaW1wb3J0IHhibWN2ZnMKaW1wb3J0IHRyYWNlYmFjawppbXBvcnQgY29va2llbGliCmZyb20gQmVhdXRpZnVsU291cCBpbXBvcnQgQmVhdXRpZnVsU3RvbmVTb3VwLCBCZWF1dGlmdWxTb3VwLCBCZWF1dGlmdWxTT0FQCnRyeToKICAgIGZyb20geG1sLnNheC5zYXh1dGlscyBpbXBvcnQgZXNjYXBlCmV4Y2VwdDogdHJhY2ViYWNrLnByaW50X2V4YygpCnRyeToKICAgIGltcG9ydCBqc29uCmV4Y2VwdDoKICAgIGltcG9ydCBzaW1wbGVqc29uIGFzIGpzb24KaW1wb3J0IFNpbXBsZURvd25sb2FkZXIgYXMgZG93bmxvYWRlcgppbXBvcnQgdGltZQoKcmVzb2x2ZV91cmw9WycxODB1cGxvYWQuY29tJywgJ2FsbG15dmlkZW9zLm5ldCcsICdiZXN0cmVhbXMubmV0JywgJ2NsaWNrbnVwbG9hZC5jb20nLCAnY2xvdWR6aWxsYS50bycsICdtb3ZzaGFyZS5uZXQnLCAnbm92YW1vdi5jb20nLCAnbm93dmlkZW8uc3gnLCAndmlkZW93ZWVkLmVzJywgJ2RhY2xpcHMuaW4nLCAnZGF0ZW11bGUuY29tJywgJ2Zhc3R2aWRlby5pbicsICdmYXN0c3RyZWFtLmluJywgJ2ZpbGVob290LmNvbScsICdmaWxlbnVrZS5jb20nLCAnc2hhcmVzaXguY29tJywgJ2RvY3MuZ29vZ2xlLmNvbScsICdwbHVzLmdvb2dsZS5jb20nLCAncGljYXNhd2ViLmdvb2dsZS5jb20nLCAnZ29yaWxsYXZpZC5jb20nLCAnZ29yaWxsYXZpZC5pbicsICdncmlmdGhvc3QuY29tJywgJ2h1Z2VmaWxlcy5uZXQnLCAnaXBpdGhvcy50bycsICdpc2hhcmVkLmV1JywgJ2tpbmdmaWxlcy5uZXQnLCAnbWFpbC5ydScsICdteS5tYWlsLnJ1JywgJ3ZpZGVvYXBpLm15Lm1haWwucnUnLCAnbWlnaHR5dXBsb2FkLmNvbScsICdtb29zaGFyZS5iaXonLCAnbW92ZGl2eC5jb20nLCAnbW92cG9kLm5ldCcsICdtb3Zwb2QuaW4nLCAnbW92cmVlbC5jb20nLCAnbXJmaWxlLm1lJywgJ25vc3ZpZGVvLmNvbScsICdvcGVubG9hZC5pbycsICdwbGF5ZWQudG8nLCAnYml0c2hhcmUuY29tJywgJ2ZpbGVmYWN0b3J5LmNvbScsICdrMnMuY2MnLCAnb2Jvb20uY29tJywgJ3JhcGlkZ2F0b3IubmV0JywgJ3VwbG9hZGVkLm5ldCcsICdwcmltZXNoYXJlLnR2JywgJ2JpdHNoYXJlLmNvbScsICdmaWxlZmFjdG9yeS5jb20nLCAnazJzLmNjJywgJ29ib29tLmNvbScsICdyYXBpZGdhdG9yLm5ldCcsICd1cGxvYWRlZC5uZXQnLCAnc2hhcmVyZXBvLmNvbScsICdzdGFnZXZ1LmNvbScsICdzdHJlYW1jbG91ZC5ldScsICdzdHJlYW1pbi50bycsICd0aGVmaWxlLm1lJywgJ3RoZXZpZGVvLm1lJywgJ3R1c2ZpbGVzLm5ldCcsICd1cGxvYWRjLmNvbScsICd6YWxhYS5jb20nLCAndXBsb2Fkcm9ja2V0Lm5ldCcsICd1cHRvYm94LmNvbScsICd2LXZpZHMuY29tJywgJ3ZlZWhkLmNvbScsICd2aWRidWxsLmNvbScsICd2aWRlb21lZ2EudHYnLCAndmlkcGxheS5uZXQnLCAndmlkc3BvdC5uZXQnLCAndmlkdG8ubWUnLCAndmlkemkudHYnLCAndmltZW8uY29tJywgJ3ZrLmNvbScsICd2b2Rsb2NrZXIuY29tJywgJ3hmaWxlbG9hZC5jb20nLCAneHZpZHN0YWdlLmNvbScsICd6ZXR0YWhvc3QudHYnXQpnX2lnbm9yZVNldFJlc29sdmVkPVsncGx1Z2luLnZpZGVvLmRyYW1hc29ubGluZScsJ3BsdWdpbi52aWRlby5mNG1UZXN0ZXInLCdwbHVnaW4udmlkZW8uc2hhaGlkbWJjbmV0JywncGx1Z2luLnZpZGVvLlNwb3J0c0RldmlsJywncGx1Z2luLnN0cmVhbS52YXVnaG5saXZlLnR2JywncGx1Z2luLnZpZGVvLlplbVRWLXNoYW5pJ10KCmNsYXNzIE5vUmVkaXJlY3Rpb24odXJsbGliMi5IVFRQRXJyb3JQcm9jZXNzb3IpOgogICBkZWYgaHR0cF9yZXNwb25zZShzZWxmLCByZXF1ZXN0LCByZXNwb25zZSk6CiAgICAgICByZXR1cm4gcmVzcG9uc2UKICAgaHR0cHNfcmVzcG9uc2UgPSBodHRwX3Jlc3BvbnNlCiAgIApDSEJhc2UgPSAoJ2h0dHBzOi8vZ2hvc3RiaW4uY29tL3Bhc3RlLzM4cnZ0L3JhdycpCgpSRU1PVEVfREJHPUZhbHNlOwppZiBSRU1PVEVfREJHOgogICAgIyBNYWtlIHB5ZGV2IGRlYnVnZ2VyIHdvcmtzIGZvciBhdXRvIHJlbG9hZC4KICAgICMgTm90ZSBweWRldmQgbW9kdWxlIG5lZWQgdG8gYmUgY29waWVkIGluIFhCTUNcc3lzdGVtXHB5dGhvblxMaWJccHlzcmMKICAgIHRyeToKICAgICAgICBpbXBvcnQgcHlzcmMucHlkZXZkIGFzIHB5ZGV2ZAogICAgIyBzdGRvdXRUb1NlcnZlciBhbmQgc3RkZXJyVG9TZXJ2ZXIgcmVkaXJlY3Qgc3Rkb3V0IGFuZCBzdGRlcnIgdG8gZWNsaXBzZSBjb25zb2xlCiAgICAgICAgcHlkZXZkLnNldHRyYWNlKCdsb2NhbGhvc3QnLCBzdGRvdXRUb1NlcnZlcj1UcnVlLCBzdGRlcnJUb1NlcnZlcj1UcnVlKQogICAgZXhjZXB0IEltcG9ydEVycm9yOgogICAgICAgIHN5cy5zdGRlcnIud3JpdGUoIkVycm9yOiAiICsKICAgICAgICAgICAgIllvdSBtdXN0IGFkZCBvcmcucHl0aG9uLnB5ZGV2LmRlYnVnLnB5c3JjIHRvIHlvdXIgUFlUSE9OUEFUSC4iKQogICAgICAgIHN5cy5leGl0KDEpCgoKYWRkb24gPSB4Ym1jYWRkb24uQWRkb24oJ3BsdWdpbi52aWRlby50dmRldG9kb3MnKQphZGRvbl92ZXJzaW9uID0gYWRkb24uZ2V0QWRkb25JbmZvKCd2ZXJzaW9uJykKcHJvZmlsZSA9IHhibWMudHJhbnNsYXRlUGF0aChhZGRvbi5nZXRBZGRvbkluZm8oJ3Byb2ZpbGUnKS5kZWNvZGUoJ3V0Zi04JykpCmhvbWUgPSB4Ym1jLnRyYW5zbGF0ZVBhdGgoYWRkb24uZ2V0QWRkb25JbmZvKCdwYXRoJykuZGVjb2RlKCd1dGYtOCcpKQpmYXZvcml0ZXMgPSBvcy5wYXRoLmpvaW4ocHJvZmlsZSwgJ2Zhdm9yaXRlcycpCmhpc3RvcnkgPSBvcy5wYXRoLmpvaW4ocHJvZmlsZSwgJ2hpc3RvcnknKQpSRVYgPSBvcy5wYXRoLmpvaW4ocHJvZmlsZSwgJ2xpc3RfcmV2aXNpb24nKQppY29uID0gb3MucGF0aC5qb2luKGhvbWUsICdpY29uLnBuZycpCkZBTkFSVCA9IG9zLnBhdGguam9pbihob21lLCAnZmFuYXJ0LmpwZycpCnNvdXJjZV9maWxlID0gb3MucGF0aC5qb2luKHByb2ZpbGUsICdzb3VyY2VfZmlsZScpCmZ1bmN0aW9uc19kaXIgPSBwcm9maWxlCgpjb21tdW5pdHlmaWxlcyA9IG9zLnBhdGguam9pbihwcm9maWxlLCAnTGl2ZXdlYlRWJykKZG93bmxvYWRlciA9IGRvd25sb2FkZXIuU2ltcGxlRG93bmxvYWRlcigpCmRlYnVnID0gYWRkb24uZ2V0U2V0dGluZygnZGVidWcnKQppZiBvcy5wYXRoLmV4aXN0cyhmYXZvcml0ZXMpPT1UcnVlOgogICAgRkFWID0gb3BlbihmYXZvcml0ZXMpLnJlYWQoKQplbHNlOiBGQVYgPSBbXQppZiBvcy5wYXRoLmV4aXN0cyhzb3VyY2VfZmlsZSk9PVRydWU6CiAgICBTT1VSQ0VTID0gb3Blbihzb3VyY2VfZmlsZSkucmVhZCgpCmVsc2U6IFNPVVJDRVMgPSBbXQoKCmRlZiBhZGRvbl9sb2coc3RyaW5nKToKICAgIGlmIGRlYnVnID09ICd0cnVlJzoKICAgICAgICB4Ym1jLmxvZygiW2FkZG9uLmxpdmUudHZkZXRvZG9zLSVzXTogJXMiICUoYWRkb25fdmVyc2lvbiwgc3RyaW5nKSkKCgpkZWYgbWFrZVJlcXVlc3QodXJsLCBoZWFkZXJzPU5vbmUpOgogICAgICAgIHRyeToKICAgICAgICAgICAgaWYgaGVhZGVycyBpcyBOb25lOgogICAgICAgICAgICAgICAgaGVhZGVycyA9IHsnVXNlci1hZ2VudCcgOiAnTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgNi4xOyBXT1c2NDsgcnY6MTkuMCkgR2Vja28vMjAxMDAxMDEgRmlyZWZveC8xOS4wJ30KICAgICAgICAgICAgcmVxID0gdXJsbGliMi5SZXF1ZXN0KHVybCxOb25lLGhlYWRlcnMpCiAgICAgICAgICAgIHJlc3BvbnNlID0gdXJsbGliMi51cmxvcGVuKHJlcSkKICAgICAgICAgICAgZGF0YSA9IHJlc3BvbnNlLnJlYWQoKQogICAgICAgICAgICByZXNwb25zZS5jbG9zZSgpCiAgICAgICAgICAgIHJldHVybiBkYXRhCiAgICAgICAgZXhjZXB0IHVybGxpYjIuVVJMRXJyb3IsIGU6CiAgICAgICAgICAgIGFkZG9uX2xvZygnVVJMOiAnK3VybCkKICAgICAgICAgICAgaWYgaGFzYXR0cihlLCAnY29kZScpOgogICAgICAgICAgICAgICAgYWRkb25fbG9nKCdXZSBmYWlsZWQgd2l0aCBlcnJvciBjb2RlIC0gJXMuJyAlIGUuY29kZSkKICAgICAgICAgICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuTm90aWZpY2F0aW9uKExpdmV0dmRldG9kb3MsV2UgZmFpbGVkIHdpdGggZXJyb3IgY29kZSAtICIrc3RyKGUuY29kZSkrIiwxMDAwMCwiK2ljb24rIikiKQogICAgICAgICAgICBlbGlmIGhhc2F0dHIoZSwgJ3JlYXNvbicpOgogICAgICAgICAgICAgICAgYWRkb25fbG9nKCdXZSBmYWlsZWQgdG8gcmVhY2ggYSBzZXJ2ZXIuJykKICAgICAgICAgICAgICAgIGFkZG9uX2xvZygnUmVhc29uOiAlcycgJWUucmVhc29uKQogICAgICAgICAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Ob3RpZmljYXRpb24oTGl2ZXR2ZGV0b2RvcyxXZSBmYWlsZWQgdG8gcmVhY2ggYSBzZXJ2ZXIuIC0gIitzdHIoZS5yZWFzb24pKyIsMTAwMDAsIitpY29uKyIpIikKCmRlZiBDSEluZGV4KCk6CiAgICBhZGRvbl9sb2coIkNISW5kZXgiKQogICAgZ2V0RGF0YShDSEJhc2UsJycpCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpCgoJCmRlZiBnZXRTb3VyY2VzKCk6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhmYXZvcml0ZXMpID09IFRydWU6CiAgICAgICAgICAgICAgICBhZGREaXIoJ0Zhdm9yaXRlcycsJ3VybCcsNCxvcy5wYXRoLmpvaW4oaG9tZSwgJ3Jlc291cmNlcycsICdmYXZvcml0ZS5wbmcnKSxGQU5BUlQsJycsJycsJycsJycpCiAgICAgICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoImJyb3dzZV94bWxfZGF0YWJhc2UiKSA9PSAidHJ1ZSI6CiAgICAgICAgICAgICAgICBhZGREaXIoJ1hNTCBEYXRhYmFzZScsJ2h0dHA6Ly94Ym1jcGx1cy54Yi5mdW5waWMuZGUvd3d3LWRhdGEvZmlsZXN5c3RlbS8nLDE1LGljb24sRkFOQVJULCcnLCcnLCcnLCcnKQogICAgICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCJicm93c2VfY29tbXVuaXR5IikgPT0gInRydWUiOgogICAgICAgICAgICAgICAgYWRkRGlyKCdDb21tdW5pdHkgRmlsZXMnLCdjb21tdW5pdHlfZmlsZXMnLDE2LGljb24sRkFOQVJULCcnLCcnLCcnLCcnKQogICAgICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCJzZWFyY2hvdGhlcnBsdWdpbnMiKSA9PSAidHJ1ZSI6CiAgICAgICAgICAgICAgICBhZGREaXIoJ1NlYXJjaCBPdGhlciBQbHVnaW5zJywnU2VhcmNoIFBsdWdpbnMnLDI1LGljb24sRkFOQVJULCcnLCcnLCcnLCcnKQogICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhzb3VyY2VfZmlsZSk9PVRydWU6CiAgICAgICAgICAgICAgICBzb3VyY2VzID0ganNvbi5sb2FkcyhvcGVuKHNvdXJjZV9maWxlLCJyIikucmVhZCgpKQogICAgICAgICAgICAgICAgI3ByaW50ICdzb3VyY2VzJyxzb3VyY2VzCiAgICAgICAgICAgICAgICBpZiBsZW4oc291cmNlcykgPiAxOgogICAgICAgICAgICAgICAgICAgIGZvciBpIGluIHNvdXJjZXM6CiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMjIGZvciBwcmUgMS4wLjggc291cmNlcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShpLCBsaXN0KToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGREaXIoaVswXS5lbmNvZGUoJ3V0Zi04JyksaVsxXS5lbmNvZGUoJ3V0Zi04JyksMSxpY29uLEZBTkFSVCwnJywnJywnJywnJywnc291cmNlJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGh1bWIgPSBpY29uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmFuYXJ0ID0gRkFOQVJUCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzYyA9ICcnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZSA9ICcnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3JlZGl0cyA9ICcnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2VucmUgPSAnJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGkuaGFzX2tleSgndGh1bWJuYWlsJyk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRodW1iID0gaVsndGh1bWJuYWlsJ10KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBpLmhhc19rZXkoJ2ZhbmFydCcpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYW5hcnQgPSBpWydmYW5hcnQnXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGkuaGFzX2tleSgnZGVzY3JpcHRpb24nKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzYyA9IGlbJ2Rlc2NyaXB0aW9uJ10KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBpLmhhc19rZXkoJ2RhdGUnKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZSA9IGlbJ2RhdGUnXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGkuaGFzX2tleSgnZ2VucmUnKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2VucmUgPSBpWydnZW5yZSddCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgaS5oYXNfa2V5KCdjcmVkaXRzJyk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNyZWRpdHMgPSBpWydjcmVkaXRzJ10KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGREaXIoaVsndGl0bGUnXS5lbmNvZGUoJ3V0Zi04JyksaVsndXJsJ10uZW5jb2RlKCd1dGYtOCcpLDEsdGh1bWIsZmFuYXJ0LGRlc2MsZ2VucmUsZGF0ZSxjcmVkaXRzLCdzb3VyY2UnKQogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6IHRyYWNlYmFjay5wcmludF9leGMoKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBpZiBsZW4oc291cmNlcykgPT0gMToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShzb3VyY2VzWzBdLCBsaXN0KToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldERhdGEoc291cmNlc1swXVsxXS5lbmNvZGUoJ3V0Zi04JyksRkFOQVJUKQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2V0RGF0YShzb3VyY2VzWzBdWyd1cmwnXSwgc291cmNlc1swXVsnZmFuYXJ0J10pCiAgICAgICAgZXhjZXB0OiB0cmFjZWJhY2sucHJpbnRfZXhjKCkKCmRlZiBhZGRTb3VyY2UodXJsPU5vbmUpOgogICAgICAgIGlmIHVybCBpcyBOb25lOgogICAgICAgICAgICBpZiBub3QgYWRkb24uZ2V0U2V0dGluZygibmV3X2ZpbGVfc291cmNlIikgPT0gIiI6CiAgICAgICAgICAgICAgIHNvdXJjZV91cmwgPSBhZGRvbi5nZXRTZXR0aW5nKCduZXdfZmlsZV9zb3VyY2UnKS5kZWNvZGUoJ3V0Zi04JykKICAgICAgICAgICAgZWxpZiBub3QgYWRkb24uZ2V0U2V0dGluZygibmV3X3VybF9zb3VyY2UiKSA9PSAiIjoKICAgICAgICAgICAgICAgc291cmNlX3VybCA9IGFkZG9uLmdldFNldHRpbmcoJ25ld191cmxfc291cmNlJykuZGVjb2RlKCd1dGYtOCcpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgc291cmNlX3VybCA9IHVybAogICAgICAgIGlmIHNvdXJjZV91cmwgPT0gJycgb3Igc291cmNlX3VybCBpcyBOb25lOgogICAgICAgICAgICByZXR1cm4KICAgICAgICBhZGRvbl9sb2coJ0FkZGluZyBOZXcgU291cmNlOiAnK3NvdXJjZV91cmwuZW5jb2RlKCd1dGYtOCcpKQoKICAgICAgICBtZWRpYV9pbmZvID0gTm9uZQogICAgICAgICNwcmludCAnc291cmNlX3VybCcsc291cmNlX3VybAogICAgICAgIGRhdGEgPSBnZXRTb3VwKHNvdXJjZV91cmwpCiAgICAgICAgcHJpbnQgJ3NvdXJjZV91cmwnLHNvdXJjZV91cmwKICAgICAgICBpZiBpc2luc3RhbmNlKGRhdGEsQmVhdXRpZnVsU09BUCk6CiAgICAgICAgICAgIGlmIGRhdGEuZmluZCgnY2hhbm5lbHNfaW5mbycpOgogICAgICAgICAgICAgICAgbWVkaWFfaW5mbyA9IGRhdGEuY2hhbm5lbHNfaW5mbwogICAgICAgICAgICBlbGlmIGRhdGEuZmluZCgnaXRlbXNfaW5mbycpOgogICAgICAgICAgICAgICAgbWVkaWFfaW5mbyA9IGRhdGEuaXRlbXNfaW5mbwogICAgICAgIGlmIG1lZGlhX2luZm86CiAgICAgICAgICAgIHNvdXJjZV9tZWRpYSA9IHt9CiAgICAgICAgICAgIHNvdXJjZV9tZWRpYVsndXJsJ10gPSBzb3VyY2VfdXJsCiAgICAgICAgICAgIHRyeTogc291cmNlX21lZGlhWyd0aXRsZSddID0gbWVkaWFfaW5mby50aXRsZS5zdHJpbmcKICAgICAgICAgICAgZXhjZXB0OiBwYXNzCiAgICAgICAgICAgIHRyeTogc291cmNlX21lZGlhWyd0aHVtYm5haWwnXSA9IG1lZGlhX2luZm8udGh1bWJuYWlsLnN0cmluZwogICAgICAgICAgICBleGNlcHQ6IHBhc3MKICAgICAgICAgICAgdHJ5OiBzb3VyY2VfbWVkaWFbJ2ZhbmFydCddID0gbWVkaWFfaW5mby5mYW5hcnQuc3RyaW5nCiAgICAgICAgICAgIGV4Y2VwdDogcGFzcwogICAgICAgICAgICB0cnk6IHNvdXJjZV9tZWRpYVsnZ2VucmUnXSA9IG1lZGlhX2luZm8uZ2VucmUuc3RyaW5nCiAgICAgICAgICAgIGV4Y2VwdDogcGFzcwogICAgICAgICAgICB0cnk6IHNvdXJjZV9tZWRpYVsnZGVzY3JpcHRpb24nXSA9IG1lZGlhX2luZm8uZGVzY3JpcHRpb24uc3RyaW5nCiAgICAgICAgICAgIGV4Y2VwdDogcGFzcwogICAgICAgICAgICB0cnk6IHNvdXJjZV9tZWRpYVsnZGF0ZSddID0gbWVkaWFfaW5mby5kYXRlLnN0cmluZwogICAgICAgICAgICBleGNlcHQ6IHBhc3MKICAgICAgICAgICAgdHJ5OiBzb3VyY2VfbWVkaWFbJ2NyZWRpdHMnXSA9IG1lZGlhX2luZm8uY3JlZGl0cy5zdHJpbmcKICAgICAgICAgICAgZXhjZXB0OiBwYXNzCiAgICAgICAgZWxzZToKICAgICAgICAgICAgaWYgJy8nIGluIHNvdXJjZV91cmw6CiAgICAgICAgICAgICAgICBuYW1lU3RyID0gc291cmNlX3VybC5zcGxpdCgnLycpWy0xXS5zcGxpdCgnLicpWzBdCiAgICAgICAgICAgIGlmICdcXCcgaW4gc291cmNlX3VybDoKICAgICAgICAgICAgICAgIG5hbWVTdHIgPSBzb3VyY2VfdXJsLnNwbGl0KCdcXCcpWy0xXS5zcGxpdCgnLicpWzBdCiAgICAgICAgICAgIGlmICclJyBpbiBuYW1lU3RyOgogICAgICAgICAgICAgICAgbmFtZVN0ciA9IHVybGxpYi51bnF1b3RlX3BsdXMobmFtZVN0cikKICAgICAgICAgICAga2V5Ym9hcmQgPSB4Ym1jLktleWJvYXJkKG5hbWVTdHIsJ0Rpc3BsYXllZCBOYW1lLCBSZW5hbWU/JykKICAgICAgICAgICAga2V5Ym9hcmQuZG9Nb2RhbCgpCiAgICAgICAgICAgIGlmIChrZXlib2FyZC5pc0NvbmZpcm1lZCgpID09IEZhbHNlKToKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBuZXdTdHIgPSBrZXlib2FyZC5nZXRUZXh0KCkKICAgICAgICAgICAgaWYgbGVuKG5ld1N0cikgPT0gMDoKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBzb3VyY2VfbWVkaWEgPSB7fQogICAgICAgICAgICBzb3VyY2VfbWVkaWFbJ3RpdGxlJ10gPSBuZXdTdHIKICAgICAgICAgICAgc291cmNlX21lZGlhWyd1cmwnXSA9IHNvdXJjZV91cmwKICAgICAgICAgICAgc291cmNlX21lZGlhWydmYW5hcnQnXSA9IGZhbmFydAoKICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhzb3VyY2VfZmlsZSk9PUZhbHNlOgogICAgICAgICAgICBzb3VyY2VfbGlzdCA9IFtdCiAgICAgICAgICAgIHNvdXJjZV9saXN0LmFwcGVuZChzb3VyY2VfbWVkaWEpCiAgICAgICAgICAgIGIgPSBvcGVuKHNvdXJjZV9maWxlLCJ3IikKICAgICAgICAgICAgYi53cml0ZShqc29uLmR1bXBzKHNvdXJjZV9saXN0KSkKICAgICAgICAgICAgYi5jbG9zZSgpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgc291cmNlcyA9IGpzb24ubG9hZHMob3Blbihzb3VyY2VfZmlsZSwiciIpLnJlYWQoKSkKICAgICAgICAgICAgc291cmNlcy5hcHBlbmQoc291cmNlX21lZGlhKQogICAgICAgICAgICBiID0gb3Blbihzb3VyY2VfZmlsZSwidyIpCiAgICAgICAgICAgIGIud3JpdGUoanNvbi5kdW1wcyhzb3VyY2VzKSkKICAgICAgICAgICAgYi5jbG9zZSgpCiAgICAgICAgYWRkb24uc2V0U2V0dGluZygnbmV3X3VybF9zb3VyY2UnLCAiIikKICAgICAgICBhZGRvbi5zZXRTZXR0aW5nKCduZXdfZmlsZV9zb3VyY2UnLCAiIikKICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLk5vdGlmaWNhdGlvbihMaXZldHZkZXRvZG9zLE5ldyBzb3VyY2UgYWRkZWQuLDUwMDAsIitpY29uKyIpIikKICAgICAgICBpZiBub3QgdXJsIGlzIE5vbmU6CiAgICAgICAgICAgIGlmICd4Ym1jcGx1cy54Yi5mdW5waWMuZGUnIGluIHVybDoKICAgICAgICAgICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuQ29udGFpbmVyLlVwZGF0ZSglcz9tb2RlPTE0LHJlcGxhY2UpIiAlc3lzLmFyZ3ZbMF0pCiAgICAgICAgICAgIGVsaWYgJ2NvbW11bml0eS1saW5rcycgaW4gdXJsOgogICAgICAgICAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Db250YWluZXIuVXBkYXRlKCVzP21vZGU9MTAscmVwbGFjZSkiICVzeXMuYXJndlswXSkKICAgICAgICBlbHNlOiBhZGRvbi5vcGVuU2V0dGluZ3MoKQoKZGVmIHJtU291cmNlKG5hbWUpOgogICAgICAgIHNvdXJjZXMgPSBqc29uLmxvYWRzKG9wZW4oc291cmNlX2ZpbGUsInIiKS5yZWFkKCkpCiAgICAgICAgZm9yIGluZGV4IGluIHJhbmdlKGxlbihzb3VyY2VzKSk6CiAgICAgICAgICAgIGlmIGlzaW5zdGFuY2Uoc291cmNlc1tpbmRleF0sIGxpc3QpOgogICAgICAgICAgICAgICAgaWYgc291cmNlc1tpbmRleF1bMF0gPT0gbmFtZToKICAgICAgICAgICAgICAgICAgICBkZWwgc291cmNlc1tpbmRleF0KICAgICAgICAgICAgICAgICAgICBiID0gb3Blbihzb3VyY2VfZmlsZSwidyIpCiAgICAgICAgICAgICAgICAgICAgYi53cml0ZShqc29uLmR1bXBzKHNvdXJjZXMpKQogICAgICAgICAgICAgICAgICAgIGIuY2xvc2UoKQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBpZiBzb3VyY2VzW2luZGV4XVsndGl0bGUnXSA9PSBuYW1lOgogICAgICAgICAgICAgICAgICAgIGRlbCBzb3VyY2VzW2luZGV4XQogICAgICAgICAgICAgICAgICAgIGIgPSBvcGVuKHNvdXJjZV9maWxlLCJ3IikKICAgICAgICAgICAgICAgICAgICBiLndyaXRlKGpzb24uZHVtcHMoc291cmNlcykpCiAgICAgICAgICAgICAgICAgICAgYi5jbG9zZSgpCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLkNvbnRhaW5lci5SZWZyZXNoIikKCmRlZiBnZXRfeG1sX2RhdGFiYXNlKHVybCwgYnJvd3NlPUZhbHNlKToKICAgICAgICBpZiB1cmwgaXMgTm9uZToKICAgICAgICAgICAgdXJsID0gJ2h0dHA6Ly94Ym1jcGx1cy54Yi5mdW5waWMuZGUvd3d3LWRhdGEvZmlsZXN5c3RlbS8nCiAgICAgICAgc291cCA9IEJlYXV0aWZ1bFNvdXAobWFrZVJlcXVlc3QodXJsKSwgY29udmVydEVudGl0aWVzPUJlYXV0aWZ1bFNvdXAuSFRNTF9FTlRJVElFUykKICAgICAgICBmb3IgaSBpbiBzb3VwKCdhJyk6CiAgICAgICAgICAgIGhyZWYgPSBpWydocmVmJ10KICAgICAgICAgICAgaWYgbm90IGhyZWYuc3RhcnRzd2l0aCgnPycpOgogICAgICAgICAgICAgICAgbmFtZSA9IGkuc3RyaW5nCiAgICAgICAgICAgICAgICBpZiBuYW1lIG5vdCBpbiBbJ1BhcmVudCBEaXJlY3RvcnknLCAncmVjeWNsZV9iaW4vJ106CiAgICAgICAgICAgICAgICAgICAgaWYgaHJlZi5lbmRzd2l0aCgnLycpOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBicm93c2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGREaXIobmFtZSx1cmwraHJlZiwxNSxpY29uLGZhbmFydCwnJywnJywnJykKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLHVybCtocmVmLDE0LGljb24sZmFuYXJ0LCcnLCcnLCcnKQogICAgICAgICAgICAgICAgICAgIGVsaWYgaHJlZi5lbmRzd2l0aCgnLnhtbCcpOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBicm93c2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGREaXIobmFtZSx1cmwraHJlZiwxLGljb24sZmFuYXJ0LCcnLCcnLCcnLCcnLCdkb3dubG9hZCcpCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhzb3VyY2VfZmlsZSk9PVRydWU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbmFtZSBpbiBTT1VSQ0VTOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGREaXIobmFtZSsnIChpbiB1c2UpJyx1cmwraHJlZiwxMSxpY29uLGZhbmFydCwnJywnJywnJywnJywnZG93bmxvYWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLHVybCtocmVmLDExLGljb24sZmFuYXJ0LCcnLCcnLCcnLCcnLCdkb3dubG9hZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLHVybCtocmVmLDExLGljb24sZmFuYXJ0LCcnLCcnLCcnLCcnLCdkb3dubG9hZCcpCgoKZGVmIGdldENvbW11bml0eVNvdXJjZXMoYnJvd3NlPUZhbHNlKToKICAgICAgICB1cmwgPSAnaHR0cDovL2NvbW11bml0eS1saW5rcy5nb29nbGVjb2RlLmNvbS9zdm4vdHJ1bmsvJwogICAgICAgIHNvdXAgPSBCZWF1dGlmdWxTb3VwKG1ha2VSZXF1ZXN0KHVybCksIGNvbnZlcnRFbnRpdGllcz1CZWF1dGlmdWxTb3VwLkhUTUxfRU5USVRJRVMpCiAgICAgICAgZmlsZXMgPSBzb3VwKCd1bCcpWzBdKCdsaScpWzE6XQogICAgICAgIGZvciBpIGluIGZpbGVzOgogICAgICAgICAgICBuYW1lID0gaSgnYScpWzBdWydocmVmJ10KICAgICAgICAgICAgaWYgYnJvd3NlOgogICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUsdXJsK25hbWUsMSxpY29uLGZhbmFydCwnJywnJywnJywnJywnZG93bmxvYWQnKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUsdXJsK25hbWUsMTEsaWNvbixmYW5hcnQsJycsJycsJycsJycsJ2Rvd25sb2FkJykKCmRlZiBnZXRTb3VwKHVybCxkYXRhPU5vbmUpOgogICAgICAgIGlmIHVybC5zdGFydHN3aXRoKCdodHRwOi8vJykgb3IgdXJsLnN0YXJ0c3dpdGgoJ2h0dHBzOi8vJyk6CiAgICAgICAgICAgIGRhdGEgPSBtYWtlUmVxdWVzdCh1cmwpCiAgICAgICAgICAgIGlmIHJlLnNlYXJjaCgiI0VYVE0zVSIsZGF0YSkgb3IgJ20zdScgaW4gdXJsOgogICAgICAgICAgICAgICAgcHJpbnQgJ2ZvdW5kIG0zdSBkYXRhJwogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGEKICAgICAgICBlbGlmIGRhdGEgPT0gTm9uZToKICAgICAgICAgICAgaWYgbm90ICcvJyAgaW4gdXJsIG9yIG5vdCAnXFwnIGluIHVybDoKICAgICAgICAgICAgICAgIHByaW50ICdObyBkaXJlY3RvcnkgZm91bmQuIExldHMgbWFrZSB0aGUgdXJsIHRvIGNhY2hlIGRpcicKICAgICAgICAgICAgICAgIHVybCA9IG9zLnBhdGguam9pbihjb21tdW5pdHlmaWxlcyx1cmwpCiAgICAgICAgICAgIGlmIHhibWN2ZnMuZXhpc3RzKHVybCk6CiAgICAgICAgICAgICAgICBpZiB1cmwuc3RhcnRzd2l0aCgic21iOi8vIikgb3IgdXJsLnN0YXJ0c3dpdGgoIm5mczovLyIpOgogICAgICAgICAgICAgICAgICAgIGNvcHkgPSB4Ym1jdmZzLmNvcHkodXJsLCBvcy5wYXRoLmpvaW4ocHJvZmlsZSwgJ3RlbXAnLCAnc29yY2VfdGVtcC50eHQnKSkKICAgICAgICAgICAgICAgICAgICBpZiBjb3B5OgogICAgICAgICAgICAgICAgICAgICAgICBkYXRhID0gb3Blbihvcy5wYXRoLmpvaW4ocHJvZmlsZSwgJ3RlbXAnLCAnc29yY2VfdGVtcC50eHQnKSwgInIiKS5yZWFkKCkKICAgICAgICAgICAgICAgICAgICAgICAgeGJtY3Zmcy5kZWxldGUob3MucGF0aC5qb2luKHByb2ZpbGUsICd0ZW1wJywgJ3NvcmNlX3RlbXAudHh0JykpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJmYWlsZWQgdG8gY29weSBmcm9tIHNtYjoiKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBkYXRhID0gb3Blbih1cmwsICdyJykucmVhZCgpCiAgICAgICAgICAgICAgICAgICAgaWYgcmUubWF0Y2goIiNFWFRNM1UiLGRhdGEpb3IgJ20zdScgaW4gdXJsOgogICAgICAgICAgICAgICAgICAgICAgICBwcmludCAnZm91bmQgbTN1IGRhdGEnCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRhCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlNvdXAgRGF0YSBub3QgZm91bmQhIikKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgIHJldHVybiBCZWF1dGlmdWxTT0FQKGRhdGEsIGNvbnZlcnRFbnRpdGllcz1CZWF1dGlmdWxTdG9uZVNvdXAuWE1MX0VOVElUSUVTKQoKCmRlZiBnZXREYXRhKHVybCxmYW5hcnQsIGRhdGE9Tm9uZSk6CiAgICBzb3VwID0gZ2V0U291cCh1cmwsZGF0YSkKICAgICNwcmludCB0eXBlKHNvdXApCiAgICBpZiBpc2luc3RhbmNlKHNvdXAsQmVhdXRpZnVsU09BUCk6CiAgICAjcHJpbnQgJ3h4eHh4eHh4eHhzb3VwJyxzb3VwCiAgICAgICAgaWYgbGVuKHNvdXAoJ2NoYW5uZWxzJykpID4gMCBhbmQgYWRkb24uZ2V0U2V0dGluZygnZG9ub3RzaG93YnljaGFubmVscycpID09ICdmYWxzZSc6CiAgICAgICAgICAgIGNoYW5uZWxzID0gc291cCgnY2hhbm5lbCcpCiAgICAgICAgICAgIGZvciBjaGFubmVsIGluIGNoYW5uZWxzOgojICAgICAgICAgICAgICAgIHByaW50IGNoYW5uZWwKCiAgICAgICAgICAgICAgICBsaW5rZWRVcmw9JycKICAgICAgICAgICAgICAgIGxjb3VudD0wCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgbGlua2VkVXJsID0gIGNoYW5uZWwoJ2V4dGVybmFsbGluaycpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgIGxjb3VudD1sZW4oY2hhbm5lbCgnZXh0ZXJuYWxsaW5rJykpCiAgICAgICAgICAgICAgICBleGNlcHQ6IHBhc3MKICAgICAgICAgICAgICAgICNwcmludCAnbGlua2VkVXJsJyxsaW5rZWRVcmwsbGNvdW50CiAgICAgICAgICAgICAgICBpZiBsY291bnQ+MTogbGlua2VkVXJsPScnCgogICAgICAgICAgICAgICAgbmFtZSA9IGNoYW5uZWwoJ25hbWUnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9IGNoYW5uZWwoJ3RodW1ibmFpbCcpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgaWYgdGh1bWJuYWlsID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgdGh1bWJuYWlsID0gJycKCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgaWYgbm90IGNoYW5uZWwoJ2ZhbmFydCcpOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCd1c2VfdGh1bWInKSA9PSAidHJ1ZSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYW5BcnQgPSB0aHVtYm5haWwKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhbkFydCA9IGZhbmFydAogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIGZhbkFydCA9IGNoYW5uZWwoJ2ZhbmFydCcpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgIGlmIGZhbkFydCA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICByYWlzZQogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIGZhbkFydCA9IGZhbmFydAoKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBkZXNjID0gY2hhbm5lbCgnaW5mbycpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgIGlmIGRlc2MgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgcmFpc2UKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBkZXNjID0gJycKCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgZ2VucmUgPSBjaGFubmVsKCdnZW5yZScpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgIGlmIGdlbnJlID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgZ2VucmUgPSAnJwoKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBkYXRlID0gY2hhbm5lbCgnZGF0ZScpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgIGlmIGRhdGUgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgcmFpc2UKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBkYXRlID0gJycKCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgY3JlZGl0cyA9IGNoYW5uZWwoJ2NyZWRpdHMnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICBpZiBjcmVkaXRzID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgY3JlZGl0cyA9ICcnCgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGlmIGxpbmtlZFVybD09Jyc6CiAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLmVuY29kZSgndXRmLTgnLCAnaWdub3JlJyksdXJsLmVuY29kZSgndXRmLTgnKSwyLHRodW1ibmFpbCxmYW5BcnQsZGVzYyxnZW5yZSxkYXRlLGNyZWRpdHMsVHJ1ZSkKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgbGlua2VkVXJsCiAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLmVuY29kZSgndXRmLTgnKSxsaW5rZWRVcmwuZW5jb2RlKCd1dGYtOCcpLDEsdGh1bWJuYWlsLGZhbkFydCxkZXNjLGdlbnJlLGRhdGUsTm9uZSwnc291cmNlJykKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coJ1RoZXJlIHdhcyBhIHByb2JsZW0gYWRkaW5nIGRpcmVjdG9yeSBmcm9tIGdldERhdGEoKTogJytuYW1lLmVuY29kZSgndXRmLTgnLCAnaWdub3JlJykpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgYWRkb25fbG9nKCdObyBDaGFubmVsczogZ2V0SXRlbXMnKQogICAgICAgICAgICBnZXRJdGVtcyhzb3VwKCdpdGVtJyksZmFuYXJ0KQogICAgZWxzZToKICAgICAgICBwYXJzZV9tM3Uoc291cCkKIyBib3Jyb3cgZnJvbSBodHRwczovL2dpdGh1Yi5jb20vZW5lbjkyL1AyUC1TdHJlYW1zLVhCTUMvYmxvYi9tYXN0ZXIvcGx1Z2luLnZpZGVvLnAycC1zdHJlYW1zL3Jlc291cmNlcy9jb3JlL2xpdmVzdHJlYW1zLnB5CiMgVGhpcyB3aWxsIG5vdCBnbyB0aHJvdWdoIHRoZSBnZXRJdGVtcyBmdW5jdGlvbnMgKCBtZWFucyB5b3UgbXVzdCBoYXZlIHJlYWR5IHRvIHBsYXkgdXJsLCBubyByZWdleCkKZGVmIHBhcnNlX20zdShkYXRhKToKICAgIGNvbnRlbnQgPSBkYXRhLnJzdHJpcCgpCiAgICBtYXRjaCA9IHJlLmNvbXBpbGUocicjRVhUSU5GOiguKz8pLCguKj8pW1xuXHJdKyhbXlxyXG5dKyknKS5maW5kYWxsKGNvbnRlbnQpCiAgICB0b3RhbCA9IGxlbihtYXRjaCkKICAgIHByaW50ICd0b3RhbCBtM3UgbGlua3MnLHRvdGFsCiAgICBmb3Igb3RoZXIsY2hhbm5lbF9uYW1lLHN0cmVhbV91cmwgaW4gbWF0Y2g6CiAgICAgICAgaWYgJ3R2Zy1sb2dvJyBpbiBvdGhlcjoKICAgICAgICAgICAgdGh1bWJuYWlsID0gcmVfbWUob3RoZXIsJ3R2Zy1sb2dvPVtcJyJdKC4qPylbXCciXScpCiAgICAgICAgICAgIGlmIHRodW1ibmFpbDoKICAgICAgICAgICAgICAgIGlmIHRodW1ibmFpbC5zdGFydHN3aXRoKCdodHRwJyk6CiAgICAgICAgICAgICAgICAgICAgdGh1bWJuYWlsID0gdGh1bWJuYWlsCgogICAgICAgICAgICAgICAgZWxpZiBub3QgYWRkb24uZ2V0U2V0dGluZygnbG9nby1mb2xkZXJQYXRoJykgPT0gIiI6CiAgICAgICAgICAgICAgICAgICAgbG9nb191cmwgPSBhZGRvbi5nZXRTZXR0aW5nKCdsb2dvLWZvbGRlclBhdGgnKQogICAgICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9IGxvZ29fdXJsICsgdGh1bWJuYWlsCgogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICB0aHVtYm5haWwgPSB0aHVtYm5haWwKICAgICAgICAgICAgI2Vsc2U6CgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHRodW1ibmFpbCA9ICcnCiAgICAgICAgaWYgJ3R5cGUnIGluIG90aGVyOgogICAgICAgICAgICBtb2RlX3R5cGUgPSByZV9tZShvdGhlciwndHlwZT1bXCciXSguKj8pW1wnIl0nKQogICAgICAgICAgICBpZiBtb2RlX3R5cGUgPT0gJ3l0LWRsJzoKICAgICAgICAgICAgICAgIHN0cmVhbV91cmwgPSBzdHJlYW1fdXJsICsiJm1vZGU9MTgiCiAgICAgICAgICAgIGVsaWYgbW9kZV90eXBlID09ICdyZWdleCc6CiAgICAgICAgICAgICAgICB1cmwgPSBzdHJlYW1fdXJsLnNwbGl0KCcmcmVnZXhzPScpCiAgICAgICAgICAgICAgICAjcHJpbnQgdXJsWzBdIGdldFNvdXAodXJsLGRhdGE9Tm9uZSkKICAgICAgICAgICAgICAgIHJlZ2V4cyA9IHBhcnNlX3JlZ2V4KGdldFNvdXAoJycsZGF0YT11cmxbMV0pKQoKICAgICAgICAgICAgICAgIGFkZExpbmsodXJsWzBdLCBjaGFubmVsX25hbWUsdGh1bWJuYWlsLCcnLCcnLCcnLCcnLCcnLE5vbmUscmVnZXhzLHRvdGFsKQogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgZWxpZiBtb2RlX3R5cGUgPT0gJ2Z0dic6CiAgICAgICAgICAgICAgICBzdHJlYW1fdXJsID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby5GLlQuVi8/bmFtZT0nK3VybGxpYi5xdW90ZShjaGFubmVsX25hbWUpICsnJnVybD0nICtzdHJlYW1fdXJsICsnJm1vZGU9MTI1JmNoX2ZhbmFydD1uYScKICAgICAgICBhZGRMaW5rKHN0cmVhbV91cmwsIGNoYW5uZWxfbmFtZSx0aHVtYm5haWwsJycsJycsJycsJycsJycsTm9uZSwnJyx0b3RhbCkKZGVmIGdldENoYW5uZWxJdGVtcyhuYW1lLHVybCxmYW5hcnQpOgogICAgICAgIHNvdXAgPSBnZXRTb3VwKHVybCkKICAgICAgICBjaGFubmVsX2xpc3QgPSBzb3VwLmZpbmQoJ2NoYW5uZWwnLCBhdHRycz17J25hbWUnIDogbmFtZS5kZWNvZGUoJ3V0Zi04Jyl9KQogICAgICAgIGl0ZW1zID0gY2hhbm5lbF9saXN0KCdpdGVtJykKICAgICAgICB0cnk6CiAgICAgICAgICAgIGZhbkFydCA9IGNoYW5uZWxfbGlzdCgnZmFuYXJ0JylbMF0uc3RyaW5nCiAgICAgICAgICAgIGlmIGZhbkFydCA9PSBOb25lOgogICAgICAgICAgICAgICAgcmFpc2UKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIGZhbkFydCA9IGZhbmFydAogICAgICAgIGZvciBjaGFubmVsIGluIGNoYW5uZWxfbGlzdCgnc3ViY2hhbm5lbCcpOgogICAgICAgICAgICBuYW1lID0gY2hhbm5lbCgnbmFtZScpWzBdLnN0cmluZwogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICB0aHVtYm5haWwgPSBjaGFubmVsKCd0aHVtYm5haWwnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgIGlmIHRodW1ibmFpbCA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9ICcnCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGlmIG5vdCBjaGFubmVsKCdmYW5hcnQnKToKICAgICAgICAgICAgICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCd1c2VfdGh1bWInKSA9PSAidHJ1ZSI6CiAgICAgICAgICAgICAgICAgICAgICAgIGZhbkFydCA9IHRodW1ibmFpbAogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBmYW5BcnQgPSBjaGFubmVsKCdmYW5hcnQnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgIGlmIGZhbkFydCA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgZGVzYyA9IGNoYW5uZWwoJ2luZm8nKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgIGlmIGRlc2MgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICByYWlzZQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBkZXNjID0gJycKCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGdlbnJlID0gY2hhbm5lbCgnZ2VucmUnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgIGlmIGdlbnJlID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgcmFpc2UKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgZ2VucmUgPSAnJwoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgZGF0ZSA9IGNoYW5uZWwoJ2RhdGUnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgIGlmIGRhdGUgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICByYWlzZQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBkYXRlID0gJycKCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGNyZWRpdHMgPSBjaGFubmVsKCdjcmVkaXRzJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICBpZiBjcmVkaXRzID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgcmFpc2UKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgY3JlZGl0cyA9ICcnCgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBhZGREaXIobmFtZS5lbmNvZGUoJ3V0Zi04JywgJ2lnbm9yZScpLHVybC5lbmNvZGUoJ3V0Zi04JyksMyx0aHVtYm5haWwsZmFuQXJ0LGRlc2MsZ2VucmUsY3JlZGl0cyxkYXRlKQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBhZGRvbl9sb2coJ1RoZXJlIHdhcyBhIHByb2JsZW0gYWRkaW5nIGRpcmVjdG9yeSAtICcrbmFtZS5lbmNvZGUoJ3V0Zi04JywgJ2lnbm9yZScpKQogICAgICAgIGdldEl0ZW1zKGl0ZW1zLGZhbkFydCkKCgpkZWYgZ2V0U3ViQ2hhbm5lbEl0ZW1zKG5hbWUsdXJsLGZhbmFydCk6CiAgICAgICAgc291cCA9IGdldFNvdXAodXJsKQogICAgICAgIGNoYW5uZWxfbGlzdCA9IHNvdXAuZmluZCgnc3ViY2hhbm5lbCcsIGF0dHJzPXsnbmFtZScgOiBuYW1lLmRlY29kZSgndXRmLTgnKX0pCiAgICAgICAgaXRlbXMgPSBjaGFubmVsX2xpc3QoJ3N1Yml0ZW0nKQogICAgICAgIGdldEl0ZW1zKGl0ZW1zLGZhbmFydCkKCmRlZiBnZXRJdGVtcyhpdGVtcyxmYW5hcnQpOgogICAgICAgIHRvdGFsID0gbGVuKGl0ZW1zKQogICAgICAgIGFkZG9uX2xvZygnVG90YWwgSXRlbXM6ICVzJyAldG90YWwpCiAgICAgICAgYWRkX3BsYXlsaXN0ID0gYWRkb24uZ2V0U2V0dGluZygnYWRkX3BsYXlsaXN0JykKICAgICAgICBhc2tfcGxheWxpc3RfaXRlbXMgPWFkZG9uLmdldFNldHRpbmcoJ2Fza19wbGF5bGlzdF9pdGVtcycpCiAgICAgICAgdXNlX3RodW1iID0gYWRkb24uZ2V0U2V0dGluZygndXNlX3RodW1iJykKICAgICAgICBwYXJlbnRhbGJsb2NrID1hZGRvbi5nZXRTZXR0aW5nKCdwYXJlbnRhbGJsb2NrZWQnKQogICAgICAgIHBhcmVudGFsYmxvY2s9IHBhcmVudGFsYmxvY2s9PSJ0cnVlIgogICAgICAgIGZvciBpdGVtIGluIGl0ZW1zOgogICAgICAgICAgICBpc1hNTFNvdXJjZT1GYWxzZQogICAgICAgICAgICBpc0pzb25ycGMgPSBGYWxzZQogICAgICAgICAgICAKICAgICAgICAgICAgYXBwbHlibG9jaz0nZmFsc2UnCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGFwcGx5YmxvY2sgPSBpdGVtKCdwYXJlbnRhbGJsb2NrJylbMF0uc3RyaW5nCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIGFkZG9uX2xvZygncGFyZW50YWxibG9jayBFcnJvcicpCiAgICAgICAgICAgICAgICBhcHBseWJsb2NrID0gJycKICAgICAgICAgICAgaWYgYXBwbHlibG9jaz09J3RydWUnIGFuZCBwYXJlbnRhbGJsb2NrOiBjb250aW51ZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIG5hbWUgPSBpdGVtKCd0aXRsZScpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgaWYgbmFtZSBpcyBOb25lOgogICAgICAgICAgICAgICAgICAgIG5hbWUgPSAndW5rbm93bj8nCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIGFkZG9uX2xvZygnTmFtZSBFcnJvcicpCiAgICAgICAgICAgICAgICBuYW1lID0gJycKCgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBpZiBpdGVtKCdlcGcnKToKICAgICAgICAgICAgICAgICAgICBpZiBpdGVtLmVwZ191cmw6CiAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygnR2V0IEVQRyBSZWdleCcpCiAgICAgICAgICAgICAgICAgICAgICAgIGVwZ191cmwgPSBpdGVtLmVwZ191cmwuc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGVwZ19yZWdleCA9IGl0ZW0uZXBnX3JlZ2V4LnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICBlcGdfbmFtZSA9IGdldF9lcGcoZXBnX3VybCwgZXBnX3JlZ2V4KQogICAgICAgICAgICAgICAgICAgICAgICBpZiBlcGdfbmFtZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUgKz0gJyAtICcgKyBlcGdfbmFtZQogICAgICAgICAgICAgICAgICAgIGVsaWYgaXRlbSgnZXBnJylbMF0uc3RyaW5nID4gMToKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZSArPSBnZXRlcGcoaXRlbSgnZXBnJylbMF0uc3RyaW5nKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIGFkZG9uX2xvZygnRVBHIEVycm9yJykKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgdXJsID0gW10KICAgICAgICAgICAgICAgIGlmIGxlbihpdGVtKCdsaW5rJykpID4wOgogICAgICAgICAgICAgICAgICAgICNwcmludCAnaXRlbSBsaW5rJywgaXRlbSgnbGluaycpCgogICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGl0ZW0oJ2xpbmsnKToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGkuc3RyaW5nID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmwuYXBwZW5kKGkuc3RyaW5nKQoKICAgICAgICAgICAgICAgIGVsaWYgbGVuKGl0ZW0oJ3Nwb3J0c2RldmlsJykpID4wOgogICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGl0ZW0oJ3Nwb3J0c2RldmlsJyk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBpLnN0cmluZyA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3BvcnRzZGV2aWwgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLlNwb3J0c0RldmlsLz9tb2RlPTEmYW1wO2l0ZW09Y2F0Y2hlciUzZHN0cmVhbXMlMjZ1cmw9JyAraS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZmVyZXIgPSBpdGVtKCdyZWZlcmVyJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiByZWZlcmVyOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAncmVmZXJlciBmb3VuZCcKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcG9ydHNkZXZpbCA9IHNwb3J0c2RldmlsICsgJyUyNnJlZmVyZXI9JyArcmVmZXJlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsLmFwcGVuZChzcG9ydHNkZXZpbCkKICAgICAgICAgICAgICAgIGVsaWYgbGVuKGl0ZW0oJ3AycCcpKSA+MDoKICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBpdGVtKCdwMnAnKToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGkuc3RyaW5nID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAnc29wOi8vJyBpbiBpLnN0cmluZzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzb3AgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnAycC1zdHJlYW1zLz9tb2RlPTJ1cmw9JytpLnN0cmluZyArJyYnICsgJ25hbWU9JytuYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsLmFwcGVuZChzb3ApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHAycD0ncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnAycC1zdHJlYW1zLz9tb2RlPTEmdXJsPScraS5zdHJpbmcgKycmJyArICduYW1lPScrbmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybC5hcHBlbmQocDJwKQogICAgICAgICAgICAgICAgZWxpZiBsZW4oaXRlbSgndmF1Z2huJykpID4wOgogICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGl0ZW0oJ3ZhdWdobicpOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgaS5zdHJpbmcgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhdWdobiA9ICdwbHVnaW46Ly9wbHVnaW4uc3RyZWFtLnZhdWdobmxpdmUudHYvP21vZGU9UGxheUxpdmVTdHJlYW0mYW1wO2NoYW5uZWw9JytpLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsLmFwcGVuZCh2YXVnaG4pCiAgICAgICAgICAgICAgICBlbGlmIGxlbihpdGVtKCdpbGl2ZScpKSA+MDoKICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBpdGVtKCdpbGl2ZScpOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgaS5zdHJpbmcgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCAnaHR0cCcgaW4gaS5zdHJpbmc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWxpdmUgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnRiaC5pbGl2ZS8/dXJsPWh0dHA6Ly93d3cuc3RyZWFtbGl2ZS50by92aWV3LycraS5zdHJpbmcrJyZhbXA7bGluaz05OSZhbXA7bW9kZT1pTGl2ZVBsYXknCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlsaXZlID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby50YmguaWxpdmUvP3VybD0nK2kuc3RyaW5nKycmYW1wO2xpbms9OTkmYW1wO21vZGU9aUxpdmVQbGF5JwogICAgICAgICAgICAgICAgZWxpZiBsZW4oaXRlbSgneXQtZGwnKSkgPjA6CiAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gaXRlbSgneXQtZGwnKToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGkuc3RyaW5nID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5dGRsID0gaS5zdHJpbmcgKyAnJm1vZGU9MTgnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmwuYXBwZW5kKHl0ZGwpCiAgICAgICAgICAgICAgICBlbGlmIGxlbihpdGVtKCdkbScpKSA+MDoKICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBpdGVtKCdkbScpOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgaS5zdHJpbmcgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRtID0gInBsdWdpbjovL3BsdWdpbi52aWRlby5kYWlseW1vdGlvbl9jb20vP21vZGU9cGxheVZpZGVvJnVybD0iICsgaS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybC5hcHBlbmQoZG0pCiAgICAgICAgICAgICAgICBlbGlmIGxlbihpdGVtKCdkbWxpdmUnKSkgPjA6CiAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gaXRlbSgnZG1saXZlJyk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBpLnN0cmluZyA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG0gPSAicGx1Z2luOi8vcGx1Z2luLnZpZGVvLmRhaWx5bW90aW9uX2NvbS8/bW9kZT1wbGF5TGl2ZVZpZGVvJnVybD0iICsgaS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybC5hcHBlbmQoZG0pCiAgICAgICAgICAgICAgICBlbGlmIGxlbihpdGVtKCd1dHViZScpKSA+MDoKICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBpdGVtKCd1dHViZScpOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgaS5zdHJpbmcgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICcgJyBpbiBpLnN0cmluZyA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXR1YmUgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnlvdXR1YmUvc2VhcmNoLz9xPScrIHVybGxpYi5xdW90ZV9wbHVzKGkuc3RyaW5nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzSnNvbnJwYz11dHViZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiBsZW4oaS5zdHJpbmcpID09IDExOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV0dWJlID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby55b3V0dWJlL3BsYXkvP3ZpZGVvX2lkPScrIGkuc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGlmIChpLnN0cmluZy5zdGFydHN3aXRoKCdQTCcpIGFuZCBub3QgJyZvcmRlcj0nIGluIGkuc3RyaW5nKSBvciBpLnN0cmluZy5zdGFydHN3aXRoKCdVVScpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV0dWJlID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby55b3V0dWJlL3BsYXkvPyZvcmRlcj1kZWZhdWx0JnBsYXlsaXN0X2lkPScgKyBpLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiBpLnN0cmluZy5zdGFydHN3aXRoKCdQTCcpIG9yIGkuc3RyaW5nLnN0YXJ0c3dpdGgoJ1VVJyk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXR1YmUgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnlvdXR1YmUvcGxheS8/cGxheWxpc3RfaWQ9JyArIGkuc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGlmIGkuc3RyaW5nLnN0YXJ0c3dpdGgoJ1VDJykgYW5kIGxlbihpLnN0cmluZykgPiAxMjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dHViZSA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8ueW91dHViZS9jaGFubmVsLycgKyBpLnN0cmluZyArICcvJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzSnNvbnJwYz11dHViZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiBub3QgaS5zdHJpbmcuc3RhcnRzd2l0aCgnVUMnKSBhbmQgbm90IChpLnN0cmluZy5zdGFydHN3aXRoKCdQTCcpKSAgOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV0dWJlID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby55b3V0dWJlL3VzZXIvJyArIGkuc3RyaW5nICsgJy8nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNKc29ucnBjPXV0dWJlCiAgICAgICAgICAgICAgICAgICAgICAgIHVybC5hcHBlbmQodXR1YmUpCiAgICAgICAgICAgICAgICBlbGlmIGxlbihpdGVtKCdpbWRiJykpID4wOgogICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGl0ZW0oJ2ltZGInKToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGkuc3RyaW5nID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCdnZW5lc2lzb3JwdWxzYXInKSA9PSAnMCc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW1kYiA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8uZ2VuZXNpcy8/YWN0aW9uPXBsYXkmaW1kYj0nK2kuc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltZGIgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnB1bHNhci9tb3ZpZS90dCcraS5zdHJpbmcrJy9wbGF5JwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsLmFwcGVuZChpbWRiKQogICAgICAgICAgICAgICAgZWxpZiBsZW4oaXRlbSgnZjRtJykpID4wOgogICAgICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBpdGVtKCdmNG0nKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBpLnN0cmluZyA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICcuZjRtJyBpbiBpLnN0cmluZzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZjRtID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby5mNG1UZXN0ZXIvP3VybD0nK3VybGxpYi5xdW90ZV9wbHVzKGkuc3RyaW5nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgJy5tM3U4JyBpbiBpLnN0cmluZzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZjRtID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby5mNG1UZXN0ZXIvP3VybD0nK3VybGxpYi5xdW90ZV9wbHVzKGkuc3RyaW5nKSsnJmFtcDtzdHJlYW10eXBlPUhMUycKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZjRtID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby5mNG1UZXN0ZXIvP3VybD0nK3VybGxpYi5xdW90ZV9wbHVzKGkuc3RyaW5nKSsnJmFtcDtzdHJlYW10eXBlPVNJTVBMRScKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybC5hcHBlbmQoZjRtKQogICAgICAgICAgICAgICAgZWxpZiBsZW4oaXRlbSgnZnR2JykpID4wOgogICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGl0ZW0oJ2Z0dicpOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgaS5zdHJpbmcgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ0diA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8uRi5ULlYvP25hbWU9Jyt1cmxsaWIucXVvdGUobmFtZSkgKycmdXJsPScgK2kuc3RyaW5nICsnJm1vZGU9MTI1JmNoX2ZhbmFydD1uYScKICAgICAgICAgICAgICAgICAgICAgICAgdXJsLmFwcGVuZChmdHYpCiAgICAgICAgICAgICAgICBlbGlmIGxlbihpdGVtKCd1cmxzb2x2ZScpKSA+MDoKICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBpdGVtKCd1cmxzb2x2ZScpOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgaS5zdHJpbmcgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmVyID0gaS5zdHJpbmcgKycmbW9kZT0xOScKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybC5hcHBlbmQocmVzb2x2ZXIpCiAgICAgICAgICAgICAgICBpZiBsZW4odXJsKSA8IDE6CiAgICAgICAgICAgICAgICAgICAgcmFpc2UKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgYWRkb25fbG9nKCdFcnJvciA8bGluaz4gZWxlbWVudCwgUGFzc2luZzonK25hbWUuZW5jb2RlKCd1dGYtOCcsICdpZ25vcmUnKSkKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGlzWE1MU291cmNlID0gaXRlbSgnZXh0ZXJuYWxsaW5rJylbMF0uc3RyaW5nCiAgICAgICAgICAgIGV4Y2VwdDogcGFzcwoKICAgICAgICAgICAgaWYgaXNYTUxTb3VyY2U6CiAgICAgICAgICAgICAgICBleHRfdXJsPVtpc1hNTFNvdXJjZV0KICAgICAgICAgICAgICAgIGlzWE1MU291cmNlPVRydWUKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGlzWE1MU291cmNlPUZhbHNlCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGlzSnNvbnJwYyA9IGl0ZW0oJ2pzb25ycGMnKVswXS5zdHJpbmcKICAgICAgICAgICAgZXhjZXB0OiBwYXNzCiAgICAgICAgICAgIGlmIGlzSnNvbnJwYzoKCiAgICAgICAgICAgICAgICBleHRfdXJsPVtpc0pzb25ycGNdCiAgICAgICAgICAgICAgICAjcHJpbnQgJ0pTT04tUlBDIGV4dF91cmwnLGV4dF91cmwKICAgICAgICAgICAgICAgIGlzSnNvbnJwYz1UcnVlCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBpc0pzb25ycGM9RmFsc2UKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgdGh1bWJuYWlsID0gaXRlbSgndGh1bWJuYWlsJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICBpZiB0aHVtYm5haWwgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICByYWlzZQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICB0aHVtYm5haWwgPSAnJwogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBpZiBub3QgaXRlbSgnZmFuYXJ0Jyk6CiAgICAgICAgICAgICAgICAgICAgaWYgYWRkb24uZ2V0U2V0dGluZygndXNlX3RodW1iJykgPT0gInRydWUiOgogICAgICAgICAgICAgICAgICAgICAgICBmYW5BcnQgPSB0aHVtYm5haWwKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBmYW5BcnQgPSBmYW5hcnQKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgZmFuQXJ0ID0gaXRlbSgnZmFuYXJ0JylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICBpZiBmYW5BcnQgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICByYWlzZQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBmYW5BcnQgPSBmYW5hcnQKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgZGVzYyA9IGl0ZW0oJ2luZm8nKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgIGlmIGRlc2MgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICByYWlzZQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBkZXNjID0gJycKCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGdlbnJlID0gaXRlbSgnZ2VucmUnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgIGlmIGdlbnJlID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgcmFpc2UKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgZ2VucmUgPSAnJwoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgZGF0ZSA9IGl0ZW0oJ2RhdGUnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgIGlmIGRhdGUgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICByYWlzZQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBkYXRlID0gJycKCiAgICAgICAgICAgIHJlZ2V4cyA9IE5vbmUKICAgICAgICAgICAgaWYgaXRlbSgncmVnZXgnKToKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICByZWdfaXRlbSA9IGl0ZW0oJ3JlZ2V4JykKICAgICAgICAgICAgICAgICAgICByZWdleHMgPSBwYXJzZV9yZWdleChyZWdfaXRlbSkKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGlmIGxlbih1cmwpID4gMToKICAgICAgICAgICAgICAgICAgICBhbHQgPSAwCiAgICAgICAgICAgICAgICAgICAgcGxheWxpc3QgPSBbXQogICAgICAgICAgICAgICAgICAgIGZvciBpIGluIHVybDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICBhZGRfcGxheWxpc3QgPT0gImZhbHNlIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbHQgKz0gMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZExpbmsoaSwnJXMpICVzJyAlKGFsdCwgbmFtZS5lbmNvZGUoJ3V0Zi04JywgJ2lnbm9yZScpKSx0aHVtYm5haWwsZmFuQXJ0LGRlc2MsZ2VucmUsZGF0ZSxUcnVlLHBsYXlsaXN0LHJlZ2V4cyx0b3RhbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgIGFkZF9wbGF5bGlzdCA9PSAidHJ1ZSIgYW5kICBhc2tfcGxheWxpc3RfaXRlbXMgPT0gJ3RydWUnOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHJlZ2V4czoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxheWxpc3QuYXBwZW5kKGkrJyZyZWdleHM9JytyZWdleHMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiAgYW55KHggaW4gaSBmb3IgeCBpbiByZXNvbHZlX3VybCkgYW5kICBpLnN0YXJ0c3dpdGgoJ2h0dHAnKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxheWxpc3QuYXBwZW5kKGkrJyZtb2RlPTE5JykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGF5bGlzdC5hcHBlbmQoaSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxheWxpc3QuYXBwZW5kKGkpCiAgICAgICAgICAgICAgICAgICAgaWYgbGVuKHBsYXlsaXN0KSA+IDE6CiAgICAgICAgICAgICAgICAgICAgICAgIGFkZExpbmsoJycsIG5hbWUsdGh1bWJuYWlsLGZhbkFydCxkZXNjLGdlbnJlLGRhdGUsVHJ1ZSxwbGF5bGlzdCxyZWdleHMsdG90YWwpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGlmIGlzWE1MU291cmNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IHJlZ2V4cyA9PSBOb25lOiAjPGV4dGVybmFsbGluaz4gYW5kIDxyZWdleD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGREaXIobmFtZS5lbmNvZGUoJ3V0Zi04JyksZXh0X3VybFswXS5lbmNvZGUoJ3V0Zi04JyksMSx0aHVtYm5haWwsZmFuYXJ0LGRlc2MsZ2VucmUsZGF0ZSxOb25lLCchIXVwZGF0ZScscmVnZXhzLHVybFswXS5lbmNvZGUoJ3V0Zi04JykpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgI2FkZExpbmsodXJsWzBdLG5hbWUuZW5jb2RlKCd1dGYtOCcsICdpZ25vcmUnKSsgICdbQ09MT1IgeWVsbG93XWJ1aWxkIFhNTFsvQ09MT1JdJyx0aHVtYm5haWwsZmFuQXJ0LGRlc2MsZ2VucmUsZGF0ZSxUcnVlLE5vbmUscmVnZXhzLHRvdGFsKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGREaXIobmFtZS5lbmNvZGUoJ3V0Zi04JyksZXh0X3VybFswXS5lbmNvZGUoJ3V0Zi04JyksMSx0aHVtYm5haWwsZmFuYXJ0LGRlc2MsZ2VucmUsZGF0ZSxOb25lLCdzb3VyY2UnLE5vbmUsTm9uZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjYWRkRGlyKG5hbWUuZW5jb2RlKCd1dGYtOCcpLHVybFswXS5lbmNvZGUoJ3V0Zi04JyksMSx0aHVtYm5haWwsZmFuYXJ0LGRlc2MsZ2VucmUsZGF0ZSxOb25lLCdzb3VyY2UnKQogICAgICAgICAgICAgICAgICAgIGVsaWYgaXNKc29ucnBjOgogICAgICAgICAgICAgICAgICAgICAgICBhZGREaXIobmFtZS5lbmNvZGUoJ3V0Zi04JyksZXh0X3VybFswXSw1Myx0aHVtYm5haWwsZmFuYXJ0LGRlc2MsZ2VucmUsZGF0ZSxOb25lLCdzb3VyY2UnKQogICAgICAgICAgICAgICAgICAgICAgICAjeGJtYy5leGVjdXRlYnVpbHRpbigiQ29udGFpbmVyLlNldFZpZXdNb2RlKDUwMCkiKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIGFkZExpbmsodXJsWzBdLG5hbWUuZW5jb2RlKCd1dGYtOCcsICdpZ25vcmUnKSx0aHVtYm5haWwsZmFuQXJ0LGRlc2MsZ2VucmUsZGF0ZSxUcnVlLE5vbmUscmVnZXhzLHRvdGFsKQogICAgICAgICAgICAgICAgICAgICNwcmludCAnc3VjY2VzcycKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgYWRkb25fbG9nKCdUaGVyZSB3YXMgYSBwcm9ibGVtIGFkZGluZyBpdGVtIC0gJytuYW1lLmVuY29kZSgndXRmLTgnLCAnaWdub3JlJykpCgpkZWYgcGFyc2VfcmVnZXgocmVnX2l0ZW0pOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIHJlZ2V4cyA9IHt9CiAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gcmVnX2l0ZW06CiAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXSA9IHt9CiAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnbmFtZSddPWkoJ25hbWUnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgI3JlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnZXhwcmVzJ10gPSBpKCdleHByZXMnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydleHByZXMnXSA9IGkoJ2V4cHJlcycpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnZXhwcmVzJ106CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydleHByZXMnXT0nJwogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBObyBSZWZlcmVyIC0tIikKICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydwYWdlJ10gPSBpKCdwYWdlJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsncmVmZXJlciddID0gaSgncmVmZXJlcicpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBObyBSZWZlcmVyIC0tIikKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydjb25uZWN0aW9uJ10gPSBpKCdjb25uZWN0aW9uJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vIGNvbm5lY3Rpb24gLS0iKQoKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydub3RwbGF5YWJsZSddID0gaSgnbm90cGxheWFibGUnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm8gbm90cGxheWFibGUgLS0iKQoKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydub3JlZGlyZWN0J10gPSBpKCdub3JlZGlyZWN0JylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vIG5vcmVkaXJlY3QgLS0iKQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ29yaWdpbiddID0gaSgnb3JpZ2luJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vIG9yaWdpbiAtLSIpCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnYWNjZXB0J10gPSBpKCdhY2NlcHQnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm8gYWNjZXB0IC0tIikKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydpbmNsdWRlaGVhZGVycyddID0gaSgnaW5jbHVkZWhlYWRlcnMnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm8gaW5jbHVkZWhlYWRlcnMgLS0iKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ2xpc3RyZXBlYXQnXSA9IGkoJ2xpc3RyZXBlYXQnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICdsaXN0cmVwZWF0JyxyZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ2xpc3RyZXBlYXQnXSxpKCdsaXN0cmVwZWF0JylbMF0uc3RyaW5nLCBpCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vIGxpc3RyZXBlYXQgLS0iKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgCgogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ3Byb3h5J10gPSBpKCdwcm94eScpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBObyBwcm94eSAtLSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWyd4LXJlcSddID0gaSgneC1yZXEnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm8geC1yZXEgLS0iKQoKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWyd4LWFkZHInXSA9IGkoJ3gtYWRkcicpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBObyB4LWFkZHIgLS0iKSAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ3gtZm9yd2FyZCddID0gaSgneC1mb3J3YXJkJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vIHgtZm9yd2FyZCAtLSIpCgogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ2FnZW50J10gPSBpKCdhZ2VudCcpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBObyBVc2VyIEFnZW50IC0tIikKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydwb3N0J10gPSBpKCdwb3N0JylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vdCBhIHBvc3QiKQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ3Jhd3Bvc3QnXSA9IGkoJ3Jhd3Bvc3QnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm90IGEgcmF3cG9zdCIpCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnaHRtbHVuZXNjYXBlJ10gPSBpKCdodG1sdW5lc2NhcGUnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm90IGEgaHRtbHVuZXNjYXBlIikKCgogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ3JlYWRjb29raWVvbmx5J10gPSBpKCdyZWFkY29va2llb25seScpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBOb3QgYSByZWFkQ29va2llT25seSIpCiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCBpCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnY29va2llamFyJ10gPSBpKCdjb29raWVqYXInKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ2Nvb2tpZWphciddOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnY29va2llamFyJ109JycKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm90IGEgY29va2llSmFyIikKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydzZXRjb29raWUnXSA9IGkoJ3NldGNvb2tpZScpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBOb3QgYSBzZXRjb29raWUiKQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ2FwcGVuZGNvb2tpZSddID0gaSgnYXBwZW5kY29va2llJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vdCBhIGFwcGVuZGNvb2tpZSIpCgogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ2lnbm9yZWNhY2hlJ10gPSBpKCdpZ25vcmVjYWNoZScpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBubyBpZ25vcmVjYWNoZSIpCiAgICAgICAgICAgICAgICAgICAgICAgICN0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICMgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydpZ25vcmVjYWNoZSddID0gaSgnaWdub3JlY2FjaGUnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgI2V4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgIyAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBubyBpZ25vcmVjYWNoZSIpCgogICAgICAgICAgICAgICAgICAgIHJlZ2V4cyA9IHVybGxpYi5xdW90ZShyZXByKHJlZ2V4cykpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlZ2V4cwogICAgICAgICAgICAgICAgICAgICNwcmludCByZWdleHMKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICByZWdleHMgPSBOb25lCiAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCdyZWdleCBFcnJvcjogJytuYW1lLmVuY29kZSgndXRmLTgnLCAnaWdub3JlJykpCiNjb3BpZXMgZnJvbSBsYW1kYSdzIGltcGxlbWVudGF0aW9uCmRlZiBnZXRfdXN0cmVhbSh1cmwpOgogICAgdHJ5OgogICAgICAgIGZvciBpIGluIHJhbmdlKDEsIDUxKToKICAgICAgICAgICAgcmVzdWx0ID0gZ2V0VXJsKHVybCkKICAgICAgICAgICAgaWYgIkVYVC1YLVNUUkVBTS1JTkYiIGluIHJlc3VsdDogcmV0dXJuIHVybAogICAgICAgICAgICBpZiBub3QgIkVYVE0zVSIgaW4gcmVzdWx0OiByZXR1cm4KICAgICAgICAgICAgeGJtYy5zbGVlcCgyMDAwKQogICAgICAgIHJldHVybgogICAgZXhjZXB0OgogICAgICAgIHJldHVybgoKZGVmIGdldFJlZ2V4UGFyc2VkKHJlZ2V4cywgdXJsLGNvb2tpZUphcj1Ob25lLGZvckNvb2tpZUphck9ubHk9RmFsc2UscmVjdXJzaXZlQ2FsbD1GYWxzZSxjYWNoZWRQYWdlcz17fSwgcmF3UG9zdD1GYWxzZSwgY29va2llX2phcl9maWxlPU5vbmUpOiMwLDEsMiA9IFVSTCwgcmVnZXhPbmx5LCBDb29raWVKYXJPbmx5CiAgICAgICAgaWYgbm90IHJlY3Vyc2l2ZUNhbGw6CiAgICAgICAgICAgIHJlZ2V4cyA9IGV2YWwodXJsbGliLnVucXVvdGUocmVnZXhzKSkKICAgICAgICAjY2FjaGVkUGFnZXMgPSB7fQogICAgICAgICNwcmludCAndXJsJyx1cmwKICAgICAgICBkb1JlZ2V4cyA9IHJlLmNvbXBpbGUoJ1wkZG9yZWdleFxbKFteXF1dKilcXScpLmZpbmRhbGwodXJsKQojICAgICAgICBwcmludCAnZG9SZWdleHMnLGRvUmVnZXhzLHJlZ2V4cwogICAgICAgIHNldHJlc29sdmVkPVRydWUKICAgICAgICBmb3IgayBpbiBkb1JlZ2V4czoKICAgICAgICAgICAgaWYgayBpbiByZWdleHM6CiAgICAgICAgICAgICAgICAjcHJpbnQgJ3Byb2Nlc3NpbmcgJyAsawogICAgICAgICAgICAgICAgbSA9IHJlZ2V4c1trXQogICAgICAgICAgICAgICAgI3ByaW50IG0KICAgICAgICAgICAgICAgIGNvb2tpZUphclBhcmFtPUZhbHNlCiAgICAgICAgICAgICAgICBpZiAgJ2Nvb2tpZWphcicgaW4gbTogIyBzbyBlaXRoZXIgY3JlYXRlIG9yIHJldXNlIGV4aXN0aW5nIGphcgogICAgICAgICAgICAgICAgICAgICNwcmludCAnY29va2llamFyIGV4aXN0cycsbVsnY29va2llamFyJ10KICAgICAgICAgICAgICAgICAgICBjb29raWVKYXJQYXJhbT1tWydjb29raWVqYXInXQogICAgICAgICAgICAgICAgICAgIGlmICAnJGRvcmVnZXgnIGluIGNvb2tpZUphclBhcmFtOgogICAgICAgICAgICAgICAgICAgICAgICBjb29raWVKYXI9Z2V0UmVnZXhQYXJzZWQocmVnZXhzLCBtWydjb29raWVqYXInXSxjb29raWVKYXIsVHJ1ZSwgVHJ1ZSxjYWNoZWRQYWdlcykKICAgICAgICAgICAgICAgICAgICAgICAgY29va2llSmFyUGFyYW09VHJ1ZQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIGNvb2tpZUphclBhcmFtPVRydWUKICAgICAgICAgICAgICAgICNwcmludCAnbVtjb29raWVqYXJdJyxtWydjb29raWVqYXInXSxjb29raWVKYXIKICAgICAgICAgICAgICAgIGlmIGNvb2tpZUphclBhcmFtOgogICAgICAgICAgICAgICAgICAgIGlmIGNvb2tpZUphcj09Tm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgI3ByaW50ICdjcmVhdGUgY29va2llIGphcicKICAgICAgICAgICAgICAgICAgICAgICAgY29va2llX2phcl9maWxlPU5vbmUKICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ29wZW5bJyBpbiBtWydjb29raWVqYXInXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvb2tpZV9qYXJfZmlsZT1tWydjb29raWVqYXInXS5zcGxpdCgnb3BlblsnKVsxXS5zcGxpdCgnXScpWzBdCgogICAgICAgICAgICAgICAgICAgICAgICBjb29raWVKYXI9Z2V0Q29va2llSmFyKGNvb2tpZV9qYXJfZmlsZSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgY29va2llX2phcl9maWxlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2F2ZUNvb2tpZUphcihjb29raWVKYXIsY29va2llX2phcl9maWxlKQogICAgICAgICAgICAgICAgICAgICAgICAjaW1wb3J0IGNvb2tpZWxpYgogICAgICAgICAgICAgICAgICAgICAgICAjY29va2llSmFyID0gY29va2llbGliLkxXUENvb2tpZUphcigpCiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAnY29va2llSmFyIG5ldycsY29va2llSmFyCiAgICAgICAgICAgICAgICAgICAgZWxpZiAnc2F2ZVsnIGluIG1bJ2Nvb2tpZWphciddOgogICAgICAgICAgICAgICAgICAgICAgICBjb29raWVfamFyX2ZpbGU9bVsnY29va2llamFyJ10uc3BsaXQoJ3NhdmVbJylbMV0uc3BsaXQoJ10nKVswXQogICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZV9wYXRoPW9zLnBhdGguam9pbihwcm9maWxlLGNvb2tpZV9qYXJfZmlsZSkKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ2NvbXBsZXRlX3BhdGgnLGNvbXBsZXRlX3BhdGgKICAgICAgICAgICAgICAgICAgICAgICAgc2F2ZUNvb2tpZUphcihjb29raWVKYXIsY29va2llX2phcl9maWxlKQogICAgICAgICAgICAgICAgaWYgIG1bJ3BhZ2UnXSBhbmQgJyRkb3JlZ2V4JyBpbiBtWydwYWdlJ106CiAgICAgICAgICAgICAgICAgICAgbVsncGFnZSddPWdldFJlZ2V4UGFyc2VkKHJlZ2V4cywgbVsncGFnZSddLGNvb2tpZUphcixyZWN1cnNpdmVDYWxsPVRydWUsY2FjaGVkUGFnZXM9Y2FjaGVkUGFnZXMpCgogICAgICAgICAgICAgICAgaWYgJ3NldGNvb2tpZScgaW4gbSBhbmQgbVsnc2V0Y29va2llJ10gYW5kICckZG9yZWdleCcgaW4gbVsnc2V0Y29va2llJ106CiAgICAgICAgICAgICAgICAgICAgbVsnc2V0Y29va2llJ109Z2V0UmVnZXhQYXJzZWQocmVnZXhzLCBtWydzZXRjb29raWUnXSxjb29raWVKYXIscmVjdXJzaXZlQ2FsbD1UcnVlLGNhY2hlZFBhZ2VzPWNhY2hlZFBhZ2VzKQogICAgICAgICAgICAgICAgaWYgJ2FwcGVuZGNvb2tpZScgaW4gbSBhbmQgbVsnYXBwZW5kY29va2llJ10gYW5kICckZG9yZWdleCcgaW4gbVsnYXBwZW5kY29va2llJ106CiAgICAgICAgICAgICAgICAgICAgbVsnYXBwZW5kY29va2llJ109Z2V0UmVnZXhQYXJzZWQocmVnZXhzLCBtWydhcHBlbmRjb29raWUnXSxjb29raWVKYXIscmVjdXJzaXZlQ2FsbD1UcnVlLGNhY2hlZFBhZ2VzPWNhY2hlZFBhZ2VzKQoKCiAgICAgICAgICAgICAgICBpZiAgJ3Bvc3QnIGluIG0gYW5kICckZG9yZWdleCcgaW4gbVsncG9zdCddOgogICAgICAgICAgICAgICAgICAgIG1bJ3Bvc3QnXT1nZXRSZWdleFBhcnNlZChyZWdleHMsIG1bJ3Bvc3QnXSxjb29raWVKYXIscmVjdXJzaXZlQ2FsbD1UcnVlLGNhY2hlZFBhZ2VzPWNhY2hlZFBhZ2VzKQogICAgICAgICAgICAgICAgICAgIHByaW50ICdwb3N0IGlzIG5vdycsbVsncG9zdCddCgogICAgICAgICAgICAgICAgaWYgICdyYXdwb3N0JyBpbiBtIGFuZCAnJGRvcmVnZXgnIGluIG1bJ3Jhd3Bvc3QnXToKICAgICAgICAgICAgICAgICAgICBtWydyYXdwb3N0J109Z2V0UmVnZXhQYXJzZWQocmVnZXhzLCBtWydyYXdwb3N0J10sY29va2llSmFyLHJlY3Vyc2l2ZUNhbGw9VHJ1ZSxjYWNoZWRQYWdlcz1jYWNoZWRQYWdlcyxyYXdQb3N0PVRydWUpCiAgICAgICAgICAgICAgICAgICAgI3ByaW50ICdyYXdwb3N0IGlzIG5vdycsbVsncmF3cG9zdCddCgogICAgICAgICAgICAgICAgaWYgJ3Jhd3Bvc3QnIGluIG0gYW5kICckZXBvY3RpbWUkJyBpbiBtWydyYXdwb3N0J106CiAgICAgICAgICAgICAgICAgICAgbVsncmF3cG9zdCddPW1bJ3Jhd3Bvc3QnXS5yZXBsYWNlKCckZXBvY3RpbWUkJyxnZXRFcG9jVGltZSgpKQoKICAgICAgICAgICAgICAgIGlmICdyYXdwb3N0JyBpbiBtIGFuZCAnJGVwb2N0aW1lMiQnIGluIG1bJ3Jhd3Bvc3QnXToKICAgICAgICAgICAgICAgICAgICBtWydyYXdwb3N0J109bVsncmF3cG9zdCddLnJlcGxhY2UoJyRlcG9jdGltZTIkJyxnZXRFcG9jVGltZTIoKSkKCgogICAgICAgICAgICAgICAgbGluaz0nJwogICAgICAgICAgICAgICAgaWYgbVsncGFnZSddIGFuZCBtWydwYWdlJ10gaW4gY2FjaGVkUGFnZXMgYW5kIG5vdCAnaWdub3JlY2FjaGUnIGluIG0gYW5kIGZvckNvb2tpZUphck9ubHk9PUZhbHNlIDoKICAgICAgICAgICAgICAgICAgICBsaW5rID0gY2FjaGVkUGFnZXNbbVsncGFnZSddXQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBpZiBtWydwYWdlJ10gYW5kICBub3QgbVsncGFnZSddPT0nJyBhbmQgIG1bJ3BhZ2UnXS5zdGFydHN3aXRoKCdodHRwJyk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICckZXBvY3RpbWUkJyBpbiBtWydwYWdlJ106CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtWydwYWdlJ109bVsncGFnZSddLnJlcGxhY2UoJyRlcG9jdGltZSQnLGdldEVwb2NUaW1lKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICckZXBvY3RpbWUyJCcgaW4gbVsncGFnZSddOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbVsncGFnZSddPW1bJ3BhZ2UnXS5yZXBsYWNlKCckZXBvY3RpbWUyJCcsZ2V0RXBvY1RpbWUyKCkpCgogICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ0luZ29yaW5nIENhY2hlJyxtWydwYWdlJ10KICAgICAgICAgICAgICAgICAgICAgICAgcGFnZV9zcGxpdD1tWydwYWdlJ10uc3BsaXQoJ3wnKQogICAgICAgICAgICAgICAgICAgICAgICBwYWdlVXJsPXBhZ2Vfc3BsaXRbMF0KICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyX2luX3BhZ2U9Tm9uZQogICAgICAgICAgICAgICAgICAgICAgICBpZiBsZW4ocGFnZV9zcGxpdCk+MToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcl9pbl9wYWdlPXBhZ2Vfc3BsaXRbMV0KCiMgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgCiMgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJveHkgPSB1cmxsaWIyLlByb3h5SGFuZGxlcih7ICgnaHR0cHMnID8gcHJveHl0b3VzZVs6NV09PSJodHRwcyI6Imh0dHAiKSA6IHByb3h5dG91c2V9KQojICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wZW5lciA9IHVybGxpYjIuYnVpbGRfb3BlbmVyKHByb3h5KQojICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybGxpYjIuaW5zdGFsbF9vcGVuZXIob3BlbmVyKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAKIyAgICAgICAgICAgICAgICAgICAgICAgIGltcG9ydCB1cmxsaWIyCiMgICAgICAgICAgICAgICAgICAgICAgICBwcmludCAndXJsbGliMi5nZXRwcm94aWVzJyx1cmxsaWIyLmdldHByb3hpZXMoKQogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50X3Byb3hpZXM9dXJsbGliMi5Qcm94eUhhbmRsZXIodXJsbGliMi5nZXRwcm94aWVzKCkpCiAgICAgICAgCiAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICByZXEgPSB1cmxsaWIyLlJlcXVlc3QocGFnZVVybCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ3Byb3h5JyBpbiBtOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJveHl0b3VzZT0gbVsncHJveHknXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ3Byb3h5dG91c2UnLHByb3h5dG91c2UKIyAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmxsaWIyLmdldHByb3hpZXM9IGxhbWJkYToge30KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHBhZ2VVcmxbOjVdPT0iaHR0cHMiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3h5ID0gdXJsbGliMi5Qcm94eUhhbmRsZXIoeyAnaHR0cHMnIDogcHJveHl0b3VzZX0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgI3JlcS5zZXRfcHJveHkocHJveHl0b3VzZSwgJ2h0dHBzJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJveHkgPSB1cmxsaWIyLlByb3h5SGFuZGxlcih7ICdodHRwJyAgOiBwcm94eXRvdXNlfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjcmVxLnNldF9wcm94eShwcm94eXRvdXNlLCAnaHR0cCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGVuZXIgPSB1cmxsaWIyLmJ1aWxkX29wZW5lcihwcm94eSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybGxpYjIuaW5zdGFsbF9vcGVuZXIob3BlbmVyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICByZXEuYWRkX2hlYWRlcignVXNlci1BZ2VudCcsICdNb3ppbGxhLzUuMCAoV2luZG93cyBOVCA2LjE7IHJ2OjE0LjApIEdlY2tvLzIwMTAwMTAxIEZpcmVmb3gvMTQuMC4xJykKICAgICAgICAgICAgICAgICAgICAgICAgcHJveHl0b3VzZT1Ob25lCgogICAgICAgICAgICAgICAgICAgICAgICBpZiAncmVmZXJlcicgaW4gbToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5hZGRfaGVhZGVyKCdSZWZlcmVyJywgbVsncmVmZXJlciddKQogICAgICAgICAgICAgICAgICAgICAgICBpZiAnYWNjZXB0JyBpbiBtOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ0FjY2VwdCcsIG1bJ2FjY2VwdCddKQogICAgICAgICAgICAgICAgICAgICAgICBpZiAnYWdlbnQnIGluIG06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXEuYWRkX2hlYWRlcignVXNlci1hZ2VudCcsIG1bJ2FnZW50J10pCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICd4LXJlcScgaW4gbToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5hZGRfaGVhZGVyKCdYLVJlcXVlc3RlZC1XaXRoJywgbVsneC1yZXEnXSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ3gtYWRkcicgaW4gbToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5hZGRfaGVhZGVyKCd4LWFkZHInLCBtWyd4LWFkZHInXSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ3gtZm9yd2FyZCcgaW4gbToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5hZGRfaGVhZGVyKCdYLUZvcndhcmRlZC1Gb3InLCBtWyd4LWZvcndhcmQnXSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ3NldGNvb2tpZScgaW4gbToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICdhZGRpbmcgY29va2llJyxtWydzZXRjb29raWUnXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ0Nvb2tpZScsIG1bJ3NldGNvb2tpZSddKQogICAgICAgICAgICAgICAgICAgICAgICBpZiAnYXBwZW5kY29va2llJyBpbiBtOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ2FwcGVuZGluZyBjb29raWUgdG8gY29va2llamFyJyxtWydhcHBlbmRjb29raWUnXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29va2llc3RvQXBlbmQ9bVsnYXBwZW5kY29va2llJ10KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvb2tpZXN0b0FwZW5kPWNvb2tpZXN0b0FwZW5kLnNwbGl0KCc7JykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBoIGluIGNvb2tpZXN0b0FwZW5kOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG4sdj1oLnNwbGl0KCc9JykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3LG49IG4uc3BsaXQoJzonKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNrID0gY29va2llbGliLkNvb2tpZSh2ZXJzaW9uPTAsIG5hbWU9biwgdmFsdWU9diwgcG9ydD1Ob25lLCBwb3J0X3NwZWNpZmllZD1GYWxzZSwgZG9tYWluPXcsIGRvbWFpbl9zcGVjaWZpZWQ9RmFsc2UsIGRvbWFpbl9pbml0aWFsX2RvdD1GYWxzZSwgcGF0aD0nLycsIHBhdGhfc3BlY2lmaWVkPVRydWUsIHNlY3VyZT1GYWxzZSwgZXhwaXJlcz1Ob25lLCBkaXNjYXJkPVRydWUsIGNvbW1lbnQ9Tm9uZSwgY29tbWVudF91cmw9Tm9uZSwgcmVzdD17J0h0dHBPbmx5JzogTm9uZX0sIHJmYzIxMDk9RmFsc2UpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29va2llSmFyLnNldF9jb29raWUoY2spCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdvcmlnaW4nIGluIG06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXEuYWRkX2hlYWRlcignT3JpZ2luJywgbVsnb3JpZ2luJ10pCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGhlYWRlcl9pbl9wYWdlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyX2luX3BhZ2U9aGVhZGVyX2luX3BhZ2Uuc3BsaXQoJyYnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGggaW4gaGVhZGVyX2luX3BhZ2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbix2PWguc3BsaXQoJz0nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5hZGRfaGVhZGVyKG4sdikKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGNvb2tpZUphcj09Tm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAnY29va2llSmFyVmFsJyxjb29raWVKYXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvb2tpZV9oYW5kbGVyID0gdXJsbGliMi5IVFRQQ29va2llUHJvY2Vzc29yKGNvb2tpZUphcikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wZW5lciA9IHVybGxpYjIuYnVpbGRfb3BlbmVyKGNvb2tpZV9oYW5kbGVyLCB1cmxsaWIyLkhUVFBCYXNpY0F1dGhIYW5kbGVyKCksIHVybGxpYjIuSFRUUEhhbmRsZXIoKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wZW5lciA9IHVybGxpYjIuaW5zdGFsbF9vcGVuZXIob3BlbmVyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ25vcmVkaXJlY3QnLCdub3JlZGlyZWN0JyBpbiBtCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICdub3JlZGlyZWN0JyBpbiBtOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wZW5lcjIgPSB1cmxsaWIyLmJ1aWxkX29wZW5lcihOb1JlZGlyZWN0aW9uKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wZW5lciA9IHVybGxpYjIuaW5zdGFsbF9vcGVuZXIob3BlbmVyMikKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdjb25uZWN0aW9uJyBpbiBtOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJy4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uY29ubmVjdGlvbi8vLy8vLy4nLG1bJ2Nvbm5lY3Rpb24nXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZnJvbSBrZWVwYWxpdmUgaW1wb3J0IEhUVFBIYW5kbGVyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZWVwYWxpdmVfaGFuZGxlciA9IEhUVFBIYW5kbGVyKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wZW5lciA9IHVybGxpYjIuYnVpbGRfb3BlbmVyKGtlZXBhbGl2ZV9oYW5kbGVyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsbGliMi5pbnN0YWxsX29wZW5lcihvcGVuZXIpCgoKICAgICAgICAgICAgICAgICAgICAgICAgI3ByaW50ICdhZnRlciBjb29raWUgamFyJwogICAgICAgICAgICAgICAgICAgICAgICBwb3N0PU5vbmUKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdwb3N0JyBpbiBtOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zdERhdGE9bVsncG9zdCddCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAnJExpdmVTdHJlYW1SZWNhcHRjaGEnIGluIHBvc3REYXRhOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChjYXB0Y2hhX2NoYWxsZW5nZSxjYXRwY2hhX3dvcmQpPXByb2Nlc3NSZWNhcHRjaGEobVsncGFnZSddKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGNhcHRjaGFfY2hhbGxlbmdlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3N0RGF0YSs9J3JlY2FwdGNoYV9jaGFsbGVuZ2VfZmllbGQ6JytjYXB0Y2hhX2NoYWxsZW5nZSsnLHJlY2FwdGNoYV9yZXNwb25zZV9maWVsZDonK2NhdHBjaGFfd29yZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3BsaXRwb3N0PXBvc3REYXRhLnNwbGl0KCcsJyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3N0PXt9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgcCBpbiBzcGxpdHBvc3Q6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbj1wLnNwbGl0KCc6JylbMF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdj1wLnNwbGl0KCc6JylbMV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zdFtuXT12CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3N0ID0gdXJsbGliLnVybGVuY29kZShwb3N0KQoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ3Jhd3Bvc3QnIGluIG06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3N0PW1bJ3Jhd3Bvc3QnXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgJyRMaXZlU3RyZWFtUmVjYXB0Y2hhJyBpbiBwb3N0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChjYXB0Y2hhX2NoYWxsZW5nZSxjYXRwY2hhX3dvcmQpPXByb2Nlc3NSZWNhcHRjaGEobVsncGFnZSddKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGNhcHRjaGFfY2hhbGxlbmdlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc3QrPScmcmVjYXB0Y2hhX2NoYWxsZW5nZV9maWVsZD0nK2NhcHRjaGFfY2hhbGxlbmdlKycmcmVjYXB0Y2hhX3Jlc3BvbnNlX2ZpZWxkPScrY2F0cGNoYV93b3JkCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHBvc3Q6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZSA9IHVybGxpYjIudXJsb3BlbihyZXEscG9zdCkKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gdXJsbGliMi51cmxvcGVuKHJlcSkKCiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmsgPSByZXNwb25zZS5yZWFkKCkKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdwcm94eScgaW4gbSBhbmQgbm90IGN1cnJlbnRfcHJveGllcyBpcyBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsbGliMi5pbnN0YWxsX29wZW5lcih1cmxsaWIyLmJ1aWxkX29wZW5lcihjdXJyZW50X3Byb3hpZXMpKQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgbGluaz1qYXZhc2NyaXB0VW5Fc2NhcGUobGluaykKICAgICAgICAgICAgICAgICAgICAgICAgI3ByaW50IGxpbmsgVGhpcyBqdXN0IHByaW50IHdob2xlIHdlYnBhZ2UgaW4gTE9HCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdpbmNsdWRlaGVhZGVycycgaW4gbToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICNsaW5rKz1zdHIocmVzcG9uc2UuaGVhZGVycy5nZXQoJ1NldC1Db29raWUnKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmsrPSckJEhFQURFUlNfU1RBUlQkJDonCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgYiBpbiByZXNwb25zZS5oZWFkZXJzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmsrPSBiKyc6JytyZXNwb25zZS5oZWFkZXJzLmdldChiKSsnXG4nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5rKz0nJCRIRUFERVJTX0VORCQkOicKIyAgICAgICAgICAgICAgICAgICAgICAgIHByaW50IGxpbmsKICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKGxpbmspCiAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZyhjb29raWVKYXIgKQoKICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UuY2xvc2UoKQogICAgICAgICAgICAgICAgICAgICAgICBjYWNoZWRQYWdlc1ttWydwYWdlJ11dID0gbGluawogICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgbGluawogICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ3N0b3JlIGxpbmsgZm9yJyxtWydwYWdlJ10sZm9yQ29va2llSmFyT25seQoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgZm9yQ29va2llSmFyT25seToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjb29raWVKYXIjIGRvIG5vdGhpbmcKICAgICAgICAgICAgICAgICAgICBlbGlmIG1bJ3BhZ2UnXSBhbmQgIG5vdCBtWydwYWdlJ10uc3RhcnRzd2l0aCgnaHR0cCcpOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBtWydwYWdlJ10uc3RhcnRzd2l0aCgnJHB5RnVuY3Rpb246Jyk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWw9ZG9FdmFsKG1bJ3BhZ2UnXS5zcGxpdCgnJHB5RnVuY3Rpb246JylbMV0sJycsY29va2llSmFyLG0gKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgZm9yQ29va2llSmFyT25seToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29va2llSmFyIyBkbyBub3RoaW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5rPXZhbAogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluaz1tWydwYWdlJ10KICAgICAgICAgICAgICAgIGlmICckcHlGdW5jdGlvbjpwbGF5bWVkaWEoJyBpbiBtWydleHByZXMnXSBvciAnQWN0aXZhdGVXaW5kb3cnICBpbiBtWydleHByZXMnXSAgb3IgJyRQTEFZRVJQUk9YWSQ9JyBpbiB1cmwgIG9yICBhbnkoeCBpbiB1cmwgZm9yIHggaW4gZ19pZ25vcmVTZXRSZXNvbHZlZCk6CiAgICAgICAgICAgICAgICAgICAgc2V0cmVzb2x2ZWQ9RmFsc2UKICAgICAgICAgICAgICAgIGlmICAnJGRvcmVnZXgnIGluIG1bJ2V4cHJlcyddOgogICAgICAgICAgICAgICAgICAgIG1bJ2V4cHJlcyddPWdldFJlZ2V4UGFyc2VkKHJlZ2V4cywgbVsnZXhwcmVzJ10sY29va2llSmFyLHJlY3Vyc2l2ZUNhbGw9VHJ1ZSxjYWNoZWRQYWdlcz1jYWNoZWRQYWdlcykKICAgICAgICAgICAgICAgIGlmIG5vdCBtWydleHByZXMnXT09Jyc6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ2RvaW5nIGl0ICcsbVsnZXhwcmVzJ10KICAgICAgICAgICAgICAgICAgICBpZiAnJExpdmVTdHJlYW1DYXB0Y2hhJyBpbiBtWydleHByZXMnXToKICAgICAgICAgICAgICAgICAgICAgICAgdmFsPWFza0NhcHRjaGEobSxsaW5rLGNvb2tpZUphcikKICAgICAgICAgICAgICAgICAgICAgICAgI3ByaW50ICd1cmwgYW5kIHZhbCcsdXJsLHZhbAogICAgICAgICAgICAgICAgICAgICAgICB1cmwgPSB1cmwucmVwbGFjZSgiJGRvcmVnZXhbIiArIGsgKyAiXSIsIHZhbCkKICAgICAgICAgICAgICAgICAgICBlbGlmIG1bJ2V4cHJlcyddLnN0YXJ0c3dpdGgoJyRweUZ1bmN0aW9uOicpIG9yICcjJHB5RnVuY3Rpb24nIGluIG1bJ2V4cHJlcyddOgogICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ2V4cGVlZWVlZWVlZWVlZWVlZWVlZWUnLG1bJ2V4cHJlcyddCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG1bJ2V4cHJlcyddLnN0YXJ0c3dpdGgoJyRweUZ1bmN0aW9uOicpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsPWRvRXZhbChtWydleHByZXMnXS5zcGxpdCgnJHB5RnVuY3Rpb246JylbMV0sbGluayxjb29raWVKYXIsbSkKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbD1kb0V2YWxGdW5jdGlvbihtWydleHByZXMnXSxsaW5rLGNvb2tpZUphcixtKQogICAgICAgICAgICAgICAgICAgICAgICBpZiAnQWN0aXZhdGVXaW5kb3cnIGluIG1bJ2V4cHJlcyddOiByZXR1cm4KICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ3VybCBrIHZhbCcsdXJsLGssdmFsCgogICAgICAgICAgICAgICAgICAgICAgICB1cmwgPSB1cmwucmVwbGFjZSgiJGRvcmVnZXhbIiArIGsgKyAiXSIsIHZhbCkKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBpZiAnbGlzdHJlcGVhdCcgaW4gbToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpc3RyZXBlYXQ9bVsnbGlzdHJlcGVhdCddCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXQ9cmUuZmluZGFsbChtWydleHByZXMnXSxsaW5rKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGxpc3RyZXBlYXQscmV0LCBtLHJlZ2V4cwogICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgbGluaz09Jyc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ2xpbmsnLGxpbmsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZyA9IHJlLmNvbXBpbGUobVsnZXhwcmVzJ10pLnNlYXJjaChsaW5rKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsPScnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsPXJlZy5ncm91cCgxKS5zdHJpcCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6IHRyYWNlYmFjay5wcmludF9leGMoKQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsPW1bJ2V4cHJlcyddCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgcmF3UG9zdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICdyYXdwb3N0JwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsPXVybGxpYi5xdW90ZV9wbHVzKHZhbCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ2h0bWx1bmVzY2FwZScgaW4gbToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICN2YWw9dXJsbGliLnVucXVvdGVfcGx1cyh2YWwpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbXBvcnQgSFRNTFBhcnNlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsPUhUTUxQYXJzZXIuSFRNTFBhcnNlcigpLnVuZXNjYXBlKHZhbCkKICAgICAgICAgICAgICAgICAgICAgICAgdXJsID0gdXJsLnJlcGxhY2UoIiRkb3JlZ2V4WyIgKyBrICsgIl0iLCB2YWwpCiAgICAgICAgICAgICAgICAgICAgICAgICNyZXR1cm4gdmFsCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHVybCA9IHVybC5yZXBsYWNlKCIkZG9yZWdleFsiICsgayArICJdIiwnJykKICAgICAgICBpZiAnJGVwb2N0aW1lJCcgaW4gdXJsOgogICAgICAgICAgICB1cmw9dXJsLnJlcGxhY2UoJyRlcG9jdGltZSQnLGdldEVwb2NUaW1lKCkpCiAgICAgICAgaWYgJyRlcG9jdGltZTIkJyBpbiB1cmw6CiAgICAgICAgICAgIHVybD11cmwucmVwbGFjZSgnJGVwb2N0aW1lMiQnLGdldEVwb2NUaW1lMigpKQoKICAgICAgICBpZiAnJEdVSUQkJyBpbiB1cmw6CiAgICAgICAgICAgIGltcG9ydCB1dWlkCiAgICAgICAgICAgIHVybD11cmwucmVwbGFjZSgnJEdVSUQkJyxzdHIodXVpZC51dWlkMSgpKS51cHBlcigpKQogICAgICAgIGlmICckZ2V0X2Nvb2tpZXMkJyBpbiB1cmw6CiAgICAgICAgICAgIHVybD11cmwucmVwbGFjZSgnJGdldF9jb29raWVzJCcsZ2V0Q29va2llc1N0cmluZyhjb29raWVKYXIpKQoKICAgICAgICBpZiByZWN1cnNpdmVDYWxsOiByZXR1cm4gdXJsCiAgICAgICAgcHJpbnQgJ2ZpbmFsIHVybCcsdXJsCiAgICAgICAgaWYgdXJsPT0iIjoKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmV0dXJuIHVybCxzZXRyZXNvbHZlZApkZWYgZ2V0bWQ1KHQpOgogICAgaW1wb3J0IGhhc2hsaWIKICAgIGg9aGFzaGxpYi5tZDUoKQogICAgaC51cGRhdGUodCkKICAgIHJldHVybiBoLmhleGRpZ2VzdCgpCgpkZWYgZGVjcnlwdF92YXVnaG5saXZlKGVuY3J5cHRlZCk6CiAgICByZXRWYWw9IiIKICAgIHByaW50ICdlbmMnLGVuY3J5cHRlZAogICAgI2ZvciB2YWwgaW4gZW5jcnlwdGVkLnNwbGl0KCc6Jyk6CiAgICAjICAgIHJldFZhbCs9Y2hyKGludCh2YWwucmVwbGFjZSgiMG0wIiwiIikpKQogICAgI3JldHVybiByZXRWYWwKCmRlZiBwbGF5bWVkaWEobWVkaWFfdXJsKToKICAgIHRyeToKICAgICAgICBpbXBvcnQgIEN1c3RvbVBsYXllcgogICAgICAgIHBsYXllciA9IEN1c3RvbVBsYXllci5NeVhCTUNQbGF5ZXIoKQogICAgICAgIGxpc3RpdGVtID0geGJtY2d1aS5MaXN0SXRlbSggbGFiZWwgPSBzdHIobmFtZSksIGljb25JbWFnZSA9ICJEZWZhdWx0VmlkZW8ucG5nIiwgdGh1bWJuYWlsSW1hZ2UgPSB4Ym1jLmdldEluZm9JbWFnZSggIkxpc3RJdGVtLlRodW1iIiApLCBwYXRoPW1lZGlhX3VybCApCiAgICAgICAgcGxheWVyLnBsYXkoIG1lZGlhX3VybCxsaXN0aXRlbSkKICAgICAgICB4Ym1jLnNsZWVwKDEwMDApCiAgICAgICAgd2hpbGUgcGxheWVyLmlzX2FjdGl2ZToKICAgICAgICAgICAgeGJtYy5zbGVlcCgyMDApCiAgICBleGNlcHQ6CiAgICAgICAgdHJhY2ViYWNrLnByaW50X2V4YygpCiAgICByZXR1cm4gJycKCmRlZiBrb2RpSnNvblJlcXVlc3QocGFyYW1zKToKICAgIGRhdGEgPSBqc29uLmR1bXBzKHBhcmFtcykKICAgIHJlcXVlc3QgPSB4Ym1jLmV4ZWN1dGVKU09OUlBDKGRhdGEpCgogICAgdHJ5OgogICAgICAgIHJlc3BvbnNlID0ganNvbi5sb2FkcyhyZXF1ZXN0KQogICAgZXhjZXB0IFVuaWNvZGVEZWNvZGVFcnJvcjoKICAgICAgICByZXNwb25zZSA9IGpzb24ubG9hZHMocmVxdWVzdC5kZWNvZGUoJ3V0Zi04JywgJ2lnbm9yZScpKQoKICAgIHRyeToKICAgICAgICBpZiAncmVzdWx0JyBpbiByZXNwb25zZToKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlWydyZXN1bHQnXQogICAgICAgIHJldHVybiBOb25lCiAgICBleGNlcHQgS2V5RXJyb3I6CiAgICAgICAgbG9nZ2VyLndhcm4oIlslc10gJXMiICUgKHBhcmFtc1snbWV0aG9kJ10sIHJlc3BvbnNlWydlcnJvciddWydtZXNzYWdlJ10pKQogICAgICAgIHJldHVybiBOb25lCgoKZGVmIHNldEtvZGlQcm94eShwcm94eXNldHRpbmdzPU5vbmUpOgoKICAgIGlmIHByb3h5c2V0dGluZ3M9PU5vbmU6CiAgICAgICAgcHJpbnQgJ3Byb3h5IHNldCB0byBub3RoaW5nJwogICAgICAgIHhibWMuZXhlY3V0ZUpTT05SUEMoJ3sianNvbnJwYyI6IjIuMCIsICJtZXRob2QiOiJTZXR0aW5ncy5TZXRTZXR0aW5nVmFsdWUiLCAicGFyYW1zIjp7InNldHRpbmciOiJuZXR3b3JrLnVzZWh0dHBwcm94eSIsICJ2YWx1ZSI6ZmFsc2V9LCAiaWQiOjF9JykKICAgIGVsc2U6CiAgICAgICAgCiAgICAgICAgcHM9cHJveHlzZXR0aW5ncy5zcGxpdCgnOicpCiAgICAgICAgcHJveHlVUkw9cHNbMF0KICAgICAgICBwcm94eVBvcnQ9cHNbMV0KICAgICAgICBwcm94eVR5cGU9cHNbMl0KICAgICAgICBwcm94eVVzZXJuYW1lPU5vbmUKICAgICAgICBwcm94eVBhc3N3b3JkPU5vbmUKICAgICAgICAgCiAgICAgICAgaWYgbGVuKHBzKT4zIGFuZCAnQCcgaW4gcHJveHlzZXR0aW5nczoKICAgICAgICAgICAgcHJveHlVc2VybmFtZT1wc1szXQogICAgICAgICAgICBwcm94eVBhc3N3b3JkPXByb3h5c2V0dGluZ3Muc3BsaXQoJ0AnKVstMV0KCiAgICAgICAgcHJpbnQgJ3Byb3h5IHNldCB0bycsIHByb3h5VHlwZSwgcHJveHlVUkwscHJveHlQb3J0CiAgICAgICAgeGJtYy5leGVjdXRlSlNPTlJQQygneyJqc29ucnBjIjoiMi4wIiwgIm1ldGhvZCI6IlNldHRpbmdzLlNldFNldHRpbmdWYWx1ZSIsICJwYXJhbXMiOnsic2V0dGluZyI6Im5ldHdvcmsudXNlaHR0cHByb3h5IiwgInZhbHVlIjp0cnVlfSwgImlkIjoxfScpCiAgICAgICAgeGJtYy5leGVjdXRlSlNPTlJQQygneyJqc29ucnBjIjoiMi4wIiwgIm1ldGhvZCI6IlNldHRpbmdzLlNldFNldHRpbmdWYWx1ZSIsICJwYXJhbXMiOnsic2V0dGluZyI6Im5ldHdvcmsuaHR0cHByb3h5dHlwZSIsICJ2YWx1ZSI6JyArIHN0cihwcm94eVR5cGUpICsnfSwgImlkIjoxfScpCiAgICAgICAgeGJtYy5leGVjdXRlSlNPTlJQQygneyJqc29ucnBjIjoiMi4wIiwgIm1ldGhvZCI6IlNldHRpbmdzLlNldFNldHRpbmdWYWx1ZSIsICJwYXJhbXMiOnsic2V0dGluZyI6Im5ldHdvcmsuaHR0cHByb3h5c2VydmVyIiwgInZhbHVlIjoiJyArIHN0cihwcm94eVVSTCkgKycifSwgImlkIjoxfScpCiAgICAgICAgeGJtYy5leGVjdXRlSlNPTlJQQygneyJqc29ucnBjIjoiMi4wIiwgIm1ldGhvZCI6IlNldHRpbmdzLlNldFNldHRpbmdWYWx1ZSIsICJwYXJhbXMiOnsic2V0dGluZyI6Im5ldHdvcmsuaHR0cHByb3h5cG9ydCIsICJ2YWx1ZSI6JyArIHN0cihwcm94eVBvcnQpICsnfSwgImlkIjoxfScpCiAgICAgICAgCiAgICAgICAgCiAgICAgICAgaWYgbm90IHByb3h5VXNlcm5hbWU9PU5vbmU6CiAgICAgICAgICAgIHhibWMuZXhlY3V0ZUpTT05SUEMoJ3sianNvbnJwYyI6IjIuMCIsICJtZXRob2QiOiJTZXR0aW5ncy5TZXRTZXR0aW5nVmFsdWUiLCAicGFyYW1zIjp7InNldHRpbmciOiJuZXR3b3JrLmh0dHBwcm94eXVzZXJuYW1lIiwgInZhbHVlIjoiJyArIHN0cihwcm94eVVzZXJuYW1lKSArJyJ9LCAiaWQiOjF9JykKICAgICAgICAgICAgeGJtYy5leGVjdXRlSlNPTlJQQygneyJqc29ucnBjIjoiMi4wIiwgIm1ldGhvZCI6IlNldHRpbmdzLlNldFNldHRpbmdWYWx1ZSIsICJwYXJhbXMiOnsic2V0dGluZyI6Im5ldHdvcmsuaHR0cHByb3h5cGFzc3dvcmQiLCAidmFsdWUiOiInICsgc3RyKHByb3h5UGFzc3dvcmQpICsnIn0sICJpZCI6MX0nKQoKICAgICAgICAKZGVmIGdldENvbmZpZ3VyZWRQcm94eSgpOgogICAgcHJveHlBY3RpdmUgPSBrb2RpSnNvblJlcXVlc3Qoeydqc29ucnBjJzogJzIuMCcsICJtZXRob2QiOiJTZXR0aW5ncy5HZXRTZXR0aW5nVmFsdWUiLCAicGFyYW1zIjp7InNldHRpbmciOiJuZXR3b3JrLnVzZWh0dHBwcm94eSJ9LCAnaWQnOiAxfSlbJ3ZhbHVlJ10KICAgIHByaW50ICdwcm94eUFjdGl2ZScscHJveHlBY3RpdmUKICAgIHByb3h5VHlwZSA9IGtvZGlKc29uUmVxdWVzdCh7J2pzb25ycGMnOiAnMi4wJywgIm1ldGhvZCI6IlNldHRpbmdzLkdldFNldHRpbmdWYWx1ZSIsICJwYXJhbXMiOnsic2V0dGluZyI6Im5ldHdvcmsuaHR0cHByb3h5dHlwZSJ9LCAnaWQnOiAxfSlbJ3ZhbHVlJ10KCiAgICBpZiBwcm94eUFjdGl2ZTogIyBQUk9YWV9IVFRQCiAgICAgICAgcHJveHlVUkwgPSBrb2RpSnNvblJlcXVlc3Qoeydqc29ucnBjJzogJzIuMCcsICJtZXRob2QiOiJTZXR0aW5ncy5HZXRTZXR0aW5nVmFsdWUiLCAicGFyYW1zIjp7InNldHRpbmciOiJuZXR3b3JrLmh0dHBwcm94eXNlcnZlciJ9LCAnaWQnOiAxfSlbJ3ZhbHVlJ10KICAgICAgICBwcm94eVBvcnQgPSB1bmljb2RlKGtvZGlKc29uUmVxdWVzdCh7J2pzb25ycGMnOiAnMi4wJywgIm1ldGhvZCI6IlNldHRpbmdzLkdldFNldHRpbmdWYWx1ZSIsICJwYXJhbXMiOnsic2V0dGluZyI6Im5ldHdvcmsuaHR0cHByb3h5cG9ydCJ9LCAnaWQnOiAxfSlbJ3ZhbHVlJ10pCiAgICAgICAgcHJveHlVc2VybmFtZSA9IGtvZGlKc29uUmVxdWVzdCh7J2pzb25ycGMnOiAnMi4wJywgIm1ldGhvZCI6IlNldHRpbmdzLkdldFNldHRpbmdWYWx1ZSIsICJwYXJhbXMiOnsic2V0dGluZyI6Im5ldHdvcmsuaHR0cHByb3h5dXNlcm5hbWUifSwgJ2lkJzogMX0pWyd2YWx1ZSddCiAgICAgICAgcHJveHlQYXNzd29yZCA9IGtvZGlKc29uUmVxdWVzdCh7J2pzb25ycGMnOiAnMi4wJywgIm1ldGhvZCI6IlNldHRpbmdzLkdldFNldHRpbmdWYWx1ZSIsICJwYXJhbXMiOnsic2V0dGluZyI6Im5ldHdvcmsuaHR0cHByb3h5cGFzc3dvcmQifSwgJ2lkJzogMX0pWyd2YWx1ZSddCgogICAgICAgIGlmIHByb3h5VXNlcm5hbWUgYW5kIHByb3h5UGFzc3dvcmQgYW5kIHByb3h5VVJMIGFuZCBwcm94eVBvcnQ6CiAgICAgICAgICAgIHJldHVybiBwcm94eVVSTCArICc6JyArIHN0cihwcm94eVBvcnQpKyc6JytzdHIocHJveHlUeXBlKSArICc6JyArIHByb3h5VXNlcm5hbWUgKyAnQCcgKyBwcm94eVBhc3N3b3JkCiAgICAgICAgZWxpZiBwcm94eVVSTCBhbmQgcHJveHlQb3J0OgogICAgICAgICAgICByZXR1cm4gcHJveHlVUkwgKyAnOicgKyBzdHIocHJveHlQb3J0KSsnOicrc3RyKHByb3h5VHlwZSkKICAgIGVsc2U6CiAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAKZGVmIHBsYXltZWRpYXdpdGhwcm94eShtZWRpYV91cmwsIG5hbWUsIGljb25JbWFnZSxwcm94eWlwLHBvcnQpOgoKICAgIHByb2dyZXNzID0geGJtY2d1aS5EaWFsb2dQcm9ncmVzcygpCiAgICBwcm9ncmVzcy5jcmVhdGUoJ1Byb2dyZXNzJywgJ1BsYXlpbmcgd2l0aCBjdXN0b20gcHJveHknKQogICAgcHJvZ3Jlc3MudXBkYXRlKCAxMCwgIiIsICJzZXR0aW5nIHByb3h5Li4iLCAiIiApCiAgICBwcm94eXNldD1GYWxzZQogICAgZXhpc3RpbmdfcHJveHk9JycKICAgIHRyeToKICAgICAgICAKICAgICAgICBleGlzdGluZ19wcm94eT1nZXRDb25maWd1cmVkUHJveHkoKQogICAgICAgIHByaW50ICdleGlzdGluZ19wcm94eScsZXhpc3RpbmdfcHJveHkKICAgICAgICAjcmVhZCBhbmQgc2V0IGhlcmUKICAgICAgICBzZXRLb2RpUHJveHkoIHByb3h5aXAgKyAnOicgKyBwb3J0Kyc6MCcpCgogICAgICAgIHByaW50ICdwcm94eSBzZXR0aW5nIGNvbXBsZXRlJywgZ2V0Q29uZmlndXJlZFByb3h5KCkKICAgICAgICBwcm94eXNldD1UcnVlCiAgICAgICAgcHJvZ3Jlc3MudXBkYXRlKCA4MCwgIiIsICJzZXR0aW5nIHByb3h5IGNvbXBsZXRlLCBub3cgcGxheWluZyIsICIiICkKICAgICAgICBwcm9ncmVzcy5jbG9zZSgpCiAgICAgICAgcHJvZ3Jlc3M9Tm9uZQogICAgICAgIGltcG9ydCAgQ3VzdG9tUGxheWVyCiAgICAgICAgcGxheWVyID0gQ3VzdG9tUGxheWVyLk15WEJNQ1BsYXllcigpCiAgICAgICAgbGlzdGl0ZW0gPSB4Ym1jZ3VpLkxpc3RJdGVtKCBsYWJlbCA9IHN0cihuYW1lKSwgaWNvbkltYWdlID0gaWNvbkltYWdlLCB0aHVtYm5haWxJbWFnZSA9IHhibWMuZ2V0SW5mb0ltYWdlKCAiTGlzdEl0ZW0uVGh1bWIiICksIHBhdGg9bWVkaWFfdXJsICkKICAgICAgICBwbGF5ZXIucGxheSggbWVkaWFfdXJsLGxpc3RpdGVtKQogICAgICAgIHhibWMuc2xlZXAoMTAwMCkKICAgICAgICB3aGlsZSBwbGF5ZXIuaXNfYWN0aXZlOgogICAgICAgICAgICB4Ym1jLnNsZWVwKDIwMCkKICAgIGV4Y2VwdDoKICAgICAgICB0cmFjZWJhY2sucHJpbnRfZXhjKCkKICAgIGlmIHByb2dyZXNzOgogICAgICAgIHByb2dyZXNzLmNsb3NlKCkKICAgIGlmIHByb3h5c2V0OgogICAgICAgIHByaW50ICdub3cgcmVzZXR0aW5nIHRoZSBwcm94eSBiYWNrJwogICAgICAgIHNldEtvZGlQcm94eShleGlzdGluZ19wcm94eSkKICAgICAgICBwcmludCAncmVzZXQgaGVyZScKICAgIHJldHVybiAnJwoKCmRlZiBnZXRfc2F3X3J0bXAocGFnZV92YWx1ZSwgcmVmZXJlcj1Ob25lKToKICAgIGlmIHJlZmVyZXI6CiAgICAgICAgcmVmZXJlcj1bKCdSZWZlcmVyJyxyZWZlcmVyKV0KICAgIGlmIHBhZ2VfdmFsdWUuc3RhcnRzd2l0aCgiaHR0cCIpOgogICAgICAgIHBhZ2VfdXJsPXBhZ2VfdmFsdWUKICAgICAgICBwYWdlX3ZhbHVlPSBnZXRVcmwocGFnZV92YWx1ZSxoZWFkZXJzPXJlZmVyZXIpCgogICAgc3RyX3BhdHRlcm49IihldmFsXChmdW5jdGlvblwocCxhLGMsayxlLCg/OnJ8ZCkuKikiCgogICAgcmVnX3Jlcz1yZS5jb21waWxlKHN0cl9wYXR0ZXJuKS5maW5kYWxsKHBhZ2VfdmFsdWUpCiAgICByPSIiCiAgICBpZiByZWdfcmVzIGFuZCBsZW4ocmVnX3Jlcyk+MDoKICAgICAgICBmb3IgdiBpbiByZWdfcmVzOgogICAgICAgICAgICByMT1nZXRfdW5wYWNrZWQodikKICAgICAgICAgICAgcjI9cmVfbWUocjEsJ1wnKC4qPylcJycpCiAgICAgICAgICAgIGlmICd1bmVzY2FwZScgaW4gcjE6CiAgICAgICAgICAgICAgICByMT11cmxsaWIudW5xdW90ZShyMikKICAgICAgICAgICAgcis9cjErJ1xuJwogICAgICAgIHByaW50ICdmaW5hbCB2YWx1ZSBpcyAnLHIKCiAgICAgICAgcGFnZV91cmw9cmVfbWUociwnc3JjPSIoLio/KSInKQoKICAgICAgICBwYWdlX3ZhbHVlPSBnZXRVcmwocGFnZV91cmwsaGVhZGVycz1yZWZlcmVyKQoKICAgICNwcmludCBwYWdlX3ZhbHVlCgogICAgcnRtcD1yZV9tZShwYWdlX3ZhbHVlLCdzdHJlYW1lclwnLio/XCcoLio/KVwnXCknKQogICAgcGxheXBhdGg9cmVfbWUocGFnZV92YWx1ZSwnZmlsZVwnLFxzXCcoLio/KVwnJykKCgogICAgcmV0dXJuIHJ0bXArJyBwbGF5cGF0aD0nK3BsYXlwYXRoICsnIHBhZ2VVcmw9JytwYWdlX3VybAoKZGVmIGdldF9sZXRvbl9ydG1wKHBhZ2VfdmFsdWUsIHJlZmVyZXI9Tm9uZSk6CiAgICBpZiByZWZlcmVyOgogICAgICAgIHJlZmVyZXI9WygnUmVmZXJlcicscmVmZXJlcildCiAgICBpZiBwYWdlX3ZhbHVlLnN0YXJ0c3dpdGgoImh0dHAiKToKICAgICAgICBwYWdlX3ZhbHVlPSBnZXRVcmwocGFnZV92YWx1ZSxoZWFkZXJzPXJlZmVyZXIpCiAgICBzdHJfcGF0dGVybj0idmFyIGEgPSAoLio/KTtccyp2YXIgYiA9ICguKj8pO1xzKnZhciBjID0gKC4qPyk7XHMqdmFyIGQgPSAoLio/KTtccyp2YXIgZiA9ICguKj8pO1xzKnZhciB2X3BhcnQgPSAnKC4qPyknOyIKICAgIHJlZ19yZXM9cmUuY29tcGlsZShzdHJfcGF0dGVybikuZmluZGFsbChwYWdlX3ZhbHVlKVswXQoKICAgIGEsYixjLGQsZix2PShyZWdfcmVzKQogICAgZj1pbnQoZikKICAgIGE9aW50KGEpL2YKICAgIGI9aW50KGIpL2YKICAgIGM9aW50KGMpL2YKICAgIGQ9aW50KGQpL2YKCiAgICByZXQ9ICdydG1wOi8vJyArIHN0cihhKSArICcuJyArIHN0cihiKSArICcuJyArIHN0cihjKSArICcuJyArIHN0cihkKSArIHY7CiAgICByZXR1cm4gcmV0CgpkZWYgY3JlYXRlTTN1Rm9yRGFzaCh1cmwsdXNlcmFnZW50PU5vbmUpOgogICAgc3RyPScjRVhUTTNVJwogICAgc3RyKz0nXG4jRVhULVgtU1RSRUFNLUlORjpQUk9HUkFNLUlEPTEsQkFORFdJRFRIPTM2MTgxNicKICAgIHN0cis9J1xuJyt1cmwrJyZieXRlcz0wLTIwMDAwMCcjKyd8VXNlci1BZ2VudD0nK3VzZXJhZ2VudAogICAgc291cmNlX2ZpbGUgPSBvcy5wYXRoLmpvaW4ocHJvZmlsZSwgJ3Rlc3RmaWxlLm0zdScpCiAgICBzdHIrPSdcbicKICAgIFNhdmVUb0ZpbGUoc291cmNlX2ZpbGUsc3RyKQogICAgI3JldHVybiAnQzovVXNlcnMvc2hhbmkvRG93bmxvYWRzL3Rlc3QubTN1OCcKICAgIHJldHVybiBzb3VyY2VfZmlsZQoKZGVmIFNhdmVUb0ZpbGUoZmlsZV9uYW1lLHBhZ2VfZGF0YSxhcHBlbmQ9RmFsc2UpOgogICAgaWYgYXBwZW5kOgogICAgICAgIGYgPSBvcGVuKGZpbGVfbmFtZSwgJ2EnKQogICAgICAgIGYud3JpdGUocGFnZV9kYXRhKQogICAgICAgIGYuY2xvc2UoKQogICAgZWxzZToKICAgICAgICBmPW9wZW4oZmlsZV9uYW1lLCd3YicpCiAgICAgICAgZi53cml0ZShwYWdlX2RhdGEpCiAgICAgICAgZi5jbG9zZSgpCiAgICAgICAgcmV0dXJuICcnCgpkZWYgTG9hZEZpbGUoZmlsZV9uYW1lKToKICAgIGY9b3BlbihmaWxlX25hbWUsJ3JiJykKICAgIGQ9Zi5yZWFkKCkKICAgIGYuY2xvc2UoKQogICAgcmV0dXJuIGQKCmRlZiBnZXRfcGFja2VkX2lwaG9uZXR2X3VybChwYWdlX2RhdGEpOgogICAgaW1wb3J0IHJlLGJhc2U2NCx1cmxsaWI7CiAgICBzPXBhZ2VfZGF0YQogICAgd2hpbGUgJ2dlaCgnIGluIHM6CiAgICAgICAgaWYgcy5zdGFydHN3aXRoKCdsb2woJyk6IHM9c1s1Oi0xXQojICAgICAgIHByaW50ICdzIGlzICcscwogICAgICAgIHM9cmUuY29tcGlsZSgnIiguKj8pIicpLmZpbmRhbGwocylbMF07CiAgICAgICAgcz0gIGJhc2U2NC5iNjRkZWNvZGUocyk7CiAgICAgICAgcz11cmxsaWIudW5xdW90ZShzKTsKICAgIHByaW50IHMKICAgIHJldHVybiBzCgpkZWYgZ2V0X2ZlcnJhcmlfdXJsKHBhZ2VfZGF0YSk6CiAgICBwcmludCAnZ2V0X2RhZ191cmwyJyxwYWdlX2RhdGEKICAgIHBhZ2VfZGF0YTI9Z2V0VXJsKHBhZ2VfZGF0YSk7CiAgICBwYXR0PScoaHR0cC4qKScKICAgIGltcG9ydCB1dWlkCiAgICBwbGF5YmFjaz1zdHIodXVpZC51dWlkMSgpKS51cHBlcigpCiAgICBsaW5rcz1yZS5jb21waWxlKHBhdHQpLmZpbmRhbGwocGFnZV9kYXRhMikKICAgIGhlYWRlcnM9WygnWC1QbGF5YmFjay1TZXNzaW9uLUlkJyxwbGF5YmFjayldCiAgICBmb3IgbCBpbiBsaW5rczoKICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBwYWdlX2RhdGF0ZW1wPWdldFVybChsLGhlYWRlcnM9aGVhZGVycyk7CgogICAgICAgIGV4Y2VwdDogcGFzcwoKICAgIHJldHVybiBwYWdlX2RhdGErJ3wmWC1QbGF5YmFjay1TZXNzaW9uLUlkPScrcGxheWJhY2sKCgpkZWYgZ2V0X2RhZ191cmwocGFnZV9kYXRhKToKICAgIHByaW50ICdnZXRfZGFnX3VybCcscGFnZV9kYXRhCiAgICBpZiBwYWdlX2RhdGEuc3RhcnRzd2l0aCgnaHR0cDovL2RhZy50b3RhbC1zdHJlYW0ubmV0Jyk6CiAgICAgICAgaGVhZGVycz1bKCdVc2VyLUFnZW50JywnVmVyaXNtby1CbGFja1VJXygyLjQuNy41LjguMC4zNCknKV0KICAgICAgICBwYWdlX2RhdGE9Z2V0VXJsKHBhZ2VfZGF0YSxoZWFkZXJzPWhlYWRlcnMpOwoKICAgIGlmICcxMjcuMC4wLjEnIGluIHBhZ2VfZGF0YToKICAgICAgICByZXR1cm4gcmV2aXN0X2RhZyhwYWdlX2RhdGEpCiAgICBlbGlmIHJlX21lKHBhZ2VfZGF0YSwgJ3dtc0F1dGhTaWduJTNEKFteJSZdKyknKSAhPSAnJzoKICAgICAgICBmaW5hbF91cmwgPSByZV9tZShwYWdlX2RhdGEsICcmdmVyX3Q9KFteJl0rKSYnKSArICc/d21zQXV0aFNpZ249JyArIHJlX21lKHBhZ2VfZGF0YSwgJ3dtc0F1dGhTaWduJTNEKFteJSZdKyknKSArICc9PS9tcDQ6JyArIHJlX21lKHBhZ2VfZGF0YSwgJ1xcP3k9KFteJl0rKSYnKQogICAgZWxzZToKICAgICAgICBmaW5hbF91cmwgPSByZV9tZShwYWdlX2RhdGEsICdocmVmPSIoW14iXSspIlteIl0rJCcpCiAgICAgICAgaWYgbGVuKGZpbmFsX3VybCk9PTA6CiAgICAgICAgICAgIGZpbmFsX3VybD1wYWdlX2RhdGEKICAgIGZpbmFsX3VybCA9IGZpbmFsX3VybC5yZXBsYWNlKCcgJywgJyUyMCcpCiAgICByZXR1cm4gZmluYWxfdXJsCgpkZWYgcmVfbWUoZGF0YSwgcmVfcGF0dGVuKToKICAgIG1hdGNoID0gJycKICAgIG0gPSByZS5zZWFyY2gocmVfcGF0dGVuLCBkYXRhKQogICAgaWYgbSAhPSBOb25lOgogICAgICAgIG1hdGNoID0gbS5ncm91cCgxKQogICAgZWxzZToKICAgICAgICBtYXRjaCA9ICcnCiAgICByZXR1cm4gbWF0Y2gKCmRlZiByZXZpc3RfZGFnKHBhZ2VfZGF0YSk6CiAgICBmaW5hbF91cmwgPSAnJwogICAgaWYgJzEyNy4wLjAuMScgaW4gcGFnZV9kYXRhOgogICAgICAgIGZpbmFsX3VybCA9IHJlX21lKHBhZ2VfZGF0YSwgJyZ2ZXJfdD0oW14mXSspJicpICsgJyBsaXZlPXRydWUgdGltZW91dD0xNSBwbGF5cGF0aD0nICsgcmVfbWUocGFnZV9kYXRhLCAnXFw/eT0oW2EtekEtWjAtOS1fXFwuQF0rKScpCgogICAgaWYgcmVfbWUocGFnZV9kYXRhLCAndG9rZW49KFteJl0rKSYnKSAhPSAnJzoKICAgICAgICBmaW5hbF91cmwgPSBmaW5hbF91cmwgKyAnP3Rva2VuPScgKyByZV9tZShwYWdlX2RhdGEsICd0b2tlbj0oW14mXSspJicpCiAgICBlbGlmIHJlX21lKHBhZ2VfZGF0YSwgJ3dtc0F1dGhTaWduJTNEKFteJSZdKyknKSAhPSAnJzoKICAgICAgICBmaW5hbF91cmwgPSByZV9tZShwYWdlX2RhdGEsICcmdmVyX3Q9KFteJl0rKSYnKSArICc/d21zQXV0aFNpZ249JyArIHJlX21lKHBhZ2VfZGF0YSwgJ3dtc0F1dGhTaWduJTNEKFteJSZdKyknKSArICc9PS9tcDQ6JyArIHJlX21lKHBhZ2VfZGF0YSwgJ1xcP3k9KFteJl0rKSYnKQogICAgZWxzZToKICAgICAgICBmaW5hbF91cmwgPSByZV9tZShwYWdlX2RhdGEsICdIUkVGPSIoW14iXSspIicpCgogICAgaWYgJ2RhZzEuYXN4JyBpbiBmaW5hbF91cmw6CiAgICAgICAgcmV0dXJuIGdldF9kYWdfdXJsKGZpbmFsX3VybCkKCiAgICBpZiAnZGV2aW5saXZlZnMuZnBsaXZlLm5ldCcgbm90IGluIGZpbmFsX3VybDoKICAgICAgICBmaW5hbF91cmwgPSBmaW5hbF91cmwucmVwbGFjZSgnZGV2aW5saXZlJywgJ2ZsaXZlJykKICAgIGlmICdwZXJtbGl2ZWZzLmZwbGl2ZS5uZXQnIG5vdCBpbiBmaW5hbF91cmw6CiAgICAgICAgZmluYWxfdXJsID0gZmluYWxfdXJsLnJlcGxhY2UoJ3Blcm1saXZlJywgJ2ZsaXZlJykKICAgIHJldHVybiBmaW5hbF91cmwKCgpkZWYgZ2V0X3Vud2lzZSggc3RyX2V2YWwpOgogICAgcGFnZV92YWx1ZT0iIgogICAgdHJ5OgogICAgICAgIHNzPSJ3LGkscyxlPSgiK3N0cl9ldmFsKycpJwogICAgICAgIGV4ZWMgKHNzKQogICAgICAgIHBhZ2VfdmFsdWU9dW53aXNlX2Z1bmModyxpLHMsZSkKICAgIGV4Y2VwdDogdHJhY2ViYWNrLnByaW50X2V4YyhmaWxlPXN5cy5zdGRvdXQpCiAgICAjcHJpbnQgJ3VucGFja2VkJyxwYWdlX3ZhbHVlCiAgICByZXR1cm4gcGFnZV92YWx1ZQoKZGVmIHVud2lzZV9mdW5jKCB3LCBpLCBzLCBlKToKICAgIGxJbGwgPSAwOwogICAgbGwxSSA9IDA7CiAgICBJbDFsID0gMDsKICAgIGxsMWwgPSBbXTsKICAgIGwxbEkgPSBbXTsKICAgIHdoaWxlIFRydWU6CiAgICAgICAgaWYgKGxJbGwgPCA1KToKICAgICAgICAgICAgbDFsSS5hcHBlbmQod1tsSWxsXSkKICAgICAgICBlbGlmIChsSWxsIDwgbGVuKHcpKToKICAgICAgICAgICAgbGwxbC5hcHBlbmQod1tsSWxsXSk7CiAgICAgICAgbElsbCs9MTsKICAgICAgICBpZiAobGwxSSA8IDUpOgogICAgICAgICAgICBsMWxJLmFwcGVuZChpW2xsMUldKQogICAgICAgIGVsaWYgKGxsMUkgPCBsZW4oaSkpOgogICAgICAgICAgICBsbDFsLmFwcGVuZChpW2xsMUldKQogICAgICAgIGxsMUkrPTE7CiAgICAgICAgaWYgKElsMWwgPCA1KToKICAgICAgICAgICAgbDFsSS5hcHBlbmQoc1tJbDFsXSkKICAgICAgICBlbGlmIChJbDFsIDwgbGVuKHMpKToKICAgICAgICAgICAgbGwxbC5hcHBlbmQoc1tJbDFsXSk7CiAgICAgICAgSWwxbCs9MTsKICAgICAgICBpZiAobGVuKHcpICsgbGVuKGkpICsgbGVuKHMpICsgbGVuKGUpID09IGxlbihsbDFsKSArIGxlbihsMWxJKSArIGxlbihlKSk6CiAgICAgICAgICAgIGJyZWFrOwoKICAgIGxJMWwgPSAnJy5qb2luKGxsMWwpIy5qb2luKCcnKTsKICAgIEkxbEkgPSAnJy5qb2luKGwxbEkpIy5qb2luKCcnKTsKICAgIGxsMUkgPSAwOwogICAgbDFsbCA9IFtdOwogICAgZm9yIGxJbGwgaW4gcmFuZ2UoMCxsZW4obGwxbCksMik6CiAgICAgICAgI3ByaW50ICdhcnJheSBpJyxsSWxsLGxlbihsbDFsKQogICAgICAgIGxsMTEgPSAtMTsKICAgICAgICBpZiAoIG9yZChJMWxJW2xsMUldKSAlIDIpOgogICAgICAgICAgICBsbDExID0gMTsKICAgICAgICAjcHJpbnQgJ3ZhbCBpcyAnLCBsSTFsW2xJbGw6IGxJbGwrMl0KICAgICAgICBsMWxsLmFwcGVuZChjaHIoICAgIGludChsSTFsW2xJbGw6IGxJbGwrMl0sIDM2KSAtIGxsMTEpKTsKICAgICAgICBsbDFJKz0xOwogICAgICAgIGlmIChsbDFJID49IGxlbihsMWxJKSk6CiAgICAgICAgICAgIGxsMUkgPSAwOwogICAgcmV0PScnLmpvaW4obDFsbCkKICAgIGlmICdldmFsKGZ1bmN0aW9uKHcsaSxzLGUpJyBpbiByZXQ6CiAgICAgICAgcHJpbnQgJ1NUSUxMIEdPaW5nJwogICAgICAgIHJldD1yZS5jb21waWxlKCdldmFsXChmdW5jdGlvblwodyxpLHMsZVwpLip9XCgoLio/KVwpJykuZmluZGFsbChyZXQpWzBdCiAgICAgICAgcmV0dXJuIGdldF91bndpc2UocmV0KQogICAgZWxzZToKICAgICAgICBwcmludCAnRklOSVNIRUQnCiAgICAgICAgcmV0dXJuIHJldAoKZGVmIGdldF91bnBhY2tlZCggcGFnZV92YWx1ZSwgcmVnZXhfZm9yX3RleHQ9JycsIGl0ZXJhdGlvbnM9MSwgdG90YWxfaXRlcmF0aW9uPTEpOgogICAgdHJ5OgogICAgICAgIHJlZ19kYXRhPU5vbmUKICAgICAgICBpZiBwYWdlX3ZhbHVlLnN0YXJ0c3dpdGgoImh0dHAiKToKICAgICAgICAgICAgcGFnZV92YWx1ZT0gZ2V0VXJsKHBhZ2VfdmFsdWUpCiAgICAgICAgcHJpbnQgJ3BhZ2VfdmFsdWUnLHBhZ2VfdmFsdWUKICAgICAgICBpZiByZWdleF9mb3JfdGV4dCBhbmQgbGVuKHJlZ2V4X2Zvcl90ZXh0KT4wOgogICAgICAgICAgICBwYWdlX3ZhbHVlPXJlLmNvbXBpbGUocmVnZXhfZm9yX3RleHQpLmZpbmRhbGwocGFnZV92YWx1ZSlbMF0gI2dldCB0aGUganMgdmFyaWFibGUKCiAgICAgICAgcGFnZV92YWx1ZT11bnBhY2socGFnZV92YWx1ZSxpdGVyYXRpb25zLHRvdGFsX2l0ZXJhdGlvbikKICAgIGV4Y2VwdDogdHJhY2ViYWNrLnByaW50X2V4YyhmaWxlPXN5cy5zdGRvdXQpCiAgICBwcmludCAndW5wYWNrZWQnLHBhZ2VfdmFsdWUKICAgIGlmICdzYXYxbGl2ZS50dicgaW4gcGFnZV92YWx1ZToKICAgICAgICBwYWdlX3ZhbHVlPXBhZ2VfdmFsdWUucmVwbGFjZSgnc2F2MWxpdmUudHYnLCdzYXdsaXZlLnR2JykgI3F1aWNrIGZpeCBzb21lIGJ1ZyBzb21ld2hlcmUKICAgICAgICBwcmludCAnc2F2MSB1bnBhY2tlZCcscGFnZV92YWx1ZQogICAgcmV0dXJuIHBhZ2VfdmFsdWUKCmRlZiB1bnBhY2soc0phdmFzY3JpcHQsaXRlcmF0aW9uPTEsIHRvdGFsaXRlcmF0aW9ucz0yICApOgogICAgcHJpbnQgJ2l0ZXJhdGlvbicsaXRlcmF0aW9uCiAgICBpZiBzSmF2YXNjcmlwdC5zdGFydHN3aXRoKCd2YXIgXzB4Y2I4YT0nKToKICAgICAgICBhU3BsaXQ9c0phdmFzY3JpcHQuc3BsaXQoJ3ZhciBfMHhjYjhhPScpCiAgICAgICAgc3M9Im15YXJyYXk9IithU3BsaXRbMV0uc3BsaXQoImV2YWwoIilbMF0KICAgICAgICBleGVjKHNzKQogICAgICAgIGExPTYyCiAgICAgICAgYzE9aW50KGFTcGxpdFsxXS5zcGxpdCgiLDYyLCIpWzFdLnNwbGl0KCcsJylbMF0pCiAgICAgICAgcDE9bXlhcnJheVswXQogICAgICAgIGsxPW15YXJyYXlbM10KICAgICAgICB3aXRoIG9wZW4oJ3RlbXAgZmlsZScrc3RyKGl0ZXJhdGlvbikrJy5qcycsICJ3YiIpIGFzIGZpbGV3cml0ZXI6CiAgICAgICAgICAgIGZpbGV3cml0ZXIud3JpdGUoc3RyKGsxKSkKICAgICAgICAjYWE9MS8wCiAgICBlbHNlOgoKICAgICAgICBpZiAicm4gcH0oJyIgaW4gc0phdmFzY3JpcHQ6CiAgICAgICAgICAgIGFTcGxpdCA9IHNKYXZhc2NyaXB0LnNwbGl0KCJybiBwfSgnIikKICAgICAgICBlbHNlOgogICAgICAgICAgICBhU3BsaXQgPSBzSmF2YXNjcmlwdC5zcGxpdCgicm4gQX0oJyIpCiAgICAgICAgcHJpbnQgYVNwbGl0CgogICAgICAgIHAxLGExLGMxLGsxPSgnJywnMCcsJzAnLCcnKQoKICAgICAgICBzcz0icDEsYTEsYzEsazE9KCciK2FTcGxpdFsxXS5zcGxpdCgiLnNwbGkiKVswXSsnKScKICAgICAgICBleGVjKHNzKQogICAgazE9azEuc3BsaXQoJ3wnKQogICAgYVNwbGl0ID0gYVNwbGl0WzFdLnNwbGl0KCIpKSciKQojICAgIHByaW50ICcgcCBhcnJheSBpcyAnLGxlbihhU3BsaXQpCiMgICBwcmludCBsZW4oYVNwbGl0ICkKCiAgICAjcD1zdHIoYVNwbGl0WzBdKycpKScpIy5yZXBsYWNlKCJcXCIsIiIpIy5yZXBsYWNlKCdcXFxcJywnXFwnKQoKICAgICNwcmludCBhU3BsaXRbMV0KICAgICNhU3BsaXQgPSBhU3BsaXRbMV0uc3BsaXQoIiwiKQogICAgI3ByaW50IGFTcGxpdFswXQogICAgI2EgPSBpbnQoYVNwbGl0WzFdKQogICAgI2MgPSBpbnQoYVNwbGl0WzJdKQogICAgI2sgPSBhU3BsaXRbM10uc3BsaXQoIi4iKVswXS5yZXBsYWNlKCInIiwgJycpLnNwbGl0KCd8JykKICAgICNhPWludChhKQogICAgI2M9aW50KGMpCgogICAgI3A9cC5yZXBsYWNlKCdcXCcsICcnKQojICAgIHByaW50ICdwIHZhbCBpcyAnLHBbMDoxMDBdLCcuLi4uLi4uLi4uLi4nLHBbLTEwMDpdLGxlbihwKQojICAgIHByaW50ICdwMSB2YWwgaXMgJyxwMVswOjEwMF0sJy4uLi4uLi4uLi4uLicscDFbLTEwMDpdLGxlbihwMSkKCiAgICAjcHJpbnQgYSxhMQogICAgI3ByaW50IGMsYTEKICAgICNwcmludCAnayB2YWwgaXMgJyxrWy0xMDpdLGxlbihrKQojICAgIHByaW50ICdrMSB2YWwgaXMgJyxrMVstMTA6XSxsZW4oazEpCiAgICBlID0gJycKICAgIGQgPSAnJyMzMjgyMwoKICAgICNzVW5wYWNrZWQgPSBzdHIoX191bnBhY2socCwgYSwgYywgaywgZSwgZCkpCiAgICBzVW5wYWNrZWQxID0gc3RyKF9fdW5wYWNrKHAxLCBhMSwgYzEsIGsxLCBlLCBkLGl0ZXJhdGlvbikpCgogICAgI3ByaW50IHNVbnBhY2tlZFs6MjAwXSsnLi4uLicrc1VucGFja2VkWy0xMDA6XSwgbGVuKHNVbnBhY2tlZCkKIyAgICBwcmludCBzVW5wYWNrZWQxWzoyMDBdKycuLi4uJytzVW5wYWNrZWQxWy0xMDA6XSwgbGVuKHNVbnBhY2tlZDEpCgogICAgI2V4ZWMoJ3NVbnBhY2tlZDE9Iicrc1VucGFja2VkMSsnIicpCiAgICBpZiBpdGVyYXRpb24+PXRvdGFsaXRlcmF0aW9uczoKIyAgICAgICAgcHJpbnQgJ2ZpbmFsIHJlcycsc1VucGFja2VkMVs6MjAwXSsnLi4uLicrc1VucGFja2VkMVstMTAwOl0sIGxlbihzVW5wYWNrZWQxKQogICAgICAgIHJldHVybiBzVW5wYWNrZWQxIy5yZXBsYWNlKCdcXFxcJywgJ1xcJykKICAgIGVsc2U6CiMgICAgICAgIHByaW50ICdmaW5hbCByZXMgZm9yIHRoaXMgaXRlcmF0aW9uIGlzJyxpdGVyYXRpb24KICAgICAgICByZXR1cm4gdW5wYWNrKHNVbnBhY2tlZDEsaXRlcmF0aW9uKzEpIy5yZXBsYWNlKCdcXCcsICcnKSxpdGVyYXRpb24pIy5yZXBsYWNlKCdcXCcsICcnKTsjdW5wYWNrKHNVbnBhY2tlZC5yZXBsYWNlKCdcXCcsICcnKSkKCmRlZiBfX3VucGFjayhwLCBhLCBjLCBrLCBlLCBkLCBpdGVyYXRpb24sdj0xKToKCiAgICAjd2l0aCBvcGVuKCdiZWZvcmUgZmlsZScrc3RyKGl0ZXJhdGlvbikrJy5qcycsICJ3YiIpIGFzIGZpbGV3cml0ZXI6CiAgICAjICAgIGZpbGV3cml0ZXIud3JpdGUoc3RyKHApKQogICAgd2hpbGUgKGMgPj0gMSk6CiAgICAgICAgYyA9IGMgLTEKICAgICAgICBpZiAoa1tjXSk6CiAgICAgICAgICAgIGFhPXN0cihfX2l0b2FOZXcoYywgYSkpCiAgICAgICAgICAgIGlmIHY9PTE6CiAgICAgICAgICAgICAgICBwPXJlLnN1YignXFxiJyArIGFhICsnXFxiJywga1tjXSwgcCkjIFRISVMgSVMgQmxvb2R5IHNsb3chCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBwPWZpbmRBbmRSZXBsYWNlV29yZChwLGFhLGtbY10pCgogICAgICAgICAgICAjcD1maW5kQW5kUmVwbGFjZVdvcmQocCxhYSxrW2NdKQoKCiAgICAjd2l0aCBvcGVuKCdhZnRlciBmaWxlJytzdHIoaXRlcmF0aW9uKSsnLmpzJywgIndiIikgYXMgZmlsZXdyaXRlcjoKICAgICMgICAgZmlsZXdyaXRlci53cml0ZShzdHIocCkpCiAgICByZXR1cm4gcAoKIwojZnVuY3Rpb24gZXF1YWxhdmVudCB0byByZS5zdWIoJ1xcYicgKyBhYSArJ1xcYicsIGtbY10sIHApCmRlZiBmaW5kQW5kUmVwbGFjZVdvcmQoc291cmNlX3N0ciwgd29yZF90b19maW5kLHJlcGxhY2Vfd2l0aCk6CiAgICBzcGxpdHM9Tm9uZQogICAgc3BsaXRzPXNvdXJjZV9zdHIuc3BsaXQod29yZF90b19maW5kKQogICAgaWYgbGVuKHNwbGl0cyk+MToKICAgICAgICBuZXdfc3RyaW5nPVtdCiAgICAgICAgY3VycmVudF9pbmRleD0wCiAgICAgICAgZm9yIGN1cnJlbnRfc3BsaXQgaW4gc3BsaXRzOgogICAgICAgICAgICAjcHJpbnQgJ2hlcmUnLGkKICAgICAgICAgICAgbmV3X3N0cmluZy5hcHBlbmQoY3VycmVudF9zcGxpdCkKICAgICAgICAgICAgdmFsPXdvcmRfdG9fZmluZCNieSBkZWZhdWx0IGFzc3VtZSBpdCB3YXMgd3JvbmcgdG8gc3BsaXQKCiAgICAgICAgICAgICNpZiBpdHMgZmlyc3Qgb25lIGFuZCBpdGVtIGlzIGJsYW5rIHRoZW4gY2hlY2sgbmV4dCBpdGVtIGlzIHZhbGlkIG9yIG5vdAogICAgICAgICAgICBpZiBjdXJyZW50X2luZGV4PT1sZW4oc3BsaXRzKS0xOgogICAgICAgICAgICAgICAgdmFsPScnICMgbGFzdCBvbmUgbm90aGluZyB0byBhcHBlbmQgbm9ybWFsbHkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGlmIGxlbihjdXJyZW50X3NwbGl0KT09MDogI2lmIGJsYW5rIGNoZWNrIG5leHQgb25lIHdpdGggY3VycmVudCBzcGxpdCB2YWx1ZQogICAgICAgICAgICAgICAgICAgIGlmICggbGVuKHNwbGl0c1tjdXJyZW50X2luZGV4KzFdKT09MCBhbmQgd29yZF90b19maW5kWzBdLmxvd2VyKCkgbm90IGluICdhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejEyMzQ1Njc4OTBfJykgb3IgKGxlbihzcGxpdHNbY3VycmVudF9pbmRleCsxXSk+MCAgYW5kIHNwbGl0c1tjdXJyZW50X2luZGV4KzFdWzBdLmxvd2VyKCkgbm90IGluICdhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejEyMzQ1Njc4OTBfJyk6IyBmaXJzdCBqdXN0IGp1c3QgY2hlY2sgbmV4dAogICAgICAgICAgICAgICAgICAgICAgICB2YWw9cmVwbGFjZV93aXRoCiAgICAgICAgICAgICAgICAjbm90IGJsYW5rLCB0aGVuIGNoZWNrIGN1cnJlbnQgZW5kdmFsdWUgYW5kIG5leHQgZmlyc3QgdmFsdWUKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgaWYgKHNwbGl0c1tjdXJyZW50X2luZGV4XVstMV0ubG93ZXIoKSBub3QgaW4gJ2FiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MTIzNDU2Nzg5MF8nKSBhbmQgKCggbGVuKHNwbGl0c1tjdXJyZW50X2luZGV4KzFdKT09MCBhbmQgd29yZF90b19maW5kWzBdLmxvd2VyKCkgbm90IGluICdhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejEyMzQ1Njc4OTBfJykgb3IgKGxlbihzcGxpdHNbY3VycmVudF9pbmRleCsxXSk+MCAgYW5kIHNwbGl0c1tjdXJyZW50X2luZGV4KzFdWzBdLmxvd2VyKCkgbm90IGluICdhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejEyMzQ1Njc4OTBfJykpOiMgZmlyc3QganVzdCBqdXN0IGNoZWNrIG5leHQKICAgICAgICAgICAgICAgICAgICAgICAgdmFsPXJlcGxhY2Vfd2l0aAoKICAgICAgICAgICAgbmV3X3N0cmluZy5hcHBlbmQodmFsKQogICAgICAgICAgICBjdXJyZW50X2luZGV4Kz0xCiAgICAgICAgI2FhYWE9MS8wCiAgICAgICAgc291cmNlX3N0cj0nJy5qb2luKG5ld19zdHJpbmcpCiAgICByZXR1cm4gc291cmNlX3N0cgoKZGVmIF9faXRvYShudW0sIHJhZGl4KToKIyAgICBwcmludCAnbnVtIHJlZCcsbnVtLCByYWRpeAogICAgcmVzdWx0ID0gIiIKICAgIGlmIG51bT09MDogcmV0dXJuICcwJwogICAgd2hpbGUgbnVtID4gMDoKICAgICAgICByZXN1bHQgPSAiMDEyMzQ1Njc4OWFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6IltudW0gJSByYWRpeF0gKyByZXN1bHQKICAgICAgICBudW0gLz0gcmFkaXgKICAgIHJldHVybiByZXN1bHQKCmRlZiBfX2l0b2FOZXcoY2MsIGEpOgogICAgYWE9IiIgaWYgY2MgPCBhIGVsc2UgX19pdG9hTmV3KGludChjYyAvIGEpLGEpCiAgICBjYyA9IChjYyAlIGEpCiAgICBiYj1jaHIoY2MgKyAyOSkgaWYgY2M+IDM1IGVsc2Ugc3RyKF9faXRvYShjYywzNikpCiAgICByZXR1cm4gYWErYmIKCgpkZWYgZ2V0Q29va2llc1N0cmluZyhjb29raWVKYXIpOgogICAgdHJ5OgogICAgICAgIGNvb2tpZVN0cmluZz0iIgogICAgICAgIGZvciBpbmRleCwgY29va2llIGluIGVudW1lcmF0ZShjb29raWVKYXIpOgogICAgICAgICAgICBjb29raWVTdHJpbmcrPWNvb2tpZS5uYW1lICsgIj0iICsgY29va2llLnZhbHVlICsiOyIKICAgIGV4Y2VwdDogcGFzcwogICAgI3ByaW50ICdjb29raWVTdHJpbmcnLGNvb2tpZVN0cmluZwogICAgcmV0dXJuIGNvb2tpZVN0cmluZwoKCmRlZiBzYXZlQ29va2llSmFyKGNvb2tpZUphcixDT09LSUVGSUxFKToKICAgIHRyeToKICAgICAgICBjb21wbGV0ZV9wYXRoPW9zLnBhdGguam9pbihwcm9maWxlLENPT0tJRUZJTEUpCiAgICAgICAgY29va2llSmFyLnNhdmUoY29tcGxldGVfcGF0aCxpZ25vcmVfZGlzY2FyZD1UcnVlKQogICAgZXhjZXB0OiBwYXNzCgpkZWYgZ2V0Q29va2llSmFyKENPT0tJRUZJTEUpOgoKICAgIGNvb2tpZUphcj1Ob25lCiAgICBpZiBDT09LSUVGSUxFOgogICAgICAgIHRyeToKICAgICAgICAgICAgY29tcGxldGVfcGF0aD1vcy5wYXRoLmpvaW4ocHJvZmlsZSxDT09LSUVGSUxFKQogICAgICAgICAgICBjb29raWVKYXIgPSBjb29raWVsaWIuTFdQQ29va2llSmFyKCkKICAgICAgICAgICAgY29va2llSmFyLmxvYWQoY29tcGxldGVfcGF0aCxpZ25vcmVfZGlzY2FyZD1UcnVlKQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgY29va2llSmFyPU5vbmUKCiAgICBpZiBub3QgY29va2llSmFyOgogICAgICAgIGNvb2tpZUphciA9IGNvb2tpZWxpYi5MV1BDb29raWVKYXIoKQoKICAgIHJldHVybiBjb29raWVKYXIKCmRlZiBkb0V2YWwoZnVuX2NhbGwscGFnZV9kYXRhLENvb2tpZV9KYXIsbSk6CiAgICByZXRfdmFsPScnCiAgICBpZiBmdW5jdGlvbnNfZGlyIG5vdCBpbiBzeXMucGF0aDoKICAgICAgICBzeXMucGF0aC5hcHBlbmQoZnVuY3Rpb25zX2RpcikKCiAgICBwcmludCBmdW5fY2FsbAogICAgdHJ5OgogICAgICAgIHB5X2ZpbGU9J2ltcG9ydCAnK2Z1bl9jYWxsLnNwbGl0KCcuJylbMF0KICAgICAgICBwcmludCBweV9maWxlLHN5cy5wYXRoCiAgICAgICAgZXhlYyggcHlfZmlsZSkKICAgICAgICBwcmludCAnZG9uZScKICAgIGV4Y2VwdDoKICAgICAgICBwcmludCAnZXJyb3IgaW4gaW1wb3J0JwogICAgICAgIHRyYWNlYmFjay5wcmludF9leGMoZmlsZT1zeXMuc3Rkb3V0KQogICAgcHJpbnQgJ3JldF92YWw9JytmdW5fY2FsbAogICAgZXhlYyAoJ3JldF92YWw9JytmdW5fY2FsbCkKICAgIHByaW50IHJldF92YWwKICAgICNleGVjKCdyZXRfdmFsPTErMScpCiAgICByZXR1cm4gc3RyKHJldF92YWwpCgpkZWYgZG9FdmFsRnVuY3Rpb24oZnVuX2NhbGwscGFnZV9kYXRhLENvb2tpZV9KYXIsbSk6CiAgICBwcmludCAnZG9FdmFsRnVuY3Rpb24nCiAgICByZXRfdmFsPScnCiAgICBpZiBmdW5jdGlvbnNfZGlyIG5vdCBpbiBzeXMucGF0aDoKICAgICAgICBzeXMucGF0aC5hcHBlbmQoZnVuY3Rpb25zX2RpcikKICAgIGY9b3BlbihmdW5jdGlvbnNfZGlyKyIvTFNQcm9keW5hbWljQ29kZS5weSIsInciKQogICAgZi53cml0ZShmdW5fY2FsbCk7CiAgICBmLmNsb3NlKCkKICAgIGltcG9ydCBMU1Byb2R5bmFtaWNDb2RlCiAgICByZXRfdmFsPUxTUHJvZHluYW1pY0NvZGUuR2V0TFNQcm9EYXRhKHBhZ2VfZGF0YSxDb29raWVfSmFyLG0pCiAgICByZXR1cm4gc3RyKHJldF92YWwpCgoKZGVmIHByb2Nlc3NSZWNhcHRjaGEodXJsKToKICAgIGh0bWxfdGV4dD1nZXRVcmwodXJsKQogICAgcmVjYXBDaGFsbGVuZ2U9IiIKICAgIHNvbHV0aW9uPSIiCiAgICBjYXBfcmVnPSI8c2NyaXB0Lio/c3JjPVwiKC4qP3JlY2FwLio/KVwiIgogICAgbWF0Y2ggPXJlLmZpbmRhbGwoY2FwX3JlZywgaHRtbF90ZXh0KQogICAgY2FwdGNoYT1GYWxzZQogICAgY2FwdGNoYV9yZWxvYWRfcmVzcG9uc2VfY2hhbGw9Tm9uZQogICAgc29sdXRpb249Tm9uZQoKICAgIGlmIG1hdGNoIGFuZCBsZW4obWF0Y2gpPjA6ICNuZXcgc2hpbnkgY2FwdGNoYSEKICAgICAgICBjYXB0Y2hhX3VybD1tYXRjaFswXQogICAgICAgIGNhcHRjaGE9VHJ1ZQoKICAgICAgICBjYXBfY2hhbGxfcmVnPSdjaGFsbGVuZ2UuKj9cJyguKj8pXCcnCiAgICAgICAgY2FwX2ltYWdlX3JlZz0nXCcoLio/KVwnJwogICAgICAgIGNhcHRjaGFfc2NyaXB0PWdldFVybChjYXB0Y2hhX3VybCkKICAgICAgICByZWNhcENoYWxsZW5nZT1yZS5maW5kYWxsKGNhcF9jaGFsbF9yZWcsIGNhcHRjaGFfc2NyaXB0KVswXQogICAgICAgIGNhcHRjaGFfcmVsb2FkPSdodHRwOi8vd3d3Lmdvb2dsZS5jb20vcmVjYXB0Y2hhL2FwaS9yZWxvYWQ/Yz0nOwogICAgICAgIGNhcHRjaGFfaz1jYXB0Y2hhX3VybC5zcGxpdCgnaz0nKVsxXQogICAgICAgIGNhcHRjaGFfcmVsb2FkKz1yZWNhcENoYWxsZW5nZSsnJms9JytjYXB0Y2hhX2srJyZjYXB0Y2hhX2s9MSZ0eXBlPWltYWdlJmxhbmc9ZW4tR0InCiAgICAgICAgY2FwdGNoYV9yZWxvYWRfanM9Z2V0VXJsKGNhcHRjaGFfcmVsb2FkKQogICAgICAgIGNhcHRjaGFfcmVsb2FkX3Jlc3BvbnNlX2NoYWxsPXJlLmZpbmRhbGwoY2FwX2ltYWdlX3JlZywgY2FwdGNoYV9yZWxvYWRfanMpWzBdCiAgICAgICAgY2FwdGNoYV9pbWFnZV91cmw9J2h0dHA6Ly93d3cuZ29vZ2xlLmNvbS9yZWNhcHRjaGEvYXBpL2ltYWdlP2M9JytjYXB0Y2hhX3JlbG9hZF9yZXNwb25zZV9jaGFsbAogICAgICAgIGlmIG5vdCBjYXB0Y2hhX2ltYWdlX3VybC5zdGFydHN3aXRoKCJodHRwIik6CiAgICAgICAgICAgIGNhcHRjaGFfaW1hZ2VfdXJsPSdodHRwOi8vd3d3Lmdvb2dsZS5jb20vcmVjYXB0Y2hhL2FwaS8nK2NhcHRjaGFfaW1hZ2VfdXJsCiAgICAgICAgaW1wb3J0IHJhbmRvbQogICAgICAgIG49cmFuZG9tLnJhbmRyYW5nZSgxMDAsMTAwMCw1KQogICAgICAgIGxvY2FsX2NhcHRjaGEgPSBvcy5wYXRoLmpvaW4ocHJvZmlsZSxzdHIobikgKyJjYXB0Y2hhLmltZyIgKQogICAgICAgIGxvY2FsRmlsZSA9IG9wZW4obG9jYWxfY2FwdGNoYSwgIndiIikKICAgICAgICBsb2NhbEZpbGUud3JpdGUoZ2V0VXJsKGNhcHRjaGFfaW1hZ2VfdXJsKSkKICAgICAgICBsb2NhbEZpbGUuY2xvc2UoKQogICAgICAgIHNvbHZlciA9IElucHV0V2luZG93KGNhcHRjaGE9bG9jYWxfY2FwdGNoYSkKICAgICAgICBzb2x1dGlvbiA9IHNvbHZlci5nZXQoKQogICAgICAgIG9zLnJlbW92ZShsb2NhbF9jYXB0Y2hhKQogICAgcmV0dXJuIGNhcHRjaGFfcmVsb2FkX3Jlc3BvbnNlX2NoYWxsICxzb2x1dGlvbgoKZGVmIGdldFVybCh1cmwsIGNvb2tpZUphcj1Ob25lLHBvc3Q9Tm9uZSwgdGltZW91dD0yMCwgaGVhZGVycz1Ob25lKToKCgogICAgY29va2llX2hhbmRsZXIgPSB1cmxsaWIyLkhUVFBDb29raWVQcm9jZXNzb3IoY29va2llSmFyKQogICAgb3BlbmVyID0gdXJsbGliMi5idWlsZF9vcGVuZXIoY29va2llX2hhbmRsZXIsIHVybGxpYjIuSFRUUEJhc2ljQXV0aEhhbmRsZXIoKSwgdXJsbGliMi5IVFRQSGFuZGxlcigpKQogICAgI29wZW5lciA9IHVybGxpYjIuaW5zdGFsbF9vcGVuZXIob3BlbmVyKQogICAgcmVxID0gdXJsbGliMi5SZXF1ZXN0KHVybCkKICAgIHJlcS5hZGRfaGVhZGVyKCdVc2VyLUFnZW50JywnTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgNi4xOyBXT1c2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzMzLjAuMTc1MC4xNTQgU2FmYXJpLzUzNy4zNicpCiAgICBpZiBoZWFkZXJzOgogICAgICAgIGZvciBoLGh2IGluIGhlYWRlcnM6CiAgICAgICAgICAgIHJlcS5hZGRfaGVhZGVyKGgsaHYpCgogICAgcmVzcG9uc2UgPSBvcGVuZXIub3BlbihyZXEscG9zdCx0aW1lb3V0PXRpbWVvdXQpCiAgICBsaW5rPXJlc3BvbnNlLnJlYWQoKQogICAgcmVzcG9uc2UuY2xvc2UoKQogICAgcmV0dXJuIGxpbms7CgpkZWYgZ2V0X2RlY29kZShzdHIscmVnPU5vbmUpOgogICAgaWYgcmVnOgogICAgICAgIHN0cj1yZS5maW5kYWxsKHJlZywgc3RyKVswXQogICAgczEgPSB1cmxsaWIudW5xdW90ZShzdHJbMDogbGVuKHN0ciktMV0pOwogICAgdCA9ICcnOwogICAgZm9yIGkgaW4gcmFuZ2UoIGxlbihzMSkpOgogICAgICAgIHQgKz0gY2hyKG9yZChzMVtpXSkgLSBzMVtsZW4oczEpLTFdKTsKICAgIHQ9dXJsbGliLnVucXVvdGUodCkKICAgIHByaW50IHQKICAgIHJldHVybiB0CgpkZWYgamF2YXNjcmlwdFVuRXNjYXBlKHN0cik6CiAgICBqcz1yZS5maW5kYWxsKCd1bmVzY2FwZVwoXCcoLio/KVwnJyxzdHIpCiAgICBwcmludCAnanMnLGpzCiAgICBpZiAobm90IGpzPT1Ob25lKSBhbmQgbGVuKGpzKT4wOgogICAgICAgIGZvciBqIGluIGpzOgogICAgICAgICAgICAjcHJpbnQgdXJsbGliLnVucXVvdGUoaikKICAgICAgICAgICAgc3RyPXN0ci5yZXBsYWNlKGogLHVybGxpYi51bnF1b3RlKGopKQogICAgcmV0dXJuIHN0cgoKaWlkPTAKZGVmIGFza0NhcHRjaGEobSxodG1sX3BhZ2UsIGNvb2tpZUphcik6CiAgICBnbG9iYWwgaWlkCiAgICBpaWQrPTEKICAgIGV4cHJlPSBtWydleHByZXMnXQogICAgcGFnZV91cmwgPSBtWydwYWdlJ10KICAgIGNhcHRjaGFfcmVnZXg9cmUuY29tcGlsZSgnXCRMaXZlU3RyZWFtQ2FwdGNoYVxbKFteXF1dKilcXScpLmZpbmRhbGwoZXhwcmUpWzBdCgogICAgY2FwdGNoYV91cmw9cmUuY29tcGlsZShjYXB0Y2hhX3JlZ2V4KS5maW5kYWxsKGh0bWxfcGFnZSlbMF0KICAgIHByaW50IGV4cHJlLGNhcHRjaGFfcmVnZXgsY2FwdGNoYV91cmwKICAgIGlmIG5vdCBjYXB0Y2hhX3VybC5zdGFydHN3aXRoKCJodHRwIik6CiAgICAgICAgcGFnZV89J2h0dHA6Ly8nKyIiLmpvaW4ocGFnZV91cmwuc3BsaXQoJy8nKVsyOjNdKQogICAgICAgIGlmIGNhcHRjaGFfdXJsLnN0YXJ0c3dpdGgoIi8iKToKICAgICAgICAgICAgY2FwdGNoYV91cmw9cGFnZV8rY2FwdGNoYV91cmwKICAgICAgICBlbHNlOgogICAgICAgICAgICBjYXB0Y2hhX3VybD1wYWdlXysnLycrY2FwdGNoYV91cmwKCiAgICBsb2NhbF9jYXB0Y2hhID0gb3MucGF0aC5qb2luKHByb2ZpbGUsIHN0cihpaWQpKyJjYXB0Y2hhLmpwZyIgKQogICAgbG9jYWxGaWxlID0gb3Blbihsb2NhbF9jYXB0Y2hhLCAid2IiKQogICAgcHJpbnQgJyBjIGNhcHVybCcsY2FwdGNoYV91cmwKICAgIHJlcSA9IHVybGxpYjIuUmVxdWVzdChjYXB0Y2hhX3VybCkKICAgIHJlcS5hZGRfaGVhZGVyKCdVc2VyLUFnZW50JywgJ01vemlsbGEvNS4wIChXaW5kb3dzIE5UIDYuMTsgcnY6MTQuMCkgR2Vja28vMjAxMDAxMDEgRmlyZWZveC8xNC4wLjEnKQogICAgaWYgJ3JlZmVyZXInIGluIG06CiAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ1JlZmVyZXInLCBtWydyZWZlcmVyJ10pCiAgICBpZiAnYWdlbnQnIGluIG06CiAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ1VzZXItYWdlbnQnLCBtWydhZ2VudCddKQogICAgaWYgJ3NldGNvb2tpZScgaW4gbToKICAgICAgICBwcmludCAnYWRkaW5nIGNvb2tpZScsbVsnc2V0Y29va2llJ10KICAgICAgICByZXEuYWRkX2hlYWRlcignQ29va2llJywgbVsnc2V0Y29va2llJ10pCgogICAgI2Nvb2tpZV9oYW5kbGVyID0gdXJsbGliMi5IVFRQQ29va2llUHJvY2Vzc29yKGNvb2tpZUphcikKICAgICNvcGVuZXIgPSB1cmxsaWIyLmJ1aWxkX29wZW5lcihjb29raWVfaGFuZGxlciwgdXJsbGliMi5IVFRQQmFzaWNBdXRoSGFuZGxlcigpLCB1cmxsaWIyLkhUVFBIYW5kbGVyKCkpCiAgICAjb3BlbmVyID0gdXJsbGliMi5pbnN0YWxsX29wZW5lcihvcGVuZXIpCiAgICB1cmxsaWIyLnVybG9wZW4ocmVxKQogICAgcmVzcG9uc2UgPSB1cmxsaWIyLnVybG9wZW4ocmVxKQoKICAgIGxvY2FsRmlsZS53cml0ZShyZXNwb25zZS5yZWFkKCkpCiAgICByZXNwb25zZS5jbG9zZSgpCiAgICBsb2NhbEZpbGUuY2xvc2UoKQogICAgc29sdmVyID0gSW5wdXRXaW5kb3coY2FwdGNoYT1sb2NhbF9jYXB0Y2hhKQogICAgc29sdXRpb24gPSBzb2x2ZXIuZ2V0KCkKICAgIHJldHVybiBzb2x1dGlvbgoKZGVmIGFza0NhcHRjaGFOZXcoaW1hZ2VyZWdleCxodG1sX3BhZ2UsY29va2llSmFyLG0pOgogICAgZ2xvYmFsIGlpZAogICAgaWlkKz0xCgoKICAgIGlmIG5vdCBpbWFnZXJlZ2V4PT0nJzoKICAgICAgICBpZiBodG1sX3BhZ2Uuc3RhcnRzd2l0aCgiaHR0cCIpOgogICAgICAgICAgICBwYWdlXz1nZXRVcmwoaHRtbF9wYWdlLGNvb2tpZUphcj1jb29raWVKYXIpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcGFnZV89aHRtbF9wYWdlCiAgICAgICAgY2FwdGNoYV91cmw9cmUuY29tcGlsZShpbWFnZXJlZ2V4KS5maW5kYWxsKGh0bWxfcGFnZSlbMF0KICAgIGVsc2U6CiAgICAgICAgY2FwdGNoYV91cmw9aHRtbF9wYWdlCiAgICAgICAgaWYgJ29uZXBsYXkudHYvZW1iZWQnIGluIGh0bWxfcGFnZToKICAgICAgICAgICAgaW1wb3J0IG9uZXBsYXkKICAgICAgICAgICAgcGFnZV89Z2V0VXJsKGh0bWxfcGFnZSxjb29raWVKYXI9Y29va2llSmFyKQogICAgICAgICAgICBjYXB0Y2hhX3VybD1vbmVwbGF5LmdldENhcHRjaGFVcmwocGFnZV8pCgogICAgbG9jYWxfY2FwdGNoYSA9IG9zLnBhdGguam9pbihwcm9maWxlLCBzdHIoaWlkKSsiY2FwdGNoYS5qcGciICkKICAgIGxvY2FsRmlsZSA9IG9wZW4obG9jYWxfY2FwdGNoYSwgIndiIikKICAgIHByaW50ICcgYyBjYXB1cmwnLGNhcHRjaGFfdXJsCiAgICByZXEgPSB1cmxsaWIyLlJlcXVlc3QoY2FwdGNoYV91cmwpCiAgICByZXEuYWRkX2hlYWRlcignVXNlci1BZ2VudCcsICdNb3ppbGxhLzUuMCAoV2luZG93cyBOVCA2LjE7IHJ2OjE0LjApIEdlY2tvLzIwMTAwMTAxIEZpcmVmb3gvMTQuMC4xJykKICAgIGlmICdyZWZlcmVyJyBpbiBtOgogICAgICAgIHJlcS5hZGRfaGVhZGVyKCdSZWZlcmVyJywgbVsncmVmZXJlciddKQogICAgaWYgJ2FnZW50JyBpbiBtOgogICAgICAgIHJlcS5hZGRfaGVhZGVyKCdVc2VyLWFnZW50JywgbVsnYWdlbnQnXSkKICAgIGlmICdhY2NlcHQnIGluIG06CiAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ0FjY2VwdCcsIG1bJ2FjY2VwdCddKQogICAgaWYgJ3NldGNvb2tpZScgaW4gbToKICAgICAgICBwcmludCAnYWRkaW5nIGNvb2tpZScsbVsnc2V0Y29va2llJ10KICAgICAgICByZXEuYWRkX2hlYWRlcignQ29va2llJywgbVsnc2V0Y29va2llJ10pCgogICAgI2Nvb2tpZV9oYW5kbGVyID0gdXJsbGliMi5IVFRQQ29va2llUHJvY2Vzc29yKGNvb2tpZUphcikKICAgICNvcGVuZXIgPSB1cmxsaWIyLmJ1aWxkX29wZW5lcihjb29raWVfaGFuZGxlciwgdXJsbGliMi5IVFRQQmFzaWNBdXRoSGFuZGxlcigpLCB1cmxsaWIyLkhUVFBIYW5kbGVyKCkpCiAgICAjb3BlbmVyID0gdXJsbGliMi5pbnN0YWxsX29wZW5lcihvcGVuZXIpCiAgICAjdXJsbGliMi51cmxvcGVuKHJlcSkKICAgIHJlc3BvbnNlID0gdXJsbGliMi51cmxvcGVuKHJlcSkKCiAgICBsb2NhbEZpbGUud3JpdGUocmVzcG9uc2UucmVhZCgpKQogICAgcmVzcG9uc2UuY2xvc2UoKQogICAgbG9jYWxGaWxlLmNsb3NlKCkKICAgIHNvbHZlciA9IElucHV0V2luZG93KGNhcHRjaGE9bG9jYWxfY2FwdGNoYSkKICAgIHNvbHV0aW9uID0gc29sdmVyLmdldCgpCiAgICByZXR1cm4gc29sdXRpb24KCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwojIEZ1bmN0aW9uICA6IEdVSUVkaXRFeHBvcnROYW1lICAgICAgICAgICAgICAgICAgICAgICAgICMKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiMgUGFyYW1ldGVyIDogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIwojICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMKIyBuYW1lICAgICAgICBzdWdlc3RlZCBuYW1lIGZvciBleHBvcnQgICAgICAgICAgICAgICAgICAjCiMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyAKIyBSZXR1cm5zICAgOiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjCiMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIwojIG5hbWUgICAgICAgIG5hbWUgb2YgZXhwb3J0IGV4Y2x1ZGluZyBhbnkgZXh0ZW5zaW9uICAgICMKIyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwpkZWYgVGFrZUlucHV0KG5hbWUsIGhlYWRuYW1lKToKCgogICAga2IgPSB4Ym1jLktleWJvYXJkKCdkZWZhdWx0JywgJ2hlYWRpbmcnLCBUcnVlKQogICAga2Iuc2V0RGVmYXVsdChuYW1lKQogICAga2Iuc2V0SGVhZGluZyhoZWFkbmFtZSkKICAgIGtiLnNldEhpZGRlbklucHV0KEZhbHNlKQogICAgcmV0dXJuIGtiLmdldFRleHQoKQoKICAgCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwoKY2xhc3MgSW5wdXRXaW5kb3coeGJtY2d1aS5XaW5kb3dEaWFsb2cpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsICphcmdzLCAqKmt3YXJncyk6CiAgICAgICAgc2VsZi5jcHRsb2MgPSBrd2FyZ3MuZ2V0KCdjYXB0Y2hhJykKICAgICAgICBzZWxmLmltZyA9IHhibWNndWkuQ29udHJvbEltYWdlKDMzNSwzMCw2MjQsNjAsc2VsZi5jcHRsb2MpCiAgICAgICAgc2VsZi5hZGRDb250cm9sKHNlbGYuaW1nKQogICAgICAgIHNlbGYua2JkID0geGJtYy5LZXlib2FyZCgpCgogICAgZGVmIGdldChzZWxmKToKICAgICAgICBzZWxmLnNob3coKQogICAgICAgIHRpbWUuc2xlZXAoMikKICAgICAgICBzZWxmLmtiZC5kb01vZGFsKCkKICAgICAgICBpZiAoc2VsZi5rYmQuaXNDb25maXJtZWQoKSk6CiAgICAgICAgICAgIHRleHQgPSBzZWxmLmtiZC5nZXRUZXh0KCkKICAgICAgICAgICAgc2VsZi5jbG9zZSgpCiAgICAgICAgICAgIHJldHVybiB0ZXh0CiAgICAgICAgc2VsZi5jbG9zZSgpCiAgICAgICAgcmV0dXJuIEZhbHNlCgpkZWYgZ2V0RXBvY1RpbWUoKToKICAgIGltcG9ydCB0aW1lCiAgICByZXR1cm4gc3RyKGludCh0aW1lLnRpbWUoKSoxMDAwKSkKCmRlZiBnZXRFcG9jVGltZTIoKToKICAgIGltcG9ydCB0aW1lCiAgICByZXR1cm4gc3RyKGludCh0aW1lLnRpbWUoKSkpCgpkZWYgZ2V0X3BhcmFtcygpOgogICAgICAgIHBhcmFtPVtdCiAgICAgICAgcGFyYW1zdHJpbmc9c3lzLmFyZ3ZbMl0KICAgICAgICBpZiBsZW4ocGFyYW1zdHJpbmcpPj0yOgogICAgICAgICAgICBwYXJhbXM9c3lzLmFyZ3ZbMl0KICAgICAgICAgICAgY2xlYW5lZHBhcmFtcz1wYXJhbXMucmVwbGFjZSgnPycsJycpCiAgICAgICAgICAgIGlmIChwYXJhbXNbbGVuKHBhcmFtcyktMV09PScvJyk6CiAgICAgICAgICAgICAgICBwYXJhbXM9cGFyYW1zWzA6bGVuKHBhcmFtcyktMl0KICAgICAgICAgICAgcGFpcnNvZnBhcmFtcz1jbGVhbmVkcGFyYW1zLnNwbGl0KCcmJykKICAgICAgICAgICAgcGFyYW09e30KICAgICAgICAgICAgZm9yIGkgaW4gcmFuZ2UobGVuKHBhaXJzb2ZwYXJhbXMpKToKICAgICAgICAgICAgICAgIHNwbGl0cGFyYW1zPXt9CiAgICAgICAgICAgICAgICBzcGxpdHBhcmFtcz1wYWlyc29mcGFyYW1zW2ldLnNwbGl0KCc9JykKICAgICAgICAgICAgICAgIGlmIChsZW4oc3BsaXRwYXJhbXMpKT09MjoKICAgICAgICAgICAgICAgICAgICBwYXJhbVtzcGxpdHBhcmFtc1swXV09c3BsaXRwYXJhbXNbMV0KICAgICAgICByZXR1cm4gcGFyYW0KCgpkZWYgZ2V0RmF2b3JpdGVzKCk6CiAgICAgICAgaXRlbXMgPSBqc29uLmxvYWRzKG9wZW4oZmF2b3JpdGVzKS5yZWFkKCkpCiAgICAgICAgdG90YWwgPSBsZW4oaXRlbXMpCiAgICAgICAgZm9yIGkgaW4gaXRlbXM6CiAgICAgICAgICAgIG5hbWUgPSBpWzBdCiAgICAgICAgICAgIHVybCA9IGlbMV0KICAgICAgICAgICAgaWNvbmltYWdlID0gaVsyXQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBmYW5BcnQgPSBpWzNdCiAgICAgICAgICAgICAgICBpZiBmYW5BcnQgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICByYWlzZQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCd1c2VfdGh1bWInKSA9PSAidHJ1ZSI6CiAgICAgICAgICAgICAgICAgICAgZmFuQXJ0ID0gaWNvbmltYWdlCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGZhbkFydCA9IGZhbmFydAogICAgICAgICAgICB0cnk6IHBsYXlsaXN0ID0gaVs1XQogICAgICAgICAgICBleGNlcHQ6IHBsYXlsaXN0ID0gTm9uZQogICAgICAgICAgICB0cnk6IHJlZ2V4cyA9IGlbNl0KICAgICAgICAgICAgZXhjZXB0OiByZWdleHMgPSBOb25lCgogICAgICAgICAgICBpZiBpWzRdID09IDA6CiAgICAgICAgICAgICAgICBhZGRMaW5rKHVybCxuYW1lLGljb25pbWFnZSxmYW5BcnQsJycsJycsJycsJ2ZhdicscGxheWxpc3QscmVnZXhzLHRvdGFsKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUsdXJsLGlbNF0saWNvbmltYWdlLGZhbmFydCwnJywnJywnJywnJywnZmF2JykKCgpkZWYgYWRkRmF2b3JpdGUobmFtZSx1cmwsaWNvbmltYWdlLGZhbmFydCxtb2RlLHBsYXlsaXN0PU5vbmUscmVnZXhzPU5vbmUpOgogICAgICAgIGZhdkxpc3QgPSBbXQogICAgICAgIHRyeToKICAgICAgICAgICAgIyBzZWVtcyB0aGF0IGFmdGVyCiAgICAgICAgICAgIG5hbWUgPSBuYW1lLmVuY29kZSgndXRmLTgnLCAnaWdub3JlJykKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIHBhc3MKICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhmYXZvcml0ZXMpPT1GYWxzZToKICAgICAgICAgICAgYWRkb25fbG9nKCdNYWtpbmcgRmF2b3JpdGVzIEZpbGUnKQogICAgICAgICAgICBmYXZMaXN0LmFwcGVuZCgobmFtZSx1cmwsaWNvbmltYWdlLGZhbmFydCxtb2RlLHBsYXlsaXN0LHJlZ2V4cykpCiAgICAgICAgICAgIGEgPSBvcGVuKGZhdm9yaXRlcywgInciKQogICAgICAgICAgICBhLndyaXRlKGpzb24uZHVtcHMoZmF2TGlzdCkpCiAgICAgICAgICAgIGEuY2xvc2UoKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGFkZG9uX2xvZygnQXBwZW5kaW5nIEZhdm9yaXRlcycpCiAgICAgICAgICAgIGEgPSBvcGVuKGZhdm9yaXRlcykucmVhZCgpCiAgICAgICAgICAgIGRhdGEgPSBqc29uLmxvYWRzKGEpCiAgICAgICAgICAgIGRhdGEuYXBwZW5kKChuYW1lLHVybCxpY29uaW1hZ2UsZmFuYXJ0LG1vZGUpKQogICAgICAgICAgICBiID0gb3BlbihmYXZvcml0ZXMsICJ3IikKICAgICAgICAgICAgYi53cml0ZShqc29uLmR1bXBzKGRhdGEpKQogICAgICAgICAgICBiLmNsb3NlKCkKCgpkZWYgcm1GYXZvcml0ZShuYW1lKToKICAgICAgICBkYXRhID0ganNvbi5sb2FkcyhvcGVuKGZhdm9yaXRlcykucmVhZCgpKQogICAgICAgIGZvciBpbmRleCBpbiByYW5nZShsZW4oZGF0YSkpOgogICAgICAgICAgICBpZiBkYXRhW2luZGV4XVswXT09bmFtZToKICAgICAgICAgICAgICAgIGRlbCBkYXRhW2luZGV4XQogICAgICAgICAgICAgICAgYiA9IG9wZW4oZmF2b3JpdGVzLCAidyIpCiAgICAgICAgICAgICAgICBiLndyaXRlKGpzb24uZHVtcHMoZGF0YSkpCiAgICAgICAgICAgICAgICBiLmNsb3NlKCkKICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Db250YWluZXIuUmVmcmVzaCIpCgpkZWYgdXJsc29sdmVyKHVybCk6CiAgICBpbXBvcnQgdXJscmVzb2x2ZXIKICAgIGhvc3QgPSB1cmxyZXNvbHZlci5Ib3N0ZWRNZWRpYUZpbGUodXJsKQogICAgaWYgaG9zdDoKICAgICAgICByZXNvbHZlciA9IHVybHJlc29sdmVyLnJlc29sdmUodXJsKQogICAgICAgIHJlc29sdmVkID0gcmVzb2x2ZXIKICAgICAgICBpZiBpc2luc3RhbmNlKHJlc29sdmVkLGxpc3QpOgogICAgICAgICAgICBmb3IgayBpbiByZXNvbHZlZDoKICAgICAgICAgICAgICAgIHF1YWxpdHkgPSBhZGRvbi5nZXRTZXR0aW5nKCdxdWFsaXR5JykKICAgICAgICAgICAgICAgIGlmIGtbJ3F1YWxpdHknXSA9PSAnSEQnICA6CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZXIgPSBrWyd1cmwnXQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICBlbGlmIGtbJ3F1YWxpdHknXSA9PSAnU0QnIDoKICAgICAgICAgICAgICAgICAgICByZXNvbHZlciA9IGtbJ3VybCddCiAgICAgICAgICAgICAgICBlbGlmIGtbJ3F1YWxpdHknXSA9PSAnMTA4MHAnIGFuZCBhZGRvbi5nZXRTZXR0aW5nKCcxMDgwcHF1YWxpdHknKSA9PSAndHJ1ZScgOgogICAgICAgICAgICAgICAgICAgIHJlc29sdmVyID0ga1sndXJsJ10KICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJlc29sdmVyID0gcmVzb2x2ZWQKICAgIGVsc2U6CiAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Ob3RpZmljYXRpb24oTGl2ZXR2ZGV0b2RvcyxVcmxyZXNvbHZlciBkb25vdCBzdXBwb3J0IHRoaXMgZG9tYWluLiAtICw1MDAwKSIpCiAgICByZXR1cm4gcmVzb2x2ZXIKZGVmIHBsYXlfcGxheWxpc3QobmFtZSwgbXVfcGxheWxpc3QscXVldWVWaWRlbz1Ob25lKToKICAgICAgICBwbGF5bGlzdCA9IHhibWMuUGxheUxpc3QoeGJtYy5QTEFZTElTVF9WSURFTykKCiAgICAgICAgaWYgYWRkb24uZ2V0U2V0dGluZygnYXNrX3BsYXlsaXN0X2l0ZW1zJykgPT0gJ3RydWUnIGFuZCBub3QgcXVldWVWaWRlbyA6CiAgICAgICAgICAgIGltcG9ydCB1cmxwYXJzZQogICAgICAgICAgICBuYW1lcyA9IFtdCiAgICAgICAgICAgIGZvciBpIGluIG11X3BsYXlsaXN0OgogICAgICAgICAgICAgICAgZF9uYW1lPXVybHBhcnNlLnVybHBhcnNlKGkpLm5ldGxvYwogICAgICAgICAgICAgICAgaWYgZF9uYW1lID09ICcnOgogICAgICAgICAgICAgICAgICAgIG5hbWVzLmFwcGVuZChuYW1lKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBuYW1lcy5hcHBlbmQoZF9uYW1lKQogICAgICAgICAgICBkaWFsb2cgPSB4Ym1jZ3VpLkRpYWxvZygpCiAgICAgICAgICAgIGluZGV4ID0gZGlhbG9nLnNlbGVjdCgnQ2hvb3NlIGEgdmlkZW8gc291cmNlJywgbmFtZXMpCiAgICAgICAgICAgIGlmIGluZGV4ID49IDA6CiAgICAgICAgICAgICAgICBpZiAiJm1vZGU9MTkiIGluIG11X3BsYXlsaXN0W2luZGV4XToKICAgICAgICAgICAgICAgICAgICAjcGxheXNldHJlc29sdmVkICh1cmxzb2x2ZXIobXVfcGxheWxpc3RbaW5kZXhdLnJlcGxhY2UoJyZtb2RlPTE5JywnJykpLG5hbWUsaWNvbmltYWdlLFRydWUpCiAgICAgICAgICAgICAgICAgICAgeGJtYy5QbGF5ZXIoKS5wbGF5KHVybHNvbHZlcihtdV9wbGF5bGlzdFtpbmRleF0ucmVwbGFjZSgnJm1vZGU9MTknLCcnKS5yZXBsYWNlKCc7JywnJykpKQogICAgICAgICAgICAgICAgZWxpZiAiJGRvcmVnZXgiIGluIG11X3BsYXlsaXN0W2luZGV4XSA6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQgbXVfcGxheWxpc3RbaW5kZXhdCiAgICAgICAgICAgICAgICAgICAgc2VwYXRlID0gbXVfcGxheWxpc3RbaW5kZXhdLnNwbGl0KCcmcmVnZXhzPScpCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgc2VwYXRlCiAgICAgICAgICAgICAgICAgICAgdXJsLHNldHJlc29sdmVkID0gZ2V0UmVnZXhQYXJzZWQoc2VwYXRlWzFdLCBzZXBhdGVbMF0pCiAgICAgICAgICAgICAgICAgICAgdXJsMiA9IHVybC5yZXBsYWNlKCc7JywnJykKICAgICAgICAgICAgICAgICAgICB4Ym1jLlBsYXllcigpLnBsYXkodXJsMikKCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHVybCA9IG11X3BsYXlsaXN0W2luZGV4XQogICAgICAgICAgICAgICAgICAgIHhibWMuUGxheWVyKCkucGxheSh1cmwpCiAgICAgICAgZWxpZiBub3QgcXVldWVWaWRlbzoKICAgICAgICAgICAgI3BsYXlsaXN0ID0geGJtYy5QbGF5TGlzdCgxKSAjIDEgbWVhbnMgdmlkZW8KICAgICAgICAgICAgcGxheWxpc3QuY2xlYXIoKQogICAgICAgICAgICBpdGVtID0gMAogICAgICAgICAgICBmb3IgaSBpbiBtdV9wbGF5bGlzdDoKICAgICAgICAgICAgICAgIGl0ZW0gKz0gMQogICAgICAgICAgICAgICAgaW5mbyA9IHhibWNndWkuTGlzdEl0ZW0oJyVzKSAlcycgJShzdHIoaXRlbSksbmFtZSkpCiAgICAgICAgICAgICAgICAjIERvbid0IGRvIHRoaXMgYXMgcmVnZXggcGFyc2VkIG1pZ2h0IHRha2UgbG9uZ2VyCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgaWYgIiRkb3JlZ2V4IiBpbiBpOgogICAgICAgICAgICAgICAgICAgICAgICBzZXBhdGUgPSBpLnNwbGl0KCcmcmVnZXhzPScpCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50IHNlcGF0ZQogICAgICAgICAgICAgICAgICAgICAgICB1cmwsc2V0cmVzb2x2ZWQgPSBnZXRSZWdleFBhcnNlZChzZXBhdGVbMV0sIHNlcGF0ZVswXSkKICAgICAgICAgICAgICAgICAgICBlbGlmICImbW9kZT0xOSIgaW4gaToKICAgICAgICAgICAgICAgICAgICAgICAgdXJsID0gdXJsc29sdmVyKGkucmVwbGFjZSgnJm1vZGU9MTknLCcnKS5yZXBsYWNlKCc7JywnJykpICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgdXJsOgogICAgICAgICAgICAgICAgICAgICAgICBwbGF5bGlzdC5hZGQodXJsLCBpbmZvKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgICAgIHBsYXlsaXN0LmFkZChpLCBpbmZvKQogICAgICAgICAgICAgICAgICAgIHBhc3MgI3hibWMuUGxheWVyKCkucGxheSh1cmwpCgogICAgICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCdwbGF5bGlzdC5wbGF5b2Zmc2V0KHZpZGVvLDApJykKICAgICAgICBlbHNlOgoKICAgICAgICAgICAgICAgIGxpc3RpdGVtID0geGJtY2d1aS5MaXN0SXRlbShuYW1lKQogICAgICAgICAgICAgICAgcGxheWxpc3QuYWRkKG11X3BsYXlsaXN0LCBsaXN0aXRlbSkKCgpkZWYgZG93bmxvYWRfZmlsZShuYW1lLCB1cmwpOgogICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoJ3NhdmVfbG9jYXRpb24nKSA9PSAiIjoKICAgICAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Ob3RpZmljYXRpb24oJ0xpdmV0dmRldG9kb3MnLCdDaG9vc2UgYSBsb2NhdGlvbiB0byBzYXZlIGZpbGVzLicsMTUwMDAsIitpY29uKyIpIikKICAgICAgICAgICAgYWRkb24ub3BlblNldHRpbmdzKCkKICAgICAgICBwYXJhbXMgPSB7J3VybCc6IHVybCwgJ2Rvd25sb2FkX3BhdGgnOiBhZGRvbi5nZXRTZXR0aW5nKCdzYXZlX2xvY2F0aW9uJyl9CiAgICAgICAgZG93bmxvYWRlci5kb3dubG9hZChuYW1lLCBwYXJhbXMpCiAgICAgICAgZGlhbG9nID0geGJtY2d1aS5EaWFsb2coKQogICAgICAgIHJldCA9IGRpYWxvZy55ZXNubygnTGl2ZXR2ZGV0b2RvcycsICdEbyB5b3Ugd2FudCB0byBhZGQgdGhpcyBmaWxlIGFzIGEgc291cmNlPycpCiAgICAgICAgaWYgcmV0OgogICAgICAgICAgICBhZGRTb3VyY2Uob3MucGF0aC5qb2luKGFkZG9uLmdldFNldHRpbmcoJ3NhdmVfbG9jYXRpb24nKSwgbmFtZSkpCgpkZWYgX3NlYXJjaCh1cmwsbmFtZSk6CiAgICMgcHJpbnQgdXJsLG5hbWUKICAgIHBsdWdpbnNlYXJjaHVybHMgPSBbJ3BsdWdpbjovL3BsdWdpbi52aWRlby5nZW5lc2lzLz9hY3Rpb249c2hvd3Nfc2VhcmNoJyxcCiAgICAgICAgICAgICAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLmdlbmVzaXMvP2FjdGlvbj1tb3ZpZXNfc2VhcmNoJyxcCiAgICAgICAgICAgICAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnNhbHRzLz9tb2RlPXNlYXJjaCZhbXA7c2VjdGlvbj1Nb3ZpZXMnLFwKICAgICAgICAgICAgICdwbHVnaW46Ly9wbHVnaW4udmlkZW8uc2FsdHMvP21vZGU9c2VhcmNoJmFtcDtzZWN0aW9uPVRWJyxcCiAgICAgICAgICAgICAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLm11Y2htb3ZpZXMuaGQvP2FjdGlvbj1tb3ZpZXNfc2VhcmNoJyxcCiAgICAgICAgICAgICAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnZpb296LmNvLz9hY3Rpb249cm9vdF9zZWFyY2gnLFwKICAgICAgICAgICAgICdwbHVnaW46Ly9wbHVnaW4udmlkZW8ub3Jvcm90di8/YWN0aW9uPXNob3dzX3NlYXJjaCcsXAogICAgICAgICAgICAgJ3BsdWdpbjovL3BsdWdpbi52aWRlby55aWZ5bW92aWVzLmhkLz9hY3Rpb249bW92aWVzX3NlYXJjaCcsXAogICAgICAgICAgICAgJ3BsdWdpbjovL3BsdWdpbi52aWRlby5jYXJ0b29uaGR0d28vP2Rlc2NyaXB0aW9uJmFtcDtmYW5hcnQmYW1wO2ljb25pbWFnZSZhbXA7bW9kZT0zJmFtcDtuYW1lPVNlYXJjaCZhbXA7dXJsPXVybCcsXAogICAgICAgICAgICAgJ3BsdWdpbjovL3BsdWdpbi52aWRlby55b3V0dWJlL2tvZGlvbi9zZWFyY2gvbGlzdC8nLFwKICAgICAgICAgICAgICdwbHVnaW46Ly9wbHVnaW4udmlkZW8uZGFpbHltb3Rpb25fY29tLz9tb2RlPXNlYXJjaCZhbXA7dXJsJyxcCiAgICAgICAgICAgICAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnZpbWVvL2tvZGlvbi9zZWFyY2gvbGlzdC8nXAogICAgICAgICAgICAgXQogICAgbmFtZXMgPSBbJ0dlbnNpcyBUVicsJ0dlbmVzaXMgTW92aWUnLCdTYWx0IG1vdmllJywnc2FsdCBUVicsJ011Y2htb3ZpZXMnLCd2aW9veicsJ09Sb3JvVFYnLFwKICAgICAgICAgICAgICdZaWZ5bW92aWVzJywnY2FydG9vbkhEJywnWW91dHViZScsJ0RhaWx5TW90aW9uJywnVmltZW8nXQogICAgZGlhbG9nID0geGJtY2d1aS5EaWFsb2coKQogICAgaW5kZXggPSBkaWFsb2cuc2VsZWN0KCdDaG9vc2UgYSB2aWRlbyBzb3VyY2UnLCBuYW1lcykKCiAgICBpZiBpbmRleCA+PSAwOgogICAgICAgIHVybCA9IHBsdWdpbnNlYXJjaHVybHNbaW5kZXhdCiAgICAgICAgcHJpbnQgJ3VybCcsdXJsCiAgICAgICAgcGx1Z2lucXVlcnlieUpTT04odXJsKQoKZGVmIGFkZERpcihuYW1lLHVybCxtb2RlLGljb25pbWFnZSxmYW5hcnQsZGVzY3JpcHRpb24sZ2VucmUsZGF0ZSxjcmVkaXRzLHNob3djb250ZXh0PUZhbHNlLHJlZ2V4cz1Ob25lLHJlZ191cmw9Tm9uZSxhbGxpbmZvPXt9KToKCiAgICAgICAgdT1zeXMuYXJndlswXSsiP3VybD0iK3VybGxpYi5xdW90ZV9wbHVzKHVybCkrIiZtb2RlPSIrc3RyKG1vZGUpKyImbmFtZT0iK3VybGxpYi5xdW90ZV9wbHVzKG5hbWUpKyImZmFuYXJ0PSIrdXJsbGliLnF1b3RlX3BsdXMoZmFuYXJ0KQogICAgICAgIG9rPVRydWUKICAgICAgICBpZiBkYXRlID09ICcnOgogICAgICAgICAgICBkYXRlID0gTm9uZQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGRlc2NyaXB0aW9uICs9ICdcblxuRGF0ZTogJXMnICVkYXRlCiAgICAgICAgbGl6PXhibWNndWkuTGlzdEl0ZW0obmFtZSwgaWNvbkltYWdlPSJEZWZhdWx0Rm9sZGVyLnBuZyIsIHRodW1ibmFpbEltYWdlPWljb25pbWFnZSkKICAgICAgICBpZiBsZW4oYWxsaW5mbykgPDEgOgogICAgICAgICAgICBsaXouc2V0SW5mbyh0eXBlPSJWaWRlbyIsIGluZm9MYWJlbHM9eyAiVGl0bGUiOiBuYW1lLCAiUGxvdCI6IGRlc2NyaXB0aW9uLCAiR2VucmUiOiBnZW5yZSwgImRhdGVhZGRlZCI6IGRhdGUsICJjcmVkaXRzIjogY3JlZGl0cyB9KQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGxpei5zZXRJbmZvKHR5cGU9IlZpZGVvIiwgaW5mb0xhYmVscz0gYWxsaW5mbykKICAgICAgICBsaXouc2V0UHJvcGVydHkoIkZhbmFydF9JbWFnZSIsIGZhbmFydCkKICAgICAgICBpZiBzaG93Y29udGV4dDoKICAgICAgICAgICAgY29udGV4dE1lbnUgPSBbXQogICAgICAgICAgICBwYXJlbnRhbGJsb2NrID1hZGRvbi5nZXRTZXR0aW5nKCdwYXJlbnRhbGJsb2NrZWQnKQogICAgICAgICAgICBwYXJlbnRhbGJsb2NrPSBwYXJlbnRhbGJsb2NrPT0idHJ1ZSIKICAgICAgICAgICAgcGFyZW50YWxibG9ja2VkcGluID1hZGRvbi5nZXRTZXR0aW5nKCdwYXJlbnRhbGJsb2NrZWRwaW4nKQojICAgICAgICAgICAgcHJpbnQgJ3BhcmVudGFsYmxvY2tlZHBpbicscGFyZW50YWxibG9ja2VkcGluCiAgICAgICAgICAgIGlmIGxlbihwYXJlbnRhbGJsb2NrZWRwaW4pPjA6CiAgICAgICAgICAgICAgICBpZiBwYXJlbnRhbGJsb2NrOgogICAgICAgICAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgoJ0Rpc2FibGUgUGFyZW50YWwgQmxvY2snLCdYQk1DLlJ1blBsdWdpbiglcz9tb2RlPTU1Jm5hbWU9JXMpJyAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSkpKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoKCdFbmFibGUgUGFyZW50YWwgQmxvY2snLCdYQk1DLlJ1blBsdWdpbiglcz9tb2RlPTU2Jm5hbWU9JXMpJyAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSkpKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICBpZiBzaG93Y29udGV4dCA9PSAnc291cmNlJzoKICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBuYW1lIGluIHN0cihTT1VSQ0VTKToKICAgICAgICAgICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoKCdSZW1vdmUgZnJvbSBTb3VyY2VzJywnWEJNQy5SdW5QbHVnaW4oJXM/bW9kZT04Jm5hbWU9JXMpJyAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSkpKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICBlbGlmIHNob3djb250ZXh0ID09ICdkb3dubG9hZCc6CiAgICAgICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoKCdEb3dubG9hZCcsJ1hCTUMuUnVuUGx1Z2luKCVzP3VybD0lcyZtb2RlPTkmbmFtZT0lcyknCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKHVybCksIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpKSkpCiAgICAgICAgICAgIGVsaWYgc2hvd2NvbnRleHQgPT0gJ2Zhdic6CiAgICAgICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoKCdSZW1vdmUgZnJvbSBMaXZldHZkZXRvZG9zIEZhdm9yaXRlcycsJ1hCTUMuUnVuUGx1Z2luKCVzP21vZGU9NiZuYW1lPSVzKScKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXMobmFtZSkpKSkKICAgICAgICAgICAgaWYgc2hvd2NvbnRleHQgPT0gJyEhdXBkYXRlJzoKICAgICAgICAgICAgICAgIGZhdl9wYXJhbXMyID0gKAogICAgICAgICAgICAgICAgICAgICclcz91cmw9JXMmbW9kZT0xNyZyZWdleHM9JXMnCiAgICAgICAgICAgICAgICAgICAgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXMocmVnX3VybCksIHJlZ2V4cykKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoKCdbQ09MT1IgeWVsbG93XSEhdXBkYXRlWy9DT0xPUl0nLCdYQk1DLlJ1blBsdWdpbiglcyknICVmYXZfcGFyYW1zMikpCiAgICAgICAgICAgIGlmIG5vdCBuYW1lIGluIEZBVjoKICAgICAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgoJ0FkZCB0byBMaXZldHZkZXRvZG9zIEZhdm9yaXRlcycsJ1hCTUMuUnVuUGx1Z2luKCVzP21vZGU9NSZuYW1lPSVzJnVybD0lcyZpY29uaW1hZ2U9JXMmZmFuYXJ0PSVzJmZhdl9tb2RlPSVzKScKICAgICAgICAgICAgICAgICAgICAgICAgICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpLCB1cmxsaWIucXVvdGVfcGx1cyh1cmwpLCB1cmxsaWIucXVvdGVfcGx1cyhpY29uaW1hZ2UpLCB1cmxsaWIucXVvdGVfcGx1cyhmYW5hcnQpLCBtb2RlKSkpCiAgICAgICAgICAgIGxpei5hZGRDb250ZXh0TWVudUl0ZW1zKGNvbnRleHRNZW51KQogICAgICAgIG9rPXhibWNwbHVnaW4uYWRkRGlyZWN0b3J5SXRlbShoYW5kbGU9aW50KHN5cy5hcmd2WzFdKSx1cmw9dSxsaXN0aXRlbT1saXosaXNGb2xkZXI9VHJ1ZSkKICAgICAgICByZXR1cm4gb2sKZGVmIHl0ZGxfZG93bmxvYWQodXJsLHRpdGxlLG1lZGlhX3R5cGU9J3ZpZGVvJyk6CiAgICAjIHBsYXkgaW4geGJtYyB3aGlsZSBwbGF5aW5nIGdvIGJhY2sgdG8gY29udGV4dE1lbnUoYykgdG8gIiEhRG93bmxvYWQhISIKICAgICMgVHJpYWwgeWFzY2Vlbjogc2VwZXJhdGUgfFVzZXItQWdlbnQ9CiAgICBpbXBvcnQgeW91dHViZWRsCiAgICBpZiBub3QgdXJsID09ICcnOgogICAgICAgIGlmIG1lZGlhX3R5cGU9PSAnYXVkaW8nOgogICAgICAgICAgICB5b3V0dWJlZGwuc2luZ2xlX1lEKHVybCxkb3dubG9hZD1UcnVlLGF1ZGlvPVRydWUpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgeW91dHViZWRsLnNpbmdsZV9ZRCh1cmwsZG93bmxvYWQ9VHJ1ZSkKICAgIGVsaWYgeGJtYy5QbGF5ZXIoKS5pc1BsYXlpbmcoKSA9PSBUcnVlIDoKICAgICAgICBpbXBvcnQgWURTdHJlYW1FeHRyYWN0b3IKICAgICAgICBpZiBZRFN0cmVhbUV4dHJhY3Rvci5pc0Rvd25sb2FkaW5nKCkgPT0gVHJ1ZToKCiAgICAgICAgICAgIFlEU3RyZWFtRXh0cmFjdG9yLm1hbmFnZURvd25sb2FkcygpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgeGJtY191cmwgPSB4Ym1jLlBsYXllcigpLmdldFBsYXlpbmdGaWxlKCkKCiAgICAgICAgICAgIHhibWNfdXJsID0geGJtY191cmwuc3BsaXQoJ3xVc2VyLUFnZW50PScpWzBdCiAgICAgICAgICAgIGluZm8gPSB7J3VybCc6eGJtY191cmwsJ3RpdGxlJzp0aXRsZSwnbWVkaWFfdHlwZSc6bWVkaWFfdHlwZX0KICAgICAgICAgICAgeW91dHViZWRsLnNpbmdsZV9ZRCgnJyxkb3dubG9hZD1UcnVlLGRsX2luZm89aW5mbykKICAgIGVsc2U6CiAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Ob3RpZmljYXRpb24oRE9XTkxPQUQsRmlyc3QgUGxheSBbQ09MT1IgeWVsbG93XVdISUxFIHBsYXlpbmcgZG93bmxvYWRbL0NPTE9SXSAsMTAwMDApIikKCiMjIEx1bmF0aXh6IFBzZXVkb1RWIGZlYXR1cmUKZGVmIGFzY2lpKHN0cmluZyk6CiAgICBpZiBpc2luc3RhbmNlKHN0cmluZywgYmFzZXN0cmluZyk6CiAgICAgICAgaWYgaXNpbnN0YW5jZShzdHJpbmcsIHVuaWNvZGUpOgogICAgICAgICAgIHN0cmluZyA9IHN0cmluZy5lbmNvZGUoJ2FzY2lpJywgJ2lnbm9yZScpCiAgICByZXR1cm4gc3RyaW5nCmRlZiB1bmkoc3RyaW5nLCBlbmNvZGluZyA9ICd1dGYtOCcpOgogICAgaWYgaXNpbnN0YW5jZShzdHJpbmcsIGJhc2VzdHJpbmcpOgogICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKHN0cmluZywgdW5pY29kZSk6CiAgICAgICAgICAgIHN0cmluZyA9IHVuaWNvZGUoc3RyaW5nLCBlbmNvZGluZywgJ2lnbm9yZScpCiAgICByZXR1cm4gc3RyaW5nCmRlZiByZW1vdmVOb25Bc2NpaShzKTogcmV0dXJuICIiLmpvaW4oZmlsdGVyKGxhbWJkYSB4OiBvcmQoeCk8MTI4LCBzKSkKCmRlZiBzZW5kSlNPTiggY29tbWFuZCk6CiAgICBkYXRhID0gJycKICAgIHRyeToKICAgICAgICBkYXRhID0geGJtYy5leGVjdXRlSlNPTlJQQyh1bmkoY29tbWFuZCkpCiAgICBleGNlcHQgVW5pY29kZUVuY29kZUVycm9yOgogICAgICAgIGRhdGEgPSB4Ym1jLmV4ZWN1dGVKU09OUlBDKGFzY2lpKGNvbW1hbmQpKQoKICAgIHJldHVybiB1bmkoZGF0YSkKCmRlZiBwbHVnaW5xdWVyeWJ5SlNPTih1cmwsZ2l2ZV9tZV9yZXN1bHQ9Tm9uZSxwbGF5bGlzdD1GYWxzZSk6CiAgICBpZiAnYXVkaW8nIGluIHVybDoKICAgICAgICBqc29uX3F1ZXJ5ID0gdW5pKCd7Impzb25ycGMiOiIyLjAiLCJtZXRob2QiOiJGaWxlcy5HZXREaXJlY3RvcnkiLCJwYXJhbXMiOiB7ImRpcmVjdG9yeSI6IiVzIiwibWVkaWEiOiJ2aWRlbyIsICJwcm9wZXJ0aWVzIjogWyJ0aXRsZSIsICJhbGJ1bSIsICJhcnRpc3QiLCAiZHVyYXRpb24iLCJ0aHVtYm5haWwiLCAieWVhciJdfSwgImlkIjogMX0nKSAldXJsCiAgICBlbHNlOgogICAgICAgIGpzb25fcXVlcnkgPSB1bmkoJ3sianNvbnJwYyI6IjIuMCIsIm1ldGhvZCI6IkZpbGVzLkdldERpcmVjdG9yeSIsInBhcmFtcyI6eyJkaXJlY3RvcnkiOiIlcyIsIm1lZGlhIjoidmlkZW8iLCJwcm9wZXJ0aWVzIjpbICJwbG90IiwicGxheWNvdW50IiwiZGlyZWN0b3IiLCAiZ2VucmUiLCJ2b3RlcyIsImR1cmF0aW9uIiwidHJhaWxlciIsInByZW1pZXJlZCIsInRodW1ibmFpbCIsInRpdGxlIiwieWVhciIsImRhdGVhZGRlZCIsImZhbmFydCIsInJhdGluZyIsInNlYXNvbiIsImVwaXNvZGUiLCJzdHVkaW8iLCJtcGFhIl19LCJpZCI6MX0nKSAldXJsCiAgICBqc29uX2ZvbGRlcl9kZXRhaWwgPSBqc29uLmxvYWRzKHNlbmRKU09OKGpzb25fcXVlcnkpKQogICAgI3ByaW50IGpzb25fZm9sZGVyX2RldGFpbAogICAgaWYgZ2l2ZV9tZV9yZXN1bHQ6CiAgICAgICAgcmV0dXJuIGpzb25fZm9sZGVyX2RldGFpbAogICAgaWYganNvbl9mb2xkZXJfZGV0YWlsLmhhc19rZXkoJ2Vycm9yJyk6CiAgICAgICAgcmV0dXJuCiAgICBlbHNlOgoKICAgICAgICBmb3IgaSBpbiBqc29uX2ZvbGRlcl9kZXRhaWxbJ3Jlc3VsdCddWydmaWxlcyddIDoKICAgICAgICAgICAgbWV0YSA9e30KICAgICAgICAgICAgdXJsID0gaVsnZmlsZSddCiAgICAgICAgICAgIG5hbWUgPSByZW1vdmVOb25Bc2NpaShpWydsYWJlbCddKQogICAgICAgICAgICB0aHVtYm5haWwgPSByZW1vdmVOb25Bc2NpaShpWyd0aHVtYm5haWwnXSkKICAgICAgICAgICAgZmFuYXJ0ID0gcmVtb3ZlTm9uQXNjaWkoaVsnZmFuYXJ0J10pCiAgICAgICAgICAgIG1ldGEgPSBkaWN0KChrLHYpIGZvciBrLCB2IGluIGkuaXRlcml0ZW1zKCkgaWYgbm90IHYgPT0gJzAnIG9yIG5vdCB2ID09IC0xIG9yIHYgPT0gJycpCiAgICAgICAgICAgIG1ldGEucG9wKCJmaWxlIiwgTm9uZSkKICAgICAgICAgICAgaWYgaVsnZmlsZXR5cGUnXSA9PSAnZmlsZSc6CiAgICAgICAgICAgICAgICBpZiBwbGF5bGlzdDoKICAgICAgICAgICAgICAgICAgICBwbGF5X3BsYXlsaXN0KG5hbWUsdXJsLHF1ZXVlVmlkZW89JzEnKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGFkZExpbmsodXJsLG5hbWUsdGh1bWJuYWlsLGZhbmFydCwnJywnJywnJywnJyxOb25lLCcnLHRvdGFsPWxlbihqc29uX2ZvbGRlcl9kZXRhaWxbJ3Jlc3VsdCddWydmaWxlcyddKSxhbGxpbmZvPW1ldGEpCiAgICAgICAgICAgICAgICAgICAgI3hibWMuZXhlY3V0ZWJ1aWx0aW4oIkNvbnRhaW5lci5TZXRWaWV3TW9kZSg1MDApIikKICAgICAgICAgICAgICAgICAgICBpZiBpWyd0eXBlJ10gYW5kIGlbJ3R5cGUnXSA9PSAndHZzaG93JyA6CiAgICAgICAgICAgICAgICAgICAgICAgIHhibWNwbHVnaW4uc2V0Q29udGVudChpbnQoc3lzLmFyZ3ZbMV0pLCAndHZzaG93cycpCiAgICAgICAgICAgICAgICAgICAgZWxpZiBpWydlcGlzb2RlJ10gPiAwIDoKICAgICAgICAgICAgICAgICAgICAgICAgeGJtY3BsdWdpbi5zZXRDb250ZW50KGludChzeXMuYXJndlsxXSksICdlcGlzb2RlcycpCgogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUsdXJsLDUzLHRodW1ibmFpbCxmYW5hcnQsJycsJycsJycsJycsYWxsaW5mbz1tZXRhKQogICAgICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkKCmRlZiBhZGRMaW5rKHVybCxuYW1lLGljb25pbWFnZSxmYW5hcnQsZGVzY3JpcHRpb24sZ2VucmUsZGF0ZSxzaG93Y29udGV4dCxwbGF5bGlzdCxyZWdleHMsdG90YWwsc2V0Q29va2llPSIiLGFsbGluZm89e30pOgogICAgICAgICNwcmludCAndXJsLG5hbWUnLHVybCxuYW1lCiAgICAgICAgY29udGV4dE1lbnUgPVtdCiAgICAgICAgcGFyZW50YWxibG9jayA9YWRkb24uZ2V0U2V0dGluZygncGFyZW50YWxibG9ja2VkJykKICAgICAgICBwYXJlbnRhbGJsb2NrPSBwYXJlbnRhbGJsb2NrPT0idHJ1ZSIKICAgICAgICBwYXJlbnRhbGJsb2NrZWRwaW4gPWFkZG9uLmdldFNldHRpbmcoJ3BhcmVudGFsYmxvY2tlZHBpbicpCiMgICAgICAgIHByaW50ICdwYXJlbnRhbGJsb2NrZWRwaW4nLHBhcmVudGFsYmxvY2tlZHBpbgogICAgICAgIGlmIGxlbihwYXJlbnRhbGJsb2NrZWRwaW4pPjA6CiAgICAgICAgICAgIGlmIHBhcmVudGFsYmxvY2s6CiAgICAgICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoKCdEaXNhYmxlIFBhcmVudGFsIEJsb2NrJywnWEJNQy5SdW5QbHVnaW4oJXM/bW9kZT01NSZuYW1lPSVzKScgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXMobmFtZSkpKSkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgoJ0VuYWJsZSBQYXJlbnRhbCBCbG9jaycsJ1hCTUMuUnVuUGx1Z2luKCVzP21vZGU9NTYmbmFtZT0lcyknICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpKSkpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgdHJ5OgogICAgICAgICAgICBuYW1lID0gbmFtZS5lbmNvZGUoJ3V0Zi04JykKICAgICAgICBleGNlcHQ6IHBhc3MKICAgICAgICBvayA9IFRydWUKICAgICAgICBpc0ZvbGRlcj1GYWxzZQogICAgICAgIGlmIHJlZ2V4czoKICAgICAgICAgICAgbW9kZSA9ICcxNycKICAgICAgICAgICAgaWYgJ2xpc3RyZXBlYXQnIGluIHJlZ2V4czoKICAgICAgICAgICAgICAgIGlzRm9sZGVyPVRydWUKICAgICAgICAgICAgICAgIHByaW50ICdzZXR0aW5nIGFzIGZvbGRlciBpbiBsaW5rJwogICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoKCdbQ09MT1Igd2hpdGVdISFEb3dubG9hZCBDdXJyZW50bHkgUGxheWluZyEhWy9DT0xPUl0nLCdYQk1DLlJ1blBsdWdpbiglcz91cmw9JXMmbW9kZT0yMSZuYW1lPSVzKScKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXModXJsKSwgdXJsbGliLnF1b3RlX3BsdXMobmFtZSkpKSkKICAgICAgICBlbGlmICAoYW55KHggaW4gdXJsIGZvciB4IGluIHJlc29sdmVfdXJsKSBhbmQgIHVybC5zdGFydHN3aXRoKCdodHRwJykpIG9yIHVybC5lbmRzd2l0aCgnJm1vZGU9MTknKToKICAgICAgICAgICAgdXJsPXVybC5yZXBsYWNlKCcmbW9kZT0xOScsJycpCiAgICAgICAgICAgIG1vZGUgPSAnMTknCiAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgoJ1tDT0xPUiB3aGl0ZV0hIURvd25sb2FkIEN1cnJlbnRseSBQbGF5aW5nISFbL0NPTE9SXScsJ1hCTUMuUnVuUGx1Z2luKCVzP3VybD0lcyZtb2RlPTIxJm5hbWU9JXMpJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyh1cmwpLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSkpKQogICAgICAgIGVsaWYgdXJsLmVuZHN3aXRoKCcmbW9kZT0xOCcpOgogICAgICAgICAgICB1cmw9dXJsLnJlcGxhY2UoJyZtb2RlPTE4JywnJykKICAgICAgICAgICAgbW9kZSA9ICcxOCcKICAgICAgICAgICAgY29udGV4dE1lbnUuYXBwZW5kKCgnW0NPTE9SIHdoaXRlXSEhRG93bmxvYWQhIVsvQ09MT1JdJywnWEJNQy5SdW5QbHVnaW4oJXM/dXJsPSVzJm1vZGU9MjMmbmFtZT0lcyknCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKHVybCksIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpKSkpCiAgICAgICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoJ2RsYXVkaW9vbmx5JykgPT0gJ3RydWUnOgogICAgICAgICAgICAgICAgY29udGV4dE1lbnUuYXBwZW5kKCgnISFEb3dubG9hZCBbQ09MT1Igc2VhYmx1ZV1BdWRpbyEhWy9DT0xPUl0nLCdYQk1DLlJ1blBsdWdpbiglcz91cmw9JXMmbW9kZT0yNCZuYW1lPSVzKScKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKHVybCksIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpKSkpCiAgICAgICAgZWxpZiB1cmwuc3RhcnRzd2l0aCgnbWFnbmV0Oj94dD0nKToKICAgICAgICAgICAgaWYgJyYnIGluIHVybCBhbmQgbm90ICcmYW1wOycgaW4gdXJsIDoKICAgICAgICAgICAgICAgIHVybCA9IHVybC5yZXBsYWNlKCcmJywnJmFtcDsnKQogICAgICAgICAgICB1cmwgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnB1bHNhci9wbGF5P3VyaT0nICsgdXJsCiAgICAgICAgICAgIG1vZGUgPSAnMTInCiAgICAgICAgZWxzZToKICAgICAgICAgICAgbW9kZSA9ICcxMicKICAgICAgICAgICAgY29udGV4dE1lbnUuYXBwZW5kKCgnW0NPTE9SIHdoaXRlXSEhRG93bmxvYWQgQ3VycmVudGx5IFBsYXlpbmchIVsvQ09MT1JdJywnWEJNQy5SdW5QbHVnaW4oJXM/dXJsPSVzJm1vZGU9MjEmbmFtZT0lcyknCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKHVybCksIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpKSkpCiAgICAgICAgaWYgJ3BsdWdpbjovL3BsdWdpbi52aWRlby55b3V0dWJlL3BsYXkvP3ZpZGVvX2lkPScgaW4gdXJsOgogICAgICAgICAgICAgIHl0X2F1ZGlvX3VybCA9IHVybC5yZXBsYWNlKCdwbHVnaW46Ly9wbHVnaW4udmlkZW8ueW91dHViZS9wbGF5Lz92aWRlb19pZD0nLCdodHRwczovL3d3dy55b3V0dWJlLmNvbS93YXRjaD92PScpCiAgICAgICAgICAgICAgY29udGV4dE1lbnUuYXBwZW5kKCgnISFEb3dubG9hZCBbQ09MT1IgYmx1ZV1BdWRpbyEhWy9DT0xPUl0nLCdYQk1DLlJ1blBsdWdpbiglcz91cmw9JXMmbW9kZT0yNCZuYW1lPSVzKScKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyh5dF9hdWRpb191cmwpLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSkpKQogICAgICAgIHU9c3lzLmFyZ3ZbMF0rIj8iCiAgICAgICAgcGxheV9saXN0ID0gRmFsc2UKICAgICAgICBpZiBwbGF5bGlzdDoKICAgICAgICAgICAgaWYgYWRkb24uZ2V0U2V0dGluZygnYWRkX3BsYXlsaXN0JykgPT0gImZhbHNlIjoKICAgICAgICAgICAgICAgIHUgKz0gInVybD0iK3VybGxpYi5xdW90ZV9wbHVzKHVybCkrIiZtb2RlPSIrbW9kZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgdSArPSAibW9kZT0xMyZuYW1lPSVzJnBsYXlsaXN0PSVzIiAlKHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpLCB1cmxsaWIucXVvdGVfcGx1cyhzdHIocGxheWxpc3QpLnJlcGxhY2UoJywnLCd8fCcpKSkKICAgICAgICAgICAgICAgIG5hbWUgPSBuYW1lICsgJ1tDT0xPUiBtYWdlbnRhXSAoJyArIHN0cihsZW4ocGxheWxpc3QpKSArICcgaXRlbXMgKVsvQ09MT1JdJwogICAgICAgICAgICAgICAgcGxheV9saXN0ID0gVHJ1ZQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHUgKz0gInVybD0iK3VybGxpYi5xdW90ZV9wbHVzKHVybCkrIiZtb2RlPSIrbW9kZQogICAgICAgIGlmIHJlZ2V4czoKICAgICAgICAgICAgdSArPSAiJnJlZ2V4cz0iK3JlZ2V4cwogICAgICAgIGlmIG5vdCBzZXRDb29raWUgPT0gJyc6CiAgICAgICAgICAgIHUgKz0gIiZzZXRDb29raWU9Iit1cmxsaWIucXVvdGVfcGx1cyhzZXRDb29raWUpCgogICAgICAgIGlmIGRhdGUgPT0gJyc6CiAgICAgICAgICAgIGRhdGUgPSBOb25lCiAgICAgICAgZWxzZToKICAgICAgICAgICAgZGVzY3JpcHRpb24gKz0gJ1xuXG5EYXRlOiAlcycgJWRhdGUKICAgICAgICBsaXo9eGJtY2d1aS5MaXN0SXRlbShuYW1lLCBpY29uSW1hZ2U9IkRlZmF1bHRWaWRlby5wbmciLCB0aHVtYm5haWxJbWFnZT1pY29uaW1hZ2UpCiAgICAgICAgaWYgbGVuKGFsbGluZm8pIDwxOgogICAgICAgICAgICBsaXouc2V0SW5mbyh0eXBlPSJWaWRlbyIsIGluZm9MYWJlbHM9eyAiVGl0bGUiOiBuYW1lLCAiUGxvdCI6IGRlc2NyaXB0aW9uLCAiR2VucmUiOiBnZW5yZSwgImRhdGVhZGRlZCI6IGRhdGUgfSkKCiAgICAgICAgZWxzZToKICAgICAgICAgICAgbGl6LnNldEluZm8odHlwZT0iVmlkZW8iLCBpbmZvTGFiZWxzPWFsbGluZm8pCiAgICAgICAgbGl6LnNldFByb3BlcnR5KCJGYW5hcnRfSW1hZ2UiLCBmYW5hcnQpCiAgICAgICAgCiAgICAgICAgaWYgKG5vdCBwbGF5X2xpc3QpIGFuZCBub3QgYW55KHggaW4gdXJsIGZvciB4IGluIGdfaWdub3JlU2V0UmVzb2x2ZWQpIGFuZCBub3QgJyRQTEFZRVJQUk9YWSQ9JyBpbiB1cmw6IyAgKG5vdCB1cmwuc3RhcnRzd2l0aCgncGx1Z2luOi8vcGx1Z2luLnZpZGVvLmY0bVRlc3RlcicpKToKICAgICAgICAgICAgaWYgcmVnZXhzOgogICAgICAgICAgICAgICAgI3ByaW50IHVybGxpYi51bnF1b3RlX3BsdXMocmVnZXhzKQogICAgICAgICAgICAgICAgaWYgJyRweUZ1bmN0aW9uOnBsYXltZWRpYSgnIG5vdCBpbiB1cmxsaWIudW5xdW90ZV9wbHVzKHJlZ2V4cykgYW5kICdub3RwbGF5YWJsZScgbm90IGluIHVybGxpYi51bnF1b3RlX3BsdXMocmVnZXhzKSBhbmQgJ2xpc3RyZXBlYXQnIG5vdCBpbiAgdXJsbGliLnVucXVvdGVfcGx1cyhyZWdleHMpIDoKICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ3NldHRpbmcgaXNwbGF5YWJsZScsdXJsLCB1cmxsaWIudW5xdW90ZV9wbHVzKHJlZ2V4cyksdXJsCiAgICAgICAgICAgICAgICAgICAgbGl6LnNldFByb3BlcnR5KCdJc1BsYXlhYmxlJywgJ3RydWUnKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgbGl6LnNldFByb3BlcnR5KCdJc1BsYXlhYmxlJywgJ3RydWUnKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGFkZG9uX2xvZyggJ05PVCBzZXR0aW5nIGlzcGxheWFibGUnK3VybCkKICAgICAgICBpZiBzaG93Y29udGV4dDoKICAgICAgICAgICAgI2NvbnRleHRNZW51ID0gW10KICAgICAgICAgICAgaWYgc2hvd2NvbnRleHQgPT0gJ2Zhdic6CiAgICAgICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoCiAgICAgICAgICAgICAgICAgICAgKCdSZW1vdmUgZnJvbSBMaXZldHZkZXRvZG9zIEZhdm9yaXRlcycsJ1hCTUMuUnVuUGx1Z2luKCVzP21vZGU9NiZuYW1lPSVzKScKICAgICAgICAgICAgICAgICAgICAgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXMobmFtZSkpKQogICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgIGVsaWYgbm90IG5hbWUgaW4gRkFWOgogICAgICAgICAgICAgICAgZmF2X3BhcmFtcyA9ICgKICAgICAgICAgICAgICAgICAgICAnJXM/bW9kZT01Jm5hbWU9JXMmdXJsPSVzJmljb25pbWFnZT0lcyZmYW5hcnQ9JXMmZmF2X21vZGU9MCcKICAgICAgICAgICAgICAgICAgICAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSwgdXJsbGliLnF1b3RlX3BsdXModXJsKSwgdXJsbGliLnF1b3RlX3BsdXMoaWNvbmltYWdlKSwgdXJsbGliLnF1b3RlX3BsdXMoZmFuYXJ0KSkKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICBpZiBwbGF5bGlzdDoKICAgICAgICAgICAgICAgICAgICBmYXZfcGFyYW1zICs9ICdwbGF5bGlzdD0nK3VybGxpYi5xdW90ZV9wbHVzKHN0cihwbGF5bGlzdCkucmVwbGFjZSgnLCcsJ3x8JykpCiAgICAgICAgICAgICAgICBpZiByZWdleHM6CiAgICAgICAgICAgICAgICAgICAgZmF2X3BhcmFtcyArPSAiJnJlZ2V4cz0iK3JlZ2V4cwogICAgICAgICAgICAgICAgY29udGV4dE1lbnUuYXBwZW5kKCgnQWRkIHRvIExpdmV0dmRldG9kb3MgRmF2b3JpdGVzJywnWEJNQy5SdW5QbHVnaW4oJXMpJyAlZmF2X3BhcmFtcykpCiAgICAgICAgICAgIGxpei5hZGRDb250ZXh0TWVudUl0ZW1zKGNvbnRleHRNZW51KQogICAgICAgIGlmIG5vdCBwbGF5bGlzdCBpcyBOb25lOgogICAgICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCdhZGRfcGxheWxpc3QnKSA9PSAiZmFsc2UiOgogICAgICAgICAgICAgICAgcGxheWxpc3RfbmFtZSA9IG5hbWUuc3BsaXQoJykgJylbMV0KICAgICAgICAgICAgICAgIGNvbnRleHRNZW51XyA9IFsKICAgICAgICAgICAgICAgICAgICAoJ1BsYXkgJytwbGF5bGlzdF9uYW1lKycgUGxheUxpc3QnLCdYQk1DLlJ1blBsdWdpbiglcz9tb2RlPTEzJm5hbWU9JXMmcGxheWxpc3Q9JXMpJwogICAgICAgICAgICAgICAgICAgICAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyhwbGF5bGlzdF9uYW1lKSwgdXJsbGliLnF1b3RlX3BsdXMoc3RyKHBsYXlsaXN0KS5yZXBsYWNlKCcsJywnfHwnKSkpKQogICAgICAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgICAgICBsaXouYWRkQ29udGV4dE1lbnVJdGVtcyhjb250ZXh0TWVudV8pCiAgICAgICAgI3ByaW50ICdhZGRpbmcnLG5hbWUKICAgICAgICBvaz14Ym1jcGx1Z2luLmFkZERpcmVjdG9yeUl0ZW0oaGFuZGxlPWludChzeXMuYXJndlsxXSksdXJsPXUsbGlzdGl0ZW09bGl6LHRvdGFsSXRlbXM9dG90YWwsaXNGb2xkZXI9aXNGb2xkZXIpCgogICAgICAgICNwcmludCAnYWRkZWQnLG5hbWUKICAgICAgICByZXR1cm4gb2sKCiAgICAgICAgCmRlZiBwbGF5c2V0cmVzb2x2ZWQodXJsLG5hbWUsaWNvbmltYWdlLHNldHJlc29sdmVkPVRydWUpOgogICAgaWYgc2V0cmVzb2x2ZWQ6CiAgICAgICAgbGl6ID0geGJtY2d1aS5MaXN0SXRlbShuYW1lLCBpY29uSW1hZ2U9aWNvbmltYWdlKQogICAgICAgIGxpei5zZXRJbmZvKHR5cGU9J1ZpZGVvJywgaW5mb0xhYmVscz17J1RpdGxlJzpuYW1lfSkKICAgICAgICBsaXouc2V0UHJvcGVydHkoIklzUGxheWFibGUiLCJ0cnVlIikKICAgICAgICBsaXouc2V0UGF0aCh1cmwpCiAgICAgICAgeGJtY3BsdWdpbi5zZXRSZXNvbHZlZFVybChpbnQoc3lzLmFyZ3ZbMV0pLCBUcnVlLCBsaXopCiAgICBlbHNlOgogICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oJ1hCTUMuUnVuUGx1Z2luKCcrdXJsKycpJykKCgojIyBUaGFua3MgdG8gZGFzY2hhY2thLCBhbiBlcGcgc2NyYXBlciBmb3IgaHR0cDovL2kudGVsZWJveS5jaC9wcm9ncmFtbS9zdGF0aW9uX3NlbGVjdC5waHAKIyMgIGh0dHA6Ly9mb3J1bS54Ym1jLm9yZy9wb3N0LnBocD9wPTkzNjIyOCZwb3N0Y291bnQ9MTA3NgpkZWYgZ2V0ZXBnKGxpbmspOgogICAgICAgIHVybD11cmxsaWIudXJsb3BlbihsaW5rKQogICAgICAgIHNvdXJjZT11cmwucmVhZCgpCiAgICAgICAgdXJsLmNsb3NlKCkKICAgICAgICBzb3VyY2UyID0gc291cmNlLnNwbGl0KCJKZXR6dCIpCiAgICAgICAgc291cmNlMyA9IHNvdXJjZTJbMV0uc3BsaXQoJ3Byb2dyYW1tL2RldGFpbC5waHA/Y29uc3RfaWQ9JykKICAgICAgICBzb3VyY2V1aHJ6ZWl0ID0gc291cmNlM1sxXS5zcGxpdCgnPGJyIC8+PGEgaHJlZj0iLycpCiAgICAgICAgbm93dGltZSA9IHNvdXJjZXVocnplaXRbMF1bNDA6bGVuKHNvdXJjZXVocnplaXRbMF0pXQogICAgICAgIHNvdXJjZXRpdGxlID0gc291cmNlM1syXS5zcGxpdCgiPC9hPjwvcD48L2Rpdj4iKQogICAgICAgIG5vd3RpdGxlID0gc291cmNldGl0bGVbMF1bMTc6bGVuKHNvdXJjZXRpdGxlWzBdKV0KICAgICAgICBub3d0aXRsZSA9IG5vd3RpdGxlLmVuY29kZSgndXRmLTgnKQogICAgICAgIHJldHVybiAiICAtICIrbm93dGl0bGUrIiAtICIrbm93dGltZQoKCmRlZiBnZXRfZXBnKHVybCwgcmVnZXgpOgogICAgICAgIGRhdGEgPSBtYWtlUmVxdWVzdCh1cmwpCiAgICAgICAgdHJ5OgogICAgICAgICAgICBpdGVtID0gcmUuZmluZGFsbChyZWdleCwgZGF0YSlbMF0KICAgICAgICAgICAgcmV0dXJuIGl0ZW0KICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIGFkZG9uX2xvZygncmVnZXggZmFpbGVkJykKICAgICAgICAgICAgYWRkb25fbG9nKHJlZ2V4KQogICAgICAgICAgICByZXR1cm4KCiAgICAKIyNub3QgYSBnZW5lcmljIGltcGxlbWVuYXRpb24gYXMgaXQgbmVlZHMgdG8gY29udmVydCAgICAgICAgICAgIApkZWYgZDJ4KGQsIHJvb3Q9InJvb3QiLG5lc3RlZD0wKToKCiAgICBvcCA9IGxhbWJkYSB0YWc6ICc8JyArIHRhZyArICc+JwogICAgY2wgPSBsYW1iZGEgdGFnOiAnPC8nICsgdGFnICsgJz5cbicKICAgIG1sID0gbGFtYmRhIHYseG1sOiB4bWwgKyBvcChrZXkpICsgc3RyKHYpICsgY2woa2V5KQoKICAgIHhtbCA9IG9wKHJvb3QpICsgJ1xuJyBpZiByb290IGVsc2UgIiIKCiAgICBmb3Iga2V5LHZsIGluIGQuaXRlcml0ZW1zKCk6CiAgICAgICAgdnR5cGUgPSB0eXBlKHZsKQogICAgICAgIGlmIG5lc3RlZD09MDoga2V5PSdyZWdleCcgI2VuZm9yY2luZyBhbGwgdG9wIGxldmVsIHRhZ3MgdG8gYmUgbmFtZWQgYXMgcmVnZXgKICAgICAgICBpZiB2dHlwZSBpcyBsaXN0OiAKICAgICAgICAgICAgZm9yIHYgaW4gdmw6CiAgICAgICAgICAgICAgICB2PWVzY2FwZSh2KQogICAgICAgICAgICAgICAgeG1sID0gbWwodix4bWwpICAgICAgICAgCiAgICAgICAgCiAgICAgICAgaWYgdnR5cGUgaXMgZGljdDogCiAgICAgICAgICAgIHhtbCA9IG1sKCdcbicgKyBkMngodmwsTm9uZSxuZXN0ZWQrMSkseG1sKSAgICAgICAgIAogICAgICAgIGlmIHZ0eXBlIGlzIG5vdCBsaXN0IGFuZCB2dHlwZSBpcyBub3QgZGljdDogCiAgICAgICAgICAgIGlmIG5vdCB2bCBpcyBOb25lOiB2bD1lc2NhcGUodmwpCiAgICAgICAgICAgIHhtbCA9IG1sKHZsLHhtbCkKCiAgICB4bWwgKz0gY2wocm9vdCkgaWYgcm9vdCBlbHNlICIiCgogICAgcmV0dXJuIHhtbAp4Ym1jcGx1Z2luLnNldENvbnRlbnQoaW50KHN5cy5hcmd2WzFdKSwgJ21vdmllcycpCgp0cnk6CiAgICB4Ym1jcGx1Z2luLmFkZFNvcnRNZXRob2QoaW50KHN5cy5hcmd2WzFdKSwgeGJtY3BsdWdpbi5TT1JUX01FVEhPRF9VTlNPUlRFRCkKZXhjZXB0OgogICAgcGFzcwp0cnk6CiAgICB4Ym1jcGx1Z2luLmFkZFNvcnRNZXRob2QoaW50KHN5cy5hcmd2WzFdKSwgeGJtY3BsdWdpbi5TT1JUX01FVEhPRF9MQUJFTCkKZXhjZXB0OgogICAgcGFzcwp0cnk6CiAgICB4Ym1jcGx1Z2luLmFkZFNvcnRNZXRob2QoaW50KHN5cy5hcmd2WzFdKSwgeGJtY3BsdWdpbi5TT1JUX01FVEhPRF9EQVRFKQpleGNlcHQ6CiAgICBwYXNzCnRyeToKICAgIHhibWNwbHVnaW4uYWRkU29ydE1ldGhvZChpbnQoc3lzLmFyZ3ZbMV0pLCB4Ym1jcGx1Z2luLlNPUlRfTUVUSE9EX0dFTlJFKQpleGNlcHQ6CiAgICBwYXNzCgpwYXJhbXM9Z2V0X3BhcmFtcygpCgp1cmw9Tm9uZQpuYW1lPU5vbmUKbW9kZT1Ob25lCnBsYXlsaXN0PU5vbmUKaWNvbmltYWdlPU5vbmUKZmFuYXJ0PUZBTkFSVApwbGF5bGlzdD1Ob25lCmZhdl9tb2RlPU5vbmUKcmVnZXhzPU5vbmUKCnRyeToKICAgIHVybD11cmxsaWIudW5xdW90ZV9wbHVzKHBhcmFtc1sidXJsIl0pLmRlY29kZSgndXRmLTgnKQpleGNlcHQ6CiAgICBwYXNzCnRyeToKICAgIG5hbWU9dXJsbGliLnVucXVvdGVfcGx1cyhwYXJhbXNbIm5hbWUiXSkKZXhjZXB0OgogICAgcGFzcwp0cnk6CiAgICBpY29uaW1hZ2U9dXJsbGliLnVucXVvdGVfcGx1cyhwYXJhbXNbImljb25pbWFnZSJdKQpleGNlcHQ6CiAgICBwYXNzCnRyeToKICAgIGZhbmFydD11cmxsaWIudW5xdW90ZV9wbHVzKHBhcmFtc1siZmFuYXJ0Il0pCmV4Y2VwdDoKICAgIHBhc3MKdHJ5OgogICAgbW9kZT1pbnQocGFyYW1zWyJtb2RlIl0pCmV4Y2VwdDoKICAgIHBhc3MKdHJ5OgogICAgcGxheWxpc3Q9ZXZhbCh1cmxsaWIudW5xdW90ZV9wbHVzKHBhcmFtc1sicGxheWxpc3QiXSkucmVwbGFjZSgnfHwnLCcsJykpCmV4Y2VwdDoKICAgIHBhc3MKdHJ5OgogICAgZmF2X21vZGU9aW50KHBhcmFtc1siZmF2X21vZGUiXSkKZXhjZXB0OgogICAgcGFzcwp0cnk6CiAgICByZWdleHM9cGFyYW1zWyJyZWdleHMiXQpleGNlcHQ6CiAgICBwYXNzCgphZGRvbl9sb2coIk1vZGU6ICIrc3RyKG1vZGUpKQoKCmlmIG5vdCB1cmwgaXMgTm9uZToKICAgIGFkZG9uX2xvZygiVVJMOiAiK3N0cih1cmwuZW5jb2RlKCd1dGYtOCcpKSkKYWRkb25fbG9nKCJOYW1lOiAiK3N0cihuYW1lKSkKCmlmIG1vZGU9PU5vbmU6CiAgICBhZGRvbl9sb2coIkluZGV4IikKICAgIENISW5kZXgoKQoKZWxpZiBtb2RlPT0xOgogICAgYWRkb25fbG9nKCJnZXREYXRhIikKICAgIGRhdGE9Tm9uZQogICAgaWYgcmVnZXhzOgogICAgICAgIGRhdGE9Z2V0UmVnZXhQYXJzZWQocmVnZXhzLCB1cmwpCiAgICAgICAgdXJsPScnCiAgICAgICAgI2NyZWF0ZSB4bWwgaGVyZQogICAgZ2V0RGF0YSh1cmwsZmFuYXJ0LGRhdGEpCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpCgplbGlmIG1vZGU9PTI6CiAgICBhZGRvbl9sb2coImdldENoYW5uZWxJdGVtcyIpCiAgICBnZXRDaGFubmVsSXRlbXMobmFtZSx1cmwsZmFuYXJ0KQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQoKZWxpZiBtb2RlPT0zOgogICAgYWRkb25fbG9nKCJnZXRTdWJDaGFubmVsSXRlbXMiKQogICAgZ2V0U3ViQ2hhbm5lbEl0ZW1zKG5hbWUsdXJsLGZhbmFydCkKICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkKCmVsaWYgbW9kZT09NDoKICAgIGFkZG9uX2xvZygiZ2V0RmF2b3JpdGVzIikKICAgIGdldEZhdm9yaXRlcygpCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpCgplbGlmIG1vZGU9PTU6CiAgICBhZGRvbl9sb2coImFkZEZhdm9yaXRlIikKICAgIHRyeToKICAgICAgICBuYW1lID0gbmFtZS5zcGxpdCgnXFwgJylbMV0KICAgIGV4Y2VwdDoKICAgICAgICBwYXNzCiAgICB0cnk6CiAgICAgICAgbmFtZSA9IG5hbWUuc3BsaXQoJyAgLSAnKVswXQogICAgZXhjZXB0OgogICAgICAgIHBhc3MKICAgIGFkZEZhdm9yaXRlKG5hbWUsdXJsLGljb25pbWFnZSxmYW5hcnQsZmF2X21vZGUpCgplbGlmIG1vZGU9PTY6CiAgICBhZGRvbl9sb2coInJtRmF2b3JpdGUiKQogICAgdHJ5OgogICAgICAgIG5hbWUgPSBuYW1lLnNwbGl0KCdcXCAnKVsxXQogICAgZXhjZXB0OgogICAgICAgIHBhc3MKICAgIHRyeToKICAgICAgICBuYW1lID0gbmFtZS5zcGxpdCgnICAtICcpWzBdCiAgICBleGNlcHQ6CiAgICAgICAgcGFzcwogICAgcm1GYXZvcml0ZShuYW1lKQoKZWxpZiBtb2RlPT03OgogICAgYWRkb25fbG9nKCJhZGRTb3VyY2UiKQogICAgYWRkU291cmNlKHVybCkKCmVsaWYgbW9kZT09ODoKICAgIGFkZG9uX2xvZygicm1Tb3VyY2UiKQogICAgcm1Tb3VyY2UobmFtZSkKCmVsaWYgbW9kZT09OToKICAgIGFkZG9uX2xvZygiZG93bmxvYWRfZmlsZSIpCiAgICBkb3dubG9hZF9maWxlKG5hbWUsIHVybCkKCmVsaWYgbW9kZT09MTA6CiAgICBhZGRvbl9sb2coImdldENvbW11bml0eVNvdXJjZXMiKQogICAgZ2V0Q29tbXVuaXR5U291cmNlcygpCgplbGlmIG1vZGU9PTExOgogICAgYWRkb25fbG9nKCJhZGRTb3VyY2UiKQogICAgYWRkU291cmNlKHVybCkKCmVsaWYgbW9kZT09MTI6CiAgICBhZGRvbl9sb2coInNldFJlc29sdmVkVXJsIikKICAgIGlmIG5vdCB1cmwuc3RhcnRzd2l0aCgicGx1Z2luOi8vcGx1Z2luIikgb3Igbm90IGFueSh4IGluIHVybCBmb3IgeCBpbiBnX2lnbm9yZVNldFJlc29sdmVkKTojbm90IHVybC5zdGFydHN3aXRoKCJwbHVnaW46Ly9wbHVnaW4udmlkZW8uZjRtVGVzdGVyIikgOgogICAgICAgIGl0ZW0gPSB4Ym1jZ3VpLkxpc3RJdGVtKHBhdGg9dXJsKQogICAgICAgIHhibWNwbHVnaW4uc2V0UmVzb2x2ZWRVcmwoaW50KHN5cy5hcmd2WzFdKSwgVHJ1ZSwgaXRlbSkKICAgIGVsc2U6CiAgICAgICAgcHJpbnQgJ05vdCBzZXR0aW5nIHNldFJlc29sdmVkVXJsJwogICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oJ1hCTUMuUnVuUGx1Z2luKCcrdXJsKycpJykKCgplbGlmIG1vZGU9PTEzOgogICAgYWRkb25fbG9nKCJwbGF5X3BsYXlsaXN0IikKICAgIHBsYXlfcGxheWxpc3QobmFtZSwgcGxheWxpc3QpCgplbGlmIG1vZGU9PTE0OgogICAgYWRkb25fbG9nKCJnZXRfeG1sX2RhdGFiYXNlIikKICAgIGdldF94bWxfZGF0YWJhc2UodXJsKQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQoKZWxpZiBtb2RlPT0xNToKICAgIGFkZG9uX2xvZygiYnJvd3NlX3htbF9kYXRhYmFzZSIpCiAgICBnZXRfeG1sX2RhdGFiYXNlKHVybCwgVHJ1ZSkKICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkKCmVsaWYgbW9kZT09MTY6CiAgICBhZGRvbl9sb2coImJyb3dzZV9jb21tdW5pdHkiKQogICAgZ2V0Q29tbXVuaXR5U291cmNlcyh1cmwsYnJvd3NlPVRydWUpCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpCgplbGlmIG1vZGU9PTE3OgogICAgYWRkb25fbG9nKCJnZXRSZWdleFBhcnNlZCIpCgogICAgZGF0YT1Ob25lCiAgICBpZiByZWdleHMgYW5kICdsaXN0cmVwZWF0JyBpbiB1cmxsaWIudW5xdW90ZV9wbHVzKHJlZ2V4cyk6CiAgICAgICAgbGlzdHJlcGVhdCxyZXQsbSxyZWdleHMgPWdldFJlZ2V4UGFyc2VkKHJlZ2V4cywgdXJsKQojICAgICAgICBwcmludCBsaXN0bGluayxsaXN0dGl0bGUsbGlzdHRodW1ibmFpbCxyZXQKICAgICAgICBkPScnCiMgICAgICAgIHByaW50ICdtIGlzJyAsIG0KIyAgICAgICAgcHJpbnQgJ3JlZ2V4cycscmVnZXhzCiAgICAgICAgcmVnZXhuYW1lPW1bJ25hbWUnXQogICAgICAgIGV4aXN0aW5nX2xpc3Q9cmVnZXhzLnBvcChyZWdleG5hbWUpCiAjICAgICAgIHByaW50ICdmaW5hbCByZWdleHMnLHJlZ2V4cyxyZWdleG5hbWUKICAgICAgICB1cmw9JycKICAgICAgICBpbXBvcnQgY29weQogICAgICAgIGxuPScnCiAgICAgICAgcm51bWJlcj0wCiAgICAgICAgZm9yIG9iaiBpbiByZXQ6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHJudW1iZXIrPTEKICAgICAgICAgICAgICAgIG5ld2NvcHk9Y29weS5kZWVwY29weShyZWdleHMpCiAgICAjICAgICAgICAgICAgcHJpbnQgJ25ld2NvcHknLG5ld2NvcHksIGxlbihuZXdjb3B5KQogICAgICAgICAgICAgICAgbGlzdHJlcGVhdFQ9bGlzdHJlcGVhdAogICAgICAgICAgICAgICAgaT0wCiAgICAgICAgICAgICAgICBmb3IgaSBpbiByYW5nZShsZW4ob2JqKSk6CiAgICAjICAgICAgICAgICAgICAgIHByaW50ICdpIGlzICcsaSwgbGVuKG9iaiksIGxlbihuZXdjb3B5KQogICAgICAgICAgICAgICAgICAgIGlmIGxlbihuZXdjb3B5KT4wOgogICAgICAgICAgICAgICAgICAgICAgICBmb3IgdGhlX2tleU8sIHRoZV92YWx1ZU8gaW4gbmV3Y29weS5pdGVyaXRlbXMoKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHRoZV92YWx1ZU8gaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIHRoZV9rZXksIHRoZV92YWx1ZSBpbiB0aGVfdmFsdWVPLml0ZXJpdGVtcygpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB0aGVfdmFsdWUgaXMgbm90IE5vbmU6ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAjICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCAgJ2tleSBhbmQgdmFsJyx0aGVfa2V5LCB0aGVfdmFsdWUKICAgICAgICAjICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCAnYWEnCiAgICAgICAgIyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ1snICsgcmVnZXhuYW1lKycucGFyYW0nK3N0cihpKzEpICsgJ10nCiAgICAgICAgIyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgcmVwcihvYmpbaV0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB0eXBlKHRoZV92YWx1ZSkgaXMgZGljdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgdGhlX2tleWwsIHRoZV92YWx1ZWwgaW4gdGhlX3ZhbHVlLml0ZXJpdGVtcygpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB0aGVfdmFsdWVsIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhlX3ZhbHVlW3RoZV9rZXlsXT10aGVfdmFsdWVsLnJlcGxhY2UoJ1snICsgcmVnZXhuYW1lKycucGFyYW0nK3N0cihpKzEpICsgJ10nLCBvYmpbaV0uZGVjb2RlKCd1dGYtOCcpICkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGVfdmFsdWVPW3RoZV9rZXldPXRoZV92YWx1ZS5yZXBsYWNlKCdbJyArIHJlZ2V4bmFtZSsnLnBhcmFtJytzdHIoaSsxKSArICddJywgb2JqW2ldLmRlY29kZSgndXRmLTgnKSApCiAgICAgICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShvYmosdHVwbGUpOgogICAgICAgICAgICAgICAgICAgICAgICBsaXN0cmVwZWF0VD1saXN0cmVwZWF0VC5yZXBsYWNlKCdbJyArIHJlZ2V4bmFtZSsnLnBhcmFtJytzdHIoaSsxKSArICddJyxvYmpbaV0uZGVjb2RlKCd1dGYtOCcpKSAKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBsaXN0cmVwZWF0VD1saXN0cmVwZWF0VC5yZXBsYWNlKCdbJyArIHJlZ2V4bmFtZSsnLnBhcmFtJytzdHIoaSsxKSArICddJyxvYmouZGVjb2RlKCd1dGYtOCcpKSAKICAgICAgICAgICAgICAgIGxpc3RyZXBlYXRUPWxpc3RyZXBlYXRULnJlcGxhY2UoJ1snICsgcmVnZXhuYW1lKycucGFyYW0nK3N0cigwKSArICddJyxzdHIocm51bWJlcikpIAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjbmV3Y29weSA9IHVybGxpYi5xdW90ZShyZXByKG5ld2NvcHkpKQogICAgIyAgICAgICAgICAgIHByaW50ICduZXcgcmVnZXggbGlzdCcsIHJlcHIobmV3Y29weSksIHJlcHIobGlzdHJlcGVhdFQpCiAgICAjICAgICAgICAgICAgYWRkTGluayhsaXN0bGlua1QsbGlzdHRpdGxlVC5lbmNvZGUoJ3V0Zi04JywgJ2lnbm9yZScpLGxpc3R0aHVtYm5haWxULCcnLCcnLCcnLCcnLFRydWUsTm9uZSxuZXdjb3B5LCBsZW4ocmV0KSkKICAgICAgICAgICAgICAgIHJlZ2V4X3htbD0nJwogICAgICAgICAgICAgICAgaWYgbGVuKG5ld2NvcHkpPjA6CiAgICAgICAgICAgICAgICAgICAgcmVnZXhfeG1sPWQyeChuZXdjb3B5LCdsc3Byb3Jvb3QnKQogICAgICAgICAgICAgICAgICAgIHJlZ2V4X3htbD1yZWdleF94bWwuc3BsaXQoJzxsc3Byb3Jvb3Q+JylbMV0uc3BsaXQoJzwvbHNwcm9yb290JylbMF0KICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxuKz0nXG48aXRlbT4lc1xuJXM8L2l0ZW0+JyUobGlzdHJlcGVhdFQscmVnZXhfeG1sKSAgIAogICAgICAgICAgICBleGNlcHQ6IHRyYWNlYmFjay5wcmludF9leGMoZmlsZT1zeXMuc3Rkb3V0KQojICAgICAgICAgICAgcHJpbnQgcmVwcihsbikKIyAgICAgICAgICAgIHByaW50IG5ld2NvcHkKICAgICAgICAgICAgICAgIAojICAgICAgICAgICAgbG4rPSc8L2l0ZW0+JwogICAgICAgICNjcmVhdGUgeG1sIGhlcmUKICAgICAgICBnZXREYXRhKCcnLCcnLGxuKQogICAgICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkKICAgIGVsc2U6CiAgICAgICAgdXJsLHNldHJlc29sdmVkID0gZ2V0UmVnZXhQYXJzZWQocmVnZXhzLCB1cmwpCiAgICAgICAgaWYgdXJsOgogICAgICAgICAgICBpZiAnJFBMQVlFUlBST1hZJD0nIGluIHVybDoKICAgICAgICAgICAgICAgIHVybCxwcm94eT11cmwuc3BsaXQoJyRQTEFZRVJQUk9YWSQ9JykKICAgICAgICAgICAgICAgIHByaW50ICdwcm94eScscHJveHkKICAgICAgICAgICAgICAgIHByb3h5aXAscG9ydD1wcm94eS5zcGxpdCgnOicpCiAgICAgICAgICAgICAgICBwbGF5bWVkaWF3aXRocHJveHkodXJsLG5hbWUsaWNvbmltYWdlLHByb3h5aXAscG9ydCApCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBwbGF5c2V0cmVzb2x2ZWQodXJsLG5hbWUsaWNvbmltYWdlLHNldHJlc29sdmVkKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuTm90aWZpY2F0aW9uKExpdmV0dmRldG9kb3MsRmFpbGVkIHRvIGV4dHJhY3QgcmVnZXguIC0gIisidGhpcyIrIiw0MDAwLCIraWNvbisiKSIpCmVsaWYgbW9kZT09MTg6CiAgICBhZGRvbl9sb2coInlvdXR1YmVkbCIpCiAgICB0cnk6CiAgICAgICAgaW1wb3J0IHlvdXR1YmVkbAogICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLk5vdGlmaWNhdGlvbihMaXZldHZkZXRvZG9zLFBsZWFzZSBbQ09MT1IgeWVsbG93XWluc3RhbGwgWW91dHViZS1kbFsvQ09MT1JdIG1vZHVsZSAsMTAwMDAsIiIpIikKICAgIHN0cmVhbV91cmw9eW91dHViZWRsLnNpbmdsZV9ZRCh1cmwpCiAgICBwbGF5c2V0cmVzb2x2ZWQoc3RyZWFtX3VybCxuYW1lLGljb25pbWFnZSkKZWxpZiBtb2RlPT0xOToKICAgIGFkZG9uX2xvZygiR2VuZXNpc2NvbW1vbnJlc29sdmVycyIpCiAgICBwbGF5c2V0cmVzb2x2ZWQgKHVybHNvbHZlcih1cmwpLG5hbWUsaWNvbmltYWdlLFRydWUpCgplbGlmIG1vZGU9PTIxOgogICAgYWRkb25fbG9nKCJkb3dubG9hZCBjdXJyZW50IGZpbGUgdXNpbmcgeW91dHViZS1kbCBzZXJ2aWNlIikKICAgIHl0ZGxfZG93bmxvYWQoJycsbmFtZSwndmlkZW8nKQplbGlmIG1vZGU9PTIzOgogICAgYWRkb25fbG9nKCJnZXQgaW5mbyB0aGVuIGRvd25sb2FkIikKICAgIHl0ZGxfZG93bmxvYWQodXJsLG5hbWUsJ3ZpZGVvJykKZWxpZiBtb2RlPT0yNDoKICAgIGFkZG9uX2xvZygiQXVkaW8gb25seSB5b3V0dWJlIGRvd25sb2FkIikKICAgIHl0ZGxfZG93bmxvYWQodXJsLG5hbWUsJ2F1ZGlvJykKZWxpZiBtb2RlPT0yNToKICAgIGFkZG9uX2xvZygiU2VhcmNoaW4gT3RoZXIgcGx1Z2lucyIpCiAgICBfc2VhcmNoKHVybCxuYW1lKQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQplbGlmIG1vZGU9PTU1OgogICAgYWRkb25fbG9nKCJlbmFibGVkIGxvY2siKQogICAgcGFyZW50YWxibG9ja2VkcGluID1hZGRvbi5nZXRTZXR0aW5nKCdwYXJlbnRhbGJsb2NrZWRwaW4nKQogICAga2V5Ym9hcmQgPSB4Ym1jLktleWJvYXJkKCcnLCdFbnRlciBQaW4nKQogICAga2V5Ym9hcmQuZG9Nb2RhbCgpCiAgICBpZiBub3QgKGtleWJvYXJkLmlzQ29uZmlybWVkKCkgPT0gRmFsc2UpOgogICAgICAgIG5ld1N0ciA9IGtleWJvYXJkLmdldFRleHQoKQogICAgICAgIGlmIG5ld1N0cj09cGFyZW50YWxibG9ja2VkcGluOgogICAgICAgICAgICBhZGRvbi5zZXRTZXR0aW5nKCdwYXJlbnRhbGJsb2NrZWQnLCAiZmFsc2UiKQogICAgICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLk5vdGlmaWNhdGlvbihMaXZldHZkZXRvZG9zLFBhcmVudGFsIEJsb2NrIERpc2FibGVkLDUwMDAsIitpY29uKyIpIikKICAgICAgICBlbHNlOgogICAgICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLk5vdGlmaWNhdGlvbihMaXZldHZkZXRvZG9zLFdyb25nIFBpbj8/LDUwMDAsIitpY29uKyIpIikKICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkKZWxpZiBtb2RlPT01NjoKICAgIGFkZG9uX2xvZygiZGlzYWJsZSBsb2NrIikKICAgIGFkZG9uLnNldFNldHRpbmcoJ3BhcmVudGFsYmxvY2tlZCcsICJ0cnVlIikKICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuTm90aWZpY2F0aW9uKExpdmV0dmRldG9kb3MsUGFyZW50YWwgYmxvY2sgZW5hYmxlZCw1MDAwLCIraWNvbisiKSIpCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpCgplbGlmIG1vZGU9PTUzOgogICAgYWRkb25fbG9nKCJSZXF1ZXN0aW5nIEpTT04tUlBDIEl0ZW1zIikKICAgIHBsdWdpbnF1ZXJ5YnlKU09OKHVybCkKICAgICN4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpCg==')