import base64;exec base64.b64decode('IyAtKi0gY29kaW5nOiB1dGYtOCAtKi0KaW1wb3J0IHVybGxpYgppbXBvcnQgdXJsbGliMgppbXBvcnQgcmUKaW1wb3J0IG9zCmltcG9ydCB4Ym1jcGx1Z2luCmltcG9ydCB4Ym1jZ3VpCmltcG9ydCB4Ym1jYWRkb24KaW1wb3J0IHhibWN2ZnMKaW1wb3J0IHRyYWNlYmFjawppbXBvcnQgY29va2llbGliCmZyb20gQmVhdXRpZnVsU291cCBpbXBvcnQgQmVhdXRpZnVsU3RvbmVTb3VwLCBCZWF1dGlmdWxTb3VwLCBCZWF1dGlmdWxTT0FQCnRyeToKICAgIGZyb20geG1sLnNheC5zYXh1dGlscyBpbXBvcnQgZXNjYXBlCmV4Y2VwdDogdHJhY2ViYWNrLnByaW50X2V4YygpCnRyeToKICAgIGltcG9ydCBqc29uCmV4Y2VwdDoKICAgIGltcG9ydCBzaW1wbGVqc29uIGFzIGpzb24KaW1wb3J0IFNpbXBsZURvd25sb2FkZXIgYXMgZG93bmxvYWRlcgppbXBvcnQgdGltZQoKcmVzb2x2ZV91cmw9WycxODB1cGxvYWQuY29tJywgJ2FsbG15dmlkZW9zLm5ldCcsICdiZXN0cmVhbXMubmV0JywgJ2NsaWNrbnVwbG9hZC5jb20nLCAnY2xvdWR6aWxsYS50bycsICdtb3ZzaGFyZS5uZXQnLCAnbm92YW1vdi5jb20nLCAnbm93dmlkZW8uc3gnLCAndmlkZW93ZWVkLmVzJywgJ2RhY2xpcHMuaW4nLCAnZGF0ZW11bGUuY29tJywgJ2Zhc3R2aWRlby5pbicsICdmYXN0c3RyZWFtLmluJywgJ2ZpbGVob290LmNvbScsICdmaWxlbnVrZS5jb20nLCAnc2hhcmVzaXguY29tJywgJ2RvY3MuZ29vZ2xlLmNvbScsICdwbHVzLmdvb2dsZS5jb20nLCAncGljYXNhd2ViLmdvb2dsZS5jb20nLCAnZ29yaWxsYXZpZC5jb20nLCAnZ29yaWxsYXZpZC5pbicsICdncmlmdGhvc3QuY29tJywgJ2h1Z2VmaWxlcy5uZXQnLCAnaXBpdGhvcy50bycsICdpc2hhcmVkLmV1JywgJ2tpbmdmaWxlcy5uZXQnLCAnbWFpbC5ydScsICdteS5tYWlsLnJ1JywgJ3ZpZGVvYXBpLm15Lm1haWwucnUnLCAnbWlnaHR5dXBsb2FkLmNvbScsICdtb29zaGFyZS5iaXonLCAnbW92ZGl2eC5jb20nLCAnbW92cG9kLm5ldCcsICdtb3Zwb2QuaW4nLCAnbW92cmVlbC5jb20nLCAnbXJmaWxlLm1lJywgJ25vc3ZpZGVvLmNvbScsICdvcGVubG9hZC5pbycsICdwbGF5ZWQudG8nLCAnYml0c2hhcmUuY29tJywgJ2ZpbGVmYWN0b3J5LmNvbScsICdrMnMuY2MnLCAnb2Jvb20uY29tJywgJ3JhcGlkZ2F0b3IubmV0JywgJ3VwbG9hZGVkLm5ldCcsICdwcmltZXNoYXJlLnR2JywgJ2JpdHNoYXJlLmNvbScsICdmaWxlZmFjdG9yeS5jb20nLCAnazJzLmNjJywgJ29ib29tLmNvbScsICdyYXBpZGdhdG9yLm5ldCcsICd1cGxvYWRlZC5uZXQnLCAnc2hhcmVyZXBvLmNvbScsICdzdGFnZXZ1LmNvbScsICdzdHJlYW1jbG91ZC5ldScsICdzdHJlYW1pbi50bycsICd0aGVmaWxlLm1lJywgJ3RoZXZpZGVvLm1lJywgJ3R1c2ZpbGVzLm5ldCcsICd1cGxvYWRjLmNvbScsICd6YWxhYS5jb20nLCAndXBsb2Fkcm9ja2V0Lm5ldCcsICd1cHRvYm94LmNvbScsICd2LXZpZHMuY29tJywgJ3ZlZWhkLmNvbScsICd2aWRidWxsLmNvbScsICd2aWRlb21lZ2EudHYnLCAndmlkcGxheS5uZXQnLCAndmlkc3BvdC5uZXQnLCAndmlkdG8ubWUnLCAndmlkemkudHYnLCAndmltZW8uY29tJywgJ3ZrLmNvbScsICd2b2Rsb2NrZXIuY29tJywgJ3hmaWxlbG9hZC5jb20nLCAneHZpZHN0YWdlLmNvbScsICd6ZXR0YWhvc3QudHYnXQpnX2lnbm9yZVNldFJlc29sdmVkPVsncGx1Z2luLnZpZGVvLmRyYW1hc29ubGluZScsJ3BsdWdpbi52aWRlby5mNG1UZXN0ZXInLCdwbHVnaW4udmlkZW8uc2hhaGlkbWJjbmV0JywncGx1Z2luLnZpZGVvLlNwb3J0c0RldmlsJywncGx1Z2luLnN0cmVhbS52YXVnaG5saXZlLnR2JywncGx1Z2luLnZpZGVvLlplbVRWLXNoYW5pJ10KCmNsYXNzIE5vUmVkaXJlY3Rpb24odXJsbGliMi5IVFRQRXJyb3JQcm9jZXNzb3IpOgogICBkZWYgaHR0cF9yZXNwb25zZShzZWxmLCByZXF1ZXN0LCByZXNwb25zZSk6CiAgICAgICByZXR1cm4gcmVzcG9uc2UKICAgaHR0cHNfcmVzcG9uc2UgPSBodHRwX3Jlc3BvbnNlCiAgIApDSEJhc2UgPSAoJ2h0dHA6Ly9wYXN0ZWJpbi5jb20vcmF3L1JtV1JiVjJ1JykKClJFTU9URV9EQkc9RmFsc2U7CmlmIFJFTU9URV9EQkc6CiAgICAjIE1ha2UgcHlkZXYgZGVidWdnZXIgd29ya3MgZm9yIGF1dG8gcmVsb2FkLgogICAgIyBOb3RlIHB5ZGV2ZCBtb2R1bGUgbmVlZCB0byBiZSBjb3BpZWQgaW4gWEJNQ1xzeXN0ZW1ccHl0aG9uXExpYlxweXNyYwogICAgdHJ5OgogICAgICAgIGltcG9ydCBweXNyYy5weWRldmQgYXMgcHlkZXZkCiAgICAjIHN0ZG91dFRvU2VydmVyIGFuZCBzdGRlcnJUb1NlcnZlciByZWRpcmVjdCBzdGRvdXQgYW5kIHN0ZGVyciB0byBlY2xpcHNlIGNvbnNvbGUKICAgICAgICBweWRldmQuc2V0dHJhY2UoJ2xvY2FsaG9zdCcsIHN0ZG91dFRvU2VydmVyPVRydWUsIHN0ZGVyclRvU2VydmVyPVRydWUpCiAgICBleGNlcHQgSW1wb3J0RXJyb3I6CiAgICAgICAgc3lzLnN0ZGVyci53cml0ZSgiRXJyb3I6ICIgKwogICAgICAgICAgICAiWW91IG11c3QgYWRkIG9yZy5weXRob24ucHlkZXYuZGVidWcucHlzcmMgdG8geW91ciBQWVRIT05QQVRILiIpCiAgICAgICAgc3lzLmV4aXQoMSkKCgphZGRvbiA9IHhibWNhZGRvbi5BZGRvbigncGx1Z2luLnZpZGVvLnR2ZGV0b2RvcycpCmFkZG9uX3ZlcnNpb24gPSBhZGRvbi5nZXRBZGRvbkluZm8oJ3ZlcnNpb24nKQpwcm9maWxlID0geGJtYy50cmFuc2xhdGVQYXRoKGFkZG9uLmdldEFkZG9uSW5mbygncHJvZmlsZScpLmRlY29kZSgndXRmLTgnKSkKaG9tZSA9IHhibWMudHJhbnNsYXRlUGF0aChhZGRvbi5nZXRBZGRvbkluZm8oJ3BhdGgnKS5kZWNvZGUoJ3V0Zi04JykpCmZhdm9yaXRlcyA9IG9zLnBhdGguam9pbihwcm9maWxlLCAnZmF2b3JpdGVzJykKaGlzdG9yeSA9IG9zLnBhdGguam9pbihwcm9maWxlLCAnaGlzdG9yeScpClJFViA9IG9zLnBhdGguam9pbihwcm9maWxlLCAnbGlzdF9yZXZpc2lvbicpCmljb24gPSBvcy5wYXRoLmpvaW4oaG9tZSwgJ2ljb24ucG5nJykKRkFOQVJUID0gb3MucGF0aC5qb2luKGhvbWUsICdmYW5hcnQuanBnJykKc291cmNlX2ZpbGUgPSBvcy5wYXRoLmpvaW4ocHJvZmlsZSwgJ3NvdXJjZV9maWxlJykKZnVuY3Rpb25zX2RpciA9IHByb2ZpbGUKCmNvbW11bml0eWZpbGVzID0gb3MucGF0aC5qb2luKHByb2ZpbGUsICdMaXZld2ViVFYnKQpkb3dubG9hZGVyID0gZG93bmxvYWRlci5TaW1wbGVEb3dubG9hZGVyKCkKZGVidWcgPSBhZGRvbi5nZXRTZXR0aW5nKCdkZWJ1ZycpCmlmIG9zLnBhdGguZXhpc3RzKGZhdm9yaXRlcyk9PVRydWU6CiAgICBGQVYgPSBvcGVuKGZhdm9yaXRlcykucmVhZCgpCmVsc2U6IEZBViA9IFtdCmlmIG9zLnBhdGguZXhpc3RzKHNvdXJjZV9maWxlKT09VHJ1ZToKICAgIFNPVVJDRVMgPSBvcGVuKHNvdXJjZV9maWxlKS5yZWFkKCkKZWxzZTogU09VUkNFUyA9IFtdCgoKZGVmIGFkZG9uX2xvZyhzdHJpbmcpOgogICAgaWYgZGVidWcgPT0gJ3RydWUnOgogICAgICAgIHhibWMubG9nKCJbYWRkb24ubGl2ZS50dmRldG9kb3MtJXNdOiAlcyIgJShhZGRvbl92ZXJzaW9uLCBzdHJpbmcpKQoKCmRlZiBtYWtlUmVxdWVzdCh1cmwsIGhlYWRlcnM9Tm9uZSk6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBpZiBoZWFkZXJzIGlzIE5vbmU6CiAgICAgICAgICAgICAgICBoZWFkZXJzID0geydVc2VyLWFnZW50JyA6ICdNb3ppbGxhLzUuMCAoV2luZG93cyBOVCA2LjE7IFdPVzY0OyBydjoxOS4wKSBHZWNrby8yMDEwMDEwMSBGaXJlZm94LzE5LjAnfQogICAgICAgICAgICByZXEgPSB1cmxsaWIyLlJlcXVlc3QodXJsLE5vbmUsaGVhZGVycykKICAgICAgICAgICAgcmVzcG9uc2UgPSB1cmxsaWIyLnVybG9wZW4ocmVxKQogICAgICAgICAgICBkYXRhID0gcmVzcG9uc2UucmVhZCgpCiAgICAgICAgICAgIHJlc3BvbnNlLmNsb3NlKCkKICAgICAgICAgICAgcmV0dXJuIGRhdGEKICAgICAgICBleGNlcHQgdXJsbGliMi5VUkxFcnJvciwgZToKICAgICAgICAgICAgYWRkb25fbG9nKCdVUkw6ICcrdXJsKQogICAgICAgICAgICBpZiBoYXNhdHRyKGUsICdjb2RlJyk6CiAgICAgICAgICAgICAgICBhZGRvbl9sb2coJ1dlIGZhaWxlZCB3aXRoIGVycm9yIGNvZGUgLSAlcy4nICUgZS5jb2RlKQogICAgICAgICAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Ob3RpZmljYXRpb24oTGl2ZXR2ZGV0b2RvcyxXZSBmYWlsZWQgd2l0aCBlcnJvciBjb2RlIC0gIitzdHIoZS5jb2RlKSsiLDEwMDAwLCIraWNvbisiKSIpCiAgICAgICAgICAgIGVsaWYgaGFzYXR0cihlLCAncmVhc29uJyk6CiAgICAgICAgICAgICAgICBhZGRvbl9sb2coJ1dlIGZhaWxlZCB0byByZWFjaCBhIHNlcnZlci4nKQogICAgICAgICAgICAgICAgYWRkb25fbG9nKCdSZWFzb246ICVzJyAlZS5yZWFzb24pCiAgICAgICAgICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLk5vdGlmaWNhdGlvbihMaXZldHZkZXRvZG9zLFdlIGZhaWxlZCB0byByZWFjaCBhIHNlcnZlci4gLSAiK3N0cihlLnJlYXNvbikrIiwxMDAwMCwiK2ljb24rIikiKQoKZGVmIENISW5kZXgoKToKICAgIGFkZG9uX2xvZygiQ0hJbmRleCIpCiAgICBnZXREYXRhKENIQmFzZSwnJykKICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkKCgkKZGVmIGdldFNvdXJjZXMoKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKGZhdm9yaXRlcykgPT0gVHJ1ZToKICAgICAgICAgICAgICAgIGFkZERpcignRmF2b3JpdGVzJywndXJsJyw0LG9zLnBhdGguam9pbihob21lLCAncmVzb3VyY2VzJywgJ2Zhdm9yaXRlLnBuZycpLEZBTkFSVCwnJywnJywnJywnJykKICAgICAgICAgICAgaWYgYWRkb24uZ2V0U2V0dGluZygiYnJvd3NlX3htbF9kYXRhYmFzZSIpID09ICJ0cnVlIjoKICAgICAgICAgICAgICAgIGFkZERpcignWE1MIERhdGFiYXNlJywnaHR0cDovL3hibWNwbHVzLnhiLmZ1bnBpYy5kZS93d3ctZGF0YS9maWxlc3lzdGVtLycsMTUsaWNvbixGQU5BUlQsJycsJycsJycsJycpCiAgICAgICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoImJyb3dzZV9jb21tdW5pdHkiKSA9PSAidHJ1ZSI6CiAgICAgICAgICAgICAgICBhZGREaXIoJ0NvbW11bml0eSBGaWxlcycsJ2NvbW11bml0eV9maWxlcycsMTYsaWNvbixGQU5BUlQsJycsJycsJycsJycpCiAgICAgICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoInNlYXJjaG90aGVycGx1Z2lucyIpID09ICJ0cnVlIjoKICAgICAgICAgICAgICAgIGFkZERpcignU2VhcmNoIE90aGVyIFBsdWdpbnMnLCdTZWFyY2ggUGx1Z2lucycsMjUsaWNvbixGQU5BUlQsJycsJycsJycsJycpCiAgICAgICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKHNvdXJjZV9maWxlKT09VHJ1ZToKICAgICAgICAgICAgICAgIHNvdXJjZXMgPSBqc29uLmxvYWRzKG9wZW4oc291cmNlX2ZpbGUsInIiKS5yZWFkKCkpCiAgICAgICAgICAgICAgICAjcHJpbnQgJ3NvdXJjZXMnLHNvdXJjZXMKICAgICAgICAgICAgICAgIGlmIGxlbihzb3VyY2VzKSA+IDE6CiAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gc291cmNlczoKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyMgZm9yIHByZSAxLjAuOCBzb3VyY2VzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBpc2luc3RhbmNlKGksIGxpc3QpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihpWzBdLmVuY29kZSgndXRmLTgnKSxpWzFdLmVuY29kZSgndXRmLTgnKSwxLGljb24sRkFOQVJULCcnLCcnLCcnLCcnLCdzb3VyY2UnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHVtYiA9IGljb24KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYW5hcnQgPSBGQU5BUlQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXNjID0gJycKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRlID0gJycKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcmVkaXRzID0gJycKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZW5yZSA9ICcnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgaS5oYXNfa2V5KCd0aHVtYm5haWwnKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGh1bWIgPSBpWyd0aHVtYm5haWwnXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGkuaGFzX2tleSgnZmFuYXJ0Jyk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhbmFydCA9IGlbJ2ZhbmFydCddCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgaS5oYXNfa2V5KCdkZXNjcmlwdGlvbicpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXNjID0gaVsnZGVzY3JpcHRpb24nXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGkuaGFzX2tleSgnZGF0ZScpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRlID0gaVsnZGF0ZSddCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgaS5oYXNfa2V5KCdnZW5yZScpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZW5yZSA9IGlbJ2dlbnJlJ10KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBpLmhhc19rZXkoJ2NyZWRpdHMnKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3JlZGl0cyA9IGlbJ2NyZWRpdHMnXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihpWyd0aXRsZSddLmVuY29kZSgndXRmLTgnKSxpWyd1cmwnXS5lbmNvZGUoJ3V0Zi04JyksMSx0aHVtYixmYW5hcnQsZGVzYyxnZW5yZSxkYXRlLGNyZWRpdHMsJ3NvdXJjZScpCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDogdHJhY2ViYWNrLnByaW50X2V4YygpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGlmIGxlbihzb3VyY2VzKSA9PSAxOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBpc2luc3RhbmNlKHNvdXJjZXNbMF0sIGxpc3QpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2V0RGF0YShzb3VyY2VzWzBdWzFdLmVuY29kZSgndXRmLTgnKSxGQU5BUlQpCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZXREYXRhKHNvdXJjZXNbMF1bJ3VybCddLCBzb3VyY2VzWzBdWydmYW5hcnQnXSkKICAgICAgICBleGNlcHQ6IHRyYWNlYmFjay5wcmludF9leGMoKQoKZGVmIGFkZFNvdXJjZSh1cmw9Tm9uZSk6CiAgICAgICAgaWYgdXJsIGlzIE5vbmU6CiAgICAgICAgICAgIGlmIG5vdCBhZGRvbi5nZXRTZXR0aW5nKCJuZXdfZmlsZV9zb3VyY2UiKSA9PSAiIjoKICAgICAgICAgICAgICAgc291cmNlX3VybCA9IGFkZG9uLmdldFNldHRpbmcoJ25ld19maWxlX3NvdXJjZScpLmRlY29kZSgndXRmLTgnKQogICAgICAgICAgICBlbGlmIG5vdCBhZGRvbi5nZXRTZXR0aW5nKCJuZXdfdXJsX3NvdXJjZSIpID09ICIiOgogICAgICAgICAgICAgICBzb3VyY2VfdXJsID0gYWRkb24uZ2V0U2V0dGluZygnbmV3X3VybF9zb3VyY2UnKS5kZWNvZGUoJ3V0Zi04JykKICAgICAgICBlbHNlOgogICAgICAgICAgICBzb3VyY2VfdXJsID0gdXJsCiAgICAgICAgaWYgc291cmNlX3VybCA9PSAnJyBvciBzb3VyY2VfdXJsIGlzIE5vbmU6CiAgICAgICAgICAgIHJldHVybgogICAgICAgIGFkZG9uX2xvZygnQWRkaW5nIE5ldyBTb3VyY2U6ICcrc291cmNlX3VybC5lbmNvZGUoJ3V0Zi04JykpCgogICAgICAgIG1lZGlhX2luZm8gPSBOb25lCiAgICAgICAgI3ByaW50ICdzb3VyY2VfdXJsJyxzb3VyY2VfdXJsCiAgICAgICAgZGF0YSA9IGdldFNvdXAoc291cmNlX3VybCkKICAgICAgICBwcmludCAnc291cmNlX3VybCcsc291cmNlX3VybAogICAgICAgIGlmIGlzaW5zdGFuY2UoZGF0YSxCZWF1dGlmdWxTT0FQKToKICAgICAgICAgICAgaWYgZGF0YS5maW5kKCdjaGFubmVsc19pbmZvJyk6CiAgICAgICAgICAgICAgICBtZWRpYV9pbmZvID0gZGF0YS5jaGFubmVsc19pbmZvCiAgICAgICAgICAgIGVsaWYgZGF0YS5maW5kKCdpdGVtc19pbmZvJyk6CiAgICAgICAgICAgICAgICBtZWRpYV9pbmZvID0gZGF0YS5pdGVtc19pbmZvCiAgICAgICAgaWYgbWVkaWFfaW5mbzoKICAgICAgICAgICAgc291cmNlX21lZGlhID0ge30KICAgICAgICAgICAgc291cmNlX21lZGlhWyd1cmwnXSA9IHNvdXJjZV91cmwKICAgICAgICAgICAgdHJ5OiBzb3VyY2VfbWVkaWFbJ3RpdGxlJ10gPSBtZWRpYV9pbmZvLnRpdGxlLnN0cmluZwogICAgICAgICAgICBleGNlcHQ6IHBhc3MKICAgICAgICAgICAgdHJ5OiBzb3VyY2VfbWVkaWFbJ3RodW1ibmFpbCddID0gbWVkaWFfaW5mby50aHVtYm5haWwuc3RyaW5nCiAgICAgICAgICAgIGV4Y2VwdDogcGFzcwogICAgICAgICAgICB0cnk6IHNvdXJjZV9tZWRpYVsnZmFuYXJ0J10gPSBtZWRpYV9pbmZvLmZhbmFydC5zdHJpbmcKICAgICAgICAgICAgZXhjZXB0OiBwYXNzCiAgICAgICAgICAgIHRyeTogc291cmNlX21lZGlhWydnZW5yZSddID0gbWVkaWFfaW5mby5nZW5yZS5zdHJpbmcKICAgICAgICAgICAgZXhjZXB0OiBwYXNzCiAgICAgICAgICAgIHRyeTogc291cmNlX21lZGlhWydkZXNjcmlwdGlvbiddID0gbWVkaWFfaW5mby5kZXNjcmlwdGlvbi5zdHJpbmcKICAgICAgICAgICAgZXhjZXB0OiBwYXNzCiAgICAgICAgICAgIHRyeTogc291cmNlX21lZGlhWydkYXRlJ10gPSBtZWRpYV9pbmZvLmRhdGUuc3RyaW5nCiAgICAgICAgICAgIGV4Y2VwdDogcGFzcwogICAgICAgICAgICB0cnk6IHNvdXJjZV9tZWRpYVsnY3JlZGl0cyddID0gbWVkaWFfaW5mby5jcmVkaXRzLnN0cmluZwogICAgICAgICAgICBleGNlcHQ6IHBhc3MKICAgICAgICBlbHNlOgogICAgICAgICAgICBpZiAnLycgaW4gc291cmNlX3VybDoKICAgICAgICAgICAgICAgIG5hbWVTdHIgPSBzb3VyY2VfdXJsLnNwbGl0KCcvJylbLTFdLnNwbGl0KCcuJylbMF0KICAgICAgICAgICAgaWYgJ1xcJyBpbiBzb3VyY2VfdXJsOgogICAgICAgICAgICAgICAgbmFtZVN0ciA9IHNvdXJjZV91cmwuc3BsaXQoJ1xcJylbLTFdLnNwbGl0KCcuJylbMF0KICAgICAgICAgICAgaWYgJyUnIGluIG5hbWVTdHI6CiAgICAgICAgICAgICAgICBuYW1lU3RyID0gdXJsbGliLnVucXVvdGVfcGx1cyhuYW1lU3RyKQogICAgICAgICAgICBrZXlib2FyZCA9IHhibWMuS2V5Ym9hcmQobmFtZVN0ciwnRGlzcGxheWVkIE5hbWUsIFJlbmFtZT8nKQogICAgICAgICAgICBrZXlib2FyZC5kb01vZGFsKCkKICAgICAgICAgICAgaWYgKGtleWJvYXJkLmlzQ29uZmlybWVkKCkgPT0gRmFsc2UpOgogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIG5ld1N0ciA9IGtleWJvYXJkLmdldFRleHQoKQogICAgICAgICAgICBpZiBsZW4obmV3U3RyKSA9PSAwOgogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIHNvdXJjZV9tZWRpYSA9IHt9CiAgICAgICAgICAgIHNvdXJjZV9tZWRpYVsndGl0bGUnXSA9IG5ld1N0cgogICAgICAgICAgICBzb3VyY2VfbWVkaWFbJ3VybCddID0gc291cmNlX3VybAogICAgICAgICAgICBzb3VyY2VfbWVkaWFbJ2ZhbmFydCddID0gZmFuYXJ0CgogICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKHNvdXJjZV9maWxlKT09RmFsc2U6CiAgICAgICAgICAgIHNvdXJjZV9saXN0ID0gW10KICAgICAgICAgICAgc291cmNlX2xpc3QuYXBwZW5kKHNvdXJjZV9tZWRpYSkKICAgICAgICAgICAgYiA9IG9wZW4oc291cmNlX2ZpbGUsInciKQogICAgICAgICAgICBiLndyaXRlKGpzb24uZHVtcHMoc291cmNlX2xpc3QpKQogICAgICAgICAgICBiLmNsb3NlKCkKICAgICAgICBlbHNlOgogICAgICAgICAgICBzb3VyY2VzID0ganNvbi5sb2FkcyhvcGVuKHNvdXJjZV9maWxlLCJyIikucmVhZCgpKQogICAgICAgICAgICBzb3VyY2VzLmFwcGVuZChzb3VyY2VfbWVkaWEpCiAgICAgICAgICAgIGIgPSBvcGVuKHNvdXJjZV9maWxlLCJ3IikKICAgICAgICAgICAgYi53cml0ZShqc29uLmR1bXBzKHNvdXJjZXMpKQogICAgICAgICAgICBiLmNsb3NlKCkKICAgICAgICBhZGRvbi5zZXRTZXR0aW5nKCduZXdfdXJsX3NvdXJjZScsICIiKQogICAgICAgIGFkZG9uLnNldFNldHRpbmcoJ25ld19maWxlX3NvdXJjZScsICIiKQogICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuTm90aWZpY2F0aW9uKExpdmV0dmRldG9kb3MsTmV3IHNvdXJjZSBhZGRlZC4sNTAwMCwiK2ljb24rIikiKQogICAgICAgIGlmIG5vdCB1cmwgaXMgTm9uZToKICAgICAgICAgICAgaWYgJ3hibWNwbHVzLnhiLmZ1bnBpYy5kZScgaW4gdXJsOgogICAgICAgICAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Db250YWluZXIuVXBkYXRlKCVzP21vZGU9MTQscmVwbGFjZSkiICVzeXMuYXJndlswXSkKICAgICAgICAgICAgZWxpZiAnY29tbXVuaXR5LWxpbmtzJyBpbiB1cmw6CiAgICAgICAgICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLkNvbnRhaW5lci5VcGRhdGUoJXM/bW9kZT0xMCxyZXBsYWNlKSIgJXN5cy5hcmd2WzBdKQogICAgICAgIGVsc2U6IGFkZG9uLm9wZW5TZXR0aW5ncygpCgpkZWYgcm1Tb3VyY2UobmFtZSk6CiAgICAgICAgc291cmNlcyA9IGpzb24ubG9hZHMob3Blbihzb3VyY2VfZmlsZSwiciIpLnJlYWQoKSkKICAgICAgICBmb3IgaW5kZXggaW4gcmFuZ2UobGVuKHNvdXJjZXMpKToKICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShzb3VyY2VzW2luZGV4XSwgbGlzdCk6CiAgICAgICAgICAgICAgICBpZiBzb3VyY2VzW2luZGV4XVswXSA9PSBuYW1lOgogICAgICAgICAgICAgICAgICAgIGRlbCBzb3VyY2VzW2luZGV4XQogICAgICAgICAgICAgICAgICAgIGIgPSBvcGVuKHNvdXJjZV9maWxlLCJ3IikKICAgICAgICAgICAgICAgICAgICBiLndyaXRlKGpzb24uZHVtcHMoc291cmNlcykpCiAgICAgICAgICAgICAgICAgICAgYi5jbG9zZSgpCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGlmIHNvdXJjZXNbaW5kZXhdWyd0aXRsZSddID09IG5hbWU6CiAgICAgICAgICAgICAgICAgICAgZGVsIHNvdXJjZXNbaW5kZXhdCiAgICAgICAgICAgICAgICAgICAgYiA9IG9wZW4oc291cmNlX2ZpbGUsInciKQogICAgICAgICAgICAgICAgICAgIGIud3JpdGUoanNvbi5kdW1wcyhzb3VyY2VzKSkKICAgICAgICAgICAgICAgICAgICBiLmNsb3NlKCkKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuQ29udGFpbmVyLlJlZnJlc2giKQoKZGVmIGdldF94bWxfZGF0YWJhc2UodXJsLCBicm93c2U9RmFsc2UpOgogICAgICAgIGlmIHVybCBpcyBOb25lOgogICAgICAgICAgICB1cmwgPSAnaHR0cDovL3hibWNwbHVzLnhiLmZ1bnBpYy5kZS93d3ctZGF0YS9maWxlc3lzdGVtLycKICAgICAgICBzb3VwID0gQmVhdXRpZnVsU291cChtYWtlUmVxdWVzdCh1cmwpLCBjb252ZXJ0RW50aXRpZXM9QmVhdXRpZnVsU291cC5IVE1MX0VOVElUSUVTKQogICAgICAgIGZvciBpIGluIHNvdXAoJ2EnKToKICAgICAgICAgICAgaHJlZiA9IGlbJ2hyZWYnXQogICAgICAgICAgICBpZiBub3QgaHJlZi5zdGFydHN3aXRoKCc/Jyk6CiAgICAgICAgICAgICAgICBuYW1lID0gaS5zdHJpbmcKICAgICAgICAgICAgICAgIGlmIG5hbWUgbm90IGluIFsnUGFyZW50IERpcmVjdG9yeScsICdyZWN5Y2xlX2Jpbi8nXToKICAgICAgICAgICAgICAgICAgICBpZiBocmVmLmVuZHN3aXRoKCcvJyk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGJyb3dzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLHVybCtocmVmLDE1LGljb24sZmFuYXJ0LCcnLCcnLCcnKQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUsdXJsK2hyZWYsMTQsaWNvbixmYW5hcnQsJycsJycsJycpCiAgICAgICAgICAgICAgICAgICAgZWxpZiBocmVmLmVuZHN3aXRoKCcueG1sJyk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGJyb3dzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLHVybCtocmVmLDEsaWNvbixmYW5hcnQsJycsJycsJycsJycsJ2Rvd25sb2FkJykKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKHNvdXJjZV9maWxlKT09VHJ1ZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBuYW1lIGluIFNPVVJDRVM6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihuYW1lKycgKGluIHVzZSknLHVybCtocmVmLDExLGljb24sZmFuYXJ0LCcnLCcnLCcnLCcnLCdkb3dubG9hZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUsdXJsK2hyZWYsMTEsaWNvbixmYW5hcnQsJycsJycsJycsJycsJ2Rvd25sb2FkJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUsdXJsK2hyZWYsMTEsaWNvbixmYW5hcnQsJycsJycsJycsJycsJ2Rvd25sb2FkJykKCgpkZWYgZ2V0Q29tbXVuaXR5U291cmNlcyhicm93c2U9RmFsc2UpOgogICAgICAgIHVybCA9ICdodHRwOi8vY29tbXVuaXR5LWxpbmtzLmdvb2dsZWNvZGUuY29tL3N2bi90cnVuay8nCiAgICAgICAgc291cCA9IEJlYXV0aWZ1bFNvdXAobWFrZVJlcXVlc3QodXJsKSwgY29udmVydEVudGl0aWVzPUJlYXV0aWZ1bFNvdXAuSFRNTF9FTlRJVElFUykKICAgICAgICBmaWxlcyA9IHNvdXAoJ3VsJylbMF0oJ2xpJylbMTpdCiAgICAgICAgZm9yIGkgaW4gZmlsZXM6CiAgICAgICAgICAgIG5hbWUgPSBpKCdhJylbMF1bJ2hyZWYnXQogICAgICAgICAgICBpZiBicm93c2U6CiAgICAgICAgICAgICAgICBhZGREaXIobmFtZSx1cmwrbmFtZSwxLGljb24sZmFuYXJ0LCcnLCcnLCcnLCcnLCdkb3dubG9hZCcpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBhZGREaXIobmFtZSx1cmwrbmFtZSwxMSxpY29uLGZhbmFydCwnJywnJywnJywnJywnZG93bmxvYWQnKQoKZGVmIGdldFNvdXAodXJsLGRhdGE9Tm9uZSk6CiAgICAgICAgaWYgdXJsLnN0YXJ0c3dpdGgoJ2h0dHA6Ly8nKSBvciB1cmwuc3RhcnRzd2l0aCgnaHR0cHM6Ly8nKToKICAgICAgICAgICAgZGF0YSA9IG1ha2VSZXF1ZXN0KHVybCkKICAgICAgICAgICAgaWYgcmUuc2VhcmNoKCIjRVhUTTNVIixkYXRhKSBvciAnbTN1JyBpbiB1cmw6CiAgICAgICAgICAgICAgICBwcmludCAnZm91bmQgbTN1IGRhdGEnCiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YQogICAgICAgIGVsaWYgZGF0YSA9PSBOb25lOgogICAgICAgICAgICBpZiBub3QgJy8nICBpbiB1cmwgb3Igbm90ICdcXCcgaW4gdXJsOgogICAgICAgICAgICAgICAgcHJpbnQgJ05vIGRpcmVjdG9yeSBmb3VuZC4gTGV0cyBtYWtlIHRoZSB1cmwgdG8gY2FjaGUgZGlyJwogICAgICAgICAgICAgICAgdXJsID0gb3MucGF0aC5qb2luKGNvbW11bml0eWZpbGVzLHVybCkKICAgICAgICAgICAgaWYgeGJtY3Zmcy5leGlzdHModXJsKToKICAgICAgICAgICAgICAgIGlmIHVybC5zdGFydHN3aXRoKCJzbWI6Ly8iKSBvciB1cmwuc3RhcnRzd2l0aCgibmZzOi8vIik6CiAgICAgICAgICAgICAgICAgICAgY29weSA9IHhibWN2ZnMuY29weSh1cmwsIG9zLnBhdGguam9pbihwcm9maWxlLCAndGVtcCcsICdzb3JjZV90ZW1wLnR4dCcpKQogICAgICAgICAgICAgICAgICAgIGlmIGNvcHk6CiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSBvcGVuKG9zLnBhdGguam9pbihwcm9maWxlLCAndGVtcCcsICdzb3JjZV90ZW1wLnR4dCcpLCAiciIpLnJlYWQoKQogICAgICAgICAgICAgICAgICAgICAgICB4Ym1jdmZzLmRlbGV0ZShvcy5wYXRoLmpvaW4ocHJvZmlsZSwgJ3RlbXAnLCAnc29yY2VfdGVtcC50eHQnKSkKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coImZhaWxlZCB0byBjb3B5IGZyb20gc21iOiIpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGRhdGEgPSBvcGVuKHVybCwgJ3InKS5yZWFkKCkKICAgICAgICAgICAgICAgICAgICBpZiByZS5tYXRjaCgiI0VYVE0zVSIsZGF0YSlvciAnbTN1JyBpbiB1cmw6CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICdmb3VuZCBtM3UgZGF0YScKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGEKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiU291cCBEYXRhIG5vdCBmb3VuZCEiKQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgcmV0dXJuIEJlYXV0aWZ1bFNPQVAoZGF0YSwgY29udmVydEVudGl0aWVzPUJlYXV0aWZ1bFN0b25lU291cC5YTUxfRU5USVRJRVMpCgoKZGVmIGdldERhdGEodXJsLGZhbmFydCwgZGF0YT1Ob25lKToKICAgIHNvdXAgPSBnZXRTb3VwKHVybCxkYXRhKQogICAgI3ByaW50IHR5cGUoc291cCkKICAgIGlmIGlzaW5zdGFuY2Uoc291cCxCZWF1dGlmdWxTT0FQKToKICAgICNwcmludCAneHh4eHh4eHh4eHNvdXAnLHNvdXAKICAgICAgICBpZiBsZW4oc291cCgnY2hhbm5lbHMnKSkgPiAwIGFuZCBhZGRvbi5nZXRTZXR0aW5nKCdkb25vdHNob3dieWNoYW5uZWxzJykgPT0gJ2ZhbHNlJzoKICAgICAgICAgICAgY2hhbm5lbHMgPSBzb3VwKCdjaGFubmVsJykKICAgICAgICAgICAgZm9yIGNoYW5uZWwgaW4gY2hhbm5lbHM6CiMgICAgICAgICAgICAgICAgcHJpbnQgY2hhbm5lbAoKICAgICAgICAgICAgICAgIGxpbmtlZFVybD0nJwogICAgICAgICAgICAgICAgbGNvdW50PTAKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBsaW5rZWRVcmwgPSAgY2hhbm5lbCgnZXh0ZXJuYWxsaW5rJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgbGNvdW50PWxlbihjaGFubmVsKCdleHRlcm5hbGxpbmsnKSkKICAgICAgICAgICAgICAgIGV4Y2VwdDogcGFzcwogICAgICAgICAgICAgICAgI3ByaW50ICdsaW5rZWRVcmwnLGxpbmtlZFVybCxsY291bnQKICAgICAgICAgICAgICAgIGlmIGxjb3VudD4xOiBsaW5rZWRVcmw9JycKCiAgICAgICAgICAgICAgICBuYW1lID0gY2hhbm5lbCgnbmFtZScpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgdGh1bWJuYWlsID0gY2hhbm5lbCgndGh1bWJuYWlsJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICBpZiB0aHVtYm5haWwgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICB0aHVtYm5haWwgPSAnJwoKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBpZiBub3QgY2hhbm5lbCgnZmFuYXJ0Jyk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoJ3VzZV90aHVtYicpID09ICJ0cnVlIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhbkFydCA9IHRodW1ibmFpbAogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmFuQXJ0ID0gZmFuYXJ0CiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgZmFuQXJ0ID0gY2hhbm5lbCgnZmFuYXJ0JylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgaWYgZmFuQXJ0ID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgZmFuQXJ0ID0gZmFuYXJ0CgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGRlc2MgPSBjaGFubmVsKCdpbmZvJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgaWYgZGVzYyA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICByYWlzZQogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIGRlc2MgPSAnJwoKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBnZW5yZSA9IGNoYW5uZWwoJ2dlbnJlJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgaWYgZ2VucmUgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgcmFpc2UKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBnZW5yZSA9ICcnCgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGRhdGUgPSBjaGFubmVsKCdkYXRlJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgaWYgZGF0ZSA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICByYWlzZQogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIGRhdGUgPSAnJwoKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBjcmVkaXRzID0gY2hhbm5lbCgnY3JlZGl0cycpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgIGlmIGNyZWRpdHMgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgcmFpc2UKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBjcmVkaXRzID0gJycKCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgaWYgbGlua2VkVXJsPT0nJzoKICAgICAgICAgICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUuZW5jb2RlKCd1dGYtOCcsICdpZ25vcmUnKSx1cmwuZW5jb2RlKCd1dGYtOCcpLDIsdGh1bWJuYWlsLGZhbkFydCxkZXNjLGdlbnJlLGRhdGUsY3JlZGl0cyxUcnVlKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCBsaW5rZWRVcmwKICAgICAgICAgICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUuZW5jb2RlKCd1dGYtOCcpLGxpbmtlZFVybC5lbmNvZGUoJ3V0Zi04JyksMSx0aHVtYm5haWwsZmFuQXJ0LGRlc2MsZ2VucmUsZGF0ZSxOb25lLCdzb3VyY2UnKQogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygnVGhlcmUgd2FzIGEgcHJvYmxlbSBhZGRpbmcgZGlyZWN0b3J5IGZyb20gZ2V0RGF0YSgpOiAnK25hbWUuZW5jb2RlKCd1dGYtOCcsICdpZ25vcmUnKSkKICAgICAgICBlbHNlOgogICAgICAgICAgICBhZGRvbl9sb2coJ05vIENoYW5uZWxzOiBnZXRJdGVtcycpCiAgICAgICAgICAgIGdldEl0ZW1zKHNvdXAoJ2l0ZW0nKSxmYW5hcnQpCiAgICBlbHNlOgogICAgICAgIHBhcnNlX20zdShzb3VwKQojIGJvcnJvdyBmcm9tIGh0dHBzOi8vZ2l0aHViLmNvbS9lbmVuOTIvUDJQLVN0cmVhbXMtWEJNQy9ibG9iL21hc3Rlci9wbHVnaW4udmlkZW8ucDJwLXN0cmVhbXMvcmVzb3VyY2VzL2NvcmUvbGl2ZXN0cmVhbXMucHkKIyBUaGlzIHdpbGwgbm90IGdvIHRocm91Z2ggdGhlIGdldEl0ZW1zIGZ1bmN0aW9ucyAoIG1lYW5zIHlvdSBtdXN0IGhhdmUgcmVhZHkgdG8gcGxheSB1cmwsIG5vIHJlZ2V4KQpkZWYgcGFyc2VfbTN1KGRhdGEpOgogICAgY29udGVudCA9IGRhdGEucnN0cmlwKCkKICAgIG1hdGNoID0gcmUuY29tcGlsZShyJyNFWFRJTkY6KC4rPyksKC4qPylbXG5ccl0rKFteXHJcbl0rKScpLmZpbmRhbGwoY29udGVudCkKICAgIHRvdGFsID0gbGVuKG1hdGNoKQogICAgcHJpbnQgJ3RvdGFsIG0zdSBsaW5rcycsdG90YWwKICAgIGZvciBvdGhlcixjaGFubmVsX25hbWUsc3RyZWFtX3VybCBpbiBtYXRjaDoKICAgICAgICBpZiAndHZnLWxvZ28nIGluIG90aGVyOgogICAgICAgICAgICB0aHVtYm5haWwgPSByZV9tZShvdGhlciwndHZnLWxvZ289W1wnIl0oLio/KVtcJyJdJykKICAgICAgICAgICAgaWYgdGh1bWJuYWlsOgogICAgICAgICAgICAgICAgaWYgdGh1bWJuYWlsLnN0YXJ0c3dpdGgoJ2h0dHAnKToKICAgICAgICAgICAgICAgICAgICB0aHVtYm5haWwgPSB0aHVtYm5haWwKCiAgICAgICAgICAgICAgICBlbGlmIG5vdCBhZGRvbi5nZXRTZXR0aW5nKCdsb2dvLWZvbGRlclBhdGgnKSA9PSAiIjoKICAgICAgICAgICAgICAgICAgICBsb2dvX3VybCA9IGFkZG9uLmdldFNldHRpbmcoJ2xvZ28tZm9sZGVyUGF0aCcpCiAgICAgICAgICAgICAgICAgICAgdGh1bWJuYWlsID0gbG9nb191cmwgKyB0aHVtYm5haWwKCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9IHRodW1ibmFpbAogICAgICAgICAgICAjZWxzZToKCiAgICAgICAgZWxzZToKICAgICAgICAgICAgdGh1bWJuYWlsID0gJycKICAgICAgICBpZiAndHlwZScgaW4gb3RoZXI6CiAgICAgICAgICAgIG1vZGVfdHlwZSA9IHJlX21lKG90aGVyLCd0eXBlPVtcJyJdKC4qPylbXCciXScpCiAgICAgICAgICAgIGlmIG1vZGVfdHlwZSA9PSAneXQtZGwnOgogICAgICAgICAgICAgICAgc3RyZWFtX3VybCA9IHN0cmVhbV91cmwgKyImbW9kZT0xOCIKICAgICAgICAgICAgZWxpZiBtb2RlX3R5cGUgPT0gJ3JlZ2V4JzoKICAgICAgICAgICAgICAgIHVybCA9IHN0cmVhbV91cmwuc3BsaXQoJyZyZWdleHM9JykKICAgICAgICAgICAgICAgICNwcmludCB1cmxbMF0gZ2V0U291cCh1cmwsZGF0YT1Ob25lKQogICAgICAgICAgICAgICAgcmVnZXhzID0gcGFyc2VfcmVnZXgoZ2V0U291cCgnJyxkYXRhPXVybFsxXSkpCgogICAgICAgICAgICAgICAgYWRkTGluayh1cmxbMF0sIGNoYW5uZWxfbmFtZSx0aHVtYm5haWwsJycsJycsJycsJycsJycsTm9uZSxyZWdleHMsdG90YWwpCiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICBlbGlmIG1vZGVfdHlwZSA9PSAnZnR2JzoKICAgICAgICAgICAgICAgIHN0cmVhbV91cmwgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLkYuVC5WLz9uYW1lPScrdXJsbGliLnF1b3RlKGNoYW5uZWxfbmFtZSkgKycmdXJsPScgK3N0cmVhbV91cmwgKycmbW9kZT0xMjUmY2hfZmFuYXJ0PW5hJwogICAgICAgIGFkZExpbmsoc3RyZWFtX3VybCwgY2hhbm5lbF9uYW1lLHRodW1ibmFpbCwnJywnJywnJywnJywnJyxOb25lLCcnLHRvdGFsKQpkZWYgZ2V0Q2hhbm5lbEl0ZW1zKG5hbWUsdXJsLGZhbmFydCk6CiAgICAgICAgc291cCA9IGdldFNvdXAodXJsKQogICAgICAgIGNoYW5uZWxfbGlzdCA9IHNvdXAuZmluZCgnY2hhbm5lbCcsIGF0dHJzPXsnbmFtZScgOiBuYW1lLmRlY29kZSgndXRmLTgnKX0pCiAgICAgICAgaXRlbXMgPSBjaGFubmVsX2xpc3QoJ2l0ZW0nKQogICAgICAgIHRyeToKICAgICAgICAgICAgZmFuQXJ0ID0gY2hhbm5lbF9saXN0KCdmYW5hcnQnKVswXS5zdHJpbmcKICAgICAgICAgICAgaWYgZmFuQXJ0ID09IE5vbmU6CiAgICAgICAgICAgICAgICByYWlzZQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgZmFuQXJ0ID0gZmFuYXJ0CiAgICAgICAgZm9yIGNoYW5uZWwgaW4gY2hhbm5lbF9saXN0KCdzdWJjaGFubmVsJyk6CiAgICAgICAgICAgIG5hbWUgPSBjaGFubmVsKCduYW1lJylbMF0uc3RyaW5nCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9IGNoYW5uZWwoJ3RodW1ibmFpbCcpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgaWYgdGh1bWJuYWlsID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgcmFpc2UKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgdGh1bWJuYWlsID0gJycKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgaWYgbm90IGNoYW5uZWwoJ2ZhbmFydCcpOgogICAgICAgICAgICAgICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoJ3VzZV90aHVtYicpID09ICJ0cnVlIjoKICAgICAgICAgICAgICAgICAgICAgICAgZmFuQXJ0ID0gdGh1bWJuYWlsCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGZhbkFydCA9IGNoYW5uZWwoJ2ZhbmFydCcpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgaWYgZmFuQXJ0ID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgcmFpc2UKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBkZXNjID0gY2hhbm5lbCgnaW5mbycpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgaWYgZGVzYyA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIGRlc2MgPSAnJwoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgZ2VucmUgPSBjaGFubmVsKCdnZW5yZScpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgaWYgZ2VucmUgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICByYWlzZQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBnZW5yZSA9ICcnCgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBkYXRlID0gY2hhbm5lbCgnZGF0ZScpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgaWYgZGF0ZSA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIGRhdGUgPSAnJwoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgY3JlZGl0cyA9IGNoYW5uZWwoJ2NyZWRpdHMnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgIGlmIGNyZWRpdHMgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICByYWlzZQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBjcmVkaXRzID0gJycKCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLmVuY29kZSgndXRmLTgnLCAnaWdub3JlJyksdXJsLmVuY29kZSgndXRmLTgnKSwzLHRodW1ibmFpbCxmYW5BcnQsZGVzYyxnZW5yZSxjcmVkaXRzLGRhdGUpCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIGFkZG9uX2xvZygnVGhlcmUgd2FzIGEgcHJvYmxlbSBhZGRpbmcgZGlyZWN0b3J5IC0gJytuYW1lLmVuY29kZSgndXRmLTgnLCAnaWdub3JlJykpCiAgICAgICAgZ2V0SXRlbXMoaXRlbXMsZmFuQXJ0KQoKCmRlZiBnZXRTdWJDaGFubmVsSXRlbXMobmFtZSx1cmwsZmFuYXJ0KToKICAgICAgICBzb3VwID0gZ2V0U291cCh1cmwpCiAgICAgICAgY2hhbm5lbF9saXN0ID0gc291cC5maW5kKCdzdWJjaGFubmVsJywgYXR0cnM9eyduYW1lJyA6IG5hbWUuZGVjb2RlKCd1dGYtOCcpfSkKICAgICAgICBpdGVtcyA9IGNoYW5uZWxfbGlzdCgnc3ViaXRlbScpCiAgICAgICAgZ2V0SXRlbXMoaXRlbXMsZmFuYXJ0KQoKZGVmIGdldEl0ZW1zKGl0ZW1zLGZhbmFydCk6CiAgICAgICAgdG90YWwgPSBsZW4oaXRlbXMpCiAgICAgICAgYWRkb25fbG9nKCdUb3RhbCBJdGVtczogJXMnICV0b3RhbCkKICAgICAgICBhZGRfcGxheWxpc3QgPSBhZGRvbi5nZXRTZXR0aW5nKCdhZGRfcGxheWxpc3QnKQogICAgICAgIGFza19wbGF5bGlzdF9pdGVtcyA9YWRkb24uZ2V0U2V0dGluZygnYXNrX3BsYXlsaXN0X2l0ZW1zJykKICAgICAgICB1c2VfdGh1bWIgPSBhZGRvbi5nZXRTZXR0aW5nKCd1c2VfdGh1bWInKQogICAgICAgIHBhcmVudGFsYmxvY2sgPWFkZG9uLmdldFNldHRpbmcoJ3BhcmVudGFsYmxvY2tlZCcpCiAgICAgICAgcGFyZW50YWxibG9jaz0gcGFyZW50YWxibG9jaz09InRydWUiCiAgICAgICAgZm9yIGl0ZW0gaW4gaXRlbXM6CiAgICAgICAgICAgIGlzWE1MU291cmNlPUZhbHNlCiAgICAgICAgICAgIGlzSnNvbnJwYyA9IEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICAgICBhcHBseWJsb2NrPSdmYWxzZScKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgYXBwbHlibG9jayA9IGl0ZW0oJ3BhcmVudGFsYmxvY2snKVswXS5zdHJpbmcKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgYWRkb25fbG9nKCdwYXJlbnRhbGJsb2NrIEVycm9yJykKICAgICAgICAgICAgICAgIGFwcGx5YmxvY2sgPSAnJwogICAgICAgICAgICBpZiBhcHBseWJsb2NrPT0ndHJ1ZScgYW5kIHBhcmVudGFsYmxvY2s6IGNvbnRpbnVlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgbmFtZSA9IGl0ZW0oJ3RpdGxlJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICBpZiBuYW1lIGlzIE5vbmU6CiAgICAgICAgICAgICAgICAgICAgbmFtZSA9ICd1bmtub3duPycKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgYWRkb25fbG9nKCdOYW1lIEVycm9yJykKICAgICAgICAgICAgICAgIG5hbWUgPSAnJwoKCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGlmIGl0ZW0oJ2VwZycpOgogICAgICAgICAgICAgICAgICAgIGlmIGl0ZW0uZXBnX3VybDoKICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCdHZXQgRVBHIFJlZ2V4JykKICAgICAgICAgICAgICAgICAgICAgICAgZXBnX3VybCA9IGl0ZW0uZXBnX3VybC5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgZXBnX3JlZ2V4ID0gaXRlbS5lcGdfcmVnZXguc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGVwZ19uYW1lID0gZ2V0X2VwZyhlcGdfdXJsLCBlcGdfcmVnZXgpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGVwZ19uYW1lOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZSArPSAnIC0gJyArIGVwZ19uYW1lCiAgICAgICAgICAgICAgICAgICAgZWxpZiBpdGVtKCdlcGcnKVswXS5zdHJpbmcgPiAxOgogICAgICAgICAgICAgICAgICAgICAgICBuYW1lICs9IGdldGVwZyhpdGVtKCdlcGcnKVswXS5zdHJpbmcpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgYWRkb25fbG9nKCdFUEcgRXJyb3InKQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICB1cmwgPSBbXQogICAgICAgICAgICAgICAgaWYgbGVuKGl0ZW0oJ2xpbmsnKSkgPjA6CiAgICAgICAgICAgICAgICAgICAgI3ByaW50ICdpdGVtIGxpbmsnLCBpdGVtKCdsaW5rJykKCiAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gaXRlbSgnbGluaycpOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgaS5zdHJpbmcgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybC5hcHBlbmQoaS5zdHJpbmcpCgogICAgICAgICAgICAgICAgZWxpZiBsZW4oaXRlbSgnc3BvcnRzZGV2aWwnKSkgPjA6CiAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gaXRlbSgnc3BvcnRzZGV2aWwnKToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGkuc3RyaW5nID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcG9ydHNkZXZpbCA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8uU3BvcnRzRGV2aWwvP21vZGU9MSZhbXA7aXRlbT1jYXRjaGVyJTNkc3RyZWFtcyUyNnVybD0nICtpLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmZXJlciA9IGl0ZW0oJ3JlZmVyZXInKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHJlZmVyZXI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgI3ByaW50ICdyZWZlcmVyIGZvdW5kJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwb3J0c2RldmlsID0gc3BvcnRzZGV2aWwgKyAnJTI2cmVmZXJlcj0nICtyZWZlcmVyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmwuYXBwZW5kKHNwb3J0c2RldmlsKQogICAgICAgICAgICAgICAgZWxpZiBsZW4oaXRlbSgncDJwJykpID4wOgogICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGl0ZW0oJ3AycCcpOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgaS5zdHJpbmcgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICdzb3A6Ly8nIGluIGkuc3RyaW5nOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvcCA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8ucDJwLXN0cmVhbXMvP21vZGU9MnVybD0nK2kuc3RyaW5nICsnJicgKyAnbmFtZT0nK25hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmwuYXBwZW5kKHNvcCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcDJwPSdwbHVnaW46Ly9wbHVnaW4udmlkZW8ucDJwLXN0cmVhbXMvP21vZGU9MSZ1cmw9JytpLnN0cmluZyArJyYnICsgJ25hbWU9JytuYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsLmFwcGVuZChwMnApCiAgICAgICAgICAgICAgICBlbGlmIGxlbihpdGVtKCd2YXVnaG4nKSkgPjA6CiAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gaXRlbSgndmF1Z2huJyk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBpLnN0cmluZyA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmF1Z2huID0gJ3BsdWdpbjovL3BsdWdpbi5zdHJlYW0udmF1Z2hubGl2ZS50di8/bW9kZT1QbGF5TGl2ZVN0cmVhbSZhbXA7Y2hhbm5lbD0nK2kuc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmwuYXBwZW5kKHZhdWdobikKICAgICAgICAgICAgICAgIGVsaWYgbGVuKGl0ZW0oJ2lsaXZlJykpID4wOgogICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGl0ZW0oJ2lsaXZlJyk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBpLnN0cmluZyA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90ICdodHRwJyBpbiBpLnN0cmluZzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbGl2ZSA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8udGJoLmlsaXZlLz91cmw9aHR0cDovL3d3dy5zdHJlYW1saXZlLnRvL3ZpZXcvJytpLnN0cmluZysnJmFtcDtsaW5rPTk5JmFtcDttb2RlPWlMaXZlUGxheScKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWxpdmUgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnRiaC5pbGl2ZS8/dXJsPScraS5zdHJpbmcrJyZhbXA7bGluaz05OSZhbXA7bW9kZT1pTGl2ZVBsYXknCiAgICAgICAgICAgICAgICBlbGlmIGxlbihpdGVtKCd5dC1kbCcpKSA+MDoKICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBpdGVtKCd5dC1kbCcpOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgaS5zdHJpbmcgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHl0ZGwgPSBpLnN0cmluZyArICcmbW9kZT0xOCcKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybC5hcHBlbmQoeXRkbCkKICAgICAgICAgICAgICAgIGVsaWYgbGVuKGl0ZW0oJ2RtJykpID4wOgogICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGl0ZW0oJ2RtJyk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBpLnN0cmluZyA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG0gPSAicGx1Z2luOi8vcGx1Z2luLnZpZGVvLmRhaWx5bW90aW9uX2NvbS8/bW9kZT1wbGF5VmlkZW8mdXJsPSIgKyBpLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsLmFwcGVuZChkbSkKICAgICAgICAgICAgICAgIGVsaWYgbGVuKGl0ZW0oJ2RtbGl2ZScpKSA+MDoKICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBpdGVtKCdkbWxpdmUnKToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGkuc3RyaW5nID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkbSA9ICJwbHVnaW46Ly9wbHVnaW4udmlkZW8uZGFpbHltb3Rpb25fY29tLz9tb2RlPXBsYXlMaXZlVmlkZW8mdXJsPSIgKyBpLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsLmFwcGVuZChkbSkKICAgICAgICAgICAgICAgIGVsaWYgbGVuKGl0ZW0oJ3V0dWJlJykpID4wOgogICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGl0ZW0oJ3V0dWJlJyk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBpLnN0cmluZyA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgJyAnIGluIGkuc3RyaW5nIDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dHViZSA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8ueW91dHViZS9zZWFyY2gvP3E9JysgdXJsbGliLnF1b3RlX3BsdXMoaS5zdHJpbmcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNKc29ucnBjPXV0dWJlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGlmIGxlbihpLnN0cmluZykgPT0gMTE6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXR1YmUgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnlvdXR1YmUvcGxheS8/dmlkZW9faWQ9JysgaS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgKGkuc3RyaW5nLnN0YXJ0c3dpdGgoJ1BMJykgYW5kIG5vdCAnJm9yZGVyPScgaW4gaS5zdHJpbmcpIG9yIGkuc3RyaW5nLnN0YXJ0c3dpdGgoJ1VVJyk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXR1YmUgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnlvdXR1YmUvcGxheS8/Jm9yZGVyPWRlZmF1bHQmcGxheWxpc3RfaWQ9JyArIGkuc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGlmIGkuc3RyaW5nLnN0YXJ0c3dpdGgoJ1BMJykgb3IgaS5zdHJpbmcuc3RhcnRzd2l0aCgnVVUnKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dHViZSA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8ueW91dHViZS9wbGF5Lz9wbGF5bGlzdF9pZD0nICsgaS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgaS5zdHJpbmcuc3RhcnRzd2l0aCgnVUMnKSBhbmQgbGVuKGkuc3RyaW5nKSA+IDEyOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV0dWJlID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby55b3V0dWJlL2NoYW5uZWwvJyArIGkuc3RyaW5nICsgJy8nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNKc29ucnBjPXV0dWJlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGlmIG5vdCBpLnN0cmluZy5zdGFydHN3aXRoKCdVQycpIGFuZCBub3QgKGkuc3RyaW5nLnN0YXJ0c3dpdGgoJ1BMJykpICA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXR1YmUgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnlvdXR1YmUvdXNlci8nICsgaS5zdHJpbmcgKyAnLycKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc0pzb25ycGM9dXR1YmUKICAgICAgICAgICAgICAgICAgICAgICAgdXJsLmFwcGVuZCh1dHViZSkKICAgICAgICAgICAgICAgIGVsaWYgbGVuKGl0ZW0oJ2ltZGInKSkgPjA6CiAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gaXRlbSgnaW1kYicpOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgaS5zdHJpbmcgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoJ2dlbmVzaXNvcnB1bHNhcicpID09ICcwJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbWRiID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby5nZW5lc2lzLz9hY3Rpb249cGxheSZpbWRiPScraS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW1kYiA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8ucHVsc2FyL21vdmllL3R0JytpLnN0cmluZysnL3BsYXknCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmwuYXBwZW5kKGltZGIpCiAgICAgICAgICAgICAgICBlbGlmIGxlbihpdGVtKCdmNG0nKSkgPjA6CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGl0ZW0oJ2Y0bScpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGkuc3RyaW5nID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgJy5mNG0nIGluIGkuc3RyaW5nOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmNG0gPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLmY0bVRlc3Rlci8/dXJsPScrdXJsbGliLnF1b3RlX3BsdXMoaS5zdHJpbmcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiAnLm0zdTgnIGluIGkuc3RyaW5nOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmNG0gPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLmY0bVRlc3Rlci8/dXJsPScrdXJsbGliLnF1b3RlX3BsdXMoaS5zdHJpbmcpKycmYW1wO3N0cmVhbXR5cGU9SExTJwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmNG0gPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLmY0bVRlc3Rlci8/dXJsPScrdXJsbGliLnF1b3RlX3BsdXMoaS5zdHJpbmcpKycmYW1wO3N0cmVhbXR5cGU9U0lNUExFJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsLmFwcGVuZChmNG0pCiAgICAgICAgICAgICAgICBlbGlmIGxlbihpdGVtKCdmdHYnKSkgPjA6CiAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gaXRlbSgnZnR2Jyk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBpLnN0cmluZyA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZnR2ID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby5GLlQuVi8/bmFtZT0nK3VybGxpYi5xdW90ZShuYW1lKSArJyZ1cmw9JyAraS5zdHJpbmcgKycmbW9kZT0xMjUmY2hfZmFuYXJ0PW5hJwogICAgICAgICAgICAgICAgICAgICAgICB1cmwuYXBwZW5kKGZ0dikKICAgICAgICAgICAgICAgIGVsaWYgbGVuKGl0ZW0oJ3VybHNvbHZlJykpID4wOgogICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGl0ZW0oJ3VybHNvbHZlJyk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBpLnN0cmluZyA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZXIgPSBpLnN0cmluZyArJyZtb2RlPTE5JwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsLmFwcGVuZChyZXNvbHZlcikKICAgICAgICAgICAgICAgIGlmIGxlbih1cmwpIDwgMToKICAgICAgICAgICAgICAgICAgICByYWlzZQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBhZGRvbl9sb2coJ0Vycm9yIDxsaW5rPiBlbGVtZW50LCBQYXNzaW5nOicrbmFtZS5lbmNvZGUoJ3V0Zi04JywgJ2lnbm9yZScpKQogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgaXNYTUxTb3VyY2UgPSBpdGVtKCdleHRlcm5hbGxpbmsnKVswXS5zdHJpbmcKICAgICAgICAgICAgZXhjZXB0OiBwYXNzCgogICAgICAgICAgICBpZiBpc1hNTFNvdXJjZToKICAgICAgICAgICAgICAgIGV4dF91cmw9W2lzWE1MU291cmNlXQogICAgICAgICAgICAgICAgaXNYTUxTb3VyY2U9VHJ1ZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgaXNYTUxTb3VyY2U9RmFsc2UKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgaXNKc29ucnBjID0gaXRlbSgnanNvbnJwYycpWzBdLnN0cmluZwogICAgICAgICAgICBleGNlcHQ6IHBhc3MKICAgICAgICAgICAgaWYgaXNKc29ucnBjOgoKICAgICAgICAgICAgICAgIGV4dF91cmw9W2lzSnNvbnJwY10KICAgICAgICAgICAgICAgICNwcmludCAnSlNPTi1SUEMgZXh0X3VybCcsZXh0X3VybAogICAgICAgICAgICAgICAgaXNKc29ucnBjPVRydWUKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGlzSnNvbnJwYz1GYWxzZQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICB0aHVtYm5haWwgPSBpdGVtKCd0aHVtYm5haWwnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgIGlmIHRodW1ibmFpbCA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9ICcnCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGlmIG5vdCBpdGVtKCdmYW5hcnQnKToKICAgICAgICAgICAgICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCd1c2VfdGh1bWInKSA9PSAidHJ1ZSI6CiAgICAgICAgICAgICAgICAgICAgICAgIGZhbkFydCA9IHRodW1ibmFpbAogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIGZhbkFydCA9IGZhbmFydAogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBmYW5BcnQgPSBpdGVtKCdmYW5hcnQnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgIGlmIGZhbkFydCA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIGZhbkFydCA9IGZhbmFydAogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBkZXNjID0gaXRlbSgnaW5mbycpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgaWYgZGVzYyA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIGRlc2MgPSAnJwoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgZ2VucmUgPSBpdGVtKCdnZW5yZScpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgaWYgZ2VucmUgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICByYWlzZQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBnZW5yZSA9ICcnCgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBkYXRlID0gaXRlbSgnZGF0ZScpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgaWYgZGF0ZSA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIGRhdGUgPSAnJwoKICAgICAgICAgICAgcmVnZXhzID0gTm9uZQogICAgICAgICAgICBpZiBpdGVtKCdyZWdleCcpOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIHJlZ19pdGVtID0gaXRlbSgncmVnZXgnKQogICAgICAgICAgICAgICAgICAgIHJlZ2V4cyA9IHBhcnNlX3JlZ2V4KHJlZ19pdGVtKQogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgaWYgbGVuKHVybCkgPiAxOgogICAgICAgICAgICAgICAgICAgIGFsdCA9IDAKICAgICAgICAgICAgICAgICAgICBwbGF5bGlzdCA9IFtdCiAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gdXJsOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgIGFkZF9wbGF5bGlzdCA9PSAiZmFsc2UiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsdCArPSAxCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkTGluayhpLCclcykgJXMnICUoYWx0LCBuYW1lLmVuY29kZSgndXRmLTgnLCAnaWdub3JlJykpLHRodW1ibmFpbCxmYW5BcnQsZGVzYyxnZW5yZSxkYXRlLFRydWUscGxheWxpc3QscmVnZXhzLHRvdGFsKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiAgYWRkX3BsYXlsaXN0ID09ICJ0cnVlIiBhbmQgIGFza19wbGF5bGlzdF9pdGVtcyA9PSAndHJ1ZSc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgcmVnZXhzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGF5bGlzdC5hcHBlbmQoaSsnJnJlZ2V4cz0nK3JlZ2V4cykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGlmICBhbnkoeCBpbiBpIGZvciB4IGluIHJlc29sdmVfdXJsKSBhbmQgIGkuc3RhcnRzd2l0aCgnaHR0cCcpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGF5bGlzdC5hcHBlbmQoaSsnJm1vZGU9MTknKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYXlsaXN0LmFwcGVuZChpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGF5bGlzdC5hcHBlbmQoaSkKICAgICAgICAgICAgICAgICAgICBpZiBsZW4ocGxheWxpc3QpID4gMToKICAgICAgICAgICAgICAgICAgICAgICAgYWRkTGluaygnJywgbmFtZSx0aHVtYm5haWwsZmFuQXJ0LGRlc2MsZ2VucmUsZGF0ZSxUcnVlLHBsYXlsaXN0LHJlZ2V4cyx0b3RhbCkKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgaWYgaXNYTUxTb3VyY2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgcmVnZXhzID09IE5vbmU6ICM8ZXh0ZXJuYWxsaW5rPiBhbmQgPHJlZ2V4PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLmVuY29kZSgndXRmLTgnKSxleHRfdXJsWzBdLmVuY29kZSgndXRmLTgnKSwxLHRodW1ibmFpbCxmYW5hcnQsZGVzYyxnZW5yZSxkYXRlLE5vbmUsJyEhdXBkYXRlJyxyZWdleHMsdXJsWzBdLmVuY29kZSgndXRmLTgnKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjYWRkTGluayh1cmxbMF0sbmFtZS5lbmNvZGUoJ3V0Zi04JywgJ2lnbm9yZScpKyAgJ1tDT0xPUiB5ZWxsb3ddYnVpbGQgWE1MWy9DT0xPUl0nLHRodW1ibmFpbCxmYW5BcnQsZGVzYyxnZW5yZSxkYXRlLFRydWUsTm9uZSxyZWdleHMsdG90YWwpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLmVuY29kZSgndXRmLTgnKSxleHRfdXJsWzBdLmVuY29kZSgndXRmLTgnKSwxLHRodW1ibmFpbCxmYW5hcnQsZGVzYyxnZW5yZSxkYXRlLE5vbmUsJ3NvdXJjZScsTm9uZSxOb25lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICNhZGREaXIobmFtZS5lbmNvZGUoJ3V0Zi04JyksdXJsWzBdLmVuY29kZSgndXRmLTgnKSwxLHRodW1ibmFpbCxmYW5hcnQsZGVzYyxnZW5yZSxkYXRlLE5vbmUsJ3NvdXJjZScpCiAgICAgICAgICAgICAgICAgICAgZWxpZiBpc0pzb25ycGM6CiAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLmVuY29kZSgndXRmLTgnKSxleHRfdXJsWzBdLDUzLHRodW1ibmFpbCxmYW5hcnQsZGVzYyxnZW5yZSxkYXRlLE5vbmUsJ3NvdXJjZScpCiAgICAgICAgICAgICAgICAgICAgICAgICN4Ym1jLmV4ZWN1dGVidWlsdGluKCJDb250YWluZXIuU2V0Vmlld01vZGUoNTAwKSIpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgYWRkTGluayh1cmxbMF0sbmFtZS5lbmNvZGUoJ3V0Zi04JywgJ2lnbm9yZScpLHRodW1ibmFpbCxmYW5BcnQsZGVzYyxnZW5yZSxkYXRlLFRydWUsTm9uZSxyZWdleHMsdG90YWwpCiAgICAgICAgICAgICAgICAgICAgI3ByaW50ICdzdWNjZXNzJwogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBhZGRvbl9sb2coJ1RoZXJlIHdhcyBhIHByb2JsZW0gYWRkaW5nIGl0ZW0gLSAnK25hbWUuZW5jb2RlKCd1dGYtOCcsICdpZ25vcmUnKSkKCmRlZiBwYXJzZV9yZWdleChyZWdfaXRlbSk6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgcmVnZXhzID0ge30KICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiByZWdfaXRlbToKICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddID0ge30KICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWyduYW1lJ109aSgnbmFtZScpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICAjcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydleHByZXMnXSA9IGkoJ2V4cHJlcycpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ2V4cHJlcyddID0gaSgnZXhwcmVzJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydleHByZXMnXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ2V4cHJlcyddPScnCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vIFJlZmVyZXIgLS0iKQogICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ3BhZ2UnXSA9IGkoJ3BhZ2UnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydyZWZlcmVyJ10gPSBpKCdyZWZlcmVyJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vIFJlZmVyZXIgLS0iKQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ2Nvbm5lY3Rpb24nXSA9IGkoJ2Nvbm5lY3Rpb24nKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm8gY29ubmVjdGlvbiAtLSIpCgogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ25vdHBsYXlhYmxlJ10gPSBpKCdub3RwbGF5YWJsZScpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBObyBub3RwbGF5YWJsZSAtLSIpCgogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ25vcmVkaXJlY3QnXSA9IGkoJ25vcmVkaXJlY3QnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm8gbm9yZWRpcmVjdCAtLSIpCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnb3JpZ2luJ10gPSBpKCdvcmlnaW4nKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm8gb3JpZ2luIC0tIikKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydhY2NlcHQnXSA9IGkoJ2FjY2VwdCcpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBObyBhY2NlcHQgLS0iKQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ2luY2x1ZGVoZWFkZXJzJ10gPSBpKCdpbmNsdWRlaGVhZGVycycpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBObyBpbmNsdWRlaGVhZGVycyAtLSIpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnbGlzdHJlcGVhdCddID0gaSgnbGlzdHJlcGVhdCcpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ2xpc3RyZXBlYXQnLHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnbGlzdHJlcGVhdCddLGkoJ2xpc3RyZXBlYXQnKVswXS5zdHJpbmcsIGkKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm8gbGlzdHJlcGVhdCAtLSIpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsncHJveHknXSA9IGkoJ3Byb3h5JylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vIHByb3h5IC0tIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ3gtcmVxJ10gPSBpKCd4LXJlcScpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBObyB4LXJlcSAtLSIpCgogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ3gtYWRkciddID0gaSgneC1hZGRyJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vIHgtYWRkciAtLSIpICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsneC1mb3J3YXJkJ10gPSBpKCd4LWZvcndhcmQnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm8geC1mb3J3YXJkIC0tIikKCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnYWdlbnQnXSA9IGkoJ2FnZW50JylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vIFVzZXIgQWdlbnQgLS0iKQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ3Bvc3QnXSA9IGkoJ3Bvc3QnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm90IGEgcG9zdCIpCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsncmF3cG9zdCddID0gaSgncmF3cG9zdCcpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBOb3QgYSByYXdwb3N0IikKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydodG1sdW5lc2NhcGUnXSA9IGkoJ2h0bWx1bmVzY2FwZScpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBOb3QgYSBodG1sdW5lc2NhcGUiKQoKCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsncmVhZGNvb2tpZW9ubHknXSA9IGkoJ3JlYWRjb29raWVvbmx5JylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vdCBhIHJlYWRDb29raWVPbmx5IikKICAgICAgICAgICAgICAgICAgICAgICAgI3ByaW50IGkKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydjb29raWVqYXInXSA9IGkoJ2Nvb2tpZWphcicpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnY29va2llamFyJ106CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydjb29raWVqYXInXT0nJwogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBOb3QgYSBjb29raWVKYXIiKQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ3NldGNvb2tpZSddID0gaSgnc2V0Y29va2llJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vdCBhIHNldGNvb2tpZSIpCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnYXBwZW5kY29va2llJ10gPSBpKCdhcHBlbmRjb29raWUnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm90IGEgYXBwZW5kY29va2llIikKCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnaWdub3JlY2FjaGUnXSA9IGkoJ2lnbm9yZWNhY2hlJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIG5vIGlnbm9yZWNhY2hlIikKICAgICAgICAgICAgICAgICAgICAgICAgI3RyeToKICAgICAgICAgICAgICAgICAgICAgICAgIyAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ2lnbm9yZWNhY2hlJ10gPSBpKCdpZ25vcmVjYWNoZScpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICAjZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAjICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIG5vIGlnbm9yZWNhY2hlIikKCiAgICAgICAgICAgICAgICAgICAgcmVnZXhzID0gdXJsbGliLnF1b3RlKHJlcHIocmVnZXhzKSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVnZXhzCiAgICAgICAgICAgICAgICAgICAgI3ByaW50IHJlZ2V4cwogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIHJlZ2V4cyA9IE5vbmUKICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coJ3JlZ2V4IEVycm9yOiAnK25hbWUuZW5jb2RlKCd1dGYtOCcsICdpZ25vcmUnKSkKI2NvcGllcyBmcm9tIGxhbWRhJ3MgaW1wbGVtZW50YXRpb24KZGVmIGdldF91c3RyZWFtKHVybCk6CiAgICB0cnk6CiAgICAgICAgZm9yIGkgaW4gcmFuZ2UoMSwgNTEpOgogICAgICAgICAgICByZXN1bHQgPSBnZXRVcmwodXJsKQogICAgICAgICAgICBpZiAiRVhULVgtU1RSRUFNLUlORiIgaW4gcmVzdWx0OiByZXR1cm4gdXJsCiAgICAgICAgICAgIGlmIG5vdCAiRVhUTTNVIiBpbiByZXN1bHQ6IHJldHVybgogICAgICAgICAgICB4Ym1jLnNsZWVwKDIwMDApCiAgICAgICAgcmV0dXJuCiAgICBleGNlcHQ6CiAgICAgICAgcmV0dXJuCgpkZWYgZ2V0UmVnZXhQYXJzZWQocmVnZXhzLCB1cmwsY29va2llSmFyPU5vbmUsZm9yQ29va2llSmFyT25seT1GYWxzZSxyZWN1cnNpdmVDYWxsPUZhbHNlLGNhY2hlZFBhZ2VzPXt9LCByYXdQb3N0PUZhbHNlLCBjb29raWVfamFyX2ZpbGU9Tm9uZSk6IzAsMSwyID0gVVJMLCByZWdleE9ubHksIENvb2tpZUphck9ubHkKICAgICAgICBpZiBub3QgcmVjdXJzaXZlQ2FsbDoKICAgICAgICAgICAgcmVnZXhzID0gZXZhbCh1cmxsaWIudW5xdW90ZShyZWdleHMpKQogICAgICAgICNjYWNoZWRQYWdlcyA9IHt9CiAgICAgICAgI3ByaW50ICd1cmwnLHVybAogICAgICAgIGRvUmVnZXhzID0gcmUuY29tcGlsZSgnXCRkb3JlZ2V4XFsoW15cXV0qKVxdJykuZmluZGFsbCh1cmwpCiMgICAgICAgIHByaW50ICdkb1JlZ2V4cycsZG9SZWdleHMscmVnZXhzCiAgICAgICAgc2V0cmVzb2x2ZWQ9VHJ1ZQogICAgICAgIGZvciBrIGluIGRvUmVnZXhzOgogICAgICAgICAgICBpZiBrIGluIHJlZ2V4czoKICAgICAgICAgICAgICAgICNwcmludCAncHJvY2Vzc2luZyAnICxrCiAgICAgICAgICAgICAgICBtID0gcmVnZXhzW2tdCiAgICAgICAgICAgICAgICAjcHJpbnQgbQogICAgICAgICAgICAgICAgY29va2llSmFyUGFyYW09RmFsc2UKICAgICAgICAgICAgICAgIGlmICAnY29va2llamFyJyBpbiBtOiAjIHNvIGVpdGhlciBjcmVhdGUgb3IgcmV1c2UgZXhpc3RpbmcgamFyCiAgICAgICAgICAgICAgICAgICAgI3ByaW50ICdjb29raWVqYXIgZXhpc3RzJyxtWydjb29raWVqYXInXQogICAgICAgICAgICAgICAgICAgIGNvb2tpZUphclBhcmFtPW1bJ2Nvb2tpZWphciddCiAgICAgICAgICAgICAgICAgICAgaWYgICckZG9yZWdleCcgaW4gY29va2llSmFyUGFyYW06CiAgICAgICAgICAgICAgICAgICAgICAgIGNvb2tpZUphcj1nZXRSZWdleFBhcnNlZChyZWdleHMsIG1bJ2Nvb2tpZWphciddLGNvb2tpZUphcixUcnVlLCBUcnVlLGNhY2hlZFBhZ2VzKQogICAgICAgICAgICAgICAgICAgICAgICBjb29raWVKYXJQYXJhbT1UcnVlCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgY29va2llSmFyUGFyYW09VHJ1ZQogICAgICAgICAgICAgICAgI3ByaW50ICdtW2Nvb2tpZWphcl0nLG1bJ2Nvb2tpZWphciddLGNvb2tpZUphcgogICAgICAgICAgICAgICAgaWYgY29va2llSmFyUGFyYW06CiAgICAgICAgICAgICAgICAgICAgaWYgY29va2llSmFyPT1Ob25lOgogICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ2NyZWF0ZSBjb29raWUgamFyJwogICAgICAgICAgICAgICAgICAgICAgICBjb29raWVfamFyX2ZpbGU9Tm9uZQogICAgICAgICAgICAgICAgICAgICAgICBpZiAnb3BlblsnIGluIG1bJ2Nvb2tpZWphciddOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29va2llX2phcl9maWxlPW1bJ2Nvb2tpZWphciddLnNwbGl0KCdvcGVuWycpWzFdLnNwbGl0KCddJylbMF0KCiAgICAgICAgICAgICAgICAgICAgICAgIGNvb2tpZUphcj1nZXRDb29raWVKYXIoY29va2llX2phcl9maWxlKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBjb29raWVfamFyX2ZpbGU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYXZlQ29va2llSmFyKGNvb2tpZUphcixjb29raWVfamFyX2ZpbGUpCiAgICAgICAgICAgICAgICAgICAgICAgICNpbXBvcnQgY29va2llbGliCiAgICAgICAgICAgICAgICAgICAgICAgICNjb29raWVKYXIgPSBjb29raWVsaWIuTFdQQ29va2llSmFyKCkKICAgICAgICAgICAgICAgICAgICAgICAgI3ByaW50ICdjb29raWVKYXIgbmV3Jyxjb29raWVKYXIKICAgICAgICAgICAgICAgICAgICBlbGlmICdzYXZlWycgaW4gbVsnY29va2llamFyJ106CiAgICAgICAgICAgICAgICAgICAgICAgIGNvb2tpZV9qYXJfZmlsZT1tWydjb29raWVqYXInXS5zcGxpdCgnc2F2ZVsnKVsxXS5zcGxpdCgnXScpWzBdCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlX3BhdGg9b3MucGF0aC5qb2luKHByb2ZpbGUsY29va2llX2phcl9maWxlKQogICAgICAgICAgICAgICAgICAgICAgICBwcmludCAnY29tcGxldGVfcGF0aCcsY29tcGxldGVfcGF0aAogICAgICAgICAgICAgICAgICAgICAgICBzYXZlQ29va2llSmFyKGNvb2tpZUphcixjb29raWVfamFyX2ZpbGUpCiAgICAgICAgICAgICAgICBpZiAgbVsncGFnZSddIGFuZCAnJGRvcmVnZXgnIGluIG1bJ3BhZ2UnXToKICAgICAgICAgICAgICAgICAgICBtWydwYWdlJ109Z2V0UmVnZXhQYXJzZWQocmVnZXhzLCBtWydwYWdlJ10sY29va2llSmFyLHJlY3Vyc2l2ZUNhbGw9VHJ1ZSxjYWNoZWRQYWdlcz1jYWNoZWRQYWdlcykKCiAgICAgICAgICAgICAgICBpZiAnc2V0Y29va2llJyBpbiBtIGFuZCBtWydzZXRjb29raWUnXSBhbmQgJyRkb3JlZ2V4JyBpbiBtWydzZXRjb29raWUnXToKICAgICAgICAgICAgICAgICAgICBtWydzZXRjb29raWUnXT1nZXRSZWdleFBhcnNlZChyZWdleHMsIG1bJ3NldGNvb2tpZSddLGNvb2tpZUphcixyZWN1cnNpdmVDYWxsPVRydWUsY2FjaGVkUGFnZXM9Y2FjaGVkUGFnZXMpCiAgICAgICAgICAgICAgICBpZiAnYXBwZW5kY29va2llJyBpbiBtIGFuZCBtWydhcHBlbmRjb29raWUnXSBhbmQgJyRkb3JlZ2V4JyBpbiBtWydhcHBlbmRjb29raWUnXToKICAgICAgICAgICAgICAgICAgICBtWydhcHBlbmRjb29raWUnXT1nZXRSZWdleFBhcnNlZChyZWdleHMsIG1bJ2FwcGVuZGNvb2tpZSddLGNvb2tpZUphcixyZWN1cnNpdmVDYWxsPVRydWUsY2FjaGVkUGFnZXM9Y2FjaGVkUGFnZXMpCgoKICAgICAgICAgICAgICAgIGlmICAncG9zdCcgaW4gbSBhbmQgJyRkb3JlZ2V4JyBpbiBtWydwb3N0J106CiAgICAgICAgICAgICAgICAgICAgbVsncG9zdCddPWdldFJlZ2V4UGFyc2VkKHJlZ2V4cywgbVsncG9zdCddLGNvb2tpZUphcixyZWN1cnNpdmVDYWxsPVRydWUsY2FjaGVkUGFnZXM9Y2FjaGVkUGFnZXMpCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ3Bvc3QgaXMgbm93JyxtWydwb3N0J10KCiAgICAgICAgICAgICAgICBpZiAgJ3Jhd3Bvc3QnIGluIG0gYW5kICckZG9yZWdleCcgaW4gbVsncmF3cG9zdCddOgogICAgICAgICAgICAgICAgICAgIG1bJ3Jhd3Bvc3QnXT1nZXRSZWdleFBhcnNlZChyZWdleHMsIG1bJ3Jhd3Bvc3QnXSxjb29raWVKYXIscmVjdXJzaXZlQ2FsbD1UcnVlLGNhY2hlZFBhZ2VzPWNhY2hlZFBhZ2VzLHJhd1Bvc3Q9VHJ1ZSkKICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ3Jhd3Bvc3QgaXMgbm93JyxtWydyYXdwb3N0J10KCiAgICAgICAgICAgICAgICBpZiAncmF3cG9zdCcgaW4gbSBhbmQgJyRlcG9jdGltZSQnIGluIG1bJ3Jhd3Bvc3QnXToKICAgICAgICAgICAgICAgICAgICBtWydyYXdwb3N0J109bVsncmF3cG9zdCddLnJlcGxhY2UoJyRlcG9jdGltZSQnLGdldEVwb2NUaW1lKCkpCgogICAgICAgICAgICAgICAgaWYgJ3Jhd3Bvc3QnIGluIG0gYW5kICckZXBvY3RpbWUyJCcgaW4gbVsncmF3cG9zdCddOgogICAgICAgICAgICAgICAgICAgIG1bJ3Jhd3Bvc3QnXT1tWydyYXdwb3N0J10ucmVwbGFjZSgnJGVwb2N0aW1lMiQnLGdldEVwb2NUaW1lMigpKQoKCiAgICAgICAgICAgICAgICBsaW5rPScnCiAgICAgICAgICAgICAgICBpZiBtWydwYWdlJ10gYW5kIG1bJ3BhZ2UnXSBpbiBjYWNoZWRQYWdlcyBhbmQgbm90ICdpZ25vcmVjYWNoZScgaW4gbSBhbmQgZm9yQ29va2llSmFyT25seT09RmFsc2UgOgogICAgICAgICAgICAgICAgICAgIGxpbmsgPSBjYWNoZWRQYWdlc1ttWydwYWdlJ11dCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGlmIG1bJ3BhZ2UnXSBhbmQgIG5vdCBtWydwYWdlJ109PScnIGFuZCAgbVsncGFnZSddLnN0YXJ0c3dpdGgoJ2h0dHAnKToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgJyRlcG9jdGltZSQnIGluIG1bJ3BhZ2UnXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1bJ3BhZ2UnXT1tWydwYWdlJ10ucmVwbGFjZSgnJGVwb2N0aW1lJCcsZ2V0RXBvY1RpbWUoKSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgJyRlcG9jdGltZTIkJyBpbiBtWydwYWdlJ106CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtWydwYWdlJ109bVsncGFnZSddLnJlcGxhY2UoJyRlcG9jdGltZTIkJyxnZXRFcG9jVGltZTIoKSkKCiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAnSW5nb3JpbmcgQ2FjaGUnLG1bJ3BhZ2UnXQogICAgICAgICAgICAgICAgICAgICAgICBwYWdlX3NwbGl0PW1bJ3BhZ2UnXS5zcGxpdCgnfCcpCiAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2VVcmw9cGFnZV9zcGxpdFswXQogICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJfaW5fcGFnZT1Ob25lCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGxlbihwYWdlX3NwbGl0KT4xOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyX2luX3BhZ2U9cGFnZV9zcGxpdFsxXQoKIyAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAKIyAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm94eSA9IHVybGxpYjIuUHJveHlIYW5kbGVyKHsgKCdodHRwcycgPyBwcm94eXRvdXNlWzo1XT09Imh0dHBzIjoiaHR0cCIpIDogcHJveHl0b3VzZX0pCiMgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlbmVyID0gdXJsbGliMi5idWlsZF9vcGVuZXIocHJveHkpCiMgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsbGliMi5pbnN0YWxsX29wZW5lcihvcGVuZXIpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIAojICAgICAgICAgICAgICAgICAgICAgICAgaW1wb3J0IHVybGxpYjIKIyAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICd1cmxsaWIyLmdldHByb3hpZXMnLHVybGxpYjIuZ2V0cHJveGllcygpCiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRfcHJveGllcz11cmxsaWIyLlByb3h5SGFuZGxlcih1cmxsaWIyLmdldHByb3hpZXMoKSkKICAgICAgICAKICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcSA9IHVybGxpYjIuUmVxdWVzdChwYWdlVXJsKQogICAgICAgICAgICAgICAgICAgICAgICBpZiAncHJveHknIGluIG06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm94eXRvdXNlPSBtWydwcm94eSddCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCAncHJveHl0b3VzZScscHJveHl0b3VzZQojICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybGxpYjIuZ2V0cHJveGllcz0gbGFtYmRhOiB7fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgcGFnZVVybFs6NV09PSJodHRwcyI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJveHkgPSB1cmxsaWIyLlByb3h5SGFuZGxlcih7ICdodHRwcycgOiBwcm94eXRvdXNlfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjcmVxLnNldF9wcm94eShwcm94eXRvdXNlLCAnaHR0cHMnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm94eSA9IHVybGxpYjIuUHJveHlIYW5kbGVyKHsgJ2h0dHAnICA6IHByb3h5dG91c2V9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICNyZXEuc2V0X3Byb3h5KHByb3h5dG91c2UsICdodHRwJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wZW5lciA9IHVybGxpYjIuYnVpbGRfb3BlbmVyKHByb3h5KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsbGliMi5pbnN0YWxsX29wZW5lcihvcGVuZXIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5hZGRfaGVhZGVyKCdVc2VyLUFnZW50JywgJ01vemlsbGEvNS4wIChXaW5kb3dzIE5UIDYuMTsgcnY6MTQuMCkgR2Vja28vMjAxMDAxMDEgRmlyZWZveC8xNC4wLjEnKQogICAgICAgICAgICAgICAgICAgICAgICBwcm94eXRvdXNlPU5vbmUKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdyZWZlcmVyJyBpbiBtOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ1JlZmVyZXInLCBtWydyZWZlcmVyJ10pCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdhY2NlcHQnIGluIG06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXEuYWRkX2hlYWRlcignQWNjZXB0JywgbVsnYWNjZXB0J10pCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdhZ2VudCcgaW4gbToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5hZGRfaGVhZGVyKCdVc2VyLWFnZW50JywgbVsnYWdlbnQnXSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ3gtcmVxJyBpbiBtOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ1gtUmVxdWVzdGVkLVdpdGgnLCBtWyd4LXJlcSddKQogICAgICAgICAgICAgICAgICAgICAgICBpZiAneC1hZGRyJyBpbiBtOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ3gtYWRkcicsIG1bJ3gtYWRkciddKQogICAgICAgICAgICAgICAgICAgICAgICBpZiAneC1mb3J3YXJkJyBpbiBtOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ1gtRm9yd2FyZGVkLUZvcicsIG1bJ3gtZm9yd2FyZCddKQogICAgICAgICAgICAgICAgICAgICAgICBpZiAnc2V0Y29va2llJyBpbiBtOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ2FkZGluZyBjb29raWUnLG1bJ3NldGNvb2tpZSddCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXEuYWRkX2hlYWRlcignQ29va2llJywgbVsnc2V0Y29va2llJ10pCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdhcHBlbmRjb29raWUnIGluIG06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCAnYXBwZW5kaW5nIGNvb2tpZSB0byBjb29raWVqYXInLG1bJ2FwcGVuZGNvb2tpZSddCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb29raWVzdG9BcGVuZD1tWydhcHBlbmRjb29raWUnXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29va2llc3RvQXBlbmQ9Y29va2llc3RvQXBlbmQuc3BsaXQoJzsnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGggaW4gY29va2llc3RvQXBlbmQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbix2PWguc3BsaXQoJz0nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHcsbj0gbi5zcGxpdCgnOicpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2sgPSBjb29raWVsaWIuQ29va2llKHZlcnNpb249MCwgbmFtZT1uLCB2YWx1ZT12LCBwb3J0PU5vbmUsIHBvcnRfc3BlY2lmaWVkPUZhbHNlLCBkb21haW49dywgZG9tYWluX3NwZWNpZmllZD1GYWxzZSwgZG9tYWluX2luaXRpYWxfZG90PUZhbHNlLCBwYXRoPScvJywgcGF0aF9zcGVjaWZpZWQ9VHJ1ZSwgc2VjdXJlPUZhbHNlLCBleHBpcmVzPU5vbmUsIGRpc2NhcmQ9VHJ1ZSwgY29tbWVudD1Ob25lLCBjb21tZW50X3VybD1Ob25lLCByZXN0PXsnSHR0cE9ubHknOiBOb25lfSwgcmZjMjEwOT1GYWxzZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb29raWVKYXIuc2V0X2Nvb2tpZShjaykKICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ29yaWdpbicgaW4gbToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5hZGRfaGVhZGVyKCdPcmlnaW4nLCBtWydvcmlnaW4nXSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgaGVhZGVyX2luX3BhZ2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJfaW5fcGFnZT1oZWFkZXJfaW5fcGFnZS5zcGxpdCgnJicpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgaCBpbiBoZWFkZXJfaW5fcGFnZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuLHY9aC5zcGxpdCgnPScpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxLmFkZF9oZWFkZXIobix2KQogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgY29va2llSmFyPT1Ob25lOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgI3ByaW50ICdjb29raWVKYXJWYWwnLGNvb2tpZUphcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29va2llX2hhbmRsZXIgPSB1cmxsaWIyLkhUVFBDb29raWVQcm9jZXNzb3IoY29va2llSmFyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlbmVyID0gdXJsbGliMi5idWlsZF9vcGVuZXIoY29va2llX2hhbmRsZXIsIHVybGxpYjIuSFRUUEJhc2ljQXV0aEhhbmRsZXIoKSwgdXJsbGliMi5IVFRQSGFuZGxlcigpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlbmVyID0gdXJsbGliMi5pbnN0YWxsX29wZW5lcihvcGVuZXIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCAnbm9yZWRpcmVjdCcsJ25vcmVkaXJlY3QnIGluIG0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ25vcmVkaXJlY3QnIGluIG06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlbmVyMiA9IHVybGxpYjIuYnVpbGRfb3BlbmVyKE5vUmVkaXJlY3Rpb24pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlbmVyID0gdXJsbGliMi5pbnN0YWxsX29wZW5lcihvcGVuZXIyKQoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ2Nvbm5lY3Rpb24nIGluIG06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCAnLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi5jb25uZWN0aW9uLy8vLy8vLicsbVsnY29ubmVjdGlvbiddCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmcm9tIGtlZXBhbGl2ZSBpbXBvcnQgSFRUUEhhbmRsZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtlZXBhbGl2ZV9oYW5kbGVyID0gSFRUUEhhbmRsZXIoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlbmVyID0gdXJsbGliMi5idWlsZF9vcGVuZXIoa2VlcGFsaXZlX2hhbmRsZXIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmxsaWIyLmluc3RhbGxfb3BlbmVyKG9wZW5lcikKCgogICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ2FmdGVyIGNvb2tpZSBqYXInCiAgICAgICAgICAgICAgICAgICAgICAgIHBvc3Q9Tm9uZQoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ3Bvc3QnIGluIG06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3N0RGF0YT1tWydwb3N0J10KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICckTGl2ZVN0cmVhbVJlY2FwdGNoYScgaW4gcG9zdERhdGE6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGNhcHRjaGFfY2hhbGxlbmdlLGNhdHBjaGFfd29yZCk9cHJvY2Vzc1JlY2FwdGNoYShtWydwYWdlJ10pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgY2FwdGNoYV9jaGFsbGVuZ2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc3REYXRhKz0ncmVjYXB0Y2hhX2NoYWxsZW5nZV9maWVsZDonK2NhcHRjaGFfY2hhbGxlbmdlKycscmVjYXB0Y2hhX3Jlc3BvbnNlX2ZpZWxkOicrY2F0cGNoYV93b3JkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcGxpdHBvc3Q9cG9zdERhdGEuc3BsaXQoJywnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc3Q9e30KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBwIGluIHNwbGl0cG9zdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuPXAuc3BsaXQoJzonKVswXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2PXAuc3BsaXQoJzonKVsxXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3N0W25dPXYKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc3QgPSB1cmxsaWIudXJsZW5jb2RlKHBvc3QpCgogICAgICAgICAgICAgICAgICAgICAgICBpZiAncmF3cG9zdCcgaW4gbToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc3Q9bVsncmF3cG9zdCddCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAnJExpdmVTdHJlYW1SZWNhcHRjaGEnIGluIHBvc3Q6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGNhcHRjaGFfY2hhbGxlbmdlLGNhdHBjaGFfd29yZCk9cHJvY2Vzc1JlY2FwdGNoYShtWydwYWdlJ10pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgY2FwdGNoYV9jaGFsbGVuZ2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zdCs9JyZyZWNhcHRjaGFfY2hhbGxlbmdlX2ZpZWxkPScrY2FwdGNoYV9jaGFsbGVuZ2UrJyZyZWNhcHRjaGFfcmVzcG9uc2VfZmllbGQ9JytjYXRwY2hhX3dvcmQKICAgICAgICAgICAgICAgICAgICAgICAgaWYgcG9zdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gdXJsbGliMi51cmxvcGVuKHJlcSxwb3N0KQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UgPSB1cmxsaWIyLnVybG9wZW4ocmVxKQoKICAgICAgICAgICAgICAgICAgICAgICAgbGluayA9IHJlc3BvbnNlLnJlYWQoKQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ3Byb3h5JyBpbiBtIGFuZCBub3QgY3VycmVudF9wcm94aWVzIGlzIE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmxsaWIyLmluc3RhbGxfb3BlbmVyKHVybGxpYjIuYnVpbGRfb3BlbmVyKGN1cnJlbnRfcHJveGllcykpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBsaW5rPWphdmFzY3JpcHRVbkVzY2FwZShsaW5rKQogICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgbGluayBUaGlzIGp1c3QgcHJpbnQgd2hvbGUgd2VicGFnZSBpbiBMT0cKICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ2luY2x1ZGVoZWFkZXJzJyBpbiBtOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgI2xpbmsrPXN0cihyZXNwb25zZS5oZWFkZXJzLmdldCgnU2V0LUNvb2tpZScpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluays9JyQkSEVBREVSU19TVEFSVCQkOicKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBiIGluIHJlc3BvbnNlLmhlYWRlcnM6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluays9IGIrJzonK3Jlc3BvbnNlLmhlYWRlcnMuZ2V0KGIpKydcbicKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmsrPSckJEhFQURFUlNfRU5EJCQ6JwojICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgbGluawogICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2cobGluaykKICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKGNvb2tpZUphciApCgogICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5jbG9zZSgpCiAgICAgICAgICAgICAgICAgICAgICAgIGNhY2hlZFBhZ2VzW21bJ3BhZ2UnXV0gPSBsaW5rCiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCBsaW5rCiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAnc3RvcmUgbGluayBmb3InLG1bJ3BhZ2UnXSxmb3JDb29raWVKYXJPbmx5CgogICAgICAgICAgICAgICAgICAgICAgICBpZiBmb3JDb29raWVKYXJPbmx5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvb2tpZUphciMgZG8gbm90aGluZwogICAgICAgICAgICAgICAgICAgIGVsaWYgbVsncGFnZSddIGFuZCAgbm90IG1bJ3BhZ2UnXS5zdGFydHN3aXRoKCdodHRwJyk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG1bJ3BhZ2UnXS5zdGFydHN3aXRoKCckcHlGdW5jdGlvbjonKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbD1kb0V2YWwobVsncGFnZSddLnNwbGl0KCckcHlGdW5jdGlvbjonKVsxXSwnJyxjb29raWVKYXIsbSApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBmb3JDb29raWVKYXJPbmx5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjb29raWVKYXIjIGRvIG5vdGhpbmcKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbms9dmFsCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5rPW1bJ3BhZ2UnXQogICAgICAgICAgICAgICAgaWYgJyRweUZ1bmN0aW9uOnBsYXltZWRpYSgnIGluIG1bJ2V4cHJlcyddIG9yICdBY3RpdmF0ZVdpbmRvdycgIGluIG1bJ2V4cHJlcyddICBvciAnJFBMQVlFUlBST1hZJD0nIGluIHVybCAgb3IgIGFueSh4IGluIHVybCBmb3IgeCBpbiBnX2lnbm9yZVNldFJlc29sdmVkKToKICAgICAgICAgICAgICAgICAgICBzZXRyZXNvbHZlZD1GYWxzZQogICAgICAgICAgICAgICAgaWYgICckZG9yZWdleCcgaW4gbVsnZXhwcmVzJ106CiAgICAgICAgICAgICAgICAgICAgbVsnZXhwcmVzJ109Z2V0UmVnZXhQYXJzZWQocmVnZXhzLCBtWydleHByZXMnXSxjb29raWVKYXIscmVjdXJzaXZlQ2FsbD1UcnVlLGNhY2hlZFBhZ2VzPWNhY2hlZFBhZ2VzKQogICAgICAgICAgICAgICAgaWYgbm90IG1bJ2V4cHJlcyddPT0nJzoKICAgICAgICAgICAgICAgICAgICBwcmludCAnZG9pbmcgaXQgJyxtWydleHByZXMnXQogICAgICAgICAgICAgICAgICAgIGlmICckTGl2ZVN0cmVhbUNhcHRjaGEnIGluIG1bJ2V4cHJlcyddOgogICAgICAgICAgICAgICAgICAgICAgICB2YWw9YXNrQ2FwdGNoYShtLGxpbmssY29va2llSmFyKQogICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ3VybCBhbmQgdmFsJyx1cmwsdmFsCiAgICAgICAgICAgICAgICAgICAgICAgIHVybCA9IHVybC5yZXBsYWNlKCIkZG9yZWdleFsiICsgayArICJdIiwgdmFsKQogICAgICAgICAgICAgICAgICAgIGVsaWYgbVsnZXhwcmVzJ10uc3RhcnRzd2l0aCgnJHB5RnVuY3Rpb246Jykgb3IgJyMkcHlGdW5jdGlvbicgaW4gbVsnZXhwcmVzJ106CiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAnZXhwZWVlZWVlZWVlZWVlZWVlZWVlZScsbVsnZXhwcmVzJ10KICAgICAgICAgICAgICAgICAgICAgICAgaWYgbVsnZXhwcmVzJ10uc3RhcnRzd2l0aCgnJHB5RnVuY3Rpb246Jyk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWw9ZG9FdmFsKG1bJ2V4cHJlcyddLnNwbGl0KCckcHlGdW5jdGlvbjonKVsxXSxsaW5rLGNvb2tpZUphcixtKQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsPWRvRXZhbEZ1bmN0aW9uKG1bJ2V4cHJlcyddLGxpbmssY29va2llSmFyLG0pCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdBY3RpdmF0ZVdpbmRvdycgaW4gbVsnZXhwcmVzJ106IHJldHVybgogICAgICAgICAgICAgICAgICAgICAgICBwcmludCAndXJsIGsgdmFsJyx1cmwsayx2YWwKCiAgICAgICAgICAgICAgICAgICAgICAgIHVybCA9IHVybC5yZXBsYWNlKCIkZG9yZWdleFsiICsgayArICJdIiwgdmFsKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdsaXN0cmVwZWF0JyBpbiBtOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlzdHJlcGVhdD1tWydsaXN0cmVwZWF0J10KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldD1yZS5maW5kYWxsKG1bJ2V4cHJlcyddLGxpbmspCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbGlzdHJlcGVhdCxyZXQsIG0scmVnZXhzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBsaW5rPT0nJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAnbGluaycsbGluawogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnID0gcmUuY29tcGlsZShtWydleHByZXMnXSkuc2VhcmNoKGxpbmspCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWw9JycKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWw9cmVnLmdyb3VwKDEpLnN0cmlwKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDogdHJhY2ViYWNrLnByaW50X2V4YygpCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWw9bVsnZXhwcmVzJ10KICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpZiByYXdQb3N0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ3Jhd3Bvc3QnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWw9dXJsbGliLnF1b3RlX3BsdXModmFsKQogICAgICAgICAgICAgICAgICAgICAgICBpZiAnaHRtbHVuZXNjYXBlJyBpbiBtOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgI3ZhbD11cmxsaWIudW5xdW90ZV9wbHVzKHZhbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltcG9ydCBIVE1MUGFyc2VyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWw9SFRNTFBhcnNlci5IVE1MUGFyc2VyKCkudW5lc2NhcGUodmFsKQogICAgICAgICAgICAgICAgICAgICAgICB1cmwgPSB1cmwucmVwbGFjZSgiJGRvcmVnZXhbIiArIGsgKyAiXSIsIHZhbCkKICAgICAgICAgICAgICAgICAgICAgICAgI3JldHVybiB2YWwKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgdXJsID0gdXJsLnJlcGxhY2UoIiRkb3JlZ2V4WyIgKyBrICsgIl0iLCcnKQogICAgICAgIGlmICckZXBvY3RpbWUkJyBpbiB1cmw6CiAgICAgICAgICAgIHVybD11cmwucmVwbGFjZSgnJGVwb2N0aW1lJCcsZ2V0RXBvY1RpbWUoKSkKICAgICAgICBpZiAnJGVwb2N0aW1lMiQnIGluIHVybDoKICAgICAgICAgICAgdXJsPXVybC5yZXBsYWNlKCckZXBvY3RpbWUyJCcsZ2V0RXBvY1RpbWUyKCkpCgogICAgICAgIGlmICckR1VJRCQnIGluIHVybDoKICAgICAgICAgICAgaW1wb3J0IHV1aWQKICAgICAgICAgICAgdXJsPXVybC5yZXBsYWNlKCckR1VJRCQnLHN0cih1dWlkLnV1aWQxKCkpLnVwcGVyKCkpCiAgICAgICAgaWYgJyRnZXRfY29va2llcyQnIGluIHVybDoKICAgICAgICAgICAgdXJsPXVybC5yZXBsYWNlKCckZ2V0X2Nvb2tpZXMkJyxnZXRDb29raWVzU3RyaW5nKGNvb2tpZUphcikpCgogICAgICAgIGlmIHJlY3Vyc2l2ZUNhbGw6IHJldHVybiB1cmwKICAgICAgICBwcmludCAnZmluYWwgdXJsJyx1cmwKICAgICAgICBpZiB1cmw9PSIiOgogICAgICAgICAgICByZXR1cm4KICAgICAgICBlbHNlOgogICAgICAgICAgICByZXR1cm4gdXJsLHNldHJlc29sdmVkCmRlZiBnZXRtZDUodCk6CiAgICBpbXBvcnQgaGFzaGxpYgogICAgaD1oYXNobGliLm1kNSgpCiAgICBoLnVwZGF0ZSh0KQogICAgcmV0dXJuIGguaGV4ZGlnZXN0KCkKCmRlZiBkZWNyeXB0X3ZhdWdobmxpdmUoZW5jcnlwdGVkKToKICAgIHJldFZhbD0iIgogICAgcHJpbnQgJ2VuYycsZW5jcnlwdGVkCiAgICAjZm9yIHZhbCBpbiBlbmNyeXB0ZWQuc3BsaXQoJzonKToKICAgICMgICAgcmV0VmFsKz1jaHIoaW50KHZhbC5yZXBsYWNlKCIwbTAiLCIiKSkpCiAgICAjcmV0dXJuIHJldFZhbAoKZGVmIHBsYXltZWRpYShtZWRpYV91cmwpOgogICAgdHJ5OgogICAgICAgIGltcG9ydCAgQ3VzdG9tUGxheWVyCiAgICAgICAgcGxheWVyID0gQ3VzdG9tUGxheWVyLk15WEJNQ1BsYXllcigpCiAgICAgICAgbGlzdGl0ZW0gPSB4Ym1jZ3VpLkxpc3RJdGVtKCBsYWJlbCA9IHN0cihuYW1lKSwgaWNvbkltYWdlID0gIkRlZmF1bHRWaWRlby5wbmciLCB0aHVtYm5haWxJbWFnZSA9IHhibWMuZ2V0SW5mb0ltYWdlKCAiTGlzdEl0ZW0uVGh1bWIiICksIHBhdGg9bWVkaWFfdXJsICkKICAgICAgICBwbGF5ZXIucGxheSggbWVkaWFfdXJsLGxpc3RpdGVtKQogICAgICAgIHhibWMuc2xlZXAoMTAwMCkKICAgICAgICB3aGlsZSBwbGF5ZXIuaXNfYWN0aXZlOgogICAgICAgICAgICB4Ym1jLnNsZWVwKDIwMCkKICAgIGV4Y2VwdDoKICAgICAgICB0cmFjZWJhY2sucHJpbnRfZXhjKCkKICAgIHJldHVybiAnJwoKZGVmIGtvZGlKc29uUmVxdWVzdChwYXJhbXMpOgogICAgZGF0YSA9IGpzb24uZHVtcHMocGFyYW1zKQogICAgcmVxdWVzdCA9IHhibWMuZXhlY3V0ZUpTT05SUEMoZGF0YSkKCiAgICB0cnk6CiAgICAgICAgcmVzcG9uc2UgPSBqc29uLmxvYWRzKHJlcXVlc3QpCiAgICBleGNlcHQgVW5pY29kZURlY29kZUVycm9yOgogICAgICAgIHJlc3BvbnNlID0ganNvbi5sb2FkcyhyZXF1ZXN0LmRlY29kZSgndXRmLTgnLCAnaWdub3JlJykpCgogICAgdHJ5OgogICAgICAgIGlmICdyZXN1bHQnIGluIHJlc3BvbnNlOgogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2VbJ3Jlc3VsdCddCiAgICAgICAgcmV0dXJuIE5vbmUKICAgIGV4Y2VwdCBLZXlFcnJvcjoKICAgICAgICBsb2dnZXIud2FybigiWyVzXSAlcyIgJSAocGFyYW1zWydtZXRob2QnXSwgcmVzcG9uc2VbJ2Vycm9yJ11bJ21lc3NhZ2UnXSkpCiAgICAgICAgcmV0dXJuIE5vbmUKCgpkZWYgc2V0S29kaVByb3h5KHByb3h5c2V0dGluZ3M9Tm9uZSk6CgogICAgaWYgcHJveHlzZXR0aW5ncz09Tm9uZToKICAgICAgICBwcmludCAncHJveHkgc2V0IHRvIG5vdGhpbmcnCiAgICAgICAgeGJtYy5leGVjdXRlSlNPTlJQQygneyJqc29ucnBjIjoiMi4wIiwgIm1ldGhvZCI6IlNldHRpbmdzLlNldFNldHRpbmdWYWx1ZSIsICJwYXJhbXMiOnsic2V0dGluZyI6Im5ldHdvcmsudXNlaHR0cHByb3h5IiwgInZhbHVlIjpmYWxzZX0sICJpZCI6MX0nKQogICAgZWxzZToKICAgICAgICAKICAgICAgICBwcz1wcm94eXNldHRpbmdzLnNwbGl0KCc6JykKICAgICAgICBwcm94eVVSTD1wc1swXQogICAgICAgIHByb3h5UG9ydD1wc1sxXQogICAgICAgIHByb3h5VHlwZT1wc1syXQogICAgICAgIHByb3h5VXNlcm5hbWU9Tm9uZQogICAgICAgIHByb3h5UGFzc3dvcmQ9Tm9uZQogICAgICAgICAKICAgICAgICBpZiBsZW4ocHMpPjMgYW5kICdAJyBpbiBwcm94eXNldHRpbmdzOgogICAgICAgICAgICBwcm94eVVzZXJuYW1lPXBzWzNdCiAgICAgICAgICAgIHByb3h5UGFzc3dvcmQ9cHJveHlzZXR0aW5ncy5zcGxpdCgnQCcpWy0xXQoKICAgICAgICBwcmludCAncHJveHkgc2V0IHRvJywgcHJveHlUeXBlLCBwcm94eVVSTCxwcm94eVBvcnQKICAgICAgICB4Ym1jLmV4ZWN1dGVKU09OUlBDKCd7Impzb25ycGMiOiIyLjAiLCAibWV0aG9kIjoiU2V0dGluZ3MuU2V0U2V0dGluZ1ZhbHVlIiwgInBhcmFtcyI6eyJzZXR0aW5nIjoibmV0d29yay51c2VodHRwcHJveHkiLCAidmFsdWUiOnRydWV9LCAiaWQiOjF9JykKICAgICAgICB4Ym1jLmV4ZWN1dGVKU09OUlBDKCd7Impzb25ycGMiOiIyLjAiLCAibWV0aG9kIjoiU2V0dGluZ3MuU2V0U2V0dGluZ1ZhbHVlIiwgInBhcmFtcyI6eyJzZXR0aW5nIjoibmV0d29yay5odHRwcHJveHl0eXBlIiwgInZhbHVlIjonICsgc3RyKHByb3h5VHlwZSkgKyd9LCAiaWQiOjF9JykKICAgICAgICB4Ym1jLmV4ZWN1dGVKU09OUlBDKCd7Impzb25ycGMiOiIyLjAiLCAibWV0aG9kIjoiU2V0dGluZ3MuU2V0U2V0dGluZ1ZhbHVlIiwgInBhcmFtcyI6eyJzZXR0aW5nIjoibmV0d29yay5odHRwcHJveHlzZXJ2ZXIiLCAidmFsdWUiOiInICsgc3RyKHByb3h5VVJMKSArJyJ9LCAiaWQiOjF9JykKICAgICAgICB4Ym1jLmV4ZWN1dGVKU09OUlBDKCd7Impzb25ycGMiOiIyLjAiLCAibWV0aG9kIjoiU2V0dGluZ3MuU2V0U2V0dGluZ1ZhbHVlIiwgInBhcmFtcyI6eyJzZXR0aW5nIjoibmV0d29yay5odHRwcHJveHlwb3J0IiwgInZhbHVlIjonICsgc3RyKHByb3h5UG9ydCkgKyd9LCAiaWQiOjF9JykKICAgICAgICAKICAgICAgICAKICAgICAgICBpZiBub3QgcHJveHlVc2VybmFtZT09Tm9uZToKICAgICAgICAgICAgeGJtYy5leGVjdXRlSlNPTlJQQygneyJqc29ucnBjIjoiMi4wIiwgIm1ldGhvZCI6IlNldHRpbmdzLlNldFNldHRpbmdWYWx1ZSIsICJwYXJhbXMiOnsic2V0dGluZyI6Im5ldHdvcmsuaHR0cHByb3h5dXNlcm5hbWUiLCAidmFsdWUiOiInICsgc3RyKHByb3h5VXNlcm5hbWUpICsnIn0sICJpZCI6MX0nKQogICAgICAgICAgICB4Ym1jLmV4ZWN1dGVKU09OUlBDKCd7Impzb25ycGMiOiIyLjAiLCAibWV0aG9kIjoiU2V0dGluZ3MuU2V0U2V0dGluZ1ZhbHVlIiwgInBhcmFtcyI6eyJzZXR0aW5nIjoibmV0d29yay5odHRwcHJveHlwYXNzd29yZCIsICJ2YWx1ZSI6IicgKyBzdHIocHJveHlQYXNzd29yZCkgKycifSwgImlkIjoxfScpCgogICAgICAgIApkZWYgZ2V0Q29uZmlndXJlZFByb3h5KCk6CiAgICBwcm94eUFjdGl2ZSA9IGtvZGlKc29uUmVxdWVzdCh7J2pzb25ycGMnOiAnMi4wJywgIm1ldGhvZCI6IlNldHRpbmdzLkdldFNldHRpbmdWYWx1ZSIsICJwYXJhbXMiOnsic2V0dGluZyI6Im5ldHdvcmsudXNlaHR0cHByb3h5In0sICdpZCc6IDF9KVsndmFsdWUnXQogICAgcHJpbnQgJ3Byb3h5QWN0aXZlJyxwcm94eUFjdGl2ZQogICAgcHJveHlUeXBlID0ga29kaUpzb25SZXF1ZXN0KHsnanNvbnJwYyc6ICcyLjAnLCAibWV0aG9kIjoiU2V0dGluZ3MuR2V0U2V0dGluZ1ZhbHVlIiwgInBhcmFtcyI6eyJzZXR0aW5nIjoibmV0d29yay5odHRwcHJveHl0eXBlIn0sICdpZCc6IDF9KVsndmFsdWUnXQoKICAgIGlmIHByb3h5QWN0aXZlOiAjIFBST1hZX0hUVFAKICAgICAgICBwcm94eVVSTCA9IGtvZGlKc29uUmVxdWVzdCh7J2pzb25ycGMnOiAnMi4wJywgIm1ldGhvZCI6IlNldHRpbmdzLkdldFNldHRpbmdWYWx1ZSIsICJwYXJhbXMiOnsic2V0dGluZyI6Im5ldHdvcmsuaHR0cHByb3h5c2VydmVyIn0sICdpZCc6IDF9KVsndmFsdWUnXQogICAgICAgIHByb3h5UG9ydCA9IHVuaWNvZGUoa29kaUpzb25SZXF1ZXN0KHsnanNvbnJwYyc6ICcyLjAnLCAibWV0aG9kIjoiU2V0dGluZ3MuR2V0U2V0dGluZ1ZhbHVlIiwgInBhcmFtcyI6eyJzZXR0aW5nIjoibmV0d29yay5odHRwcHJveHlwb3J0In0sICdpZCc6IDF9KVsndmFsdWUnXSkKICAgICAgICBwcm94eVVzZXJuYW1lID0ga29kaUpzb25SZXF1ZXN0KHsnanNvbnJwYyc6ICcyLjAnLCAibWV0aG9kIjoiU2V0dGluZ3MuR2V0U2V0dGluZ1ZhbHVlIiwgInBhcmFtcyI6eyJzZXR0aW5nIjoibmV0d29yay5odHRwcHJveHl1c2VybmFtZSJ9LCAnaWQnOiAxfSlbJ3ZhbHVlJ10KICAgICAgICBwcm94eVBhc3N3b3JkID0ga29kaUpzb25SZXF1ZXN0KHsnanNvbnJwYyc6ICcyLjAnLCAibWV0aG9kIjoiU2V0dGluZ3MuR2V0U2V0dGluZ1ZhbHVlIiwgInBhcmFtcyI6eyJzZXR0aW5nIjoibmV0d29yay5odHRwcHJveHlwYXNzd29yZCJ9LCAnaWQnOiAxfSlbJ3ZhbHVlJ10KCiAgICAgICAgaWYgcHJveHlVc2VybmFtZSBhbmQgcHJveHlQYXNzd29yZCBhbmQgcHJveHlVUkwgYW5kIHByb3h5UG9ydDoKICAgICAgICAgICAgcmV0dXJuIHByb3h5VVJMICsgJzonICsgc3RyKHByb3h5UG9ydCkrJzonK3N0cihwcm94eVR5cGUpICsgJzonICsgcHJveHlVc2VybmFtZSArICdAJyArIHByb3h5UGFzc3dvcmQKICAgICAgICBlbGlmIHByb3h5VVJMIGFuZCBwcm94eVBvcnQ6CiAgICAgICAgICAgIHJldHVybiBwcm94eVVSTCArICc6JyArIHN0cihwcm94eVBvcnQpKyc6JytzdHIocHJveHlUeXBlKQogICAgZWxzZToKICAgICAgICByZXR1cm4gTm9uZQogICAgICAgIApkZWYgcGxheW1lZGlhd2l0aHByb3h5KG1lZGlhX3VybCwgbmFtZSwgaWNvbkltYWdlLHByb3h5aXAscG9ydCk6CgogICAgcHJvZ3Jlc3MgPSB4Ym1jZ3VpLkRpYWxvZ1Byb2dyZXNzKCkKICAgIHByb2dyZXNzLmNyZWF0ZSgnUHJvZ3Jlc3MnLCAnUGxheWluZyB3aXRoIGN1c3RvbSBwcm94eScpCiAgICBwcm9ncmVzcy51cGRhdGUoIDEwLCAiIiwgInNldHRpbmcgcHJveHkuLiIsICIiICkKICAgIHByb3h5c2V0PUZhbHNlCiAgICBleGlzdGluZ19wcm94eT0nJwogICAgdHJ5OgogICAgICAgIAogICAgICAgIGV4aXN0aW5nX3Byb3h5PWdldENvbmZpZ3VyZWRQcm94eSgpCiAgICAgICAgcHJpbnQgJ2V4aXN0aW5nX3Byb3h5JyxleGlzdGluZ19wcm94eQogICAgICAgICNyZWFkIGFuZCBzZXQgaGVyZQogICAgICAgIHNldEtvZGlQcm94eSggcHJveHlpcCArICc6JyArIHBvcnQrJzowJykKCiAgICAgICAgcHJpbnQgJ3Byb3h5IHNldHRpbmcgY29tcGxldGUnLCBnZXRDb25maWd1cmVkUHJveHkoKQogICAgICAgIHByb3h5c2V0PVRydWUKICAgICAgICBwcm9ncmVzcy51cGRhdGUoIDgwLCAiIiwgInNldHRpbmcgcHJveHkgY29tcGxldGUsIG5vdyBwbGF5aW5nIiwgIiIgKQogICAgICAgIHByb2dyZXNzLmNsb3NlKCkKICAgICAgICBwcm9ncmVzcz1Ob25lCiAgICAgICAgaW1wb3J0ICBDdXN0b21QbGF5ZXIKICAgICAgICBwbGF5ZXIgPSBDdXN0b21QbGF5ZXIuTXlYQk1DUGxheWVyKCkKICAgICAgICBsaXN0aXRlbSA9IHhibWNndWkuTGlzdEl0ZW0oIGxhYmVsID0gc3RyKG5hbWUpLCBpY29uSW1hZ2UgPSBpY29uSW1hZ2UsIHRodW1ibmFpbEltYWdlID0geGJtYy5nZXRJbmZvSW1hZ2UoICJMaXN0SXRlbS5UaHVtYiIgKSwgcGF0aD1tZWRpYV91cmwgKQogICAgICAgIHBsYXllci5wbGF5KCBtZWRpYV91cmwsbGlzdGl0ZW0pCiAgICAgICAgeGJtYy5zbGVlcCgxMDAwKQogICAgICAgIHdoaWxlIHBsYXllci5pc19hY3RpdmU6CiAgICAgICAgICAgIHhibWMuc2xlZXAoMjAwKQogICAgZXhjZXB0OgogICAgICAgIHRyYWNlYmFjay5wcmludF9leGMoKQogICAgaWYgcHJvZ3Jlc3M6CiAgICAgICAgcHJvZ3Jlc3MuY2xvc2UoKQogICAgaWYgcHJveHlzZXQ6CiAgICAgICAgcHJpbnQgJ25vdyByZXNldHRpbmcgdGhlIHByb3h5IGJhY2snCiAgICAgICAgc2V0S29kaVByb3h5KGV4aXN0aW5nX3Byb3h5KQogICAgICAgIHByaW50ICdyZXNldCBoZXJlJwogICAgcmV0dXJuICcnCgoKZGVmIGdldF9zYXdfcnRtcChwYWdlX3ZhbHVlLCByZWZlcmVyPU5vbmUpOgogICAgaWYgcmVmZXJlcjoKICAgICAgICByZWZlcmVyPVsoJ1JlZmVyZXInLHJlZmVyZXIpXQogICAgaWYgcGFnZV92YWx1ZS5zdGFydHN3aXRoKCJodHRwIik6CiAgICAgICAgcGFnZV91cmw9cGFnZV92YWx1ZQogICAgICAgIHBhZ2VfdmFsdWU9IGdldFVybChwYWdlX3ZhbHVlLGhlYWRlcnM9cmVmZXJlcikKCiAgICBzdHJfcGF0dGVybj0iKGV2YWxcKGZ1bmN0aW9uXChwLGEsYyxrLGUsKD86cnxkKS4qKSIKCiAgICByZWdfcmVzPXJlLmNvbXBpbGUoc3RyX3BhdHRlcm4pLmZpbmRhbGwocGFnZV92YWx1ZSkKICAgIHI9IiIKICAgIGlmIHJlZ19yZXMgYW5kIGxlbihyZWdfcmVzKT4wOgogICAgICAgIGZvciB2IGluIHJlZ19yZXM6CiAgICAgICAgICAgIHIxPWdldF91bnBhY2tlZCh2KQogICAgICAgICAgICByMj1yZV9tZShyMSwnXCcoLio/KVwnJykKICAgICAgICAgICAgaWYgJ3VuZXNjYXBlJyBpbiByMToKICAgICAgICAgICAgICAgIHIxPXVybGxpYi51bnF1b3RlKHIyKQogICAgICAgICAgICByKz1yMSsnXG4nCiAgICAgICAgcHJpbnQgJ2ZpbmFsIHZhbHVlIGlzICcscgoKICAgICAgICBwYWdlX3VybD1yZV9tZShyLCdzcmM9IiguKj8pIicpCgogICAgICAgIHBhZ2VfdmFsdWU9IGdldFVybChwYWdlX3VybCxoZWFkZXJzPXJlZmVyZXIpCgogICAgI3ByaW50IHBhZ2VfdmFsdWUKCiAgICBydG1wPXJlX21lKHBhZ2VfdmFsdWUsJ3N0cmVhbWVyXCcuKj9cJyguKj8pXCdcKScpCiAgICBwbGF5cGF0aD1yZV9tZShwYWdlX3ZhbHVlLCdmaWxlXCcsXHNcJyguKj8pXCcnKQoKCiAgICByZXR1cm4gcnRtcCsnIHBsYXlwYXRoPScrcGxheXBhdGggKycgcGFnZVVybD0nK3BhZ2VfdXJsCgpkZWYgZ2V0X2xldG9uX3J0bXAocGFnZV92YWx1ZSwgcmVmZXJlcj1Ob25lKToKICAgIGlmIHJlZmVyZXI6CiAgICAgICAgcmVmZXJlcj1bKCdSZWZlcmVyJyxyZWZlcmVyKV0KICAgIGlmIHBhZ2VfdmFsdWUuc3RhcnRzd2l0aCgiaHR0cCIpOgogICAgICAgIHBhZ2VfdmFsdWU9IGdldFVybChwYWdlX3ZhbHVlLGhlYWRlcnM9cmVmZXJlcikKICAgIHN0cl9wYXR0ZXJuPSJ2YXIgYSA9ICguKj8pO1xzKnZhciBiID0gKC4qPyk7XHMqdmFyIGMgPSAoLio/KTtccyp2YXIgZCA9ICguKj8pO1xzKnZhciBmID0gKC4qPyk7XHMqdmFyIHZfcGFydCA9ICcoLio/KSc7IgogICAgcmVnX3Jlcz1yZS5jb21waWxlKHN0cl9wYXR0ZXJuKS5maW5kYWxsKHBhZ2VfdmFsdWUpWzBdCgogICAgYSxiLGMsZCxmLHY9KHJlZ19yZXMpCiAgICBmPWludChmKQogICAgYT1pbnQoYSkvZgogICAgYj1pbnQoYikvZgogICAgYz1pbnQoYykvZgogICAgZD1pbnQoZCkvZgoKICAgIHJldD0gJ3J0bXA6Ly8nICsgc3RyKGEpICsgJy4nICsgc3RyKGIpICsgJy4nICsgc3RyKGMpICsgJy4nICsgc3RyKGQpICsgdjsKICAgIHJldHVybiByZXQKCmRlZiBjcmVhdGVNM3VGb3JEYXNoKHVybCx1c2VyYWdlbnQ9Tm9uZSk6CiAgICBzdHI9JyNFWFRNM1UnCiAgICBzdHIrPSdcbiNFWFQtWC1TVFJFQU0tSU5GOlBST0dSQU0tSUQ9MSxCQU5EV0lEVEg9MzYxODE2JwogICAgc3RyKz0nXG4nK3VybCsnJmJ5dGVzPTAtMjAwMDAwJyMrJ3xVc2VyLUFnZW50PScrdXNlcmFnZW50CiAgICBzb3VyY2VfZmlsZSA9IG9zLnBhdGguam9pbihwcm9maWxlLCAndGVzdGZpbGUubTN1JykKICAgIHN0cis9J1xuJwogICAgU2F2ZVRvRmlsZShzb3VyY2VfZmlsZSxzdHIpCiAgICAjcmV0dXJuICdDOi9Vc2Vycy9zaGFuaS9Eb3dubG9hZHMvdGVzdC5tM3U4JwogICAgcmV0dXJuIHNvdXJjZV9maWxlCgpkZWYgU2F2ZVRvRmlsZShmaWxlX25hbWUscGFnZV9kYXRhLGFwcGVuZD1GYWxzZSk6CiAgICBpZiBhcHBlbmQ6CiAgICAgICAgZiA9IG9wZW4oZmlsZV9uYW1lLCAnYScpCiAgICAgICAgZi53cml0ZShwYWdlX2RhdGEpCiAgICAgICAgZi5jbG9zZSgpCiAgICBlbHNlOgogICAgICAgIGY9b3BlbihmaWxlX25hbWUsJ3diJykKICAgICAgICBmLndyaXRlKHBhZ2VfZGF0YSkKICAgICAgICBmLmNsb3NlKCkKICAgICAgICByZXR1cm4gJycKCmRlZiBMb2FkRmlsZShmaWxlX25hbWUpOgogICAgZj1vcGVuKGZpbGVfbmFtZSwncmInKQogICAgZD1mLnJlYWQoKQogICAgZi5jbG9zZSgpCiAgICByZXR1cm4gZAoKZGVmIGdldF9wYWNrZWRfaXBob25ldHZfdXJsKHBhZ2VfZGF0YSk6CiAgICBpbXBvcnQgcmUsYmFzZTY0LHVybGxpYjsKICAgIHM9cGFnZV9kYXRhCiAgICB3aGlsZSAnZ2VoKCcgaW4gczoKICAgICAgICBpZiBzLnN0YXJ0c3dpdGgoJ2xvbCgnKTogcz1zWzU6LTFdCiMgICAgICAgcHJpbnQgJ3MgaXMgJyxzCiAgICAgICAgcz1yZS5jb21waWxlKCciKC4qPykiJykuZmluZGFsbChzKVswXTsKICAgICAgICBzPSAgYmFzZTY0LmI2NGRlY29kZShzKTsKICAgICAgICBzPXVybGxpYi51bnF1b3RlKHMpOwogICAgcHJpbnQgcwogICAgcmV0dXJuIHMKCmRlZiBnZXRfZmVycmFyaV91cmwocGFnZV9kYXRhKToKICAgIHByaW50ICdnZXRfZGFnX3VybDInLHBhZ2VfZGF0YQogICAgcGFnZV9kYXRhMj1nZXRVcmwocGFnZV9kYXRhKTsKICAgIHBhdHQ9JyhodHRwLiopJwogICAgaW1wb3J0IHV1aWQKICAgIHBsYXliYWNrPXN0cih1dWlkLnV1aWQxKCkpLnVwcGVyKCkKICAgIGxpbmtzPXJlLmNvbXBpbGUocGF0dCkuZmluZGFsbChwYWdlX2RhdGEyKQogICAgaGVhZGVycz1bKCdYLVBsYXliYWNrLVNlc3Npb24tSWQnLHBsYXliYWNrKV0KICAgIGZvciBsIGluIGxpbmtzOgogICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHBhZ2VfZGF0YXRlbXA9Z2V0VXJsKGwsaGVhZGVycz1oZWFkZXJzKTsKCiAgICAgICAgZXhjZXB0OiBwYXNzCgogICAgcmV0dXJuIHBhZ2VfZGF0YSsnfCZYLVBsYXliYWNrLVNlc3Npb24tSWQ9JytwbGF5YmFjawoKCmRlZiBnZXRfZGFnX3VybChwYWdlX2RhdGEpOgogICAgcHJpbnQgJ2dldF9kYWdfdXJsJyxwYWdlX2RhdGEKICAgIGlmIHBhZ2VfZGF0YS5zdGFydHN3aXRoKCdodHRwOi8vZGFnLnRvdGFsLXN0cmVhbS5uZXQnKToKICAgICAgICBoZWFkZXJzPVsoJ1VzZXItQWdlbnQnLCdWZXJpc21vLUJsYWNrVUlfKDIuNC43LjUuOC4wLjM0KScpXQogICAgICAgIHBhZ2VfZGF0YT1nZXRVcmwocGFnZV9kYXRhLGhlYWRlcnM9aGVhZGVycyk7CgogICAgaWYgJzEyNy4wLjAuMScgaW4gcGFnZV9kYXRhOgogICAgICAgIHJldHVybiByZXZpc3RfZGFnKHBhZ2VfZGF0YSkKICAgIGVsaWYgcmVfbWUocGFnZV9kYXRhLCAnd21zQXV0aFNpZ24lM0QoW14lJl0rKScpICE9ICcnOgogICAgICAgIGZpbmFsX3VybCA9IHJlX21lKHBhZ2VfZGF0YSwgJyZ2ZXJfdD0oW14mXSspJicpICsgJz93bXNBdXRoU2lnbj0nICsgcmVfbWUocGFnZV9kYXRhLCAnd21zQXV0aFNpZ24lM0QoW14lJl0rKScpICsgJz09L21wNDonICsgcmVfbWUocGFnZV9kYXRhLCAnXFw/eT0oW14mXSspJicpCiAgICBlbHNlOgogICAgICAgIGZpbmFsX3VybCA9IHJlX21lKHBhZ2VfZGF0YSwgJ2hyZWY9IihbXiJdKykiW14iXSskJykKICAgICAgICBpZiBsZW4oZmluYWxfdXJsKT09MDoKICAgICAgICAgICAgZmluYWxfdXJsPXBhZ2VfZGF0YQogICAgZmluYWxfdXJsID0gZmluYWxfdXJsLnJlcGxhY2UoJyAnLCAnJTIwJykKICAgIHJldHVybiBmaW5hbF91cmwKCmRlZiByZV9tZShkYXRhLCByZV9wYXR0ZW4pOgogICAgbWF0Y2ggPSAnJwogICAgbSA9IHJlLnNlYXJjaChyZV9wYXR0ZW4sIGRhdGEpCiAgICBpZiBtICE9IE5vbmU6CiAgICAgICAgbWF0Y2ggPSBtLmdyb3VwKDEpCiAgICBlbHNlOgogICAgICAgIG1hdGNoID0gJycKICAgIHJldHVybiBtYXRjaAoKZGVmIHJldmlzdF9kYWcocGFnZV9kYXRhKToKICAgIGZpbmFsX3VybCA9ICcnCiAgICBpZiAnMTI3LjAuMC4xJyBpbiBwYWdlX2RhdGE6CiAgICAgICAgZmluYWxfdXJsID0gcmVfbWUocGFnZV9kYXRhLCAnJnZlcl90PShbXiZdKykmJykgKyAnIGxpdmU9dHJ1ZSB0aW1lb3V0PTE1IHBsYXlwYXRoPScgKyByZV9tZShwYWdlX2RhdGEsICdcXD95PShbYS16QS1aMC05LV9cXC5AXSspJykKCiAgICBpZiByZV9tZShwYWdlX2RhdGEsICd0b2tlbj0oW14mXSspJicpICE9ICcnOgogICAgICAgIGZpbmFsX3VybCA9IGZpbmFsX3VybCArICc/dG9rZW49JyArIHJlX21lKHBhZ2VfZGF0YSwgJ3Rva2VuPShbXiZdKykmJykKICAgIGVsaWYgcmVfbWUocGFnZV9kYXRhLCAnd21zQXV0aFNpZ24lM0QoW14lJl0rKScpICE9ICcnOgogICAgICAgIGZpbmFsX3VybCA9IHJlX21lKHBhZ2VfZGF0YSwgJyZ2ZXJfdD0oW14mXSspJicpICsgJz93bXNBdXRoU2lnbj0nICsgcmVfbWUocGFnZV9kYXRhLCAnd21zQXV0aFNpZ24lM0QoW14lJl0rKScpICsgJz09L21wNDonICsgcmVfbWUocGFnZV9kYXRhLCAnXFw/eT0oW14mXSspJicpCiAgICBlbHNlOgogICAgICAgIGZpbmFsX3VybCA9IHJlX21lKHBhZ2VfZGF0YSwgJ0hSRUY9IihbXiJdKykiJykKCiAgICBpZiAnZGFnMS5hc3gnIGluIGZpbmFsX3VybDoKICAgICAgICByZXR1cm4gZ2V0X2RhZ191cmwoZmluYWxfdXJsKQoKICAgIGlmICdkZXZpbmxpdmVmcy5mcGxpdmUubmV0JyBub3QgaW4gZmluYWxfdXJsOgogICAgICAgIGZpbmFsX3VybCA9IGZpbmFsX3VybC5yZXBsYWNlKCdkZXZpbmxpdmUnLCAnZmxpdmUnKQogICAgaWYgJ3Blcm1saXZlZnMuZnBsaXZlLm5ldCcgbm90IGluIGZpbmFsX3VybDoKICAgICAgICBmaW5hbF91cmwgPSBmaW5hbF91cmwucmVwbGFjZSgncGVybWxpdmUnLCAnZmxpdmUnKQogICAgcmV0dXJuIGZpbmFsX3VybAoKCmRlZiBnZXRfdW53aXNlKCBzdHJfZXZhbCk6CiAgICBwYWdlX3ZhbHVlPSIiCiAgICB0cnk6CiAgICAgICAgc3M9IncsaSxzLGU9KCIrc3RyX2V2YWwrJyknCiAgICAgICAgZXhlYyAoc3MpCiAgICAgICAgcGFnZV92YWx1ZT11bndpc2VfZnVuYyh3LGkscyxlKQogICAgZXhjZXB0OiB0cmFjZWJhY2sucHJpbnRfZXhjKGZpbGU9c3lzLnN0ZG91dCkKICAgICNwcmludCAndW5wYWNrZWQnLHBhZ2VfdmFsdWUKICAgIHJldHVybiBwYWdlX3ZhbHVlCgpkZWYgdW53aXNlX2Z1bmMoIHcsIGksIHMsIGUpOgogICAgbElsbCA9IDA7CiAgICBsbDFJID0gMDsKICAgIElsMWwgPSAwOwogICAgbGwxbCA9IFtdOwogICAgbDFsSSA9IFtdOwogICAgd2hpbGUgVHJ1ZToKICAgICAgICBpZiAobElsbCA8IDUpOgogICAgICAgICAgICBsMWxJLmFwcGVuZCh3W2xJbGxdKQogICAgICAgIGVsaWYgKGxJbGwgPCBsZW4odykpOgogICAgICAgICAgICBsbDFsLmFwcGVuZCh3W2xJbGxdKTsKICAgICAgICBsSWxsKz0xOwogICAgICAgIGlmIChsbDFJIDwgNSk6CiAgICAgICAgICAgIGwxbEkuYXBwZW5kKGlbbGwxSV0pCiAgICAgICAgZWxpZiAobGwxSSA8IGxlbihpKSk6CiAgICAgICAgICAgIGxsMWwuYXBwZW5kKGlbbGwxSV0pCiAgICAgICAgbGwxSSs9MTsKICAgICAgICBpZiAoSWwxbCA8IDUpOgogICAgICAgICAgICBsMWxJLmFwcGVuZChzW0lsMWxdKQogICAgICAgIGVsaWYgKElsMWwgPCBsZW4ocykpOgogICAgICAgICAgICBsbDFsLmFwcGVuZChzW0lsMWxdKTsKICAgICAgICBJbDFsKz0xOwogICAgICAgIGlmIChsZW4odykgKyBsZW4oaSkgKyBsZW4ocykgKyBsZW4oZSkgPT0gbGVuKGxsMWwpICsgbGVuKGwxbEkpICsgbGVuKGUpKToKICAgICAgICAgICAgYnJlYWs7CgogICAgbEkxbCA9ICcnLmpvaW4obGwxbCkjLmpvaW4oJycpOwogICAgSTFsSSA9ICcnLmpvaW4obDFsSSkjLmpvaW4oJycpOwogICAgbGwxSSA9IDA7CiAgICBsMWxsID0gW107CiAgICBmb3IgbElsbCBpbiByYW5nZSgwLGxlbihsbDFsKSwyKToKICAgICAgICAjcHJpbnQgJ2FycmF5IGknLGxJbGwsbGVuKGxsMWwpCiAgICAgICAgbGwxMSA9IC0xOwogICAgICAgIGlmICggb3JkKEkxbElbbGwxSV0pICUgMik6CiAgICAgICAgICAgIGxsMTEgPSAxOwogICAgICAgICNwcmludCAndmFsIGlzICcsIGxJMWxbbElsbDogbElsbCsyXQogICAgICAgIGwxbGwuYXBwZW5kKGNociggICAgaW50KGxJMWxbbElsbDogbElsbCsyXSwgMzYpIC0gbGwxMSkpOwogICAgICAgIGxsMUkrPTE7CiAgICAgICAgaWYgKGxsMUkgPj0gbGVuKGwxbEkpKToKICAgICAgICAgICAgbGwxSSA9IDA7CiAgICByZXQ9Jycuam9pbihsMWxsKQogICAgaWYgJ2V2YWwoZnVuY3Rpb24odyxpLHMsZSknIGluIHJldDoKICAgICAgICBwcmludCAnU1RJTEwgR09pbmcnCiAgICAgICAgcmV0PXJlLmNvbXBpbGUoJ2V2YWxcKGZ1bmN0aW9uXCh3LGkscyxlXCkuKn1cKCguKj8pXCknKS5maW5kYWxsKHJldClbMF0KICAgICAgICByZXR1cm4gZ2V0X3Vud2lzZShyZXQpCiAgICBlbHNlOgogICAgICAgIHByaW50ICdGSU5JU0hFRCcKICAgICAgICByZXR1cm4gcmV0CgpkZWYgZ2V0X3VucGFja2VkKCBwYWdlX3ZhbHVlLCByZWdleF9mb3JfdGV4dD0nJywgaXRlcmF0aW9ucz0xLCB0b3RhbF9pdGVyYXRpb249MSk6CiAgICB0cnk6CiAgICAgICAgcmVnX2RhdGE9Tm9uZQogICAgICAgIGlmIHBhZ2VfdmFsdWUuc3RhcnRzd2l0aCgiaHR0cCIpOgogICAgICAgICAgICBwYWdlX3ZhbHVlPSBnZXRVcmwocGFnZV92YWx1ZSkKICAgICAgICBwcmludCAncGFnZV92YWx1ZScscGFnZV92YWx1ZQogICAgICAgIGlmIHJlZ2V4X2Zvcl90ZXh0IGFuZCBsZW4ocmVnZXhfZm9yX3RleHQpPjA6CiAgICAgICAgICAgIHBhZ2VfdmFsdWU9cmUuY29tcGlsZShyZWdleF9mb3JfdGV4dCkuZmluZGFsbChwYWdlX3ZhbHVlKVswXSAjZ2V0IHRoZSBqcyB2YXJpYWJsZQoKICAgICAgICBwYWdlX3ZhbHVlPXVucGFjayhwYWdlX3ZhbHVlLGl0ZXJhdGlvbnMsdG90YWxfaXRlcmF0aW9uKQogICAgZXhjZXB0OiB0cmFjZWJhY2sucHJpbnRfZXhjKGZpbGU9c3lzLnN0ZG91dCkKICAgIHByaW50ICd1bnBhY2tlZCcscGFnZV92YWx1ZQogICAgaWYgJ3NhdjFsaXZlLnR2JyBpbiBwYWdlX3ZhbHVlOgogICAgICAgIHBhZ2VfdmFsdWU9cGFnZV92YWx1ZS5yZXBsYWNlKCdzYXYxbGl2ZS50dicsJ3Nhd2xpdmUudHYnKSAjcXVpY2sgZml4IHNvbWUgYnVnIHNvbWV3aGVyZQogICAgICAgIHByaW50ICdzYXYxIHVucGFja2VkJyxwYWdlX3ZhbHVlCiAgICByZXR1cm4gcGFnZV92YWx1ZQoKZGVmIHVucGFjayhzSmF2YXNjcmlwdCxpdGVyYXRpb249MSwgdG90YWxpdGVyYXRpb25zPTIgICk6CiAgICBwcmludCAnaXRlcmF0aW9uJyxpdGVyYXRpb24KICAgIGlmIHNKYXZhc2NyaXB0LnN0YXJ0c3dpdGgoJ3ZhciBfMHhjYjhhPScpOgogICAgICAgIGFTcGxpdD1zSmF2YXNjcmlwdC5zcGxpdCgndmFyIF8weGNiOGE9JykKICAgICAgICBzcz0ibXlhcnJheT0iK2FTcGxpdFsxXS5zcGxpdCgiZXZhbCgiKVswXQogICAgICAgIGV4ZWMoc3MpCiAgICAgICAgYTE9NjIKICAgICAgICBjMT1pbnQoYVNwbGl0WzFdLnNwbGl0KCIsNjIsIilbMV0uc3BsaXQoJywnKVswXSkKICAgICAgICBwMT1teWFycmF5WzBdCiAgICAgICAgazE9bXlhcnJheVszXQogICAgICAgIHdpdGggb3BlbigndGVtcCBmaWxlJytzdHIoaXRlcmF0aW9uKSsnLmpzJywgIndiIikgYXMgZmlsZXdyaXRlcjoKICAgICAgICAgICAgZmlsZXdyaXRlci53cml0ZShzdHIoazEpKQogICAgICAgICNhYT0xLzAKICAgIGVsc2U6CgogICAgICAgIGlmICJybiBwfSgnIiBpbiBzSmF2YXNjcmlwdDoKICAgICAgICAgICAgYVNwbGl0ID0gc0phdmFzY3JpcHQuc3BsaXQoInJuIHB9KCciKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGFTcGxpdCA9IHNKYXZhc2NyaXB0LnNwbGl0KCJybiBBfSgnIikKICAgICAgICBwcmludCBhU3BsaXQKCiAgICAgICAgcDEsYTEsYzEsazE9KCcnLCcwJywnMCcsJycpCgogICAgICAgIHNzPSJwMSxhMSxjMSxrMT0oJyIrYVNwbGl0WzFdLnNwbGl0KCIuc3BsaSIpWzBdKycpJwogICAgICAgIGV4ZWMoc3MpCiAgICBrMT1rMS5zcGxpdCgnfCcpCiAgICBhU3BsaXQgPSBhU3BsaXRbMV0uc3BsaXQoIikpJyIpCiMgICAgcHJpbnQgJyBwIGFycmF5IGlzICcsbGVuKGFTcGxpdCkKIyAgIHByaW50IGxlbihhU3BsaXQgKQoKICAgICNwPXN0cihhU3BsaXRbMF0rJykpJykjLnJlcGxhY2UoIlxcIiwiIikjLnJlcGxhY2UoJ1xcXFwnLCdcXCcpCgogICAgI3ByaW50IGFTcGxpdFsxXQogICAgI2FTcGxpdCA9IGFTcGxpdFsxXS5zcGxpdCgiLCIpCiAgICAjcHJpbnQgYVNwbGl0WzBdCiAgICAjYSA9IGludChhU3BsaXRbMV0pCiAgICAjYyA9IGludChhU3BsaXRbMl0pCiAgICAjayA9IGFTcGxpdFszXS5zcGxpdCgiLiIpWzBdLnJlcGxhY2UoIiciLCAnJykuc3BsaXQoJ3wnKQogICAgI2E9aW50KGEpCiAgICAjYz1pbnQoYykKCiAgICAjcD1wLnJlcGxhY2UoJ1xcJywgJycpCiMgICAgcHJpbnQgJ3AgdmFsIGlzICcscFswOjEwMF0sJy4uLi4uLi4uLi4uLicscFstMTAwOl0sbGVuKHApCiMgICAgcHJpbnQgJ3AxIHZhbCBpcyAnLHAxWzA6MTAwXSwnLi4uLi4uLi4uLi4uJyxwMVstMTAwOl0sbGVuKHAxKQoKICAgICNwcmludCBhLGExCiAgICAjcHJpbnQgYyxhMQogICAgI3ByaW50ICdrIHZhbCBpcyAnLGtbLTEwOl0sbGVuKGspCiMgICAgcHJpbnQgJ2sxIHZhbCBpcyAnLGsxWy0xMDpdLGxlbihrMSkKICAgIGUgPSAnJwogICAgZCA9ICcnIzMyODIzCgogICAgI3NVbnBhY2tlZCA9IHN0cihfX3VucGFjayhwLCBhLCBjLCBrLCBlLCBkKSkKICAgIHNVbnBhY2tlZDEgPSBzdHIoX191bnBhY2socDEsIGExLCBjMSwgazEsIGUsIGQsaXRlcmF0aW9uKSkKCiAgICAjcHJpbnQgc1VucGFja2VkWzoyMDBdKycuLi4uJytzVW5wYWNrZWRbLTEwMDpdLCBsZW4oc1VucGFja2VkKQojICAgIHByaW50IHNVbnBhY2tlZDFbOjIwMF0rJy4uLi4nK3NVbnBhY2tlZDFbLTEwMDpdLCBsZW4oc1VucGFja2VkMSkKCiAgICAjZXhlYygnc1VucGFja2VkMT0iJytzVW5wYWNrZWQxKyciJykKICAgIGlmIGl0ZXJhdGlvbj49dG90YWxpdGVyYXRpb25zOgojICAgICAgICBwcmludCAnZmluYWwgcmVzJyxzVW5wYWNrZWQxWzoyMDBdKycuLi4uJytzVW5wYWNrZWQxWy0xMDA6XSwgbGVuKHNVbnBhY2tlZDEpCiAgICAgICAgcmV0dXJuIHNVbnBhY2tlZDEjLnJlcGxhY2UoJ1xcXFwnLCAnXFwnKQogICAgZWxzZToKIyAgICAgICAgcHJpbnQgJ2ZpbmFsIHJlcyBmb3IgdGhpcyBpdGVyYXRpb24gaXMnLGl0ZXJhdGlvbgogICAgICAgIHJldHVybiB1bnBhY2soc1VucGFja2VkMSxpdGVyYXRpb24rMSkjLnJlcGxhY2UoJ1xcJywgJycpLGl0ZXJhdGlvbikjLnJlcGxhY2UoJ1xcJywgJycpOyN1bnBhY2soc1VucGFja2VkLnJlcGxhY2UoJ1xcJywgJycpKQoKZGVmIF9fdW5wYWNrKHAsIGEsIGMsIGssIGUsIGQsIGl0ZXJhdGlvbix2PTEpOgoKICAgICN3aXRoIG9wZW4oJ2JlZm9yZSBmaWxlJytzdHIoaXRlcmF0aW9uKSsnLmpzJywgIndiIikgYXMgZmlsZXdyaXRlcjoKICAgICMgICAgZmlsZXdyaXRlci53cml0ZShzdHIocCkpCiAgICB3aGlsZSAoYyA+PSAxKToKICAgICAgICBjID0gYyAtMQogICAgICAgIGlmIChrW2NdKToKICAgICAgICAgICAgYWE9c3RyKF9faXRvYU5ldyhjLCBhKSkKICAgICAgICAgICAgaWYgdj09MToKICAgICAgICAgICAgICAgIHA9cmUuc3ViKCdcXGInICsgYWEgKydcXGInLCBrW2NdLCBwKSMgVEhJUyBJUyBCbG9vZHkgc2xvdyEKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHA9ZmluZEFuZFJlcGxhY2VXb3JkKHAsYWEsa1tjXSkKCiAgICAgICAgICAgICNwPWZpbmRBbmRSZXBsYWNlV29yZChwLGFhLGtbY10pCgoKICAgICN3aXRoIG9wZW4oJ2FmdGVyIGZpbGUnK3N0cihpdGVyYXRpb24pKycuanMnLCAid2IiKSBhcyBmaWxld3JpdGVyOgogICAgIyAgICBmaWxld3JpdGVyLndyaXRlKHN0cihwKSkKICAgIHJldHVybiBwCgojCiNmdW5jdGlvbiBlcXVhbGF2ZW50IHRvIHJlLnN1YignXFxiJyArIGFhICsnXFxiJywga1tjXSwgcCkKZGVmIGZpbmRBbmRSZXBsYWNlV29yZChzb3VyY2Vfc3RyLCB3b3JkX3RvX2ZpbmQscmVwbGFjZV93aXRoKToKICAgIHNwbGl0cz1Ob25lCiAgICBzcGxpdHM9c291cmNlX3N0ci5zcGxpdCh3b3JkX3RvX2ZpbmQpCiAgICBpZiBsZW4oc3BsaXRzKT4xOgogICAgICAgIG5ld19zdHJpbmc9W10KICAgICAgICBjdXJyZW50X2luZGV4PTAKICAgICAgICBmb3IgY3VycmVudF9zcGxpdCBpbiBzcGxpdHM6CiAgICAgICAgICAgICNwcmludCAnaGVyZScsaQogICAgICAgICAgICBuZXdfc3RyaW5nLmFwcGVuZChjdXJyZW50X3NwbGl0KQogICAgICAgICAgICB2YWw9d29yZF90b19maW5kI2J5IGRlZmF1bHQgYXNzdW1lIGl0IHdhcyB3cm9uZyB0byBzcGxpdAoKICAgICAgICAgICAgI2lmIGl0cyBmaXJzdCBvbmUgYW5kIGl0ZW0gaXMgYmxhbmsgdGhlbiBjaGVjayBuZXh0IGl0ZW0gaXMgdmFsaWQgb3Igbm90CiAgICAgICAgICAgIGlmIGN1cnJlbnRfaW5kZXg9PWxlbihzcGxpdHMpLTE6CiAgICAgICAgICAgICAgICB2YWw9JycgIyBsYXN0IG9uZSBub3RoaW5nIHRvIGFwcGVuZCBub3JtYWxseQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgaWYgbGVuKGN1cnJlbnRfc3BsaXQpPT0wOiAjaWYgYmxhbmsgY2hlY2sgbmV4dCBvbmUgd2l0aCBjdXJyZW50IHNwbGl0IHZhbHVlCiAgICAgICAgICAgICAgICAgICAgaWYgKCBsZW4oc3BsaXRzW2N1cnJlbnRfaW5kZXgrMV0pPT0wIGFuZCB3b3JkX3RvX2ZpbmRbMF0ubG93ZXIoKSBub3QgaW4gJ2FiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MTIzNDU2Nzg5MF8nKSBvciAobGVuKHNwbGl0c1tjdXJyZW50X2luZGV4KzFdKT4wICBhbmQgc3BsaXRzW2N1cnJlbnRfaW5kZXgrMV1bMF0ubG93ZXIoKSBub3QgaW4gJ2FiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MTIzNDU2Nzg5MF8nKTojIGZpcnN0IGp1c3QganVzdCBjaGVjayBuZXh0CiAgICAgICAgICAgICAgICAgICAgICAgIHZhbD1yZXBsYWNlX3dpdGgKICAgICAgICAgICAgICAgICNub3QgYmxhbmssIHRoZW4gY2hlY2sgY3VycmVudCBlbmR2YWx1ZSBhbmQgbmV4dCBmaXJzdCB2YWx1ZQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBpZiAoc3BsaXRzW2N1cnJlbnRfaW5kZXhdWy0xXS5sb3dlcigpIG5vdCBpbiAnYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXoxMjM0NTY3ODkwXycpIGFuZCAoKCBsZW4oc3BsaXRzW2N1cnJlbnRfaW5kZXgrMV0pPT0wIGFuZCB3b3JkX3RvX2ZpbmRbMF0ubG93ZXIoKSBub3QgaW4gJ2FiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MTIzNDU2Nzg5MF8nKSBvciAobGVuKHNwbGl0c1tjdXJyZW50X2luZGV4KzFdKT4wICBhbmQgc3BsaXRzW2N1cnJlbnRfaW5kZXgrMV1bMF0ubG93ZXIoKSBub3QgaW4gJ2FiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MTIzNDU2Nzg5MF8nKSk6IyBmaXJzdCBqdXN0IGp1c3QgY2hlY2sgbmV4dAogICAgICAgICAgICAgICAgICAgICAgICB2YWw9cmVwbGFjZV93aXRoCgogICAgICAgICAgICBuZXdfc3RyaW5nLmFwcGVuZCh2YWwpCiAgICAgICAgICAgIGN1cnJlbnRfaW5kZXgrPTEKICAgICAgICAjYWFhYT0xLzAKICAgICAgICBzb3VyY2Vfc3RyPScnLmpvaW4obmV3X3N0cmluZykKICAgIHJldHVybiBzb3VyY2Vfc3RyCgpkZWYgX19pdG9hKG51bSwgcmFkaXgpOgojICAgIHByaW50ICdudW0gcmVkJyxudW0sIHJhZGl4CiAgICByZXN1bHQgPSAiIgogICAgaWYgbnVtPT0wOiByZXR1cm4gJzAnCiAgICB3aGlsZSBudW0gPiAwOgogICAgICAgIHJlc3VsdCA9ICIwMTIzNDU2Nzg5YWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXoiW251bSAlIHJhZGl4XSArIHJlc3VsdAogICAgICAgIG51bSAvPSByYWRpeAogICAgcmV0dXJuIHJlc3VsdAoKZGVmIF9faXRvYU5ldyhjYywgYSk6CiAgICBhYT0iIiBpZiBjYyA8IGEgZWxzZSBfX2l0b2FOZXcoaW50KGNjIC8gYSksYSkKICAgIGNjID0gKGNjICUgYSkKICAgIGJiPWNocihjYyArIDI5KSBpZiBjYz4gMzUgZWxzZSBzdHIoX19pdG9hKGNjLDM2KSkKICAgIHJldHVybiBhYStiYgoKCmRlZiBnZXRDb29raWVzU3RyaW5nKGNvb2tpZUphcik6CiAgICB0cnk6CiAgICAgICAgY29va2llU3RyaW5nPSIiCiAgICAgICAgZm9yIGluZGV4LCBjb29raWUgaW4gZW51bWVyYXRlKGNvb2tpZUphcik6CiAgICAgICAgICAgIGNvb2tpZVN0cmluZys9Y29va2llLm5hbWUgKyAiPSIgKyBjb29raWUudmFsdWUgKyI7IgogICAgZXhjZXB0OiBwYXNzCiAgICAjcHJpbnQgJ2Nvb2tpZVN0cmluZycsY29va2llU3RyaW5nCiAgICByZXR1cm4gY29va2llU3RyaW5nCgoKZGVmIHNhdmVDb29raWVKYXIoY29va2llSmFyLENPT0tJRUZJTEUpOgogICAgdHJ5OgogICAgICAgIGNvbXBsZXRlX3BhdGg9b3MucGF0aC5qb2luKHByb2ZpbGUsQ09PS0lFRklMRSkKICAgICAgICBjb29raWVKYXIuc2F2ZShjb21wbGV0ZV9wYXRoLGlnbm9yZV9kaXNjYXJkPVRydWUpCiAgICBleGNlcHQ6IHBhc3MKCmRlZiBnZXRDb29raWVKYXIoQ09PS0lFRklMRSk6CgogICAgY29va2llSmFyPU5vbmUKICAgIGlmIENPT0tJRUZJTEU6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBjb21wbGV0ZV9wYXRoPW9zLnBhdGguam9pbihwcm9maWxlLENPT0tJRUZJTEUpCiAgICAgICAgICAgIGNvb2tpZUphciA9IGNvb2tpZWxpYi5MV1BDb29raWVKYXIoKQogICAgICAgICAgICBjb29raWVKYXIubG9hZChjb21wbGV0ZV9wYXRoLGlnbm9yZV9kaXNjYXJkPVRydWUpCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBjb29raWVKYXI9Tm9uZQoKICAgIGlmIG5vdCBjb29raWVKYXI6CiAgICAgICAgY29va2llSmFyID0gY29va2llbGliLkxXUENvb2tpZUphcigpCgogICAgcmV0dXJuIGNvb2tpZUphcgoKZGVmIGRvRXZhbChmdW5fY2FsbCxwYWdlX2RhdGEsQ29va2llX0phcixtKToKICAgIHJldF92YWw9JycKICAgIGlmIGZ1bmN0aW9uc19kaXIgbm90IGluIHN5cy5wYXRoOgogICAgICAgIHN5cy5wYXRoLmFwcGVuZChmdW5jdGlvbnNfZGlyKQoKICAgIHByaW50IGZ1bl9jYWxsCiAgICB0cnk6CiAgICAgICAgcHlfZmlsZT0naW1wb3J0ICcrZnVuX2NhbGwuc3BsaXQoJy4nKVswXQogICAgICAgIHByaW50IHB5X2ZpbGUsc3lzLnBhdGgKICAgICAgICBleGVjKCBweV9maWxlKQogICAgICAgIHByaW50ICdkb25lJwogICAgZXhjZXB0OgogICAgICAgIHByaW50ICdlcnJvciBpbiBpbXBvcnQnCiAgICAgICAgdHJhY2ViYWNrLnByaW50X2V4YyhmaWxlPXN5cy5zdGRvdXQpCiAgICBwcmludCAncmV0X3ZhbD0nK2Z1bl9jYWxsCiAgICBleGVjICgncmV0X3ZhbD0nK2Z1bl9jYWxsKQogICAgcHJpbnQgcmV0X3ZhbAogICAgI2V4ZWMoJ3JldF92YWw9MSsxJykKICAgIHJldHVybiBzdHIocmV0X3ZhbCkKCmRlZiBkb0V2YWxGdW5jdGlvbihmdW5fY2FsbCxwYWdlX2RhdGEsQ29va2llX0phcixtKToKICAgIHByaW50ICdkb0V2YWxGdW5jdGlvbicKICAgIHJldF92YWw9JycKICAgIGlmIGZ1bmN0aW9uc19kaXIgbm90IGluIHN5cy5wYXRoOgogICAgICAgIHN5cy5wYXRoLmFwcGVuZChmdW5jdGlvbnNfZGlyKQogICAgZj1vcGVuKGZ1bmN0aW9uc19kaXIrIi9MU1Byb2R5bmFtaWNDb2RlLnB5IiwidyIpCiAgICBmLndyaXRlKGZ1bl9jYWxsKTsKICAgIGYuY2xvc2UoKQogICAgaW1wb3J0IExTUHJvZHluYW1pY0NvZGUKICAgIHJldF92YWw9TFNQcm9keW5hbWljQ29kZS5HZXRMU1Byb0RhdGEocGFnZV9kYXRhLENvb2tpZV9KYXIsbSkKICAgIHJldHVybiBzdHIocmV0X3ZhbCkKCgpkZWYgcHJvY2Vzc1JlY2FwdGNoYSh1cmwpOgogICAgaHRtbF90ZXh0PWdldFVybCh1cmwpCiAgICByZWNhcENoYWxsZW5nZT0iIgogICAgc29sdXRpb249IiIKICAgIGNhcF9yZWc9IjxzY3JpcHQuKj9zcmM9XCIoLio/cmVjYXAuKj8pXCIiCiAgICBtYXRjaCA9cmUuZmluZGFsbChjYXBfcmVnLCBodG1sX3RleHQpCiAgICBjYXB0Y2hhPUZhbHNlCiAgICBjYXB0Y2hhX3JlbG9hZF9yZXNwb25zZV9jaGFsbD1Ob25lCiAgICBzb2x1dGlvbj1Ob25lCgogICAgaWYgbWF0Y2ggYW5kIGxlbihtYXRjaCk+MDogI25ldyBzaGlueSBjYXB0Y2hhIQogICAgICAgIGNhcHRjaGFfdXJsPW1hdGNoWzBdCiAgICAgICAgY2FwdGNoYT1UcnVlCgogICAgICAgIGNhcF9jaGFsbF9yZWc9J2NoYWxsZW5nZS4qP1wnKC4qPylcJycKICAgICAgICBjYXBfaW1hZ2VfcmVnPSdcJyguKj8pXCcnCiAgICAgICAgY2FwdGNoYV9zY3JpcHQ9Z2V0VXJsKGNhcHRjaGFfdXJsKQogICAgICAgIHJlY2FwQ2hhbGxlbmdlPXJlLmZpbmRhbGwoY2FwX2NoYWxsX3JlZywgY2FwdGNoYV9zY3JpcHQpWzBdCiAgICAgICAgY2FwdGNoYV9yZWxvYWQ9J2h0dHA6Ly93d3cuZ29vZ2xlLmNvbS9yZWNhcHRjaGEvYXBpL3JlbG9hZD9jPSc7CiAgICAgICAgY2FwdGNoYV9rPWNhcHRjaGFfdXJsLnNwbGl0KCdrPScpWzFdCiAgICAgICAgY2FwdGNoYV9yZWxvYWQrPXJlY2FwQ2hhbGxlbmdlKycmaz0nK2NhcHRjaGFfaysnJmNhcHRjaGFfaz0xJnR5cGU9aW1hZ2UmbGFuZz1lbi1HQicKICAgICAgICBjYXB0Y2hhX3JlbG9hZF9qcz1nZXRVcmwoY2FwdGNoYV9yZWxvYWQpCiAgICAgICAgY2FwdGNoYV9yZWxvYWRfcmVzcG9uc2VfY2hhbGw9cmUuZmluZGFsbChjYXBfaW1hZ2VfcmVnLCBjYXB0Y2hhX3JlbG9hZF9qcylbMF0KICAgICAgICBjYXB0Y2hhX2ltYWdlX3VybD0naHR0cDovL3d3dy5nb29nbGUuY29tL3JlY2FwdGNoYS9hcGkvaW1hZ2U/Yz0nK2NhcHRjaGFfcmVsb2FkX3Jlc3BvbnNlX2NoYWxsCiAgICAgICAgaWYgbm90IGNhcHRjaGFfaW1hZ2VfdXJsLnN0YXJ0c3dpdGgoImh0dHAiKToKICAgICAgICAgICAgY2FwdGNoYV9pbWFnZV91cmw9J2h0dHA6Ly93d3cuZ29vZ2xlLmNvbS9yZWNhcHRjaGEvYXBpLycrY2FwdGNoYV9pbWFnZV91cmwKICAgICAgICBpbXBvcnQgcmFuZG9tCiAgICAgICAgbj1yYW5kb20ucmFuZHJhbmdlKDEwMCwxMDAwLDUpCiAgICAgICAgbG9jYWxfY2FwdGNoYSA9IG9zLnBhdGguam9pbihwcm9maWxlLHN0cihuKSArImNhcHRjaGEuaW1nIiApCiAgICAgICAgbG9jYWxGaWxlID0gb3Blbihsb2NhbF9jYXB0Y2hhLCAid2IiKQogICAgICAgIGxvY2FsRmlsZS53cml0ZShnZXRVcmwoY2FwdGNoYV9pbWFnZV91cmwpKQogICAgICAgIGxvY2FsRmlsZS5jbG9zZSgpCiAgICAgICAgc29sdmVyID0gSW5wdXRXaW5kb3coY2FwdGNoYT1sb2NhbF9jYXB0Y2hhKQogICAgICAgIHNvbHV0aW9uID0gc29sdmVyLmdldCgpCiAgICAgICAgb3MucmVtb3ZlKGxvY2FsX2NhcHRjaGEpCiAgICByZXR1cm4gY2FwdGNoYV9yZWxvYWRfcmVzcG9uc2VfY2hhbGwgLHNvbHV0aW9uCgpkZWYgZ2V0VXJsKHVybCwgY29va2llSmFyPU5vbmUscG9zdD1Ob25lLCB0aW1lb3V0PTIwLCBoZWFkZXJzPU5vbmUpOgoKCiAgICBjb29raWVfaGFuZGxlciA9IHVybGxpYjIuSFRUUENvb2tpZVByb2Nlc3Nvcihjb29raWVKYXIpCiAgICBvcGVuZXIgPSB1cmxsaWIyLmJ1aWxkX29wZW5lcihjb29raWVfaGFuZGxlciwgdXJsbGliMi5IVFRQQmFzaWNBdXRoSGFuZGxlcigpLCB1cmxsaWIyLkhUVFBIYW5kbGVyKCkpCiAgICAjb3BlbmVyID0gdXJsbGliMi5pbnN0YWxsX29wZW5lcihvcGVuZXIpCiAgICByZXEgPSB1cmxsaWIyLlJlcXVlc3QodXJsKQogICAgcmVxLmFkZF9oZWFkZXIoJ1VzZXItQWdlbnQnLCdNb3ppbGxhLzUuMCAoV2luZG93cyBOVCA2LjE7IFdPVzY0KSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBDaHJvbWUvMzMuMC4xNzUwLjE1NCBTYWZhcmkvNTM3LjM2JykKICAgIGlmIGhlYWRlcnM6CiAgICAgICAgZm9yIGgsaHYgaW4gaGVhZGVyczoKICAgICAgICAgICAgcmVxLmFkZF9oZWFkZXIoaCxodikKCiAgICByZXNwb25zZSA9IG9wZW5lci5vcGVuKHJlcSxwb3N0LHRpbWVvdXQ9dGltZW91dCkKICAgIGxpbms9cmVzcG9uc2UucmVhZCgpCiAgICByZXNwb25zZS5jbG9zZSgpCiAgICByZXR1cm4gbGluazsKCmRlZiBnZXRfZGVjb2RlKHN0cixyZWc9Tm9uZSk6CiAgICBpZiByZWc6CiAgICAgICAgc3RyPXJlLmZpbmRhbGwocmVnLCBzdHIpWzBdCiAgICBzMSA9IHVybGxpYi51bnF1b3RlKHN0clswOiBsZW4oc3RyKS0xXSk7CiAgICB0ID0gJyc7CiAgICBmb3IgaSBpbiByYW5nZSggbGVuKHMxKSk6CiAgICAgICAgdCArPSBjaHIob3JkKHMxW2ldKSAtIHMxW2xlbihzMSktMV0pOwogICAgdD11cmxsaWIudW5xdW90ZSh0KQogICAgcHJpbnQgdAogICAgcmV0dXJuIHQKCmRlZiBqYXZhc2NyaXB0VW5Fc2NhcGUoc3RyKToKICAgIGpzPXJlLmZpbmRhbGwoJ3VuZXNjYXBlXChcJyguKj8pXCcnLHN0cikKICAgIHByaW50ICdqcycsanMKICAgIGlmIChub3QganM9PU5vbmUpIGFuZCBsZW4oanMpPjA6CiAgICAgICAgZm9yIGogaW4ganM6CiAgICAgICAgICAgICNwcmludCB1cmxsaWIudW5xdW90ZShqKQogICAgICAgICAgICBzdHI9c3RyLnJlcGxhY2UoaiAsdXJsbGliLnVucXVvdGUoaikpCiAgICByZXR1cm4gc3RyCgppaWQ9MApkZWYgYXNrQ2FwdGNoYShtLGh0bWxfcGFnZSwgY29va2llSmFyKToKICAgIGdsb2JhbCBpaWQKICAgIGlpZCs9MQogICAgZXhwcmU9IG1bJ2V4cHJlcyddCiAgICBwYWdlX3VybCA9IG1bJ3BhZ2UnXQogICAgY2FwdGNoYV9yZWdleD1yZS5jb21waWxlKCdcJExpdmVTdHJlYW1DYXB0Y2hhXFsoW15cXV0qKVxdJykuZmluZGFsbChleHByZSlbMF0KCiAgICBjYXB0Y2hhX3VybD1yZS5jb21waWxlKGNhcHRjaGFfcmVnZXgpLmZpbmRhbGwoaHRtbF9wYWdlKVswXQogICAgcHJpbnQgZXhwcmUsY2FwdGNoYV9yZWdleCxjYXB0Y2hhX3VybAogICAgaWYgbm90IGNhcHRjaGFfdXJsLnN0YXJ0c3dpdGgoImh0dHAiKToKICAgICAgICBwYWdlXz0naHR0cDovLycrIiIuam9pbihwYWdlX3VybC5zcGxpdCgnLycpWzI6M10pCiAgICAgICAgaWYgY2FwdGNoYV91cmwuc3RhcnRzd2l0aCgiLyIpOgogICAgICAgICAgICBjYXB0Y2hhX3VybD1wYWdlXytjYXB0Y2hhX3VybAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGNhcHRjaGFfdXJsPXBhZ2VfKycvJytjYXB0Y2hhX3VybAoKICAgIGxvY2FsX2NhcHRjaGEgPSBvcy5wYXRoLmpvaW4ocHJvZmlsZSwgc3RyKGlpZCkrImNhcHRjaGEuanBnIiApCiAgICBsb2NhbEZpbGUgPSBvcGVuKGxvY2FsX2NhcHRjaGEsICJ3YiIpCiAgICBwcmludCAnIGMgY2FwdXJsJyxjYXB0Y2hhX3VybAogICAgcmVxID0gdXJsbGliMi5SZXF1ZXN0KGNhcHRjaGFfdXJsKQogICAgcmVxLmFkZF9oZWFkZXIoJ1VzZXItQWdlbnQnLCAnTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgNi4xOyBydjoxNC4wKSBHZWNrby8yMDEwMDEwMSBGaXJlZm94LzE0LjAuMScpCiAgICBpZiAncmVmZXJlcicgaW4gbToKICAgICAgICByZXEuYWRkX2hlYWRlcignUmVmZXJlcicsIG1bJ3JlZmVyZXInXSkKICAgIGlmICdhZ2VudCcgaW4gbToKICAgICAgICByZXEuYWRkX2hlYWRlcignVXNlci1hZ2VudCcsIG1bJ2FnZW50J10pCiAgICBpZiAnc2V0Y29va2llJyBpbiBtOgogICAgICAgIHByaW50ICdhZGRpbmcgY29va2llJyxtWydzZXRjb29raWUnXQogICAgICAgIHJlcS5hZGRfaGVhZGVyKCdDb29raWUnLCBtWydzZXRjb29raWUnXSkKCiAgICAjY29va2llX2hhbmRsZXIgPSB1cmxsaWIyLkhUVFBDb29raWVQcm9jZXNzb3IoY29va2llSmFyKQogICAgI29wZW5lciA9IHVybGxpYjIuYnVpbGRfb3BlbmVyKGNvb2tpZV9oYW5kbGVyLCB1cmxsaWIyLkhUVFBCYXNpY0F1dGhIYW5kbGVyKCksIHVybGxpYjIuSFRUUEhhbmRsZXIoKSkKICAgICNvcGVuZXIgPSB1cmxsaWIyLmluc3RhbGxfb3BlbmVyKG9wZW5lcikKICAgIHVybGxpYjIudXJsb3BlbihyZXEpCiAgICByZXNwb25zZSA9IHVybGxpYjIudXJsb3BlbihyZXEpCgogICAgbG9jYWxGaWxlLndyaXRlKHJlc3BvbnNlLnJlYWQoKSkKICAgIHJlc3BvbnNlLmNsb3NlKCkKICAgIGxvY2FsRmlsZS5jbG9zZSgpCiAgICBzb2x2ZXIgPSBJbnB1dFdpbmRvdyhjYXB0Y2hhPWxvY2FsX2NhcHRjaGEpCiAgICBzb2x1dGlvbiA9IHNvbHZlci5nZXQoKQogICAgcmV0dXJuIHNvbHV0aW9uCgpkZWYgYXNrQ2FwdGNoYU5ldyhpbWFnZXJlZ2V4LGh0bWxfcGFnZSxjb29raWVKYXIsbSk6CiAgICBnbG9iYWwgaWlkCiAgICBpaWQrPTEKCgogICAgaWYgbm90IGltYWdlcmVnZXg9PScnOgogICAgICAgIGlmIGh0bWxfcGFnZS5zdGFydHN3aXRoKCJodHRwIik6CiAgICAgICAgICAgIHBhZ2VfPWdldFVybChodG1sX3BhZ2UsY29va2llSmFyPWNvb2tpZUphcikKICAgICAgICBlbHNlOgogICAgICAgICAgICBwYWdlXz1odG1sX3BhZ2UKICAgICAgICBjYXB0Y2hhX3VybD1yZS5jb21waWxlKGltYWdlcmVnZXgpLmZpbmRhbGwoaHRtbF9wYWdlKVswXQogICAgZWxzZToKICAgICAgICBjYXB0Y2hhX3VybD1odG1sX3BhZ2UKICAgICAgICBpZiAnb25lcGxheS50di9lbWJlZCcgaW4gaHRtbF9wYWdlOgogICAgICAgICAgICBpbXBvcnQgb25lcGxheQogICAgICAgICAgICBwYWdlXz1nZXRVcmwoaHRtbF9wYWdlLGNvb2tpZUphcj1jb29raWVKYXIpCiAgICAgICAgICAgIGNhcHRjaGFfdXJsPW9uZXBsYXkuZ2V0Q2FwdGNoYVVybChwYWdlXykKCiAgICBsb2NhbF9jYXB0Y2hhID0gb3MucGF0aC5qb2luKHByb2ZpbGUsIHN0cihpaWQpKyJjYXB0Y2hhLmpwZyIgKQogICAgbG9jYWxGaWxlID0gb3Blbihsb2NhbF9jYXB0Y2hhLCAid2IiKQogICAgcHJpbnQgJyBjIGNhcHVybCcsY2FwdGNoYV91cmwKICAgIHJlcSA9IHVybGxpYjIuUmVxdWVzdChjYXB0Y2hhX3VybCkKICAgIHJlcS5hZGRfaGVhZGVyKCdVc2VyLUFnZW50JywgJ01vemlsbGEvNS4wIChXaW5kb3dzIE5UIDYuMTsgcnY6MTQuMCkgR2Vja28vMjAxMDAxMDEgRmlyZWZveC8xNC4wLjEnKQogICAgaWYgJ3JlZmVyZXInIGluIG06CiAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ1JlZmVyZXInLCBtWydyZWZlcmVyJ10pCiAgICBpZiAnYWdlbnQnIGluIG06CiAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ1VzZXItYWdlbnQnLCBtWydhZ2VudCddKQogICAgaWYgJ2FjY2VwdCcgaW4gbToKICAgICAgICByZXEuYWRkX2hlYWRlcignQWNjZXB0JywgbVsnYWNjZXB0J10pCiAgICBpZiAnc2V0Y29va2llJyBpbiBtOgogICAgICAgIHByaW50ICdhZGRpbmcgY29va2llJyxtWydzZXRjb29raWUnXQogICAgICAgIHJlcS5hZGRfaGVhZGVyKCdDb29raWUnLCBtWydzZXRjb29raWUnXSkKCiAgICAjY29va2llX2hhbmRsZXIgPSB1cmxsaWIyLkhUVFBDb29raWVQcm9jZXNzb3IoY29va2llSmFyKQogICAgI29wZW5lciA9IHVybGxpYjIuYnVpbGRfb3BlbmVyKGNvb2tpZV9oYW5kbGVyLCB1cmxsaWIyLkhUVFBCYXNpY0F1dGhIYW5kbGVyKCksIHVybGxpYjIuSFRUUEhhbmRsZXIoKSkKICAgICNvcGVuZXIgPSB1cmxsaWIyLmluc3RhbGxfb3BlbmVyKG9wZW5lcikKICAgICN1cmxsaWIyLnVybG9wZW4ocmVxKQogICAgcmVzcG9uc2UgPSB1cmxsaWIyLnVybG9wZW4ocmVxKQoKICAgIGxvY2FsRmlsZS53cml0ZShyZXNwb25zZS5yZWFkKCkpCiAgICByZXNwb25zZS5jbG9zZSgpCiAgICBsb2NhbEZpbGUuY2xvc2UoKQogICAgc29sdmVyID0gSW5wdXRXaW5kb3coY2FwdGNoYT1sb2NhbF9jYXB0Y2hhKQogICAgc29sdXRpb24gPSBzb2x2ZXIuZ2V0KCkKICAgIHJldHVybiBzb2x1dGlvbgoKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiMgRnVuY3Rpb24gIDogR1VJRWRpdEV4cG9ydE5hbWUgICAgICAgICAgICAgICAgICAgICAgICAgIwojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKIyBQYXJhbWV0ZXIgOiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjCiMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIwojIG5hbWUgICAgICAgIHN1Z2VzdGVkIG5hbWUgZm9yIGV4cG9ydCAgICAgICAgICAgICAgICAgICMKIyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIAojIFJldHVybnMgICA6ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMKIyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjCiMgbmFtZSAgICAgICAgbmFtZSBvZiBleHBvcnQgZXhjbHVkaW5nIGFueSBleHRlbnNpb24gICAgIwojICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCmRlZiBUYWtlSW5wdXQobmFtZSwgaGVhZG5hbWUpOgoKCiAgICBrYiA9IHhibWMuS2V5Ym9hcmQoJ2RlZmF1bHQnLCAnaGVhZGluZycsIFRydWUpCiAgICBrYi5zZXREZWZhdWx0KG5hbWUpCiAgICBrYi5zZXRIZWFkaW5nKGhlYWRuYW1lKQogICAga2Iuc2V0SGlkZGVuSW5wdXQoRmFsc2UpCiAgICByZXR1cm4ga2IuZ2V0VGV4dCgpCgogICAKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCgpjbGFzcyBJbnB1dFdpbmRvdyh4Ym1jZ3VpLldpbmRvd0RpYWxvZyk6CiAgICBkZWYgX19pbml0X18oc2VsZiwgKmFyZ3MsICoqa3dhcmdzKToKICAgICAgICBzZWxmLmNwdGxvYyA9IGt3YXJncy5nZXQoJ2NhcHRjaGEnKQogICAgICAgIHNlbGYuaW1nID0geGJtY2d1aS5Db250cm9sSW1hZ2UoMzM1LDMwLDYyNCw2MCxzZWxmLmNwdGxvYykKICAgICAgICBzZWxmLmFkZENvbnRyb2woc2VsZi5pbWcpCiAgICAgICAgc2VsZi5rYmQgPSB4Ym1jLktleWJvYXJkKCkKCiAgICBkZWYgZ2V0KHNlbGYpOgogICAgICAgIHNlbGYuc2hvdygpCiAgICAgICAgdGltZS5zbGVlcCgyKQogICAgICAgIHNlbGYua2JkLmRvTW9kYWwoKQogICAgICAgIGlmIChzZWxmLmtiZC5pc0NvbmZpcm1lZCgpKToKICAgICAgICAgICAgdGV4dCA9IHNlbGYua2JkLmdldFRleHQoKQogICAgICAgICAgICBzZWxmLmNsb3NlKCkKICAgICAgICAgICAgcmV0dXJuIHRleHQKICAgICAgICBzZWxmLmNsb3NlKCkKICAgICAgICByZXR1cm4gRmFsc2UKCmRlZiBnZXRFcG9jVGltZSgpOgogICAgaW1wb3J0IHRpbWUKICAgIHJldHVybiBzdHIoaW50KHRpbWUudGltZSgpKjEwMDApKQoKZGVmIGdldEVwb2NUaW1lMigpOgogICAgaW1wb3J0IHRpbWUKICAgIHJldHVybiBzdHIoaW50KHRpbWUudGltZSgpKSkKCmRlZiBnZXRfcGFyYW1zKCk6CiAgICAgICAgcGFyYW09W10KICAgICAgICBwYXJhbXN0cmluZz1zeXMuYXJndlsyXQogICAgICAgIGlmIGxlbihwYXJhbXN0cmluZyk+PTI6CiAgICAgICAgICAgIHBhcmFtcz1zeXMuYXJndlsyXQogICAgICAgICAgICBjbGVhbmVkcGFyYW1zPXBhcmFtcy5yZXBsYWNlKCc/JywnJykKICAgICAgICAgICAgaWYgKHBhcmFtc1tsZW4ocGFyYW1zKS0xXT09Jy8nKToKICAgICAgICAgICAgICAgIHBhcmFtcz1wYXJhbXNbMDpsZW4ocGFyYW1zKS0yXQogICAgICAgICAgICBwYWlyc29mcGFyYW1zPWNsZWFuZWRwYXJhbXMuc3BsaXQoJyYnKQogICAgICAgICAgICBwYXJhbT17fQogICAgICAgICAgICBmb3IgaSBpbiByYW5nZShsZW4ocGFpcnNvZnBhcmFtcykpOgogICAgICAgICAgICAgICAgc3BsaXRwYXJhbXM9e30KICAgICAgICAgICAgICAgIHNwbGl0cGFyYW1zPXBhaXJzb2ZwYXJhbXNbaV0uc3BsaXQoJz0nKQogICAgICAgICAgICAgICAgaWYgKGxlbihzcGxpdHBhcmFtcykpPT0yOgogICAgICAgICAgICAgICAgICAgIHBhcmFtW3NwbGl0cGFyYW1zWzBdXT1zcGxpdHBhcmFtc1sxXQogICAgICAgIHJldHVybiBwYXJhbQoKCmRlZiBnZXRGYXZvcml0ZXMoKToKICAgICAgICBpdGVtcyA9IGpzb24ubG9hZHMob3BlbihmYXZvcml0ZXMpLnJlYWQoKSkKICAgICAgICB0b3RhbCA9IGxlbihpdGVtcykKICAgICAgICBmb3IgaSBpbiBpdGVtczoKICAgICAgICAgICAgbmFtZSA9IGlbMF0KICAgICAgICAgICAgdXJsID0gaVsxXQogICAgICAgICAgICBpY29uaW1hZ2UgPSBpWzJdCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGZhbkFydCA9IGlbM10KICAgICAgICAgICAgICAgIGlmIGZhbkFydCA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoJ3VzZV90aHVtYicpID09ICJ0cnVlIjoKICAgICAgICAgICAgICAgICAgICBmYW5BcnQgPSBpY29uaW1hZ2UKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgZmFuQXJ0ID0gZmFuYXJ0CiAgICAgICAgICAgIHRyeTogcGxheWxpc3QgPSBpWzVdCiAgICAgICAgICAgIGV4Y2VwdDogcGxheWxpc3QgPSBOb25lCiAgICAgICAgICAgIHRyeTogcmVnZXhzID0gaVs2XQogICAgICAgICAgICBleGNlcHQ6IHJlZ2V4cyA9IE5vbmUKCiAgICAgICAgICAgIGlmIGlbNF0gPT0gMDoKICAgICAgICAgICAgICAgIGFkZExpbmsodXJsLG5hbWUsaWNvbmltYWdlLGZhbkFydCwnJywnJywnJywnZmF2JyxwbGF5bGlzdCxyZWdleHMsdG90YWwpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBhZGREaXIobmFtZSx1cmwsaVs0XSxpY29uaW1hZ2UsZmFuYXJ0LCcnLCcnLCcnLCcnLCdmYXYnKQoKCmRlZiBhZGRGYXZvcml0ZShuYW1lLHVybCxpY29uaW1hZ2UsZmFuYXJ0LG1vZGUscGxheWxpc3Q9Tm9uZSxyZWdleHM9Tm9uZSk6CiAgICAgICAgZmF2TGlzdCA9IFtdCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIHNlZW1zIHRoYXQgYWZ0ZXIKICAgICAgICAgICAgbmFtZSA9IG5hbWUuZW5jb2RlKCd1dGYtOCcsICdpZ25vcmUnKQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgcGFzcwogICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKGZhdm9yaXRlcyk9PUZhbHNlOgogICAgICAgICAgICBhZGRvbl9sb2coJ01ha2luZyBGYXZvcml0ZXMgRmlsZScpCiAgICAgICAgICAgIGZhdkxpc3QuYXBwZW5kKChuYW1lLHVybCxpY29uaW1hZ2UsZmFuYXJ0LG1vZGUscGxheWxpc3QscmVnZXhzKSkKICAgICAgICAgICAgYSA9IG9wZW4oZmF2b3JpdGVzLCAidyIpCiAgICAgICAgICAgIGEud3JpdGUoanNvbi5kdW1wcyhmYXZMaXN0KSkKICAgICAgICAgICAgYS5jbG9zZSgpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgYWRkb25fbG9nKCdBcHBlbmRpbmcgRmF2b3JpdGVzJykKICAgICAgICAgICAgYSA9IG9wZW4oZmF2b3JpdGVzKS5yZWFkKCkKICAgICAgICAgICAgZGF0YSA9IGpzb24ubG9hZHMoYSkKICAgICAgICAgICAgZGF0YS5hcHBlbmQoKG5hbWUsdXJsLGljb25pbWFnZSxmYW5hcnQsbW9kZSkpCiAgICAgICAgICAgIGIgPSBvcGVuKGZhdm9yaXRlcywgInciKQogICAgICAgICAgICBiLndyaXRlKGpzb24uZHVtcHMoZGF0YSkpCiAgICAgICAgICAgIGIuY2xvc2UoKQoKCmRlZiBybUZhdm9yaXRlKG5hbWUpOgogICAgICAgIGRhdGEgPSBqc29uLmxvYWRzKG9wZW4oZmF2b3JpdGVzKS5yZWFkKCkpCiAgICAgICAgZm9yIGluZGV4IGluIHJhbmdlKGxlbihkYXRhKSk6CiAgICAgICAgICAgIGlmIGRhdGFbaW5kZXhdWzBdPT1uYW1lOgogICAgICAgICAgICAgICAgZGVsIGRhdGFbaW5kZXhdCiAgICAgICAgICAgICAgICBiID0gb3BlbihmYXZvcml0ZXMsICJ3IikKICAgICAgICAgICAgICAgIGIud3JpdGUoanNvbi5kdW1wcyhkYXRhKSkKICAgICAgICAgICAgICAgIGIuY2xvc2UoKQogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLkNvbnRhaW5lci5SZWZyZXNoIikKCmRlZiB1cmxzb2x2ZXIodXJsKToKICAgIGltcG9ydCB1cmxyZXNvbHZlcgogICAgaG9zdCA9IHVybHJlc29sdmVyLkhvc3RlZE1lZGlhRmlsZSh1cmwpCiAgICBpZiBob3N0OgogICAgICAgIHJlc29sdmVyID0gdXJscmVzb2x2ZXIucmVzb2x2ZSh1cmwpCiAgICAgICAgcmVzb2x2ZWQgPSByZXNvbHZlcgogICAgICAgIGlmIGlzaW5zdGFuY2UocmVzb2x2ZWQsbGlzdCk6CiAgICAgICAgICAgIGZvciBrIGluIHJlc29sdmVkOgogICAgICAgICAgICAgICAgcXVhbGl0eSA9IGFkZG9uLmdldFNldHRpbmcoJ3F1YWxpdHknKQogICAgICAgICAgICAgICAgaWYga1sncXVhbGl0eSddID09ICdIRCcgIDoKICAgICAgICAgICAgICAgICAgICByZXNvbHZlciA9IGtbJ3VybCddCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIGVsaWYga1sncXVhbGl0eSddID09ICdTRCcgOgogICAgICAgICAgICAgICAgICAgIHJlc29sdmVyID0ga1sndXJsJ10KICAgICAgICAgICAgICAgIGVsaWYga1sncXVhbGl0eSddID09ICcxMDgwcCcgYW5kIGFkZG9uLmdldFNldHRpbmcoJzEwODBwcXVhbGl0eScpID09ICd0cnVlJyA6CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZXIgPSBrWyd1cmwnXQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmVzb2x2ZXIgPSByZXNvbHZlZAogICAgZWxzZToKICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLk5vdGlmaWNhdGlvbihMaXZldHZkZXRvZG9zLFVybHJlc29sdmVyIGRvbm90IHN1cHBvcnQgdGhpcyBkb21haW4uIC0gLDUwMDApIikKICAgIHJldHVybiByZXNvbHZlcgpkZWYgcGxheV9wbGF5bGlzdChuYW1lLCBtdV9wbGF5bGlzdCxxdWV1ZVZpZGVvPU5vbmUpOgogICAgICAgIHBsYXlsaXN0ID0geGJtYy5QbGF5TGlzdCh4Ym1jLlBMQVlMSVNUX1ZJREVPKQoKICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCdhc2tfcGxheWxpc3RfaXRlbXMnKSA9PSAndHJ1ZScgYW5kIG5vdCBxdWV1ZVZpZGVvIDoKICAgICAgICAgICAgaW1wb3J0IHVybHBhcnNlCiAgICAgICAgICAgIG5hbWVzID0gW10KICAgICAgICAgICAgZm9yIGkgaW4gbXVfcGxheWxpc3Q6CiAgICAgICAgICAgICAgICBkX25hbWU9dXJscGFyc2UudXJscGFyc2UoaSkubmV0bG9jCiAgICAgICAgICAgICAgICBpZiBkX25hbWUgPT0gJyc6CiAgICAgICAgICAgICAgICAgICAgbmFtZXMuYXBwZW5kKG5hbWUpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIG5hbWVzLmFwcGVuZChkX25hbWUpCiAgICAgICAgICAgIGRpYWxvZyA9IHhibWNndWkuRGlhbG9nKCkKICAgICAgICAgICAgaW5kZXggPSBkaWFsb2cuc2VsZWN0KCdDaG9vc2UgYSB2aWRlbyBzb3VyY2UnLCBuYW1lcykKICAgICAgICAgICAgaWYgaW5kZXggPj0gMDoKICAgICAgICAgICAgICAgIGlmICImbW9kZT0xOSIgaW4gbXVfcGxheWxpc3RbaW5kZXhdOgogICAgICAgICAgICAgICAgICAgICNwbGF5c2V0cmVzb2x2ZWQgKHVybHNvbHZlcihtdV9wbGF5bGlzdFtpbmRleF0ucmVwbGFjZSgnJm1vZGU9MTknLCcnKSksbmFtZSxpY29uaW1hZ2UsVHJ1ZSkKICAgICAgICAgICAgICAgICAgICB4Ym1jLlBsYXllcigpLnBsYXkodXJsc29sdmVyKG11X3BsYXlsaXN0W2luZGV4XS5yZXBsYWNlKCcmbW9kZT0xOScsJycpLnJlcGxhY2UoJzsnLCcnKSkpCiAgICAgICAgICAgICAgICBlbGlmICIkZG9yZWdleCIgaW4gbXVfcGxheWxpc3RbaW5kZXhdIDoKICAgICAgICAgICAgICAgICAgICBwcmludCBtdV9wbGF5bGlzdFtpbmRleF0KICAgICAgICAgICAgICAgICAgICBzZXBhdGUgPSBtdV9wbGF5bGlzdFtpbmRleF0uc3BsaXQoJyZyZWdleHM9JykKICAgICAgICAgICAgICAgICAgICBwcmludCBzZXBhdGUKICAgICAgICAgICAgICAgICAgICB1cmwsc2V0cmVzb2x2ZWQgPSBnZXRSZWdleFBhcnNlZChzZXBhdGVbMV0sIHNlcGF0ZVswXSkKICAgICAgICAgICAgICAgICAgICB1cmwyID0gdXJsLnJlcGxhY2UoJzsnLCcnKQogICAgICAgICAgICAgICAgICAgIHhibWMuUGxheWVyKCkucGxheSh1cmwyKQoKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgdXJsID0gbXVfcGxheWxpc3RbaW5kZXhdCiAgICAgICAgICAgICAgICAgICAgeGJtYy5QbGF5ZXIoKS5wbGF5KHVybCkKICAgICAgICBlbGlmIG5vdCBxdWV1ZVZpZGVvOgogICAgICAgICAgICAjcGxheWxpc3QgPSB4Ym1jLlBsYXlMaXN0KDEpICMgMSBtZWFucyB2aWRlbwogICAgICAgICAgICBwbGF5bGlzdC5jbGVhcigpCiAgICAgICAgICAgIGl0ZW0gPSAwCiAgICAgICAgICAgIGZvciBpIGluIG11X3BsYXlsaXN0OgogICAgICAgICAgICAgICAgaXRlbSArPSAxCiAgICAgICAgICAgICAgICBpbmZvID0geGJtY2d1aS5MaXN0SXRlbSgnJXMpICVzJyAlKHN0cihpdGVtKSxuYW1lKSkKICAgICAgICAgICAgICAgICMgRG9uJ3QgZG8gdGhpcyBhcyByZWdleCBwYXJzZWQgbWlnaHQgdGFrZSBsb25nZXIKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBpZiAiJGRvcmVnZXgiIGluIGk6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlcGF0ZSA9IGkuc3BsaXQoJyZyZWdleHM9JykKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgc2VwYXRlCiAgICAgICAgICAgICAgICAgICAgICAgIHVybCxzZXRyZXNvbHZlZCA9IGdldFJlZ2V4UGFyc2VkKHNlcGF0ZVsxXSwgc2VwYXRlWzBdKQogICAgICAgICAgICAgICAgICAgIGVsaWYgIiZtb2RlPTE5IiBpbiBpOgogICAgICAgICAgICAgICAgICAgICAgICB1cmwgPSB1cmxzb2x2ZXIoaS5yZXBsYWNlKCcmbW9kZT0xOScsJycpLnJlcGxhY2UoJzsnLCcnKSkgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiB1cmw6CiAgICAgICAgICAgICAgICAgICAgICAgIHBsYXlsaXN0LmFkZCh1cmwsIGluZm8pCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgcmFpc2UKICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgICAgICAgICAgcGxheWxpc3QuYWRkKGksIGluZm8pCiAgICAgICAgICAgICAgICAgICAgcGFzcyAjeGJtYy5QbGF5ZXIoKS5wbGF5KHVybCkKCiAgICAgICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oJ3BsYXlsaXN0LnBsYXlvZmZzZXQodmlkZW8sMCknKQogICAgICAgIGVsc2U6CgogICAgICAgICAgICAgICAgbGlzdGl0ZW0gPSB4Ym1jZ3VpLkxpc3RJdGVtKG5hbWUpCiAgICAgICAgICAgICAgICBwbGF5bGlzdC5hZGQobXVfcGxheWxpc3QsIGxpc3RpdGVtKQoKCmRlZiBkb3dubG9hZF9maWxlKG5hbWUsIHVybCk6CiAgICAgICAgaWYgYWRkb24uZ2V0U2V0dGluZygnc2F2ZV9sb2NhdGlvbicpID09ICIiOgogICAgICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLk5vdGlmaWNhdGlvbignTGl2ZXR2ZGV0b2RvcycsJ0Nob29zZSBhIGxvY2F0aW9uIHRvIHNhdmUgZmlsZXMuJywxNTAwMCwiK2ljb24rIikiKQogICAgICAgICAgICBhZGRvbi5vcGVuU2V0dGluZ3MoKQogICAgICAgIHBhcmFtcyA9IHsndXJsJzogdXJsLCAnZG93bmxvYWRfcGF0aCc6IGFkZG9uLmdldFNldHRpbmcoJ3NhdmVfbG9jYXRpb24nKX0KICAgICAgICBkb3dubG9hZGVyLmRvd25sb2FkKG5hbWUsIHBhcmFtcykKICAgICAgICBkaWFsb2cgPSB4Ym1jZ3VpLkRpYWxvZygpCiAgICAgICAgcmV0ID0gZGlhbG9nLnllc25vKCdMaXZldHZkZXRvZG9zJywgJ0RvIHlvdSB3YW50IHRvIGFkZCB0aGlzIGZpbGUgYXMgYSBzb3VyY2U/JykKICAgICAgICBpZiByZXQ6CiAgICAgICAgICAgIGFkZFNvdXJjZShvcy5wYXRoLmpvaW4oYWRkb24uZ2V0U2V0dGluZygnc2F2ZV9sb2NhdGlvbicpLCBuYW1lKSkKCmRlZiBfc2VhcmNoKHVybCxuYW1lKToKICAgIyBwcmludCB1cmwsbmFtZQogICAgcGx1Z2luc2VhcmNodXJscyA9IFsncGx1Z2luOi8vcGx1Z2luLnZpZGVvLmdlbmVzaXMvP2FjdGlvbj1zaG93c19zZWFyY2gnLFwKICAgICAgICAgICAgICdwbHVnaW46Ly9wbHVnaW4udmlkZW8uZ2VuZXNpcy8/YWN0aW9uPW1vdmllc19zZWFyY2gnLFwKICAgICAgICAgICAgICdwbHVnaW46Ly9wbHVnaW4udmlkZW8uc2FsdHMvP21vZGU9c2VhcmNoJmFtcDtzZWN0aW9uPU1vdmllcycsXAogICAgICAgICAgICAgJ3BsdWdpbjovL3BsdWdpbi52aWRlby5zYWx0cy8/bW9kZT1zZWFyY2gmYW1wO3NlY3Rpb249VFYnLFwKICAgICAgICAgICAgICdwbHVnaW46Ly9wbHVnaW4udmlkZW8ubXVjaG1vdmllcy5oZC8/YWN0aW9uPW1vdmllc19zZWFyY2gnLFwKICAgICAgICAgICAgICdwbHVnaW46Ly9wbHVnaW4udmlkZW8udmlvb3ouY28vP2FjdGlvbj1yb290X3NlYXJjaCcsXAogICAgICAgICAgICAgJ3BsdWdpbjovL3BsdWdpbi52aWRlby5vcm9yb3R2Lz9hY3Rpb249c2hvd3Nfc2VhcmNoJyxcCiAgICAgICAgICAgICAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnlpZnltb3ZpZXMuaGQvP2FjdGlvbj1tb3ZpZXNfc2VhcmNoJyxcCiAgICAgICAgICAgICAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLmNhcnRvb25oZHR3by8/ZGVzY3JpcHRpb24mYW1wO2ZhbmFydCZhbXA7aWNvbmltYWdlJmFtcDttb2RlPTMmYW1wO25hbWU9U2VhcmNoJmFtcDt1cmw9dXJsJyxcCiAgICAgICAgICAgICAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnlvdXR1YmUva29kaW9uL3NlYXJjaC9saXN0LycsXAogICAgICAgICAgICAgJ3BsdWdpbjovL3BsdWdpbi52aWRlby5kYWlseW1vdGlvbl9jb20vP21vZGU9c2VhcmNoJmFtcDt1cmwnLFwKICAgICAgICAgICAgICdwbHVnaW46Ly9wbHVnaW4udmlkZW8udmltZW8va29kaW9uL3NlYXJjaC9saXN0LydcCiAgICAgICAgICAgICBdCiAgICBuYW1lcyA9IFsnR2Vuc2lzIFRWJywnR2VuZXNpcyBNb3ZpZScsJ1NhbHQgbW92aWUnLCdzYWx0IFRWJywnTXVjaG1vdmllcycsJ3Zpb296JywnT1Jvcm9UVicsXAogICAgICAgICAgICAgJ1lpZnltb3ZpZXMnLCdjYXJ0b29uSEQnLCdZb3V0dWJlJywnRGFpbHlNb3Rpb24nLCdWaW1lbyddCiAgICBkaWFsb2cgPSB4Ym1jZ3VpLkRpYWxvZygpCiAgICBpbmRleCA9IGRpYWxvZy5zZWxlY3QoJ0Nob29zZSBhIHZpZGVvIHNvdXJjZScsIG5hbWVzKQoKICAgIGlmIGluZGV4ID49IDA6CiAgICAgICAgdXJsID0gcGx1Z2luc2VhcmNodXJsc1tpbmRleF0KICAgICAgICBwcmludCAndXJsJyx1cmwKICAgICAgICBwbHVnaW5xdWVyeWJ5SlNPTih1cmwpCgpkZWYgYWRkRGlyKG5hbWUsdXJsLG1vZGUsaWNvbmltYWdlLGZhbmFydCxkZXNjcmlwdGlvbixnZW5yZSxkYXRlLGNyZWRpdHMsc2hvd2NvbnRleHQ9RmFsc2UscmVnZXhzPU5vbmUscmVnX3VybD1Ob25lLGFsbGluZm89e30pOgoKICAgICAgICB1PXN5cy5hcmd2WzBdKyI/dXJsPSIrdXJsbGliLnF1b3RlX3BsdXModXJsKSsiJm1vZGU9IitzdHIobW9kZSkrIiZuYW1lPSIrdXJsbGliLnF1b3RlX3BsdXMobmFtZSkrIiZmYW5hcnQ9Iit1cmxsaWIucXVvdGVfcGx1cyhmYW5hcnQpCiAgICAgICAgb2s9VHJ1ZQogICAgICAgIGlmIGRhdGUgPT0gJyc6CiAgICAgICAgICAgIGRhdGUgPSBOb25lCiAgICAgICAgZWxzZToKICAgICAgICAgICAgZGVzY3JpcHRpb24gKz0gJ1xuXG5EYXRlOiAlcycgJWRhdGUKICAgICAgICBsaXo9eGJtY2d1aS5MaXN0SXRlbShuYW1lLCBpY29uSW1hZ2U9IkRlZmF1bHRGb2xkZXIucG5nIiwgdGh1bWJuYWlsSW1hZ2U9aWNvbmltYWdlKQogICAgICAgIGlmIGxlbihhbGxpbmZvKSA8MSA6CiAgICAgICAgICAgIGxpei5zZXRJbmZvKHR5cGU9IlZpZGVvIiwgaW5mb0xhYmVscz17ICJUaXRsZSI6IG5hbWUsICJQbG90IjogZGVzY3JpcHRpb24sICJHZW5yZSI6IGdlbnJlLCAiZGF0ZWFkZGVkIjogZGF0ZSwgImNyZWRpdHMiOiBjcmVkaXRzIH0pCiAgICAgICAgZWxzZToKICAgICAgICAgICAgbGl6LnNldEluZm8odHlwZT0iVmlkZW8iLCBpbmZvTGFiZWxzPSBhbGxpbmZvKQogICAgICAgIGxpei5zZXRQcm9wZXJ0eSgiRmFuYXJ0X0ltYWdlIiwgZmFuYXJ0KQogICAgICAgIGlmIHNob3djb250ZXh0OgogICAgICAgICAgICBjb250ZXh0TWVudSA9IFtdCiAgICAgICAgICAgIHBhcmVudGFsYmxvY2sgPWFkZG9uLmdldFNldHRpbmcoJ3BhcmVudGFsYmxvY2tlZCcpCiAgICAgICAgICAgIHBhcmVudGFsYmxvY2s9IHBhcmVudGFsYmxvY2s9PSJ0cnVlIgogICAgICAgICAgICBwYXJlbnRhbGJsb2NrZWRwaW4gPWFkZG9uLmdldFNldHRpbmcoJ3BhcmVudGFsYmxvY2tlZHBpbicpCiMgICAgICAgICAgICBwcmludCAncGFyZW50YWxibG9ja2VkcGluJyxwYXJlbnRhbGJsb2NrZWRwaW4KICAgICAgICAgICAgaWYgbGVuKHBhcmVudGFsYmxvY2tlZHBpbik+MDoKICAgICAgICAgICAgICAgIGlmIHBhcmVudGFsYmxvY2s6CiAgICAgICAgICAgICAgICAgICAgY29udGV4dE1lbnUuYXBwZW5kKCgnRGlzYWJsZSBQYXJlbnRhbCBCbG9jaycsJ1hCTUMuUnVuUGx1Z2luKCVzP21vZGU9NTUmbmFtZT0lcyknICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpKSkpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgoJ0VuYWJsZSBQYXJlbnRhbCBCbG9jaycsJ1hCTUMuUnVuUGx1Z2luKCVzP21vZGU9NTYmbmFtZT0lcyknICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpKSkpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHNob3djb250ZXh0ID09ICdzb3VyY2UnOgogICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIG5hbWUgaW4gc3RyKFNPVVJDRVMpOgogICAgICAgICAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgoJ1JlbW92ZSBmcm9tIFNvdXJjZXMnLCdYQk1DLlJ1blBsdWdpbiglcz9tb2RlPTgmbmFtZT0lcyknICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpKSkpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGVsaWYgc2hvd2NvbnRleHQgPT0gJ2Rvd25sb2FkJzoKICAgICAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgoJ0Rvd25sb2FkJywnWEJNQy5SdW5QbHVnaW4oJXM/dXJsPSVzJm1vZGU9OSZuYW1lPSVzKScKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXModXJsKSwgdXJsbGliLnF1b3RlX3BsdXMobmFtZSkpKSkKICAgICAgICAgICAgZWxpZiBzaG93Y29udGV4dCA9PSAnZmF2JzoKICAgICAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgoJ1JlbW92ZSBmcm9tIExpdmV0dmRldG9kb3MgRmF2b3JpdGVzJywnWEJNQy5SdW5QbHVnaW4oJXM/bW9kZT02Jm5hbWU9JXMpJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSkpKQogICAgICAgICAgICBpZiBzaG93Y29udGV4dCA9PSAnISF1cGRhdGUnOgogICAgICAgICAgICAgICAgZmF2X3BhcmFtczIgPSAoCiAgICAgICAgICAgICAgICAgICAgJyVzP3VybD0lcyZtb2RlPTE3JnJlZ2V4cz0lcycKICAgICAgICAgICAgICAgICAgICAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyhyZWdfdXJsKSwgcmVnZXhzKQogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgoJ1tDT0xPUiB5ZWxsb3ddISF1cGRhdGVbL0NPTE9SXScsJ1hCTUMuUnVuUGx1Z2luKCVzKScgJWZhdl9wYXJhbXMyKSkKICAgICAgICAgICAgaWYgbm90IG5hbWUgaW4gRkFWOgogICAgICAgICAgICAgICAgY29udGV4dE1lbnUuYXBwZW5kKCgnQWRkIHRvIExpdmV0dmRldG9kb3MgRmF2b3JpdGVzJywnWEJNQy5SdW5QbHVnaW4oJXM/bW9kZT01Jm5hbWU9JXMmdXJsPSVzJmljb25pbWFnZT0lcyZmYW5hcnQ9JXMmZmF2X21vZGU9JXMpJwogICAgICAgICAgICAgICAgICAgICAgICAgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXMobmFtZSksIHVybGxpYi5xdW90ZV9wbHVzKHVybCksIHVybGxpYi5xdW90ZV9wbHVzKGljb25pbWFnZSksIHVybGxpYi5xdW90ZV9wbHVzKGZhbmFydCksIG1vZGUpKSkKICAgICAgICAgICAgbGl6LmFkZENvbnRleHRNZW51SXRlbXMoY29udGV4dE1lbnUpCiAgICAgICAgb2s9eGJtY3BsdWdpbi5hZGREaXJlY3RvcnlJdGVtKGhhbmRsZT1pbnQoc3lzLmFyZ3ZbMV0pLHVybD11LGxpc3RpdGVtPWxpeixpc0ZvbGRlcj1UcnVlKQogICAgICAgIHJldHVybiBvawpkZWYgeXRkbF9kb3dubG9hZCh1cmwsdGl0bGUsbWVkaWFfdHlwZT0ndmlkZW8nKToKICAgICMgcGxheSBpbiB4Ym1jIHdoaWxlIHBsYXlpbmcgZ28gYmFjayB0byBjb250ZXh0TWVudShjKSB0byAiISFEb3dubG9hZCEhIgogICAgIyBUcmlhbCB5YXNjZWVuOiBzZXBlcmF0ZSB8VXNlci1BZ2VudD0KICAgIGltcG9ydCB5b3V0dWJlZGwKICAgIGlmIG5vdCB1cmwgPT0gJyc6CiAgICAgICAgaWYgbWVkaWFfdHlwZT09ICdhdWRpbyc6CiAgICAgICAgICAgIHlvdXR1YmVkbC5zaW5nbGVfWUQodXJsLGRvd25sb2FkPVRydWUsYXVkaW89VHJ1ZSkKICAgICAgICBlbHNlOgogICAgICAgICAgICB5b3V0dWJlZGwuc2luZ2xlX1lEKHVybCxkb3dubG9hZD1UcnVlKQogICAgZWxpZiB4Ym1jLlBsYXllcigpLmlzUGxheWluZygpID09IFRydWUgOgogICAgICAgIGltcG9ydCBZRFN0cmVhbUV4dHJhY3RvcgogICAgICAgIGlmIFlEU3RyZWFtRXh0cmFjdG9yLmlzRG93bmxvYWRpbmcoKSA9PSBUcnVlOgoKICAgICAgICAgICAgWURTdHJlYW1FeHRyYWN0b3IubWFuYWdlRG93bmxvYWRzKCkKICAgICAgICBlbHNlOgogICAgICAgICAgICB4Ym1jX3VybCA9IHhibWMuUGxheWVyKCkuZ2V0UGxheWluZ0ZpbGUoKQoKICAgICAgICAgICAgeGJtY191cmwgPSB4Ym1jX3VybC5zcGxpdCgnfFVzZXItQWdlbnQ9JylbMF0KICAgICAgICAgICAgaW5mbyA9IHsndXJsJzp4Ym1jX3VybCwndGl0bGUnOnRpdGxlLCdtZWRpYV90eXBlJzptZWRpYV90eXBlfQogICAgICAgICAgICB5b3V0dWJlZGwuc2luZ2xlX1lEKCcnLGRvd25sb2FkPVRydWUsZGxfaW5mbz1pbmZvKQogICAgZWxzZToKICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLk5vdGlmaWNhdGlvbihET1dOTE9BRCxGaXJzdCBQbGF5IFtDT0xPUiB5ZWxsb3ddV0hJTEUgcGxheWluZyBkb3dubG9hZFsvQ09MT1JdICwxMDAwMCkiKQoKIyMgTHVuYXRpeHogUHNldWRvVFYgZmVhdHVyZQpkZWYgYXNjaWkoc3RyaW5nKToKICAgIGlmIGlzaW5zdGFuY2Uoc3RyaW5nLCBiYXNlc3RyaW5nKToKICAgICAgICBpZiBpc2luc3RhbmNlKHN0cmluZywgdW5pY29kZSk6CiAgICAgICAgICAgc3RyaW5nID0gc3RyaW5nLmVuY29kZSgnYXNjaWknLCAnaWdub3JlJykKICAgIHJldHVybiBzdHJpbmcKZGVmIHVuaShzdHJpbmcsIGVuY29kaW5nID0gJ3V0Zi04Jyk6CiAgICBpZiBpc2luc3RhbmNlKHN0cmluZywgYmFzZXN0cmluZyk6CiAgICAgICAgaWYgbm90IGlzaW5zdGFuY2Uoc3RyaW5nLCB1bmljb2RlKToKICAgICAgICAgICAgc3RyaW5nID0gdW5pY29kZShzdHJpbmcsIGVuY29kaW5nLCAnaWdub3JlJykKICAgIHJldHVybiBzdHJpbmcKZGVmIHJlbW92ZU5vbkFzY2lpKHMpOiByZXR1cm4gIiIuam9pbihmaWx0ZXIobGFtYmRhIHg6IG9yZCh4KTwxMjgsIHMpKQoKZGVmIHNlbmRKU09OKCBjb21tYW5kKToKICAgIGRhdGEgPSAnJwogICAgdHJ5OgogICAgICAgIGRhdGEgPSB4Ym1jLmV4ZWN1dGVKU09OUlBDKHVuaShjb21tYW5kKSkKICAgIGV4Y2VwdCBVbmljb2RlRW5jb2RlRXJyb3I6CiAgICAgICAgZGF0YSA9IHhibWMuZXhlY3V0ZUpTT05SUEMoYXNjaWkoY29tbWFuZCkpCgogICAgcmV0dXJuIHVuaShkYXRhKQoKZGVmIHBsdWdpbnF1ZXJ5YnlKU09OKHVybCxnaXZlX21lX3Jlc3VsdD1Ob25lLHBsYXlsaXN0PUZhbHNlKToKICAgIGlmICdhdWRpbycgaW4gdXJsOgogICAgICAgIGpzb25fcXVlcnkgPSB1bmkoJ3sianNvbnJwYyI6IjIuMCIsIm1ldGhvZCI6IkZpbGVzLkdldERpcmVjdG9yeSIsInBhcmFtcyI6IHsiZGlyZWN0b3J5IjoiJXMiLCJtZWRpYSI6InZpZGVvIiwgInByb3BlcnRpZXMiOiBbInRpdGxlIiwgImFsYnVtIiwgImFydGlzdCIsICJkdXJhdGlvbiIsInRodW1ibmFpbCIsICJ5ZWFyIl19LCAiaWQiOiAxfScpICV1cmwKICAgIGVsc2U6CiAgICAgICAganNvbl9xdWVyeSA9IHVuaSgneyJqc29ucnBjIjoiMi4wIiwibWV0aG9kIjoiRmlsZXMuR2V0RGlyZWN0b3J5IiwicGFyYW1zIjp7ImRpcmVjdG9yeSI6IiVzIiwibWVkaWEiOiJ2aWRlbyIsInByb3BlcnRpZXMiOlsgInBsb3QiLCJwbGF5Y291bnQiLCJkaXJlY3RvciIsICJnZW5yZSIsInZvdGVzIiwiZHVyYXRpb24iLCJ0cmFpbGVyIiwicHJlbWllcmVkIiwidGh1bWJuYWlsIiwidGl0bGUiLCJ5ZWFyIiwiZGF0ZWFkZGVkIiwiZmFuYXJ0IiwicmF0aW5nIiwic2Vhc29uIiwiZXBpc29kZSIsInN0dWRpbyIsIm1wYWEiXX0sImlkIjoxfScpICV1cmwKICAgIGpzb25fZm9sZGVyX2RldGFpbCA9IGpzb24ubG9hZHMoc2VuZEpTT04oanNvbl9xdWVyeSkpCiAgICAjcHJpbnQganNvbl9mb2xkZXJfZGV0YWlsCiAgICBpZiBnaXZlX21lX3Jlc3VsdDoKICAgICAgICByZXR1cm4ganNvbl9mb2xkZXJfZGV0YWlsCiAgICBpZiBqc29uX2ZvbGRlcl9kZXRhaWwuaGFzX2tleSgnZXJyb3InKToKICAgICAgICByZXR1cm4KICAgIGVsc2U6CgogICAgICAgIGZvciBpIGluIGpzb25fZm9sZGVyX2RldGFpbFsncmVzdWx0J11bJ2ZpbGVzJ10gOgogICAgICAgICAgICBtZXRhID17fQogICAgICAgICAgICB1cmwgPSBpWydmaWxlJ10KICAgICAgICAgICAgbmFtZSA9IHJlbW92ZU5vbkFzY2lpKGlbJ2xhYmVsJ10pCiAgICAgICAgICAgIHRodW1ibmFpbCA9IHJlbW92ZU5vbkFzY2lpKGlbJ3RodW1ibmFpbCddKQogICAgICAgICAgICBmYW5hcnQgPSByZW1vdmVOb25Bc2NpaShpWydmYW5hcnQnXSkKICAgICAgICAgICAgbWV0YSA9IGRpY3QoKGssdikgZm9yIGssIHYgaW4gaS5pdGVyaXRlbXMoKSBpZiBub3QgdiA9PSAnMCcgb3Igbm90IHYgPT0gLTEgb3IgdiA9PSAnJykKICAgICAgICAgICAgbWV0YS5wb3AoImZpbGUiLCBOb25lKQogICAgICAgICAgICBpZiBpWydmaWxldHlwZSddID09ICdmaWxlJzoKICAgICAgICAgICAgICAgIGlmIHBsYXlsaXN0OgogICAgICAgICAgICAgICAgICAgIHBsYXlfcGxheWxpc3QobmFtZSx1cmwscXVldWVWaWRlbz0nMScpCiAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgYWRkTGluayh1cmwsbmFtZSx0aHVtYm5haWwsZmFuYXJ0LCcnLCcnLCcnLCcnLE5vbmUsJycsdG90YWw9bGVuKGpzb25fZm9sZGVyX2RldGFpbFsncmVzdWx0J11bJ2ZpbGVzJ10pLGFsbGluZm89bWV0YSkKICAgICAgICAgICAgICAgICAgICAjeGJtYy5leGVjdXRlYnVpbHRpbigiQ29udGFpbmVyLlNldFZpZXdNb2RlKDUwMCkiKQogICAgICAgICAgICAgICAgICAgIGlmIGlbJ3R5cGUnXSBhbmQgaVsndHlwZSddID09ICd0dnNob3cnIDoKICAgICAgICAgICAgICAgICAgICAgICAgeGJtY3BsdWdpbi5zZXRDb250ZW50KGludChzeXMuYXJndlsxXSksICd0dnNob3dzJykKICAgICAgICAgICAgICAgICAgICBlbGlmIGlbJ2VwaXNvZGUnXSA+IDAgOgogICAgICAgICAgICAgICAgICAgICAgICB4Ym1jcGx1Z2luLnNldENvbnRlbnQoaW50KHN5cy5hcmd2WzFdKSwgJ2VwaXNvZGVzJykKCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBhZGREaXIobmFtZSx1cmwsNTMsdGh1bWJuYWlsLGZhbmFydCwnJywnJywnJywnJyxhbGxpbmZvPW1ldGEpCiAgICAgICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQoKZGVmIGFkZExpbmsodXJsLG5hbWUsaWNvbmltYWdlLGZhbmFydCxkZXNjcmlwdGlvbixnZW5yZSxkYXRlLHNob3djb250ZXh0LHBsYXlsaXN0LHJlZ2V4cyx0b3RhbCxzZXRDb29raWU9IiIsYWxsaW5mbz17fSk6CiAgICAgICAgI3ByaW50ICd1cmwsbmFtZScsdXJsLG5hbWUKICAgICAgICBjb250ZXh0TWVudSA9W10KICAgICAgICBwYXJlbnRhbGJsb2NrID1hZGRvbi5nZXRTZXR0aW5nKCdwYXJlbnRhbGJsb2NrZWQnKQogICAgICAgIHBhcmVudGFsYmxvY2s9IHBhcmVudGFsYmxvY2s9PSJ0cnVlIgogICAgICAgIHBhcmVudGFsYmxvY2tlZHBpbiA9YWRkb24uZ2V0U2V0dGluZygncGFyZW50YWxibG9ja2VkcGluJykKIyAgICAgICAgcHJpbnQgJ3BhcmVudGFsYmxvY2tlZHBpbicscGFyZW50YWxibG9ja2VkcGluCiAgICAgICAgaWYgbGVuKHBhcmVudGFsYmxvY2tlZHBpbik+MDoKICAgICAgICAgICAgaWYgcGFyZW50YWxibG9jazoKICAgICAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgoJ0Rpc2FibGUgUGFyZW50YWwgQmxvY2snLCdYQk1DLlJ1blBsdWdpbiglcz9tb2RlPTU1Jm5hbWU9JXMpJyAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSkpKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgY29udGV4dE1lbnUuYXBwZW5kKCgnRW5hYmxlIFBhcmVudGFsIEJsb2NrJywnWEJNQy5SdW5QbHVnaW4oJXM/bW9kZT01NiZuYW1lPSVzKScgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXMobmFtZSkpKSkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICB0cnk6CiAgICAgICAgICAgIG5hbWUgPSBuYW1lLmVuY29kZSgndXRmLTgnKQogICAgICAgIGV4Y2VwdDogcGFzcwogICAgICAgIG9rID0gVHJ1ZQogICAgICAgIGlzRm9sZGVyPUZhbHNlCiAgICAgICAgaWYgcmVnZXhzOgogICAgICAgICAgICBtb2RlID0gJzE3JwogICAgICAgICAgICBpZiAnbGlzdHJlcGVhdCcgaW4gcmVnZXhzOgogICAgICAgICAgICAgICAgaXNGb2xkZXI9VHJ1ZQogICAgICAgICAgICAgICAgcHJpbnQgJ3NldHRpbmcgYXMgZm9sZGVyIGluIGxpbmsnCiAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgoJ1tDT0xPUiB3aGl0ZV0hIURvd25sb2FkIEN1cnJlbnRseSBQbGF5aW5nISFbL0NPTE9SXScsJ1hCTUMuUnVuUGx1Z2luKCVzP3VybD0lcyZtb2RlPTIxJm5hbWU9JXMpJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyh1cmwpLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSkpKQogICAgICAgIGVsaWYgIChhbnkoeCBpbiB1cmwgZm9yIHggaW4gcmVzb2x2ZV91cmwpIGFuZCAgdXJsLnN0YXJ0c3dpdGgoJ2h0dHAnKSkgb3IgdXJsLmVuZHN3aXRoKCcmbW9kZT0xOScpOgogICAgICAgICAgICB1cmw9dXJsLnJlcGxhY2UoJyZtb2RlPTE5JywnJykKICAgICAgICAgICAgbW9kZSA9ICcxOScKICAgICAgICAgICAgY29udGV4dE1lbnUuYXBwZW5kKCgnW0NPTE9SIHdoaXRlXSEhRG93bmxvYWQgQ3VycmVudGx5IFBsYXlpbmchIVsvQ09MT1JdJywnWEJNQy5SdW5QbHVnaW4oJXM/dXJsPSVzJm1vZGU9MjEmbmFtZT0lcyknCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKHVybCksIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpKSkpCiAgICAgICAgZWxpZiB1cmwuZW5kc3dpdGgoJyZtb2RlPTE4Jyk6CiAgICAgICAgICAgIHVybD11cmwucmVwbGFjZSgnJm1vZGU9MTgnLCcnKQogICAgICAgICAgICBtb2RlID0gJzE4JwogICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoKCdbQ09MT1Igd2hpdGVdISFEb3dubG9hZCEhWy9DT0xPUl0nLCdYQk1DLlJ1blBsdWdpbiglcz91cmw9JXMmbW9kZT0yMyZuYW1lPSVzKScKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXModXJsKSwgdXJsbGliLnF1b3RlX3BsdXMobmFtZSkpKSkKICAgICAgICAgICAgaWYgYWRkb24uZ2V0U2V0dGluZygnZGxhdWRpb29ubHknKSA9PSAndHJ1ZSc6CiAgICAgICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoKCchIURvd25sb2FkIFtDT0xPUiBzZWFibHVlXUF1ZGlvISFbL0NPTE9SXScsJ1hCTUMuUnVuUGx1Z2luKCVzP3VybD0lcyZtb2RlPTI0Jm5hbWU9JXMpJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXModXJsKSwgdXJsbGliLnF1b3RlX3BsdXMobmFtZSkpKSkKICAgICAgICBlbGlmIHVybC5zdGFydHN3aXRoKCdtYWduZXQ6P3h0PScpOgogICAgICAgICAgICBpZiAnJicgaW4gdXJsIGFuZCBub3QgJyZhbXA7JyBpbiB1cmwgOgogICAgICAgICAgICAgICAgdXJsID0gdXJsLnJlcGxhY2UoJyYnLCcmYW1wOycpCiAgICAgICAgICAgIHVybCA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8ucHVsc2FyL3BsYXk/dXJpPScgKyB1cmwKICAgICAgICAgICAgbW9kZSA9ICcxMicKICAgICAgICBlbHNlOgogICAgICAgICAgICBtb2RlID0gJzEyJwogICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoKCdbQ09MT1Igd2hpdGVdISFEb3dubG9hZCBDdXJyZW50bHkgUGxheWluZyEhWy9DT0xPUl0nLCdYQk1DLlJ1blBsdWdpbiglcz91cmw9JXMmbW9kZT0yMSZuYW1lPSVzKScKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXModXJsKSwgdXJsbGliLnF1b3RlX3BsdXMobmFtZSkpKSkKICAgICAgICBpZiAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnlvdXR1YmUvcGxheS8/dmlkZW9faWQ9JyBpbiB1cmw6CiAgICAgICAgICAgICAgeXRfYXVkaW9fdXJsID0gdXJsLnJlcGxhY2UoJ3BsdWdpbjovL3BsdWdpbi52aWRlby55b3V0dWJlL3BsYXkvP3ZpZGVvX2lkPScsJ2h0dHBzOi8vd3d3LnlvdXR1YmUuY29tL3dhdGNoP3Y9JykKICAgICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoKCchIURvd25sb2FkIFtDT0xPUiBibHVlXUF1ZGlvISFbL0NPTE9SXScsJ1hCTUMuUnVuUGx1Z2luKCVzP3VybD0lcyZtb2RlPTI0Jm5hbWU9JXMpJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKHl0X2F1ZGlvX3VybCksIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpKSkpCiAgICAgICAgdT1zeXMuYXJndlswXSsiPyIKICAgICAgICBwbGF5X2xpc3QgPSBGYWxzZQogICAgICAgIGlmIHBsYXlsaXN0OgogICAgICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCdhZGRfcGxheWxpc3QnKSA9PSAiZmFsc2UiOgogICAgICAgICAgICAgICAgdSArPSAidXJsPSIrdXJsbGliLnF1b3RlX3BsdXModXJsKSsiJm1vZGU9Iittb2RlCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICB1ICs9ICJtb2RlPTEzJm5hbWU9JXMmcGxheWxpc3Q9JXMiICUodXJsbGliLnF1b3RlX3BsdXMobmFtZSksIHVybGxpYi5xdW90ZV9wbHVzKHN0cihwbGF5bGlzdCkucmVwbGFjZSgnLCcsJ3x8JykpKQogICAgICAgICAgICAgICAgbmFtZSA9IG5hbWUgKyAnW0NPTE9SIG1hZ2VudGFdICgnICsgc3RyKGxlbihwbGF5bGlzdCkpICsgJyBpdGVtcyApWy9DT0xPUl0nCiAgICAgICAgICAgICAgICBwbGF5X2xpc3QgPSBUcnVlCiAgICAgICAgZWxzZToKICAgICAgICAgICAgdSArPSAidXJsPSIrdXJsbGliLnF1b3RlX3BsdXModXJsKSsiJm1vZGU9Iittb2RlCiAgICAgICAgaWYgcmVnZXhzOgogICAgICAgICAgICB1ICs9ICImcmVnZXhzPSIrcmVnZXhzCiAgICAgICAgaWYgbm90IHNldENvb2tpZSA9PSAnJzoKICAgICAgICAgICAgdSArPSAiJnNldENvb2tpZT0iK3VybGxpYi5xdW90ZV9wbHVzKHNldENvb2tpZSkKCiAgICAgICAgaWYgZGF0ZSA9PSAnJzoKICAgICAgICAgICAgZGF0ZSA9IE5vbmUKICAgICAgICBlbHNlOgogICAgICAgICAgICBkZXNjcmlwdGlvbiArPSAnXG5cbkRhdGU6ICVzJyAlZGF0ZQogICAgICAgIGxpej14Ym1jZ3VpLkxpc3RJdGVtKG5hbWUsIGljb25JbWFnZT0iRGVmYXVsdFZpZGVvLnBuZyIsIHRodW1ibmFpbEltYWdlPWljb25pbWFnZSkKICAgICAgICBpZiBsZW4oYWxsaW5mbykgPDE6CiAgICAgICAgICAgIGxpei5zZXRJbmZvKHR5cGU9IlZpZGVvIiwgaW5mb0xhYmVscz17ICJUaXRsZSI6IG5hbWUsICJQbG90IjogZGVzY3JpcHRpb24sICJHZW5yZSI6IGdlbnJlLCAiZGF0ZWFkZGVkIjogZGF0ZSB9KQoKICAgICAgICBlbHNlOgogICAgICAgICAgICBsaXouc2V0SW5mbyh0eXBlPSJWaWRlbyIsIGluZm9MYWJlbHM9YWxsaW5mbykKICAgICAgICBsaXouc2V0UHJvcGVydHkoIkZhbmFydF9JbWFnZSIsIGZhbmFydCkKICAgICAgICAKICAgICAgICBpZiAobm90IHBsYXlfbGlzdCkgYW5kIG5vdCBhbnkoeCBpbiB1cmwgZm9yIHggaW4gZ19pZ25vcmVTZXRSZXNvbHZlZCkgYW5kIG5vdCAnJFBMQVlFUlBST1hZJD0nIGluIHVybDojICAobm90IHVybC5zdGFydHN3aXRoKCdwbHVnaW46Ly9wbHVnaW4udmlkZW8uZjRtVGVzdGVyJykpOgogICAgICAgICAgICBpZiByZWdleHM6CiAgICAgICAgICAgICAgICAjcHJpbnQgdXJsbGliLnVucXVvdGVfcGx1cyhyZWdleHMpCiAgICAgICAgICAgICAgICBpZiAnJHB5RnVuY3Rpb246cGxheW1lZGlhKCcgbm90IGluIHVybGxpYi51bnF1b3RlX3BsdXMocmVnZXhzKSBhbmQgJ25vdHBsYXlhYmxlJyBub3QgaW4gdXJsbGliLnVucXVvdGVfcGx1cyhyZWdleHMpIGFuZCAnbGlzdHJlcGVhdCcgbm90IGluICB1cmxsaWIudW5xdW90ZV9wbHVzKHJlZ2V4cykgOgogICAgICAgICAgICAgICAgICAgICNwcmludCAnc2V0dGluZyBpc3BsYXlhYmxlJyx1cmwsIHVybGxpYi51bnF1b3RlX3BsdXMocmVnZXhzKSx1cmwKICAgICAgICAgICAgICAgICAgICBsaXouc2V0UHJvcGVydHkoJ0lzUGxheWFibGUnLCAndHJ1ZScpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBsaXouc2V0UHJvcGVydHkoJ0lzUGxheWFibGUnLCAndHJ1ZScpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgYWRkb25fbG9nKCAnTk9UIHNldHRpbmcgaXNwbGF5YWJsZScrdXJsKQogICAgICAgIGlmIHNob3djb250ZXh0OgogICAgICAgICAgICAjY29udGV4dE1lbnUgPSBbXQogICAgICAgICAgICBpZiBzaG93Y29udGV4dCA9PSAnZmF2JzoKICAgICAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgKICAgICAgICAgICAgICAgICAgICAoJ1JlbW92ZSBmcm9tIExpdmV0dmRldG9kb3MgRmF2b3JpdGVzJywnWEJNQy5SdW5QbHVnaW4oJXM/bW9kZT02Jm5hbWU9JXMpJwogICAgICAgICAgICAgICAgICAgICAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSkpCiAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgZWxpZiBub3QgbmFtZSBpbiBGQVY6CiAgICAgICAgICAgICAgICBmYXZfcGFyYW1zID0gKAogICAgICAgICAgICAgICAgICAgICclcz9tb2RlPTUmbmFtZT0lcyZ1cmw9JXMmaWNvbmltYWdlPSVzJmZhbmFydD0lcyZmYXZfbW9kZT0wJwogICAgICAgICAgICAgICAgICAgICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpLCB1cmxsaWIucXVvdGVfcGx1cyh1cmwpLCB1cmxsaWIucXVvdGVfcGx1cyhpY29uaW1hZ2UpLCB1cmxsaWIucXVvdGVfcGx1cyhmYW5hcnQpKQogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIGlmIHBsYXlsaXN0OgogICAgICAgICAgICAgICAgICAgIGZhdl9wYXJhbXMgKz0gJ3BsYXlsaXN0PScrdXJsbGliLnF1b3RlX3BsdXMoc3RyKHBsYXlsaXN0KS5yZXBsYWNlKCcsJywnfHwnKSkKICAgICAgICAgICAgICAgIGlmIHJlZ2V4czoKICAgICAgICAgICAgICAgICAgICBmYXZfcGFyYW1zICs9ICImcmVnZXhzPSIrcmVnZXhzCiAgICAgICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoKCdBZGQgdG8gTGl2ZXR2ZGV0b2RvcyBGYXZvcml0ZXMnLCdYQk1DLlJ1blBsdWdpbiglcyknICVmYXZfcGFyYW1zKSkKICAgICAgICAgICAgbGl6LmFkZENvbnRleHRNZW51SXRlbXMoY29udGV4dE1lbnUpCiAgICAgICAgaWYgbm90IHBsYXlsaXN0IGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoJ2FkZF9wbGF5bGlzdCcpID09ICJmYWxzZSI6CiAgICAgICAgICAgICAgICBwbGF5bGlzdF9uYW1lID0gbmFtZS5zcGxpdCgnKSAnKVsxXQogICAgICAgICAgICAgICAgY29udGV4dE1lbnVfID0gWwogICAgICAgICAgICAgICAgICAgICgnUGxheSAnK3BsYXlsaXN0X25hbWUrJyBQbGF5TGlzdCcsJ1hCTUMuUnVuUGx1Z2luKCVzP21vZGU9MTMmbmFtZT0lcyZwbGF5bGlzdD0lcyknCiAgICAgICAgICAgICAgICAgICAgICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKHBsYXlsaXN0X25hbWUpLCB1cmxsaWIucXVvdGVfcGx1cyhzdHIocGxheWxpc3QpLnJlcGxhY2UoJywnLCd8fCcpKSkpCiAgICAgICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgIGxpei5hZGRDb250ZXh0TWVudUl0ZW1zKGNvbnRleHRNZW51XykKICAgICAgICAjcHJpbnQgJ2FkZGluZycsbmFtZQogICAgICAgIG9rPXhibWNwbHVnaW4uYWRkRGlyZWN0b3J5SXRlbShoYW5kbGU9aW50KHN5cy5hcmd2WzFdKSx1cmw9dSxsaXN0aXRlbT1saXosdG90YWxJdGVtcz10b3RhbCxpc0ZvbGRlcj1pc0ZvbGRlcikKCiAgICAgICAgI3ByaW50ICdhZGRlZCcsbmFtZQogICAgICAgIHJldHVybiBvawoKICAgICAgICAKZGVmIHBsYXlzZXRyZXNvbHZlZCh1cmwsbmFtZSxpY29uaW1hZ2Usc2V0cmVzb2x2ZWQ9VHJ1ZSk6CiAgICBpZiBzZXRyZXNvbHZlZDoKICAgICAgICBsaXogPSB4Ym1jZ3VpLkxpc3RJdGVtKG5hbWUsIGljb25JbWFnZT1pY29uaW1hZ2UpCiAgICAgICAgbGl6LnNldEluZm8odHlwZT0nVmlkZW8nLCBpbmZvTGFiZWxzPXsnVGl0bGUnOm5hbWV9KQogICAgICAgIGxpei5zZXRQcm9wZXJ0eSgiSXNQbGF5YWJsZSIsInRydWUiKQogICAgICAgIGxpei5zZXRQYXRoKHVybCkKICAgICAgICB4Ym1jcGx1Z2luLnNldFJlc29sdmVkVXJsKGludChzeXMuYXJndlsxXSksIFRydWUsIGxpeikKICAgIGVsc2U6CiAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbignWEJNQy5SdW5QbHVnaW4oJyt1cmwrJyknKQoKCiMjIFRoYW5rcyB0byBkYXNjaGFja2EsIGFuIGVwZyBzY3JhcGVyIGZvciBodHRwOi8vaS50ZWxlYm95LmNoL3Byb2dyYW1tL3N0YXRpb25fc2VsZWN0LnBocAojIyAgaHR0cDovL2ZvcnVtLnhibWMub3JnL3Bvc3QucGhwP3A9OTM2MjI4JnBvc3Rjb3VudD0xMDc2CmRlZiBnZXRlcGcobGluayk6CiAgICAgICAgdXJsPXVybGxpYi51cmxvcGVuKGxpbmspCiAgICAgICAgc291cmNlPXVybC5yZWFkKCkKICAgICAgICB1cmwuY2xvc2UoKQogICAgICAgIHNvdXJjZTIgPSBzb3VyY2Uuc3BsaXQoIkpldHp0IikKICAgICAgICBzb3VyY2UzID0gc291cmNlMlsxXS5zcGxpdCgncHJvZ3JhbW0vZGV0YWlsLnBocD9jb25zdF9pZD0nKQogICAgICAgIHNvdXJjZXVocnplaXQgPSBzb3VyY2UzWzFdLnNwbGl0KCc8YnIgLz48YSBocmVmPSIvJykKICAgICAgICBub3d0aW1lID0gc291cmNldWhyemVpdFswXVs0MDpsZW4oc291cmNldWhyemVpdFswXSldCiAgICAgICAgc291cmNldGl0bGUgPSBzb3VyY2UzWzJdLnNwbGl0KCI8L2E+PC9wPjwvZGl2PiIpCiAgICAgICAgbm93dGl0bGUgPSBzb3VyY2V0aXRsZVswXVsxNzpsZW4oc291cmNldGl0bGVbMF0pXQogICAgICAgIG5vd3RpdGxlID0gbm93dGl0bGUuZW5jb2RlKCd1dGYtOCcpCiAgICAgICAgcmV0dXJuICIgIC0gIitub3d0aXRsZSsiIC0gIitub3d0aW1lCgoKZGVmIGdldF9lcGcodXJsLCByZWdleCk6CiAgICAgICAgZGF0YSA9IG1ha2VSZXF1ZXN0KHVybCkKICAgICAgICB0cnk6CiAgICAgICAgICAgIGl0ZW0gPSByZS5maW5kYWxsKHJlZ2V4LCBkYXRhKVswXQogICAgICAgICAgICByZXR1cm4gaXRlbQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgYWRkb25fbG9nKCdyZWdleCBmYWlsZWQnKQogICAgICAgICAgICBhZGRvbl9sb2cocmVnZXgpCiAgICAgICAgICAgIHJldHVybgoKICAgIAojI25vdCBhIGdlbmVyaWMgaW1wbGVtZW5hdGlvbiBhcyBpdCBuZWVkcyB0byBjb252ZXJ0ICAgICAgICAgICAgCmRlZiBkMngoZCwgcm9vdD0icm9vdCIsbmVzdGVkPTApOgoKICAgIG9wID0gbGFtYmRhIHRhZzogJzwnICsgdGFnICsgJz4nCiAgICBjbCA9IGxhbWJkYSB0YWc6ICc8LycgKyB0YWcgKyAnPlxuJwogICAgbWwgPSBsYW1iZGEgdix4bWw6IHhtbCArIG9wKGtleSkgKyBzdHIodikgKyBjbChrZXkpCgogICAgeG1sID0gb3Aocm9vdCkgKyAnXG4nIGlmIHJvb3QgZWxzZSAiIgoKICAgIGZvciBrZXksdmwgaW4gZC5pdGVyaXRlbXMoKToKICAgICAgICB2dHlwZSA9IHR5cGUodmwpCiAgICAgICAgaWYgbmVzdGVkPT0wOiBrZXk9J3JlZ2V4JyAjZW5mb3JjaW5nIGFsbCB0b3AgbGV2ZWwgdGFncyB0byBiZSBuYW1lZCBhcyByZWdleAogICAgICAgIGlmIHZ0eXBlIGlzIGxpc3Q6IAogICAgICAgICAgICBmb3IgdiBpbiB2bDoKICAgICAgICAgICAgICAgIHY9ZXNjYXBlKHYpCiAgICAgICAgICAgICAgICB4bWwgPSBtbCh2LHhtbCkgICAgICAgICAKICAgICAgICAKICAgICAgICBpZiB2dHlwZSBpcyBkaWN0OiAKICAgICAgICAgICAgeG1sID0gbWwoJ1xuJyArIGQyeCh2bCxOb25lLG5lc3RlZCsxKSx4bWwpICAgICAgICAgCiAgICAgICAgaWYgdnR5cGUgaXMgbm90IGxpc3QgYW5kIHZ0eXBlIGlzIG5vdCBkaWN0OiAKICAgICAgICAgICAgaWYgbm90IHZsIGlzIE5vbmU6IHZsPWVzY2FwZSh2bCkKICAgICAgICAgICAgeG1sID0gbWwodmwseG1sKQoKICAgIHhtbCArPSBjbChyb290KSBpZiByb290IGVsc2UgIiIKCiAgICByZXR1cm4geG1sCnhibWNwbHVnaW4uc2V0Q29udGVudChpbnQoc3lzLmFyZ3ZbMV0pLCAnbW92aWVzJykKCnRyeToKICAgIHhibWNwbHVnaW4uYWRkU29ydE1ldGhvZChpbnQoc3lzLmFyZ3ZbMV0pLCB4Ym1jcGx1Z2luLlNPUlRfTUVUSE9EX1VOU09SVEVEKQpleGNlcHQ6CiAgICBwYXNzCnRyeToKICAgIHhibWNwbHVnaW4uYWRkU29ydE1ldGhvZChpbnQoc3lzLmFyZ3ZbMV0pLCB4Ym1jcGx1Z2luLlNPUlRfTUVUSE9EX0xBQkVMKQpleGNlcHQ6CiAgICBwYXNzCnRyeToKICAgIHhibWNwbHVnaW4uYWRkU29ydE1ldGhvZChpbnQoc3lzLmFyZ3ZbMV0pLCB4Ym1jcGx1Z2luLlNPUlRfTUVUSE9EX0RBVEUpCmV4Y2VwdDoKICAgIHBhc3MKdHJ5OgogICAgeGJtY3BsdWdpbi5hZGRTb3J0TWV0aG9kKGludChzeXMuYXJndlsxXSksIHhibWNwbHVnaW4uU09SVF9NRVRIT0RfR0VOUkUpCmV4Y2VwdDoKICAgIHBhc3MKCnBhcmFtcz1nZXRfcGFyYW1zKCkKCnVybD1Ob25lCm5hbWU9Tm9uZQptb2RlPU5vbmUKcGxheWxpc3Q9Tm9uZQppY29uaW1hZ2U9Tm9uZQpmYW5hcnQ9RkFOQVJUCnBsYXlsaXN0PU5vbmUKZmF2X21vZGU9Tm9uZQpyZWdleHM9Tm9uZQoKdHJ5OgogICAgdXJsPXVybGxpYi51bnF1b3RlX3BsdXMocGFyYW1zWyJ1cmwiXSkuZGVjb2RlKCd1dGYtOCcpCmV4Y2VwdDoKICAgIHBhc3MKdHJ5OgogICAgbmFtZT11cmxsaWIudW5xdW90ZV9wbHVzKHBhcmFtc1sibmFtZSJdKQpleGNlcHQ6CiAgICBwYXNzCnRyeToKICAgIGljb25pbWFnZT11cmxsaWIudW5xdW90ZV9wbHVzKHBhcmFtc1siaWNvbmltYWdlIl0pCmV4Y2VwdDoKICAgIHBhc3MKdHJ5OgogICAgZmFuYXJ0PXVybGxpYi51bnF1b3RlX3BsdXMocGFyYW1zWyJmYW5hcnQiXSkKZXhjZXB0OgogICAgcGFzcwp0cnk6CiAgICBtb2RlPWludChwYXJhbXNbIm1vZGUiXSkKZXhjZXB0OgogICAgcGFzcwp0cnk6CiAgICBwbGF5bGlzdD1ldmFsKHVybGxpYi51bnF1b3RlX3BsdXMocGFyYW1zWyJwbGF5bGlzdCJdKS5yZXBsYWNlKCd8fCcsJywnKSkKZXhjZXB0OgogICAgcGFzcwp0cnk6CiAgICBmYXZfbW9kZT1pbnQocGFyYW1zWyJmYXZfbW9kZSJdKQpleGNlcHQ6CiAgICBwYXNzCnRyeToKICAgIHJlZ2V4cz1wYXJhbXNbInJlZ2V4cyJdCmV4Y2VwdDoKICAgIHBhc3MKCmFkZG9uX2xvZygiTW9kZTogIitzdHIobW9kZSkpCgoKaWYgbm90IHVybCBpcyBOb25lOgogICAgYWRkb25fbG9nKCJVUkw6ICIrc3RyKHVybC5lbmNvZGUoJ3V0Zi04JykpKQphZGRvbl9sb2coIk5hbWU6ICIrc3RyKG5hbWUpKQoKaWYgbW9kZT09Tm9uZToKICAgIGFkZG9uX2xvZygiSW5kZXgiKQogICAgQ0hJbmRleCgpCgplbGlmIG1vZGU9PTE6CiAgICBhZGRvbl9sb2coImdldERhdGEiKQogICAgZGF0YT1Ob25lCiAgICBpZiByZWdleHM6CiAgICAgICAgZGF0YT1nZXRSZWdleFBhcnNlZChyZWdleHMsIHVybCkKICAgICAgICB1cmw9JycKICAgICAgICAjY3JlYXRlIHhtbCBoZXJlCiAgICBnZXREYXRhKHVybCxmYW5hcnQsZGF0YSkKICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkKCmVsaWYgbW9kZT09MjoKICAgIGFkZG9uX2xvZygiZ2V0Q2hhbm5lbEl0ZW1zIikKICAgIGdldENoYW5uZWxJdGVtcyhuYW1lLHVybCxmYW5hcnQpCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpCgplbGlmIG1vZGU9PTM6CiAgICBhZGRvbl9sb2coImdldFN1YkNoYW5uZWxJdGVtcyIpCiAgICBnZXRTdWJDaGFubmVsSXRlbXMobmFtZSx1cmwsZmFuYXJ0KQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQoKZWxpZiBtb2RlPT00OgogICAgYWRkb25fbG9nKCJnZXRGYXZvcml0ZXMiKQogICAgZ2V0RmF2b3JpdGVzKCkKICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkKCmVsaWYgbW9kZT09NToKICAgIGFkZG9uX2xvZygiYWRkRmF2b3JpdGUiKQogICAgdHJ5OgogICAgICAgIG5hbWUgPSBuYW1lLnNwbGl0KCdcXCAnKVsxXQogICAgZXhjZXB0OgogICAgICAgIHBhc3MKICAgIHRyeToKICAgICAgICBuYW1lID0gbmFtZS5zcGxpdCgnICAtICcpWzBdCiAgICBleGNlcHQ6CiAgICAgICAgcGFzcwogICAgYWRkRmF2b3JpdGUobmFtZSx1cmwsaWNvbmltYWdlLGZhbmFydCxmYXZfbW9kZSkKCmVsaWYgbW9kZT09NjoKICAgIGFkZG9uX2xvZygicm1GYXZvcml0ZSIpCiAgICB0cnk6CiAgICAgICAgbmFtZSA9IG5hbWUuc3BsaXQoJ1xcICcpWzFdCiAgICBleGNlcHQ6CiAgICAgICAgcGFzcwogICAgdHJ5OgogICAgICAgIG5hbWUgPSBuYW1lLnNwbGl0KCcgIC0gJylbMF0KICAgIGV4Y2VwdDoKICAgICAgICBwYXNzCiAgICBybUZhdm9yaXRlKG5hbWUpCgplbGlmIG1vZGU9PTc6CiAgICBhZGRvbl9sb2coImFkZFNvdXJjZSIpCiAgICBhZGRTb3VyY2UodXJsKQoKZWxpZiBtb2RlPT04OgogICAgYWRkb25fbG9nKCJybVNvdXJjZSIpCiAgICBybVNvdXJjZShuYW1lKQoKZWxpZiBtb2RlPT05OgogICAgYWRkb25fbG9nKCJkb3dubG9hZF9maWxlIikKICAgIGRvd25sb2FkX2ZpbGUobmFtZSwgdXJsKQoKZWxpZiBtb2RlPT0xMDoKICAgIGFkZG9uX2xvZygiZ2V0Q29tbXVuaXR5U291cmNlcyIpCiAgICBnZXRDb21tdW5pdHlTb3VyY2VzKCkKCmVsaWYgbW9kZT09MTE6CiAgICBhZGRvbl9sb2coImFkZFNvdXJjZSIpCiAgICBhZGRTb3VyY2UodXJsKQoKZWxpZiBtb2RlPT0xMjoKICAgIGFkZG9uX2xvZygic2V0UmVzb2x2ZWRVcmwiKQogICAgaWYgbm90IHVybC5zdGFydHN3aXRoKCJwbHVnaW46Ly9wbHVnaW4iKSBvciBub3QgYW55KHggaW4gdXJsIGZvciB4IGluIGdfaWdub3JlU2V0UmVzb2x2ZWQpOiNub3QgdXJsLnN0YXJ0c3dpdGgoInBsdWdpbjovL3BsdWdpbi52aWRlby5mNG1UZXN0ZXIiKSA6CiAgICAgICAgaXRlbSA9IHhibWNndWkuTGlzdEl0ZW0ocGF0aD11cmwpCiAgICAgICAgeGJtY3BsdWdpbi5zZXRSZXNvbHZlZFVybChpbnQoc3lzLmFyZ3ZbMV0pLCBUcnVlLCBpdGVtKQogICAgZWxzZToKICAgICAgICBwcmludCAnTm90IHNldHRpbmcgc2V0UmVzb2x2ZWRVcmwnCiAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbignWEJNQy5SdW5QbHVnaW4oJyt1cmwrJyknKQoKCmVsaWYgbW9kZT09MTM6CiAgICBhZGRvbl9sb2coInBsYXlfcGxheWxpc3QiKQogICAgcGxheV9wbGF5bGlzdChuYW1lLCBwbGF5bGlzdCkKCmVsaWYgbW9kZT09MTQ6CiAgICBhZGRvbl9sb2coImdldF94bWxfZGF0YWJhc2UiKQogICAgZ2V0X3htbF9kYXRhYmFzZSh1cmwpCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpCgplbGlmIG1vZGU9PTE1OgogICAgYWRkb25fbG9nKCJicm93c2VfeG1sX2RhdGFiYXNlIikKICAgIGdldF94bWxfZGF0YWJhc2UodXJsLCBUcnVlKQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQoKZWxpZiBtb2RlPT0xNjoKICAgIGFkZG9uX2xvZygiYnJvd3NlX2NvbW11bml0eSIpCiAgICBnZXRDb21tdW5pdHlTb3VyY2VzKHVybCxicm93c2U9VHJ1ZSkKICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkKCmVsaWYgbW9kZT09MTc6CiAgICBhZGRvbl9sb2coImdldFJlZ2V4UGFyc2VkIikKCiAgICBkYXRhPU5vbmUKICAgIGlmIHJlZ2V4cyBhbmQgJ2xpc3RyZXBlYXQnIGluIHVybGxpYi51bnF1b3RlX3BsdXMocmVnZXhzKToKICAgICAgICBsaXN0cmVwZWF0LHJldCxtLHJlZ2V4cyA9Z2V0UmVnZXhQYXJzZWQocmVnZXhzLCB1cmwpCiMgICAgICAgIHByaW50IGxpc3RsaW5rLGxpc3R0aXRsZSxsaXN0dGh1bWJuYWlsLHJldAogICAgICAgIGQ9JycKIyAgICAgICAgcHJpbnQgJ20gaXMnICwgbQojICAgICAgICBwcmludCAncmVnZXhzJyxyZWdleHMKICAgICAgICByZWdleG5hbWU9bVsnbmFtZSddCiAgICAgICAgZXhpc3RpbmdfbGlzdD1yZWdleHMucG9wKHJlZ2V4bmFtZSkKICMgICAgICAgcHJpbnQgJ2ZpbmFsIHJlZ2V4cycscmVnZXhzLHJlZ2V4bmFtZQogICAgICAgIHVybD0nJwogICAgICAgIGltcG9ydCBjb3B5CiAgICAgICAgbG49JycKICAgICAgICBybnVtYmVyPTAKICAgICAgICBmb3Igb2JqIGluIHJldDoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgcm51bWJlcis9MQogICAgICAgICAgICAgICAgbmV3Y29weT1jb3B5LmRlZXBjb3B5KHJlZ2V4cykKICAgICMgICAgICAgICAgICBwcmludCAnbmV3Y29weScsbmV3Y29weSwgbGVuKG5ld2NvcHkpCiAgICAgICAgICAgICAgICBsaXN0cmVwZWF0VD1saXN0cmVwZWF0CiAgICAgICAgICAgICAgICBpPTAKICAgICAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKGxlbihvYmopKToKICAgICMgICAgICAgICAgICAgICAgcHJpbnQgJ2kgaXMgJyxpLCBsZW4ob2JqKSwgbGVuKG5ld2NvcHkpCiAgICAgICAgICAgICAgICAgICAgaWYgbGVuKG5ld2NvcHkpPjA6CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciB0aGVfa2V5TywgdGhlX3ZhbHVlTyBpbiBuZXdjb3B5Lml0ZXJpdGVtcygpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdGhlX3ZhbHVlTyBpcyBub3QgTm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgdGhlX2tleSwgdGhlX3ZhbHVlIGluIHRoZV92YWx1ZU8uaXRlcml0ZW1zKCk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHRoZV92YWx1ZSBpcyBub3QgTm9uZTogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICAna2V5IGFuZCB2YWwnLHRoZV9rZXksIHRoZV92YWx1ZQogICAgICAgICMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICdhYScKICAgICAgICAjICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCAnWycgKyByZWdleG5hbWUrJy5wYXJhbScrc3RyKGkrMSkgKyAnXScKICAgICAgICAjICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCByZXByKG9ialtpXSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHR5cGUodGhlX3ZhbHVlKSBpcyBkaWN0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciB0aGVfa2V5bCwgdGhlX3ZhbHVlbCBpbiB0aGVfdmFsdWUuaXRlcml0ZW1zKCk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHRoZV92YWx1ZWwgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGVfdmFsdWVbdGhlX2tleWxdPXRoZV92YWx1ZWwucmVwbGFjZSgnWycgKyByZWdleG5hbWUrJy5wYXJhbScrc3RyKGkrMSkgKyAnXScsIG9ialtpXS5kZWNvZGUoJ3V0Zi04JykgKSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoZV92YWx1ZU9bdGhlX2tleV09dGhlX3ZhbHVlLnJlcGxhY2UoJ1snICsgcmVnZXhuYW1lKycucGFyYW0nK3N0cihpKzEpICsgJ10nLCBvYmpbaV0uZGVjb2RlKCd1dGYtOCcpICkKICAgICAgICAgICAgICAgICAgICBpZiBpc2luc3RhbmNlKG9iaix0dXBsZSk6CiAgICAgICAgICAgICAgICAgICAgICAgIGxpc3RyZXBlYXRUPWxpc3RyZXBlYXRULnJlcGxhY2UoJ1snICsgcmVnZXhuYW1lKycucGFyYW0nK3N0cihpKzEpICsgJ10nLG9ialtpXS5kZWNvZGUoJ3V0Zi04JykpIAogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIGxpc3RyZXBlYXRUPWxpc3RyZXBlYXRULnJlcGxhY2UoJ1snICsgcmVnZXhuYW1lKycucGFyYW0nK3N0cihpKzEpICsgJ10nLG9iai5kZWNvZGUoJ3V0Zi04JykpIAogICAgICAgICAgICAgICAgbGlzdHJlcGVhdFQ9bGlzdHJlcGVhdFQucmVwbGFjZSgnWycgKyByZWdleG5hbWUrJy5wYXJhbScrc3RyKDApICsgJ10nLHN0cihybnVtYmVyKSkgCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICNuZXdjb3B5ID0gdXJsbGliLnF1b3RlKHJlcHIobmV3Y29weSkpCiAgICAjICAgICAgICAgICAgcHJpbnQgJ25ldyByZWdleCBsaXN0JywgcmVwcihuZXdjb3B5KSwgcmVwcihsaXN0cmVwZWF0VCkKICAgICMgICAgICAgICAgICBhZGRMaW5rKGxpc3RsaW5rVCxsaXN0dGl0bGVULmVuY29kZSgndXRmLTgnLCAnaWdub3JlJyksbGlzdHRodW1ibmFpbFQsJycsJycsJycsJycsVHJ1ZSxOb25lLG5ld2NvcHksIGxlbihyZXQpKQogICAgICAgICAgICAgICAgcmVnZXhfeG1sPScnCiAgICAgICAgICAgICAgICBpZiBsZW4obmV3Y29weSk+MDoKICAgICAgICAgICAgICAgICAgICByZWdleF94bWw9ZDJ4KG5ld2NvcHksJ2xzcHJvcm9vdCcpCiAgICAgICAgICAgICAgICAgICAgcmVnZXhfeG1sPXJlZ2V4X3htbC5zcGxpdCgnPGxzcHJvcm9vdD4nKVsxXS5zcGxpdCgnPC9sc3Byb3Jvb3QnKVswXQogICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG4rPSdcbjxpdGVtPiVzXG4lczwvaXRlbT4nJShsaXN0cmVwZWF0VCxyZWdleF94bWwpICAgCiAgICAgICAgICAgIGV4Y2VwdDogdHJhY2ViYWNrLnByaW50X2V4YyhmaWxlPXN5cy5zdGRvdXQpCiMgICAgICAgICAgICBwcmludCByZXByKGxuKQojICAgICAgICAgICAgcHJpbnQgbmV3Y29weQogICAgICAgICAgICAgICAgCiMgICAgICAgICAgICBsbis9JzwvaXRlbT4nCiAgICAgICAgI2NyZWF0ZSB4bWwgaGVyZQogICAgICAgIGdldERhdGEoJycsJycsbG4pCiAgICAgICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQogICAgZWxzZToKICAgICAgICB1cmwsc2V0cmVzb2x2ZWQgPSBnZXRSZWdleFBhcnNlZChyZWdleHMsIHVybCkKICAgICAgICBpZiB1cmw6CiAgICAgICAgICAgIGlmICckUExBWUVSUFJPWFkkPScgaW4gdXJsOgogICAgICAgICAgICAgICAgdXJsLHByb3h5PXVybC5zcGxpdCgnJFBMQVlFUlBST1hZJD0nKQogICAgICAgICAgICAgICAgcHJpbnQgJ3Byb3h5Jyxwcm94eQogICAgICAgICAgICAgICAgcHJveHlpcCxwb3J0PXByb3h5LnNwbGl0KCc6JykKICAgICAgICAgICAgICAgIHBsYXltZWRpYXdpdGhwcm94eSh1cmwsbmFtZSxpY29uaW1hZ2UscHJveHlpcCxwb3J0ICkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHBsYXlzZXRyZXNvbHZlZCh1cmwsbmFtZSxpY29uaW1hZ2Usc2V0cmVzb2x2ZWQpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Ob3RpZmljYXRpb24oTGl2ZXR2ZGV0b2RvcyxGYWlsZWQgdG8gZXh0cmFjdCByZWdleC4gLSAiKyJ0aGlzIisiLDQwMDAsIitpY29uKyIpIikKZWxpZiBtb2RlPT0xODoKICAgIGFkZG9uX2xvZygieW91dHViZWRsIikKICAgIHRyeToKICAgICAgICBpbXBvcnQgeW91dHViZWRsCiAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuTm90aWZpY2F0aW9uKExpdmV0dmRldG9kb3MsUGxlYXNlIFtDT0xPUiB5ZWxsb3ddaW5zdGFsbCBZb3V0dWJlLWRsWy9DT0xPUl0gbW9kdWxlICwxMDAwMCwiIikiKQogICAgc3RyZWFtX3VybD15b3V0dWJlZGwuc2luZ2xlX1lEKHVybCkKICAgIHBsYXlzZXRyZXNvbHZlZChzdHJlYW1fdXJsLG5hbWUsaWNvbmltYWdlKQplbGlmIG1vZGU9PTE5OgogICAgYWRkb25fbG9nKCJHZW5lc2lzY29tbW9ucmVzb2x2ZXJzIikKICAgIHBsYXlzZXRyZXNvbHZlZCAodXJsc29sdmVyKHVybCksbmFtZSxpY29uaW1hZ2UsVHJ1ZSkKCmVsaWYgbW9kZT09MjE6CiAgICBhZGRvbl9sb2coImRvd25sb2FkIGN1cnJlbnQgZmlsZSB1c2luZyB5b3V0dWJlLWRsIHNlcnZpY2UiKQogICAgeXRkbF9kb3dubG9hZCgnJyxuYW1lLCd2aWRlbycpCmVsaWYgbW9kZT09MjM6CiAgICBhZGRvbl9sb2coImdldCBpbmZvIHRoZW4gZG93bmxvYWQiKQogICAgeXRkbF9kb3dubG9hZCh1cmwsbmFtZSwndmlkZW8nKQplbGlmIG1vZGU9PTI0OgogICAgYWRkb25fbG9nKCJBdWRpbyBvbmx5IHlvdXR1YmUgZG93bmxvYWQiKQogICAgeXRkbF9kb3dubG9hZCh1cmwsbmFtZSwnYXVkaW8nKQplbGlmIG1vZGU9PTI1OgogICAgYWRkb25fbG9nKCJTZWFyY2hpbiBPdGhlciBwbHVnaW5zIikKICAgIF9zZWFyY2godXJsLG5hbWUpCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpCmVsaWYgbW9kZT09NTU6CiAgICBhZGRvbl9sb2coImVuYWJsZWQgbG9jayIpCiAgICBwYXJlbnRhbGJsb2NrZWRwaW4gPWFkZG9uLmdldFNldHRpbmcoJ3BhcmVudGFsYmxvY2tlZHBpbicpCiAgICBrZXlib2FyZCA9IHhibWMuS2V5Ym9hcmQoJycsJ0VudGVyIFBpbicpCiAgICBrZXlib2FyZC5kb01vZGFsKCkKICAgIGlmIG5vdCAoa2V5Ym9hcmQuaXNDb25maXJtZWQoKSA9PSBGYWxzZSk6CiAgICAgICAgbmV3U3RyID0ga2V5Ym9hcmQuZ2V0VGV4dCgpCiAgICAgICAgaWYgbmV3U3RyPT1wYXJlbnRhbGJsb2NrZWRwaW46CiAgICAgICAgICAgIGFkZG9uLnNldFNldHRpbmcoJ3BhcmVudGFsYmxvY2tlZCcsICJmYWxzZSIpCiAgICAgICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuTm90aWZpY2F0aW9uKExpdmV0dmRldG9kb3MsUGFyZW50YWwgQmxvY2sgRGlzYWJsZWQsNTAwMCwiK2ljb24rIikiKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuTm90aWZpY2F0aW9uKExpdmV0dmRldG9kb3MsV3JvbmcgUGluPz8sNTAwMCwiK2ljb24rIikiKQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQplbGlmIG1vZGU9PTU2OgogICAgYWRkb25fbG9nKCJkaXNhYmxlIGxvY2siKQogICAgYWRkb24uc2V0U2V0dGluZygncGFyZW50YWxibG9ja2VkJywgInRydWUiKQogICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Ob3RpZmljYXRpb24oTGl2ZXR2ZGV0b2RvcyxQYXJlbnRhbCBibG9jayBlbmFibGVkLDUwMDAsIitpY29uKyIpIikKICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkKCmVsaWYgbW9kZT09NTM6CiAgICBhZGRvbl9sb2coIlJlcXVlc3RpbmcgSlNPTi1SUEMgSXRlbXMiKQogICAgcGx1Z2lucXVlcnlieUpTT04odXJsKQogICAgI3hibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSk=')